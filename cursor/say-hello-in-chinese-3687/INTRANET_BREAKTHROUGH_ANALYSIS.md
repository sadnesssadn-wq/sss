# ğŸ”¥ å†…ç½‘æ¸—é€ - å…³é”®å‘ç°åˆ†æ

## Phase 1 æµ‹è¯•ç»“æœ

### âŒ 1. JasperæŠ¥è¡¨SSRF
**çŠ¶æ€**: å¤±è´¥  
**é”™è¯¯**: `KhÃ´ng thá»ƒ láº¥y thÃ´ng tin phÃ¢n quyá»n` (æ— æ³•è·å–æƒé™ä¿¡æ¯)  
**åŸå› **: æƒé™æ£€æŸ¥å¤±è´¥ï¼Œå½“å‰è´¦æˆ·æ— æ³•è®¿é—®Jasperç«¯ç‚¹

---

### âŒ 2. downloadTemplate SSRF
**çŠ¶æ€**: å¤±è´¥  
**é”™è¯¯**: `IndexOutOfBoundsException: Index: 0, Size: 0`  
**åˆ†æ**: 
- åç«¯æœŸæœ›ä¸€ä¸ªéç©ºåˆ—è¡¨/æ•°ç»„
- å¯èƒ½éœ€è¦ç‰¹å®šçš„å‚æ•°ç»“æ„
- ä½ä¼˜å…ˆçº§ç»§ç»­ç ”ç©¶

---

### ğŸ”¥ 3. æ–‡ä»¶ä¸Šä¼ RCE - **çªç ´å£ï¼**

**çŠ¶æ€**: å‘ç°æ¼æ´ï¼  
**ç«¯ç‚¹**: `/khlbe/api/auth/uploadTemplate`

#### æµ‹è¯•ç»“æœè¯¦ç»†åˆ†æ

**æµ‹è¯•1**: `info={"name":"test.jsp","type":"template"}`
```json
Response: {"name":"test.jsp","type":"template"}
```
- **å…³é”®**: JSONè¢«echoå›æ¥ï¼Œè¯´æ˜è¢«è§£æäº†

**æµ‹è¯•2**: `info="test"` â­â­â­â­â­
```
Error: String index out of range: 9
Stack Trace:
  at java.lang.String.substring(String.java:1963)
  at AuthServicesImpl.uploadTemplate(AuthServicesImpl.java:29)
```

**å·¨å¤§ä¿¡æ¯æ³„éœ²**:
1. âœ… æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½**çœŸå®å­˜åœ¨**
2. âœ… `info`å‚æ•°è¢«åç«¯ä»£ç å¤„ç†
3. âœ… åœ¨`AuthServicesImpl.java`ç¬¬29è¡Œè°ƒç”¨`substring()`
4. âœ… ä»£ç å°è¯•æå–`info`å­—ç¬¦ä¸²çš„å­ä¸²ï¼Œèµ·å§‹ä½ç½®å¯èƒ½æ˜¯9
5. âœ… è¿™æš—ç¤º`info`å‚æ•°åº”è¯¥æ˜¯ä¸€ä¸ª**ç‰¹å®šé•¿åº¦çš„å­—ç¬¦ä¸²**æˆ–**ç‰¹å®šæ ¼å¼**

**æµ‹è¯•3**: `info={"filename":"test.jsp","category":"template","description":"test"}`
```json
Response: {"filename":"test.jsp","category":"template","description":"test"}
```
- å†æ¬¡echoå›æ¥ï¼Œä½†æ ¼å¼ä»ç„¶ä¸å¯¹

#### ğŸ¯ å…³é”®æ¨æ–­

ä»`substring(9)`é”™è¯¯æ¨æ–­:
- infoå‚æ•°å¯èƒ½æ˜¯å½¢å¦‚: `XXXXXXXXX_filename.ext`çš„æ ¼å¼
- å‰9ä¸ªå­—ç¬¦å¯èƒ½æ˜¯æŸç§å‰ç¼€/æ ‡è¯†ç¬¦
- æˆ–è€…infoæ˜¯Base64ç¼–ç çš„æ•°æ®
- æˆ–è€…infoæ˜¯ä¸€ä¸ªç‰¹æ®Šæ ¼å¼çš„ID

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

### Priority 1: åˆ†æinfoå‚æ•°æ ¼å¼ (15åˆ†é’Ÿ)

**æ–¹æ³•**:
1. æœç´¢`portal_uat_main.js`ä¸­çš„`uploadTemplate`è°ƒç”¨
2. æŸ¥æ‰¾infoå‚æ•°çš„æ„é€ æ–¹å¼
3. é€†å‘å·¥ç¨‹çœŸå®çš„infoæ ¼å¼

**å‘½ä»¤**:
```bash
# æœç´¢uploadTemplateè°ƒç”¨
strings /tmp/portal_uat_main.js | grep -A10 -B10 "uploadTemplate"

# æœç´¢infoå‚æ•°æ„é€ 
strings /tmp/portal_uat_main.js | grep -i "info.*=" | head -50
```

### Priority 2: æ„é€ æ­£ç¡®payload (15åˆ†é’Ÿ)

ä¸€æ—¦æ‰¾åˆ°infoæ ¼å¼:
1. åˆ›å»ºminimal JSP webshell
2. ä½¿ç”¨æ­£ç¡®çš„infoå‚æ•°ä¸Šä¼ 
3. å°è¯•è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶

### Priority 3: åˆ©ç”¨ (30åˆ†é’Ÿ)

å¦‚æœä¸Šä¼ æˆåŠŸ:
1. è®¿é—®webshell
2. æ‰§è¡Œå‘½ä»¤æ¢æµ‹å†…ç½‘
3. å°è¯•è®¿é—®172.23.0.22:8081
4. å°è¯•è®¿é—®192.168.68.160:5000/5001

---

## ğŸ“Š æˆåŠŸæ¦‚ç‡

| æ­¥éª¤ | æˆåŠŸç‡ | å½±å“ |
|------|--------|------|
| æ‰¾åˆ°infoæ ¼å¼ | 80% | â­â­â­â­â­ |
| æˆåŠŸä¸Šä¼ æ–‡ä»¶ | 60% | â­â­â­â­â­ |
| ç»•è¿‡æ–‡ä»¶ç±»å‹æ£€æŸ¥ | 50% | â­â­â­â­ |
| è®¿é—®ä¸Šä¼ æ–‡ä»¶ | 70% | â­â­â­â­â­ |
| è·å–webshell | 40% | â­â­â­â­â­ |

**ç»¼åˆæˆåŠŸç‡**: 40-60% (å¦‚æœæ‰¾åˆ°infoæ ¼å¼)

---

## ğŸ’¡ å¤‡ç”¨æ–¹æ¡ˆ

å¦‚æœæ–‡ä»¶ä¸Šä¼ å¤±è´¥:
1. æ·±å…¥ç ”ç©¶downloadTemplateçš„å‚æ•°
2. æµ‹è¯•å…¶ä»–æ–‡ä»¶æ“ä½œAPI
3. å¯»æ‰¾SQLæ³¨å…¥ç‚¹
4. æµ‹è¯•ååºåˆ—åŒ–æ¼æ´

