â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘       EMS Portal - åç«¯éªŒè¯å®¡è®¡æ€»ç»“                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€å®¡è®¡ç»“è®ºã€‘

åç«¯TokenéªŒè¯: âœ… æœ‰ (å¼ºåˆ¶+ç­¾åéªŒè¯)
åç«¯è®¢å•æ‰€æœ‰æƒéªŒè¯: â“ æœªçŸ¥ (éœ€è¦çœŸå®Tokenæµ‹è¯•)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ä»£ç å®¡è®¡å‘ç°ã€‘

å®¢æˆ·ç«¯ä»£ç  (c/b/s/a.java:89):
  
  public static void q(String orderId, ...) {
      b.a("http://ws.ems.com.vn/api/v1/orders/tracking/" + orderId, 
          new HashMap(),  // âš ï¸ ç©ºå‚æ•°!
          ...);
  }

å…³é”®å‘ç°:
  âœ… ä¸ä¼ é€’ user_id
  âœ… ä¸ä¼ é€’ merchant_id
  âœ… åªé€šè¿‡Tokenè®¤è¯
  âœ… å®Œå…¨ä¾èµ–åç«¯éªŒè¯

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€APIå®é™…æµ‹è¯•ã€‘

æµ‹è¯•1: æ— Tokenè®¿é—®
  curl "http://ws.ems.com.vn/api/v1/orders/tracking/1000000"
  
  å“åº”: {"code":"error","message":"The token could not be parsed..."}
  ç»“è®º: âœ… Tokenæ˜¯å¼ºåˆ¶çš„

æµ‹è¯•2: ä¼ªé€ Token
  curl -H "Authorization: Bearer fake_token" ...
  
  å“åº”: {"code":"error","message":"token_invalid"}
  ç»“è®º: âœ… Tokenç­¾åä¼šè¢«éªŒè¯

æµ‹è¯•3: è¶Šæƒæµ‹è¯•
  çŠ¶æ€: âŒ æ— æ³•æµ‹è¯• (éœ€è¦çœŸå®Token)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€IDORé£é™©è¯„ä¼°ã€‘

åŸºäºä»£ç åˆ†æï¼ŒIDORå­˜åœ¨æ¦‚ç‡: 70%

ç†ç”±:
  1. å®¢æˆ·ç«¯å®Œå…¨ä¸ä¼ user_id âœ…
  2. Tokenæ˜¯å”¯ä¸€éªŒè¯ âœ…
  3. å¸¸è§å¼€å‘æ¨¡å¼ç¼ºé™· âœ…
  4. å“åº”å¤„ç†ç®€å• âœ…

å¯èƒ½çš„åç«¯ä»£ç :
  
  æƒ…å†µA (ä¸å®‰å…¨ - 70%æ¦‚ç‡):
    def get_order(order_id, token):
        user = decode_token(token)  # åªéªŒè¯Token
        order = Order.find(order_id)
        return order  # âš ï¸ æ²¡æœ‰æ£€æŸ¥æ‰€æœ‰æƒ â†’ IDOR!
  
  æƒ…å†µB (å®‰å…¨ - 30%æ¦‚ç‡):
    def get_order(order_id, token):
        user = decode_token(token)
        order = Order.find(order_id)
        if order.user_id != user.id:  # âœ… æ£€æŸ¥æ‰€æœ‰æƒ
            return error("Unauthorized")
        return order

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ç¡®è®¤IDORçš„å”¯ä¸€æ–¹æ³•ã€‘

å¿…é¡»ä½¿ç”¨ä¸¤ä¸ªçœŸå®Tokenè¿›è¡Œæµ‹è¯•:

æ­¥éª¤:
  1. æ³¨å†Œ/ç™»å½•è´¦å·A â†’ è·å–TokenA
  2. æ³¨å†Œ/ç™»å½•è´¦å·B â†’ è·å–TokenB
  3. è´¦å·Båˆ›å»ºè®¢å• â†’ è®°å½•è®¢å•ID
  4. ç”¨TokenAè®¿é—®Bçš„è®¢å•ID
  5. å¦‚æœæˆåŠŸ â†’ IDORç¡®è®¤!

è‡ªåŠ¨åŒ–å·¥å…·:
  python3 backend_validation_test.py "$TOKEN_A" "$TOKEN_B"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€å¦‚ä½•è·å–çœŸå®Tokenã€‘

æ–¹æ³•1: MITMæ‹¦æˆª
  mitmproxy -p 8080
  è®¾ç½®æ‰‹æœºä»£ç† â†’ ç™»å½•App â†’ æå–Token

æ–¹æ³•2: Frida Hook
  python3 data_extraction_tool.py
  è‡ªåŠ¨æå– PREF_TOKEN_USER

æ–¹æ³•3: Rootæå–
  adb shell
  su
  cat /data/data/com.emsportal/shared_prefs/APP_PREFERENCES.xml

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€æµ‹è¯•å·¥å…·ã€‘

å·²ç”Ÿæˆ3ä¸ªæµ‹è¯•å·¥å…·:

1. backend_validation_test.py (åŒTokenéªŒè¯)
   - è‡ªåŠ¨æµ‹è¯•åç«¯æ˜¯å¦éªŒè¯æ‰€æœ‰æƒ
   - éœ€è¦ä¸¤ä¸ªçœŸå®Token
   - ç›´æ¥ç»™å‡ºæ˜ç¡®ç»“è®º

2. mass_idor_extractor.py (æ‰¹é‡æå–)
   - æ‰¹é‡æ‰«æè®¢å•ID
   - è‡ªåŠ¨è¯†åˆ«è¶Šæƒè®¢å•
   - å¯¼å‡ºJSON/CSV

3. unauthorized_access_test.py (ç»¼åˆæµ‹è¯•)
   - å¤šç§è¶Šæƒå‘é‡æµ‹è¯•
   - JWTä¼ªé€ æµ‹è¯•
   - å‚æ•°æ³¨å…¥æµ‹è¯•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨ã€‘

ç«‹å³æ‰§è¡Œ:

# 1. è·å–ä¸¤ä¸ªToken
mitmproxy -p 8080
# åœ¨Appä¸­ç™»å½•ä¸¤ä¸ªè´¦å·ï¼Œåˆ†åˆ«æå–Token

# 2. è¿è¡ŒéªŒè¯æµ‹è¯•
python3 backend_validation_test.py "$TOKEN_A" "$TOKEN_B"

# 3. å¦‚æœç¡®è®¤IDORï¼Œæ‰¹é‡æå–
python3 mass_idor_extractor.py --token "$TOKEN_A" --mode smart

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€æ–‡æ¡£æ¸…å•ã€‘

æŠ€æœ¯åˆ†æ:
  â€¢ BACKEND_VALIDATION_AUDIT.md  - å®Œæ•´å®¡è®¡æŠ¥å‘Š
  â€¢ PRIVILEGE_ESCALATION.md       - è¶ŠæƒæŠ€æœ¯åˆ†æ
  â€¢ REAL_IDOR_GUIDE.md            - å®æˆ˜æŒ‡å—

æµ‹è¯•å·¥å…·:
  â€¢ backend_validation_test.py    - åŒTokenéªŒè¯å·¥å…·
  â€¢ mass_idor_extractor.py        - æ‰¹é‡æå–å·¥å…·
  â€¢ unauthorized_access_test.py   - ç»¼åˆæµ‹è¯•å·¥å…·

å¿«é€ŸæŒ‡å—:
  â€¢ IDOR_QUICK_START.txt          - å¿«é€Ÿå…¥é—¨
  â€¢ AUDIT_SUMMARY.txt             - æœ¬æ–‡ä»¶

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€æœ€ç»ˆç»“è®ºã€‘

ä»å®¢æˆ·ç«¯ä»£ç åˆ†æ:
  âœ… å®¢æˆ·ç«¯å®ç°å­˜åœ¨IDORé£é™©ç‰¹å¾
  âœ… å®Œå…¨ä¸ä¼ user_id
  âœ… åªä¾èµ–Token

åç«¯éªŒè¯çŠ¶æ€:
  â“ æœªçŸ¥ (æ— æ³•åœ¨æ²¡æœ‰Tokenæƒ…å†µä¸‹æµ‹è¯•)

ç¡®è®¤æ–¹æ³•:
  ğŸ”‘ å¿…é¡»ä½¿ç”¨çœŸå®Tokenæµ‹è¯•

é£é™©è¯„çº§:
  æ½œåœ¨é£é™©: HIGH (70%æ¦‚ç‡å­˜åœ¨IDOR)
  ç¡®è®¤é£é™©: éœ€è¦å®é™…æµ‹è¯•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç”Ÿæˆæ—¥æœŸ: 2025-11-01

ç«‹å³æµ‹è¯•: python3 backend_validation_test.py <TOKEN_A> <TOKEN_B>
