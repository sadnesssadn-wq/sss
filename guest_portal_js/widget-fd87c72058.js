(r=>{function n(t){if("object"===r.type(t.id))r(t.id).attr("id")?this.domId=r(t.id).attr("id"):(this.domId=r.su.randomId("widget-"),r(t.id).attr("id",this.domId)),t.id=this.domId;else{if("string"!==r.type(t.id))return void console.error("Widget id doesn't exists. ");this.domId=t.id}this._init(t),this.init(t);var i,s,a,n,t=this.render;return"echart"===this._type?this.render=(a=t,n=this,function(){var t=this,e=r.Deferred();return a.call(this,function(){n._bindListeners(),n._initTip(),n._initScrollbar(),t._view&&t._view.onChildWidgetRendered(t),t.rendered=!0,e.resolve()}),e.promise()}):this.render=(i=t,s=this,function(){var t,e=i.call(this);return e&&e.then&&(t=e),s._bindListeners(),this.noRenderErrorTips||s._initTip(),s._initScrollbar(),this._view&&this._view.onChildWidgetRendered(this),this.rendered=!0,t||((e=r.Deferred()).resolve(),e.promise())}),this}var d;r.su=r.su||{},r.su.widgets={},r.su.Widget=(n.regMap={base:r.extend({settings:d={labelField:{attribute:"label-field",defaultValue:""},cls:{attribute:"cls",defaultValue:" container widget-container "},separator:{attribute:"separator",defaultValue:""},labelCls:{attribute:"label-cls",defaultValue:""},inputCls:{attribute:"input-cls",defaultValue:""},tips:{attribute:"tips",defaultValue:""},tipsCls:{attribute:"tips-cls",defaultValue:""},errorTipsCls:{attribute:"error-tips-cls",defaultValue:""},noRenderErrorTips:{attribute:"no-render-error-tips",defaultValue:!1}},listeners:[]},n.prototype={_init:function(t){var a=this.dom(),n=this,o=t.settings=t.settings||{};this.settings=(()=>{var t,e,i,s=r.extend({},d,n.settings);for(t in s)s.hasOwnProperty(t)&&(e=s[t],o.hasOwnProperty(e.attribute)||a[0]&&a[0].hasAttribute(e.attribute)?("object"===r.type(o[e.attribute])&&"object"===r.type(e.defaultValue)&&(o[e.attribute]=r.extend(!0,{},e.defaultValue,o[e.attribute])),i=o[e.attribute]||a.attr(e.attribute),i=r.isFunction(e.setter)?e.setter.call(a,i):i,o[t]=i):(i=e.defaultValue,e.getter?o[t]=e.getter.call(a):o[t]="object"===r.type(i)?r.su.clone(i):i));return o})(),t.customSettings&&r.extend(this.settings,t.customSettings),this._view=t.view,this._view&&this._view.addChildWidget(this),this._status={shown:!0,disabled:!1},this.dom().data("viewObj",this)},_initTip:function(t){var e,i=(t=this).settings,s=t.getContainer();i.tipText&&s&&(e=s.children("div[widget=toolTip]")).get(0)&&(r(e[0]).attr("id",t.domId+"_tooltip"),new r.su.widgets.toolTip({id:r(e[0]),tipText:i.tipText}).render()),i.labelTipText&&s&&(e=s.find("div[widget=toolTip].label-tip")).get(0)&&(r(e[0]).attr("id",t.domId+"_label_tooltip"),new r.su.widgets.toolTip({id:r(e[0]),tipText:i.labelTipText}).render()),s&&(e=s.children(".widget-wrap-outer").children("div[widget=errortip]")).get(0)&&(r(e[0]).attr("id",t.domId+"_errortip"),t.errortip=new r.su.widgets.errortip({id:r(e[0]),type:t._type}),t.errortip.render(),t.errortip.hide()),t.setTips(i.tips)},_initScrollbar:function(){var i=this;i.dom().find(".su-scroll").add(i.dom().filter(".su-scroll")).each(function(t,e){r(this).closest("[widget]")[0]==i.dom()[0]&&r.su.scrollbar({ele:e,opts:i.scrollOption||{}})})},_bindListeners:function(){if(this.listeners&&r.isArray(this.listeners)){var t,e,a=this,n=this.listeners;if(a._eventMap&&0<a._eventMap.length)for(t=0,e=a._eventMap.length;t<e;t++){var i=a._eventMap[t];i.target?i.parent.off(i.event,i.target,i.func):i.parent.off(i.event,i.func)}for(a._eventMap=[],t=0,e=n.length;t<e;t++)(e=>{function t(){var t=Array.prototype.slice.apply(arguments);t.push(a),n[e].callback.apply(this,t)}var i,s;n[e].condition&&!1===n[e].condition(a)||(i=n[e].selector,"function"===r.type(i)?((s=i.call(a)).target?r(s.parent).on(n[e].event,s.target,t):r(s.parent).on(n[e].event,t),a._eventMap.push({parent:r(s.parent),target:s.target||"",event:n[e].event,handler:t})):(""!==i?a.dom().on(n[e].event,i,t):a.dom().on(n[e].event,t),a._eventMap.push({parent:a.dom(),target:i||"",event:n[e].event,handler:t})))})(t)}},init:function(){},dom:function(){return r("#"+this.domId)},render:function(){this.dom().addClass(this.settings.cls)},getContainer:function(){var t=this.dom();return t.hasClass("widget-container")?t:(t=t.children(".widget-container")).get(0)&&"repeatItem"!==this._type?r(t.get(0)):null},show:function(t){t?this.dom().css("visibility","visible"):this.dom().show(),this.dom().triggerHandler("ev_widget_show")},hide:function(t){t?this.dom().css("visibility","hidden"):this.dom().hide(),this.dom().triggerHandler("ev_widget_hide")},enable:function(){this.dom().removeClass("disabled"),this.dom().triggerHandler("ev_view_enable")},disable:function(){this.dom().addClass("disabled"),this.dom().triggerHandler("ev_view_disable")},isDisabled:function(){var t=this.dom(),e=this.getContainer();return e&&e.hasClass("disabled")||!0===t.prop("disabled")},getLabel:function(t){return this.dom().find(".widget-fieldlabel").text()},setLabel:function(t){this.dom().find(".widget-fieldlabel").text(t)},setLabelHtml:function(t){this.dom().find(".widget-fieldlabel").html(t)},handleCombinationWidget:function(t){var e=this.getContainer();e&&e.hasClass("combination-item")&&(e=e.closest(".combination-container"))&&t(e)},setError:function(e,t){var i=this.dom(),s=this.getContainer(),i=i.find("div[widget=errortip]");s&&!this.isDisabled()&&(this.errortip?e&&this.errortip.show(e,t):0<i.length&&s&&(i=s.children(".widget-wrap-outer").children("div[widget=errortip]")).get(0)&&(r(i[0]).attr("id",this.domId+"_errortip"),this.errortip=r(i[0]).errortip({type:this.type})[0],this.errortip.render(),e)&&this.errortip.show(e,t),s.removeClass("valid").addClass("error"),e||s.addClass("empty-error"),this.handleCombinationWidget(t=>{t.addClass("error"),e||t.addClass("empty-error")}),s.find("span.widget-validate-icon").css({"display":"inline-block"}))},setNormal:function(){var t=this.dom(),e=(this.settings,this.getContainer()||t);t.find("div[widget=errortip]");e&&(this.handleCombinationWidget(t=>{t.removeClass("error"),t.removeClass("empty-error")}),e.removeClass("focus error disable dirty correct empty-error"),e.find("span.widget-validate-icon").css({"display":"none"}),e.find("div.widget-addon").hide(),this.errortip)&&this.errortip.hide()},addClass:function(t){var e=this.dom();return e&&0<e.length&&e.addClass(t),this},removeClass:function(t){var e=this.dom();return e&&0<e.length&&e.removeClass(t),this},hasClass:function(t){var e=this.dom();return!!(e&&0<e.length)&&e.hasClass(t)},setFocus:function(){var t=this.getContainer();this.setNormal(),t.addClass("focus")},removeFocus:function(){this.getContainer().removeClass("focus")},setTips:function(t){var e=this.dom(),i=this.settings,e=(this.getContainer()||e).find(".widget-wrap-outer").eq(0).children(".widget-tips");i.tips=t,"string"===r.type(t)&&e.find("div.tips-content").html(t),t?(e.show(),e.fadeIn(150)):(e.hide(),e.css("display","none"))},setToolTip:function(t){var e=this.dom(),i=this.settings,e=this.getContainer()||e,s=e.find("div.tooltip-container");i.tipText=t,0===s.length&&(s=r('<div widget="toolTip"></div>'),e.append(s),s.attr("id",this.domId+"_tooltip"),new r.su.widgets.toolTip({id:s,tipText:t}).render()),"string"===r.type(t)&&s.find("p.tip-text").html(t),t?s.show():s.hide()},setLabelToolTip:function(t){var e=this.dom(),e=this.getContainer()||e,i=e.find(".widget-fieldlabel-wrap").find("div.tooltip-container");0===i.length&&(i=r('<div widget="toolTip"></div>'),e.find(".widget-fieldlabel-wrap").append(i),i.attr("id",this.domId+"_label_tooltip"),new r.su.widgets.toolTip({id:i,tipText:t}).render()),"string"===r.type(t)&&i.addClass("label-toolTip-container").find("p.tip-text").html(t),t?i.show():i.hide()},setDataTip:function(t,e){var i=this.dom();t?i.attr({"data-tip":t,"data-pointer":e?"bottom":"top"}):i.removeAttr("data-tip")},setPosition:function(t,e){var i=this.getContainer();if(i)return t="center"===t?parseInt((r(window).width()-i.width())/2,10):t||0,e="center"===e?parseInt((r(window).height()-i.height())/2,10):e||0,t=(t<0?0:t)+(r("html").scrollLeft()||r("body").scrollLeft()),e=(e-60<0?e:e-60)+(r("html").scrollTop()||r("body").scrollTop()),i.css({left:t,top:e}),{x:t,y:e}},getMask:function(){var t=r("#global-mask");return 0<t.length?t.data("viewObj"):(r('<div id="global-mask"></div>').appendTo(r("body")),new r.su.widgets.mask({id:"global-mask"}))},_destroy:function(){if(this._view&&this._view.removeChildWidget(this),this.destroy&&this.destroy(),this._eventMap){for(var t=0,e=this._eventMap.length;t<e;t++){var i=this._eventMap[t];i.target?r(i.parent).off(i.event,i.target,i.handler):r(i.parent).off(i.event,i.handler)}this._eventMap=[]}this.dom().data("viewObj",null),this.dom().remove(),this.settings=null},getStatus:function(t){return t?this._status[t]:this._status},setStatus:function(t,e){this._status[t]=e,this.dom().triggerHandler("ev_status_change",[this._status])},changeSettings:function(t,e){var i=this.settings;void 0===i[t]?(i.configs||(i.configs={}),i.configs[t]=e):i[t]=e}})},n.register=function(e,s){var a,i,t;for(t in n.regMap[e]=s,i=s.extend?r.su.widgets[s.extend]:r.su.Widget,n.regMap[e].settings=(()=>{var t,e,i=s.extend?n.regMap[s.extend].settings:d;for(e in t=r.isFunction(s.settings)?s.settings.call(a,r.extend({},i)):r.extend({},i,s.settings))t.hasOwnProperty(e)&&!t[e].setter&&(t[e].setter=(t[e].attribute,function(t){r(this);var e=r.su.getAttrObject;if(null!=t)return"string"===r.type(t)&&t.match(/{(.+)}/g)?null!=(e=e(r.su.CHAR,t))?e:"Not Defined":t}));return t})(),n.regMap[e].listeners=(()=>{var t=s.extend?n.regMap[s.extend].listeners:[];return s.listeners=s.listeners||[],r.isFunction(s.listeners)?s.listeners.call(a,t):t.concat(s.listeners)})(),a=r.su.widgets[e]=function(t){return this._type||(this._type=e,this.settings=n.regMap[e].settings,this.listeners=n.regMap[e].listeners),i.call(this,t),this},r.su.inherit(i,a),s)s.hasOwnProperty(t)&&r.isFunction(s[t])&&(a.prototype[t]=s[t]);return a},n),r("html").delegate("input","focus",function(t){t.stopPropagation(),t.preventDefault()}).delegate(".combobox-search-box, .combobox-search-box-icon","click",function(t){t.stopPropagation()}).on("click",function(t){t.stopPropagation(),r("div.region-select-wrap, div.region-search-wrap").hide(),0===r(t.target).closest(".combobox-list-wrap").length&&(r("div.combobox-list-wrap").hide().attr("toggleflag","hidden"),r("#global-combobox-options").off("click","label.combobox-label").attr("data-shown","_hidden_"),r("#customer-combobox-options").off("click","label.combobox-label").attr("data-shown","_hidden_"),r("div.combobox-container").removeClass("selected focus")),r("div.timepicker-msg-container").removeAttr("dragFlag")}).on("mouseup",function(t){r("div.button-container").removeClass("clicked"),r("div.btn-help-container a.btn-help").removeClass("clicked"),r("div.timepicker-msg-container-wrap").trigger("mouseup")}).on("keyup mousedown",function(t){}),r(document).ready(function(t){r('<div id="global-mask"></div>').appendTo(r("body")),r.appUtils.mask=new r.su.widgets.mask({id:"global-mask"}),r.appUtils.mask.render(),r('<div id="global-combobox-options" data-shown="_hidden_"></div>').appendTo(r("body")),r('<div id="customer-combobox-options" data-shown="_hidden_"></div>').appendTo(r("body")),r('<div id="global-tips-text" class="global-tips-text" data-shown="_hidden_"></div>').appendTo(r("body")),r('<div id="global-errortip" widget="errortip" class="global-errortip" data-shown="_hidden_"></div>').appendTo(r("body")),r('<div id="global-info-panel" widget="infoPanel" class="u-d-none"></div>').appendTo(r("body")),r('<div id="global-nav-wrapper" class="global-nav-wrapper u-d-none"></div>').appendTo(r("body")),r.appUtils.globalInfoPanel=new r.su.widgets.infoPanel({id:"global-info-panel"}),r.appUtils.globalInfoPanel.render();var e=document.body.clientWidth,e=e<=768?"s":e<1024?"m":e<1280?"l":"xl";r.su.widgetSize=e}),r(window).on("resize",r.su.debounce(function(t){var e=r("div.msg-container.show"),i=document.body.clientWidth,s=r("#global-combobox-options"),a=r("#customer-combobox-options"),n=r("#global-tips-text"),s=s.attr("data-shown"),a=a.attr("data-shown"),n=n.attr("data-shown"),i=(r(window).trigger("ev_resize",[i]),e.each(function(t,e){e=r(e).data("viewObj");e.settings.shown&&e.settings.autoAdapt&&e.setPosition("center","center")}),"_hidden_"!==s&&r("#"+s).data("viewObj").calculatePosition(),"_hidden_"!==a&&r("#"+a).data("viewObj").calculatePosition(),"_hidden_"!==n&&r("#"+n).data("viewObj").adjustLayout(r.su.widgetSize),r(".page-content").data("ps"));i&&i.update()},100)),new MutationObserver(r.su.debounce(function(){0!==r("#vue-container").height()||"#dashboard"===location.hash&&r.su.moduleManager.get("dashboard")||r(".ps:visible").each(function(){var t=r(this).data("ps");t&&t.update()})},50)).observe(document,{subtree:!0,attributes:!1,childList:!0})})(jQuery),(l=>{l.su.Widget.register("searchList",{settings:{multiselect:{attribute:"multiselect",defaultValue:!1},maxLine:{attribute:"max-line",defaultValue:4},scroll:{attribute:"scroll",defaultValue:!1},numPerPage:{attribute:"num-per-page",defaultValue:10},pathSeparator:{attribute:"path-separator",defaultValue:">"}},listeners:[{selector:".searchList-content-container a",event:"click",callback:function(t,e){t.preventDefault(),e.dom().trigger("ev_searchList_go",[l(this).data("target"),l(this).data("tab")])}},{selector:".searchList-paging-container .paging-btn",event:"click",callback:function(t,e){var i=e.dom().find(".searchList-item-container"),s=parseInt(l(this).text()),a=e.settings.numPerPage,n=e.dom().find(".paging-btn-num");i.hide(),isNaN(s)&&(s=l(this).hasClass("pageing-btn-prev")?1:n.length),i.filter(function(t){return(s-1)*a<=t&&t<s*a}).show(),e.dom().find(".current").removeClass("current"),n.hide(),(s<=2?n.filter(function(t){return t<=4}):s>=n.length-1?n.filter(function(t){return t>=n.length-5}):n.filter(function(t){return s-3<=t&&t<=s+1})).show(),n.eq(s-1).addClass("current"),e.dom().find(".searchList-content-ul").data("ps").update()}}],init:function(t){},render:function(){this.settings;var t=this.dom(),e=(t.addClass("searchList-container widget-container "),""),e=(e=(e=(e=(e+='<div class="searchList-header">')+'<div class="searchList-results-title">'+'<span class="searchList-results-label"></span>')+'<span class="searchList-results-separator"></span>'+('<span class="searchList-results-count">'+l.su.CHAR.SEARCH.RESULTS+"</span>"))+"</div>"+"</div>")+'<div class="no-results-prompt">'+("<p>"+l.su.CHAR.SEARCH.NO_RESULTS_PROMPT+"</p>");t.append(e=(e=e+"</div>"+'<div class="searchList-content-container">')+'<ul class="searchList-content-ul"></ul>'+"</div>"),l.su.scrollbar({ele:".searchList-content-ul"})},loadItems:function(t){var e=this.dom().find(".searchList-content-ul"),i=(this.settings,this.dom()),s=(e.empty(),t.length);if(0===s)i.find(".no-results-prompt").show(),i.find(".searchList-content-container").hide();else{i.find(".no-results-prompt").hide(),i.find(".searchList-content-container").show();for(var a=0;a<s;a++){var n=t[a],o=l('<li id="'+this.domId+"-item-"+a+'" class="searchList-item-container"></li>'),n=l(this.renderContent(n));o.append(n).appendTo(e)}}i.find(".searchList-results-count").text(l.su.CHAR.SEARCH.RESULTS+"("+s+")"),this.renderSearchList()},renderSearchList:function(){var t,e=this.dom(),i=this.settings,s=i.maxLine,a=i.numPerPage,n=e.find(".searchList-item-container"),s=n.eq(0).outerHeight(!0)*s,o=(n.length>a&&!i.scroll?(t=Math.ceil(n.length/a),n.filter(function(t){return a<=t}).hide()):i.scroll&&(e.outerHeight(s),e.css({"overflow-y":"scroll"})),'<div class="searchList-paging-container paging-container disabled">');o+='<div class="paging-wrap"><div class="paging-btns inline-block">',5<t&&(o+='<a href="javascript:void(0);" class="paging-btn pageing-btn-prev" data-index="prev"><span class="icon"></span><span class="text"><</span></a>'),o+='<div class="num-buttons-container">';for(var r=0;r<t;r++)o=(o=o+'<a href="javascript:void(0);" class="paging-btn paging-btn-num pageing-btn-'+r+'"><span class="icon"></span>')+'<span class="text">'+(r+1)+"</span></a>";o+="</div>",5<t&&(o+='<a href="javascript:void(0);" class="paging-btn pageing-btn-next" data-index="next"><span class="icon"></span><span class="text">></span></a>'),o+="</div></div></div>",e.find(".searchList-paging-container").remove(),l(o).appendTo(e);n=e.find(".paging-btn-num");n.eq(0).addClass("current"),5<t&&n.filter(function(t){return 5<=t}).hide()},renderContent:function(t){var e=this.settings,i=t.name,s=t.path,a=t.introduction,n=e.pathSeparator,o='<div class="searchList-item-content">',r=(s=l.isArray(s)?s:[s]).length;o+='<a data-target="'+i+'"'+(t.tab?' data-tab="'+t.tab+'"':"")+' href="#'+i+'">';for(var d=0;d<r;d++)o+='<span class="path-node">'+this.handleSearchItemContent(s[d])+"</span>",d!=r-1&&(o+='<span class="path-separator"> '+n+" </span>");return o+="</a>",o=""!=a?o+'<div class="searchList-item-introduction">'+a+"</div></div>":o},setSearchWorld:function(i){this.dom().find(".searchList-item-content").each(function(){var t=l(this).find(".path-node").last(),e=(wordTransed=i.replace(/[\*\.\?\+\$\^\[\]\(\)\{\}\|\\\/]/g,function(t){return"\\"+t}),new RegExp(wordTransed,"i"));t.html(t.text().replace(e,function(t){return'<span class="searchList-matched-text">'+t+"</span>"}))})},handleSearchItemContent:function(t){return t}})})(jQuery),(()=>{function i(t,e){var i;0<$(t.ele).length&&($(t.ele).data("ps")?$(t.ele).data("ps").update():(t.opts=$.extend({wheelPropagation:!0},t.opts),i=new PerfectScrollbar(t.ele,t.opts),$(t.ele).data("ps",i),$(t.ele).off("ps-scroll-x").on("ps-scroll-x",()=>{i.update()}),e&&e(i)))}$.su.scrollbar=function(t,e){$.su.isMobile()||"Microsoft Internet Explorer"===navigator.appName&&(navigator.userAgent.match(/Trident/i)&&navigator.userAgent.match(/MSIE 8.0/i)||navigator.userAgent.match(/MSIE 9.0/i))||($.su.scrollbar.loaded?i(t,e):$.su.router.loadFile("js/libs/perfect-scrollbar-f04dcc0069.min.js",function(){i(t,e),$.su.scrollbar.loaded=!0}))},$.su.scrollbar.loaded=!1})(),$.su.Widget.register("form",{settings:{formName:{attribute:"form-name",defaultValue:""}},init:function(){this.fields=[]},render:function(){},loadData:function(){},getAllFields:function(){for(var t=[],e=this.dom().find("div[widget]"),i=0,s=e.length;i<s;i++){var a,n=$(e[i]),o=n.attr("widget"),r=n.attr("name");r&&((a=(a=$(n).data("viewObj"))||$(n)[o]({})[0]).field=r,t.push(a))}return t}}),jQuery,$.su.Widget.register("transition",{init:function(){this._fields=[]},render:function(){var t,i=this;this._domStr=this.dom().html(),this._domStr&&(t=this._domStr.replace(/{.*?}/g,function(t){var e=$.su.getAttrObject($.su.CHAR,t);return e||(i._fields.push({name:t.replace(/[\{,\}]/g,""),value:null}),t)}),t=(this._initTransferedStr=t).replace(/{.*?}/g,function(t){return""}),this.dom().html(t))},setField:function(t,e){for(var i=this._fields,s=0;s<i.length;s++)i[s].name===t&&(i[s].value=e);this._updateDomStr()},setFields:function(t){for(var e,i=this._fields,s=i.length;s--;)void 0!==t[(e=i[s]).name]&&(e.value=t[e.name]);this._updateDomStr()},_updateDomStr:function(){var n=this,t=this._initTransferedStr.replace(/{.*?}/g,function(t){for(var e,i=t.replace(/[\{,\}]/g,""),s=n._fields,a=0;a<s.length;a++)if(s[a].name===i)return null===(e=s[a].value)?"":e;return""});this.dom().html(t)}}),(x=>{x.su.Widget.register("repeat",{settings:{items:{attribute:"items",defaultValue:[]},itemWidget:{attribute:"item-widget",defaultValue:null},itemDom:{attribute:"item-dom",defaultValue:null},itemDataLoader:{attribute:"item-data-loader",defaultValue:"loadData"},autoRenderAllItems:{defaultValue:!0},itemCls:{attribute:"item-cls",defaultValue:""},noRenderErrorTips:{attribute:"no-render-error-tips",defaultValue:!1},scroll:{attribute:"scroll",defaultValue:!0},serialNum:{attribute:"serial-num",defaultValue:!1}},listeners:[{selector:"a.button-button",event:"click",callback:function(t,e){t.preventDefault(),e.dom().triggerHandler("ev_repeat_button_click")}}],init:function(){this.repeatId=x.su.randomId("repeat-"),this._keys=[],this._renderedItems=[]},render:function(){var i,t=this.dom(),e=this.settings;t.addClass("repeat-container"),e.itemWidget||e.itemRender||(t.wrapInner(function(){return'<div class="repeat-item '+e.itemCls+'"></div>'}),this.initItem=t.find(".repeat-item"),this.itemModel=this.initItem.clone(),i=[],this.initItem.find("[widget]").each(function(t,e){i.push(x(e).data("viewObj"))}),x.each(i,function(t,e){e._destroy()}),this.initItem.detach()),e.scroll&&0===t.find(".ps__rail-y").length&&x.su.scrollbar({ele:t[0]})},filterItems:function(t,e){var i=this.dom();e?i.find(".repeat-item").hide():(i.find(".repeat-item").show(),(t=x.isArray(t)?t:[t]).forEach(function(t,e){i.find(".repeat-item[data-index="+t+"]").hide()}))},showItems:function(t,e){var i=this.dom();e?i.find(".repeat-item").show():(t=x.isArray(t)?t:[t]).forEach(function(t,e){i.find(".repeat-item[data-index="+t+"]").show()})},syncData:function(t,e){this._keys=t,x.each(this._renderedItems,function(t,e){e.obj.dom().remove(),x.each(e.widgets,function(t,e){e._destroy()})}),this.dom().empty(),this._renderedItems=[],this.settings.autoRenderAllItems&&this.dom().triggerHandler("ev_store_render_items",[t])},setItemRender:function(t){this.settings.itemRender=t},renderModels:function(t,e,i,s){var n=this,a=this.dom(),o=(x.isArray(e)&&0!==e.length?a.removeClass("empty"):a.removeClass("empty").addClass("empty"),this.settings),r=(s=s&&!x.isArray(s)?[s]:s,o.itemWidget);a.attr("tagName");if(r){var d=a.clone(!1),l=o.itemDataLoader;d.removeAttr("id"),d.removeAttr("item-Widget"),d.removeAttr("item-dom"),d.removeAttr("item-data-loader"),d.removeAttr("data-bind"),d.removeClass("repeat-container"),d.attr("widget",r),d.attr("repeat-id",this.repeatId);for(var c=0;c<e.length;c++){var h=e[c].getData();(p=d.clone(!1)).attr("id",x.su.randomId("widget-")),a.append(p),(v=new x.su.widgets[r]({id:p,view:n._view})).render(),l&&v[l](h),this._renderedItems.push({key:e[c][t].getValue(),obj:v})}}else if(o.itemRender)for(c=0;c<e.length;c++){var h=e[c].getData(),g=e[c][t].getValue(),u=o.itemRender.call(this,g,h),u=x(u),u=(u.on("click",((t,e)=>function(){a.trigger("ev_item_click",[t,e])})(g,h)),a.append(u),new x.su.widgets.repeatItem({id:u}));u.render(),this._renderedItems.push({key:g,obj:u})}else for(c=0;c<e.length;c++){var g=e[c][t].getValue(),h=e[c].getData(),p=this.itemModel.clone(!1);if(o.render&&p.append(o.render.call(this,g,h)),p.attr("id",x.su.randomId("widget-")),p.attr("data-index",c),p.attr("data-key",e[c][t].getValue()),s){for(var m=[],f=0;f<s.length;f++)m.push(e[c][s[f]].getValue());p.addClass(m.join(" "))}p.find("[id]").each(function(t,e){e=x(e);e.attr("render-once")||e.attr("id",x.su.randomId("widget-"))}),o.serialNum&&p.prepend(x("<span class='repeat-index'>"+(c+1)+"</span>")),a.append(p);var v=new x.su.widgets.repeatItem({id:p}),b={widgets:{}};p.find("[widget]").each(function(t,e){var i,e=x(e),s=e.attr("widget"),a=e.attr("name");e.attr("render-once")?0===c&&((i=new x.su.widgets[s]({id:e,view:n._view})).renderParent="repeat",n.settings.widgetInstance&&(b.widgets[a].widgetInstance=!0),i.render(),o.renderCallback)&&o.renderCallback.call(this,i,h):(b.widgets[a]=new x.su.widgets[s]({id:e,view:n._view,settings:{repeatWidget:n}}),b.widgets[a].renderParent="repeat",n.settings.noRenderErrorTips&&(b.widgets[a].noRenderErrorTips=!0),b.widgets[a].render(),o.renderCallback&&o.renderCallback.call(this,b.widgets[a],h))}),v.render(),x.extend(!0,b,{key:e[c][t].getValue(),obj:v}),this._renderedItems.push(b)}i&&i(this._renderedItems),this.dom().triggerHandler("ev_repeat_render_end")},remove:function(t){var e,i,s=this._renderedItems;if(t)for(e=s.length-1;0<=e;e--)s[e].key===t&&(s[e].obj._destroy(),s.splice(e,1));else{for(e=0,i=s.length;e<i;e++)s[e].obj._destroy();s.length=0}},each:function(t){for(var e=0;e<this._renderedItems.length;e++)if(!1===t(this._renderedItems[e]))return},getInnerWidgets:function(i){var s=[];return x.each(this._renderedItems,function(t,e){s.push(i?e.widgets[i]:e.obj)}),s},getRenderItems:function(){return this._renderedItems},find:function(t){var e=[];if("function"!=typeof t)return!1;for(var i=0;i<this._renderedItems.length;i++){var s=this._renderedItems[i].obj;t(s)&&e.push(s)}return e}})})(jQuery),(i=>{i.su.Widget.register("repeatItem",{extend:"form",remove:function(){var t=this.dom();t.find("[widget]").each(function(t,e){e=i(e).data("viewObj");e&&e.remove()}),t.remove(),this.settings=null,this._view&&this._view.removeChildWidget(this)}})})(jQuery),$.su.Widget.register("panel",{settings:{_title:{attribute:"title-label",defaultValue:""},instruction:{attribute:"instruction",defaultValue:""},icon:{attribute:"icon",defaultValue:""},iconCls:{attribute:"icon-cls",defaultValue:""},panelType:{attribute:"panel-type",defaultValue:"form"},collapsible:{attribute:"collapsible",defaultValue:!1},collapsed:{attribute:"collapsed",defaultValue:!1},close:{attribute:"close",defaultValue:!1},tipText:{attribute:"tip-text",defaultValue:""}},listeners:[{selector:".panel-header",event:"click",callback:function(t,e){t.stopPropagation();var i,s,t=e.settings;t.collapsible&&(i=$(this).find(".panel-header-btn-collapse"),s=e.getContainer().find("div.panel-content"),t.collapsed?(s.slideDown(200,function(){s.css("display","block"),i.removeClass("collapsed")}),t.collapsed=!1,i.closest("div[widget=panel]").triggerHandler("ev_panel_open")):(s.slideUp(200,function(){$(this).css("display","none"),i.addClass("collapsed")}),t.collapsed=!0,i.closest("div[widget=panel]").triggerHandler("ev_panel_close")))}},{selector:"span.panel-header-btn-close",event:"click",callback:function(t,e){e=e.dom();e.hide(),e.triggerHandler("ev_panel_hide")}}],init:function(){this._titleText=null},render:function(){var t=this.dom(),e=this.settings,i=!e.collapsible||!1===e.collapsed?"block":"none",s=(t.addClass(e.cls+"panel-container "+e.panelType+(e.collapsible?" collapsible":"")),""),a=e.collapsed?"collapsed":"",a=(s=s+'<div class="panel-wrap">'+'<div class="panel-title-wrap">',!1!==e._title&&(s=(s+='<div class="panel-header"><h3 class="panel-title">')+'<span class="panel-title-icon"></span><span class="panel-title-text">'+e._title+"</span>",e.tipText&&(s+='<div widget="toolTip" class="panel-tip"></div>'),"string"===$.type(e.instruction)&&""!==e.instruction&&(s+='<div class="panel-title-instruction">'+e.instruction+"</div>"),s+='<div class="panel-header-btn-container">',e.collapsible&&(s+='<span class="panel-header-btn-collapse '+a+'" type="button"></span>'),e.close&&(s+='<span class="panel-header-btn-close close-icon"><span class="icon"></span></span>'),s+="</div></h3></div>"),s=(s=(s=(s=s+'<div class="status-slot hidden m-l-8 m-b-8"></div>'+"</div>")+('<div class="panel-content" style="display: '+i+'">')+'<div class="panel-tbar-container"></div>')+'<div class="panel-content-container"></div>'+'<div class="panel-fbar-container"></div>')+"</div>"+"</div>",$(s));0<t.find("div.panel-content-container").length?(a.find("div.panel-content-container").append(t.find("div.panel-content-container").children().detach()),t.find(".panel-wrap").remove()):a.find("div.panel-content-container").append(t.children().detach()),t.append(a),this._titleText=t.find(".panel-title-text"),e.tipText&&new $.su.widgets.toolTip({id:$(".panel-title").children("div[widget=toolTip]").not(".tooltip-container"),tipText:e.tipText}).render()},setToolTip:function(t){var e=this.dom().find(".panel-title");let i=e.children(".tooltip-container");0===i.length&&(i=$("<div widget='toolTip' class='panel-tip'></div>"),e.append(i),new $.su.widgets.toolTip({id:i,tipText:t}).render()),"string"===$.type(t)&&i.find(".tip-text").html(t),t?i.show():i.hide()},getTitle:function(){return this._titleText&&this._titleText.text()},setTitle:function(t){var e=this.getContainer();t&&e.find("h3.panel-title span.panel-title-text").eq(0).html(t)},disableTitle:function(){this.dom().addClass("no-title")},enableTitle:function(){var t=this.dom();t.hasClass("no-title")&&t.removeClass("no-title")},open:function(){var t=this.settings,e=this.getContainer(),i=e.find("div.panel-content"),s=e.find("span.panel-header-btn-collapse");i.slideDown(200,function(){i.css("display","block"),s.removeClass("collapsed")}),t.collapsed=!1,this.dom().triggerHandler("ev_panel_open")},updateTemplateStatus:function(t,e){var i=$(`#${this.domId}>.panel-wrap>.panel-title-wrap>.status-slot`);if(!arguments.length)return i.addClass("hidden");let s=$.su.serviceManager.get("siteTemplate").getTemplateStatusDom(t,e);""===s?i.addClass("hidden"):(t===$.su.serviceManager.get("siteTemplate").TEMPLATE_STATUS.OVERRIDE&&(s=`<div data-tip="${$.su.CHAR.SITE_PROFILE.SITE_CONFIGURATION_OVERRIDE_TIP}" tip-width="250px" data-pointer="top">${s}</div>`),i.removeClass("hidden").html(s))}}),$.su.Widget.register("infoPanel",{settings:{},listeners:[{selector:function(){return{parent:"body",target:"[data-info-panel]"}},event:"mouseenter",callback:function(t,e){var i=$(this),s=i.attr("data-key")||i.closest(".grid-content-tr").attr("data-key"),a=$.su.getDefaultEvent(e,function(){e.setPanel(i),e.anchorDom(i)});(e._dom=i).trigger("ev_info_panel_show",[s,i,a.ev]),a.exe()}}],init:function(){},render:function(){this.dom().addClass("info-panel"),this.dom().append('<span class="tip-pointer"></span><span class="panel-data"></span>')},anchorDom:function(t,e){var i=this,s="keep"===t.attr("keep-on-hover");i._dom=t,s=e?(i.hideOnLeave=!1!==e.hideOnLeave,"keep"!==e.keepOnHover):(i.hideOnLeave="false"!==t.attr("hide-on-leave"),"keep"===t.attr("keep-on-hover")),i.dom().removeClass(i._type),i._type=t.attr("data-info-panel"),i.dom().addClass(i._type),$("body").one("click",function(){i.hide()}),clearTimeout(i.timeout),t.off("mouseleave").one("mouseleave",function(){i.hideOnLeave?i.hide():(i.timeout=setTimeout(function(){i.hide()},2e3),s&&i.dom().one("mouseenter",function(){clearTimeout(i.timeout),i.dom().off("mouseleave").one("mouseleave",function(){i.hide()})}))})},setPanel:function(t,e,i){var s,a,n,o,r,d,l,c,h,g=this.dom();0===g.find(".info-panel-grid").length&&!0!==i||(i=t.offset(),s=t.outerWidth(),l=t.outerHeight(),a=g.find(".tip-pointer"),e=!!e&&e.pos||t.attr("panel-position")||"bottom",$.su.language.isRtl()&&("left"===e?e="right":"right"===e&&(e="left")),g.css({"display":"inline-block","visibility":"hidden"}),n=g.outerWidth(),o=g.outerHeight(),r=$(window).width(),d=$(window).height(),l=(o-l)/2,"left"===e?(g.css({"visibility":"visible","left":i.left-n-16,"right":"auto","top":Math.min(i.top-l,d-o)}),$.su.language.isRtl()?a.removeClass("left right bottom top").addClass("right"):a.removeClass("left right bottom top").addClass("left"),a.removeAttr("style"),c=0,i.top-l>d-o&&(c=i.top-l-(d-o)),a.css({"right":-12,"top":(o-20)/2+c})):"right"===e?(g.css({"visibility":"visible","left":i.left+t.outerWidth()+16,"right":"auto","top":Math.min(i.top-l,d-o)}),$.su.language.isRtl()?a.removeClass("left right bottom top").addClass("left"):a.removeClass("left right bottom top").addClass("right"),c=0,i.top-l>d-o&&(c=i.top-l-(d-o)),a.removeAttr("style"),a.css({"left":-12,"top":(o-20)/2+c})):"bottom"===e?(h=i.left+(t.outerWidth()-n)/2,h=Math.max(0,Math.min(h,r-n)),g.css({"visibility":"visible","left":h,"right":"auto","top":i.top+t.outerHeight()+16}),a.removeClass("left right bottom top").addClass("bottom"),a.removeAttr("style"),a.css({"left":i.left-h+(s-20)/2,"top":-12})):"top"===e?(h=i.left+(t.outerWidth()-n)/2,h=Math.max(0,Math.min(h,r-n)),g.css({"visibility":"visible","left":h,"right":"auto","top":i.top-o-16}),a.removeClass("left right bottom top").addClass("top"),a.removeAttr("style"),a.css({"left":i.left-h+(s-20)/2,"bottom":-12,"right":"auto"})):"bottomLeft"===e&&(h=i.left,$.su.language.isRtl()?g.css({"visibility":"visible","right":$("body").width()-h-s,"left":"auto","top":i.top+t.outerHeight()+4}):g.css({"visibility":"visible","left":h,"right":"auto","top":i.top+t.outerHeight()+4}),a.removeClass("left right bottom top")))},setInfo:function(t,e){var i=this.dom(),s="";if(this.dom().removeClass().addClass("info-panel u-d-none"),t.cls&&this.dom().addClass(t.cls),t.title&&(s+='<div class="info-panel-row"><span class="info-panel-title">'+t.title+"</span></div>"),t.rows){s+='<div class="info-panel-grid"><table>';for(var a=0,n=t.rows.length;a<n;a++)t.rows[a]&&(s+='<tr class="info-panel-row '+(t.rows[a].cls||"")+'"><td class="info-panel-name">'+$.su.escapeHtml(t.rows[a].name)+'</td><td class="info-panel-value">'+(void 0!==t.rows[a].value?$.su.escapeHtml(t.rows[a].value):t.rows[a].html)+"</td></tr>");s+="</table></div>"}i.find(".panel-data").html(s),this.setPanel(this._dom,e,void 0)},setHtml:function(t,e){var i=this.dom();i.removeClass().addClass("info-panel u-d-none"),e&&e.cls&&this.dom().addClass(e.cls),i.find(".panel-data").html(t),this.setPanel(this._dom,e,!0)},setPanelDom:function(t,e){var i=this.dom(),s="";if(i.removeClass().addClass("info-panel u-d-none"),t.cls&&i.addClass(t.cls),t.title&&(s+='<div class="info-panel-row info-row-title"><span class="info-panel-title">'+t.title+"</span></div>"),t.dataSet)for(var a=0;a<t.dataSet.length;a++){t.dataSet[a].title&&(s+='<div class="info-panel-row info-row-title"><span class="info-panel-title">'+t.dataSet[a].title+"</span></div>"),s+='<div class="info-panel-dataset-wrapper">';for(var n=0;n<t.dataSet[a].data.length;n++)t.dataSet[a].data[n]&&(s+='<div class="u-d-inline-block dataset-item '+t.dataSet[a].data[n].colCls+'"><div class="dataset-top '+t.dataSet[a].data[n].topCls+'">'+t.dataSet[a].data[n].top+'</div><div class="dataset-bottom '+t.dataSet[a].data[n].bottomCls+'">'+t.dataSet[a].data[n].bottom+"</div></div>");s+="</div>"+(t.dataSet[a].split?'<div class="info-split"></div>':"")}if(t.rows){var o=[];s+='<div class="info-panel-grid"><table>';for(var r=0,d=t.rows.length;r<d;r++)t.rows[r]&&(t.rows[r].widget&&o.push(t.rows[r].widget.value),s+='<tr class="info-panel-row '+(t.rows[r].cls||"")+'"><td class="'+(t.rows[r].status?"info-panel-name-shrink":"info-panel-name")+'">'+$.su.escapeHtml(t.rows[r].name)+"</td>"+(t.rows[r].status?'<td class="info-panel-status">'+t.rows[r].status+"</td>":"")+(t.rows[r].widget?'<td class="info-panel-value" '+(t.rows[r].widget.colspan?"colspan="+t.rows[r].widget.colspan:"")+'><div widget="'+t.rows[r].widget.name+'"  id="'+t.rows[r].widget.name+"-"+r+'" class="'+t.rows[r].widget.cls+'"'+t.rows[r].widget.attr+"></div></td>":'<td class="info-panel-value">'+(void 0!==t.rows[r].value?$.su.escapeHtml(t.rows[r].value):t.rows[r].html)+"</td>")+"</tr>"+(t.rows[r].split?'<div class="info-split"></div>':""));s+="</table></div>"}i.find(".panel-data").html(s),this.setPanel(this._dom,e,void 0),$.each($(".info-panel-grid [widget]"),function(t,e){e=new $.su.widgets[$(e).attr("widget")]({id:$(e).attr("id")});e.render(),e.setValue(o[t])})}}),$.su.Widget.register("simpleDom",{}),$.su.Widget.register("toast",{settings:{noticeText:{attribute:"notice-text",defaultValue:""},showTime:{attribute:"show-time",defaultValue:6e3},fadeTime:{attribute:"fade-time",defaultValue:300},baseWidth:{attribute:"base-width",defaultValue:432}},listeners:[{selector:"div.close",event:"click",callback:function(t,e){t.preventDefault(),t.stopPropagation(),$(t.target||t.srcElement).closest(".toast-item").remove()}}],init:function(){this.toastMap=[{},{},{},{}]},render:function(){var t=this.dom(),e=this.settings;t.addClass(e.cls+" eap-toast");t.append('<div class="toast-wrap"></div>')},show:function(t,e,i){var s=this.dom(),a=this,n=s.find(".toast-wrap"),s=this.settings,o="";switch(e){case 0:o="success";break;case 1:o="fail";break;case 2:o="warning";break;case 3:o="info"}if(a.toastMap[e][t])clearTimeout(a.toastMap[e][t].timer);else{var r='<div id="'+$.su.randomId("toast")+'" class="toast-inline-item toast-item u-d-table-row u-d-none '+o+'">',r=(r=(r=(r=(r+='<div class="img-wrap">')+'<span class="icon"></span>'+"</div>")+'<div class="text-wrap">'+('<span class="text">'+t||s.noticeText+"</span>"))+"</div>"+'<div class="close">')+"</div>"+"</div>";for(a.toastMap[e][t]={};5<n.find($(".toast-item.toast-inline-item")).length;)n.find($(".toast-item.toast-inline-item")).eq(0).remove();a.toastMap[e][t].dom=$(r).appendTo(n),a.toastMap[e][t].dom.fadeIn(s.fadeTime),0===e&&(s.succeed=!0)}r=$.su.measureText(t),r=r?1e3*(4+3*Math.floor(r/s.baseWidth)):s.showTime;a.toastMap[e][t].timer=setTimeout(function(){a.toastMap[e][t].dom.remove(),delete a.toastMap[e][t]},r)},showMsg:function(t,e,i){var s=this.dom().find(".toast-wrap"),a=this.settings,n='<div class="toast-item visible u-d-table-row u-d-none">',e=(n=(n=(n=(n=(n=(n+='<div class="close-wrap">')+'<div class="close">'+"</div>")+"</div>"+'<div class="content-container su-scroll">')+'<div class="text-wrap">'+('<div class="title">'+e+"</div>"))+('<div class="text">'+t||a.noticeText+"</div>")+"</div>")+"</div>"+"</div>",$(n).appendTo(s));$.su.scrollbar({ele:e.find(".content-container")[0]}),e.fadeIn(a.fadeTime),i&&i(e)},hide:function(t){this.dom();this.dom().stop(!0).fadeOut(t?0:this.settings.fadeTime),this.settings.timerFlag=!1},setText:function(t){"string"==typeof t&&this.dom().find("span.text").html(t)}}),$.su.Widget.register("msg",{settings:{type:{attribute:"type",defaultValue:"prompt"},infoType:{attribute:"info-type",defaultValue:"info"},_title:{attribute:"msg-title",defaultValue:""},draggable:{attribute:"draggable",defaultValue:!0},autoshow:{attribute:"autoshow",defaultValue:!1},autoAdapt:{attribute:"auto-adapt",defaultValue:!0},zIndex:{attribute:"z-index",defaultValue:"auto"},mask:{attribute:"mask",defaultValue:!0},msg:{attribute:"msg",defaultValue:""},htmlLoader:{attribute:"html-loader",defaultValue:!1},callback:{attribute:"callback",defaultValue:null},titleBar:{attribute:"title-bar",defaultValue:!0},closeBtn:{attribute:"close-btn",defaultValue:!0},optBtn:{attribute:"operation-btn",defaultValue:!0},okText:{attribute:"ok-text",defaultValue:$.su.CHAR.OPERATION.OK},yesText:{attribute:"yes-text",defaultValue:$.su.CHAR.OPERATION.CONFIRM},noText:{attribute:"no-text",defaultValue:$.su.CHAR.OPERATION.NO},cancelText:{attribute:"cancel-text",defaultValue:$.su.CHAR.OPERATION.CANCEL},escapeSpace:{attribute:"escape-space",defaultValue:!0},scroll:{attribute:"scroll",defaultValue:!0},titleTipText:{attribute:"title-tip-text",defaultValue:""},titleTransferWidth:{attribute:"title-transfer-width",defaultValue:340},comboWidth:{attribute:"combo-width",defaultValue:190}},listeners:[{selector:"a.msg-close",event:"click",callback:function(t,e){t.preventDefault(),e.isFrozen||(t=$.su.getDefaultEvent(e,function(){e.close()}),e.showPromise.reject(),e.dom().triggerHandler("ev_msg_close",[t.ev]),t.exe())}},{selector:"div.btn-msg-ok",event:"click",callback:function(t,e){t.preventDefault(),t.stopPropagation(),e.getButton("ok").dom().hasClass("disabled")||(t=$.su.getDefaultEvent(e,e.close),e.showPromise.resolve(),e.dom().triggerHandler("ev_msg_ok",[t.ev]),t.exe())}},{selector:"div.btn-msg-no",event:"click",callback:function(t,e){t.preventDefault(),t.stopPropagation();t=$.su.getDefaultEvent(e,e.close);e.showPromise.reject(),e.dom().triggerHandler("ev_msg_no",[t.ev]),t.exe()}},{selector:"div.btn-msg-cancel",event:"click",callback:function(t,e){t.preventDefault(),t.stopPropagation();t=$.su.getDefaultEvent(e,e.close);e.showPromise.reject(),e.dom().triggerHandler("ev_msg_cancel",[t.ev]),t.exe()}},{selector:".msg-title",event:"mousedown",callback:function(t,i){var s,a,n,o,e,r,d;if(i.settings.draggable)return t=t||event,s=$("body").innerWidth(),a=$("body").innerHeight(),n=i.dom().outerWidth(),o=i.dom().outerHeight(),e=t.target||t.srcElement,$(e).closest(".msg-title").css("cursor","move"),r=$(this).offset().left,d=$(this).offset().top,i.distanceX=t.clientX-r,i.distanceY=t.clientY-d,i.drag=!0,i.dom().css({top:d,left:r,bottom:"",right:""}),i.dom().triggerHandler("ev_msg_before_move"),$(document).on("mousemove",l).on("mouseup",c),!1;function l(t){var e;if(!1!==i.drag)return $("#global-tip").data("viewObj").removeTip(),$.su.isIe&&(t.clientX>=s-10||t.clientX<10||t.clientY>=a-10||t.clientY<10)&&c(),(e=(t=t||event).clientX-i.distanceX)<=0?e=0:s-n<=e&&(e=s-n),(t=t.clientY-i.distanceY)<=0?t=0:a-o<=t&&(t=a-o),(3<Math.abs(e-r)||3<Math.abs(t-d))&&i.dom().triggerHandler("ev_msg_move"),i.dom().css({top:t+"px",left:e+"px",bottom:"",right:""}),$.su.emitModalEvent(i.dom(),!0),!1}function c(t){return $(document).off("mouseup",c).off("mousemove",l),i.dom().triggerHandler("ev_msg_after_move"),!1}}},{selector:".msg-content-container",event:"keyup",callback:function(t,e){13===t.keyCode&&e.dom().triggerHandler("ev_msg_enter")}}],init:function(){},render:function(){var t=this.dom(),e=this.settings,i=(t.addClass(e.cls+" msg-container "+("info"===e.type?e.infoType:e.type)),"ios"===$.su.platform&&t.addClass("ios"),""),s=(i+='<div class="msg-wrap">',"info"!==e.type&&"confirm"!==e.type&&e.closeBtn?i+='<div class="msg-close-container"><a class="widget-close msg-close" href="javascript:void(0);"></a></div>':i+='<a class="widget-close msg-close u-d-none" href="javascript:void(0);"></a>',i+='<div class="msg-content-wrap">',e._title||"");if(e.titleBar){if(0===s.length&&"info"===e.type)switch(e.infoType){case"success":s=$.su.CHAR.OPERATION.SUCCESS;break;case"fail":s=$.su.CHAR.OPERATION.ERROR;break;case"info":s=$.su.CHAR.OPERATION.NOTIFICATION;break;case"alert":s=$.su.CHAR.OPERATION.WARNING}i=(i+='<h3 class="widget-title msg-title '+(e.draggable?"":"immobile")+'">')+('<span class="msg-title-container">'+this.transferTitle(s,e.titleTransferWidth)+"</span>"),e.titleTipText&&(i+='<div widget="toolTip" class="msg-title-tool-tip"></div>'),i=i+'<span class="status-slot hidden"></span>'+"</h3>"}var a=e.msg||"",i=i+('<div class="widget-content msg-content-container '+(e.scroll?"su-scroll":"")+'">'+a+"</div>")+"</div>";if(e.optBtn){var a=e.type,n='<div widget="button" id="'+this.domId+'-btn-ok" class="btn-msg-ok u-d-inline-block m-b-0" label-field="{false}" text="'+e.okText+'"></div>',o='<div widget="button" id="'+this.domId+'-btn-no" class="btn-msg-no secondary-button  u-d-inline-block m-b-0" label-field="{false}" text="'+e.noText+'"></div>',r='<div widget="button" id="'+this.domId+'-btn-ok" class="btn-msg-ok u-d-inline-block m-b-0" label-field="{false}" text="'+e.yesText+'"></div>',d='<div widget="button" id="'+this.domId+'-btn-cancel" class="btn-msg-cancel secondary-button u-d-inline-block m-b-0" label-field="{false}" text="'+e.cancelText+'"></div>',l='<div widget="combobox" id="'+this.domId+'-btn-cancel" class="combobox_msg u-d-inline-block m-b-0" label-field="{false}" none-selected-text="'+e.cancelText+'"></div>';switch(a){case"info":case"fail":i=(i=(i=(i+='<div class="msg-btn-container">')+'<div class="msg-btn-wrap">'+'<div class="button-container u-d-inline-block">')+n+"</div>")+"</div>"+"</div>";break;case"confirm":i=(i=(i=(i=(i=i+'<div class="msg-btn-container">'+'<div class="msg-btn-wrap">')+'<div class="button-container u-d-inline-block">'+r)+"</div>"+'<div class="button-container u-d-inline-block">')+d+"</div>")+"</div>"+"</div>";break;case"notify":i=(i=(i=(i=(i=i+'<div class="msg-btn-container">'+'<div class="msg-btn-wrap">')+'<div class="button-container u-d-inline-block">'+r)+"</div>"+'<div class="button-container u-d-inline-block">')+l+"</div>")+"</div>"+"</div>";break;case"prompt":i=(i=(i=(i=(i=i+'<div class="button-container msg-btn-container">'+'<div class="msg-btn-wrap">')+'<div class="button-container u-d-inline-block">'+r)+"</div>"+'<div class="button-container u-d-inline-block">')+d+"</div>")+"</div>"+"</div>";break;case"show":i=(i=(i=(i=(i=(i=(i+='<div class="button-container msg-btn-container">')+'<div class="msg-btn-wrap">'+'<div class="button-container u-d-inline-block">')+r+"</div>")+'<div class="button-container u-d-inline-block">'+o)+"</div>"+'<div class="button-container u-d-inline-block">')+d+"</div>")+"</div>"+"</div>";break;case"window":break;default:e.buttons}}i='<div class="position-top-left"></div>'+(i='<div class="position-top-center"></div>'+(i='<div class="position-top-right"></div>'+(i='<div class="position-center-left">'+(i='<div class="position-center-right">'+(i+="</div>")+"</div>")+"</div>"))),i+='<div class="position-bottom-left"></div><div class="position-bottom-center"></div><div class="position-bottom-right"></div>';for(var a=$("div#msg-boxs-container"),c=(0==a.length&&(a=$('<div id="msg-boxs-container" class="msg-boxs-container"></div>'),$("body").append(a)),a.append(t),t.append($(i)).css({"z-index":"auto"==e.zIndex?void 0:e.zIndex,"display":"none"}),e.autoshow&&this.show(),t.find(".msg-btn-container").find("div[widget=button]")),a=t.find(".msg-btn-container").find("div[widget=combobox]"),h=0,g=c.length;h<g;h++)new $.su.widgets.button({id:$(c[h])}).render();0<a.length&&(this.comboBtn=new $.su.widgets.combobox({id:a.eq(0),customSettings:{itemWidth:e.comboWidth,autoWidth:!1,closerOptions:!0}})).render(),0<t.children("div[widget]").length&&t.children("div[widget]").appendTo(t.find("div.msg-content-container")),0<t.find("[data-slot]").length&&t.find(".msg-title").after(t.find("[data-slot]"));a=$(".widget-content");0===a.find(".ps__rail-y").length&&$.su.scrollbar({ele:a[0]}),e.titleTipText&&new $.su.widgets.toolTip({id:$(".widget-title").children("div[widget=toolTip]").not(".tooltip-container"),tipText:e.titleTipText}).render()},setComboBtn:function(t){this.comboBtn.loadItems(t)},show:function(t){var e=this.dom(),i=this.settings,s=this.getContainer();return this.showPromise=$.Deferred(),e.parent().append(e),i.mask&&!i.shown&&this.getMask().show(this.domId+" su-msg-mask"),i.shown=!0,s.removeClass("show").addClass("show"),s.show(),i.autoAdapt&&this.setPosition("center","center"),s.css({"opacity":1,"filter":"alpha(opacity=100)"}),$.isFunction(t)&&t(),$.su.emitModalEvent(e,!0),this.showPromise},close:function(t,e,i){var s=this.dom(),a=this.settings,n=this.getContainer(),o="function"===$.type(t)?t:null,t="boolean"===$.type(t)?t:"boolean"===$.type(e)&&e;a.shown&&(a.mask&&this.getMask().hide(this.domId+" su-msg-mask"),$.su.emitModalEvent(s,!1),t?n.fadeOut(i||200,function(){if(a.shown=!1,n.removeClass("show"),s.remove(),o)return o.call(this,this)}):n.fadeOut(i||200,function(){if(n.removeClass("show"),a.shown=!1,n.css({"display":"none","opacity":0,"filter":"alpha(opacity=0)"}),o)return o.call(this,this)}),this.setNormal(),s.triggerHandler("ev_msg_on_close"))},hide:function(){this.close()},setTitle:function(t,e){var i=this.dom(),s=this.settings;void 0!==t&&(s._title=t,e?i.find("span.msg-title-container").html(t):i.find("span.msg-title-container").html(this.transferTitle(t,s.titleTransferWidth)))},transferTitle:function(t,e){e=$.su.abbreviateStr(t,e,20,"16px "+$.su.defaultFont),t='<span data-tip="'+(e.abbreviate?$.su.escapeHtml(t):"")+'">';return t+$.su.escapeHtml(e.text)+"</span>"},setContent:function(t){var e=this.dom();t&&e.find("div.msg-content-container").text(t)},setContentByHtml:function(t){t&&this.dom().find("div.msg-content-container").html(t)},restoreContentHeight:function(t){$(t).height($(t).height())},hideContent:function(t){$(t).height(0)},showContent:function(t){var e=$(t).find('div[widget="fieldset"]').height();$(t).stop(),$(t).animate({height:e+12},300,function(){$(t).css("height","auto")})},removePosition:function(){this.dom().css({top:"",left:""})},showButtons:function(){this.dom().find("div.msg-btn-container").fadeIn(150)},hideButtons:function(){this.dom().find("div.msg-btn-container").css("display","none")},getButton:function(t){var e=this.dom();switch(t){case"yes":case"ok":return e.find(".btn-msg-ok").data("viewObj");case"no":return e.find(".btn-msg-no").data("viewObj");case"cancel":return e.find(".btn-msg-cancel").data("viewObj")}},disableButton:function(t){this.getButton(t).disable()},enableButton:function(t){this.getButton(t).enable()},showCloseButton:function(){this.dom().find("a.msg-close").show()},hideCloseButton:function(){this.dom().find("a.msg-close").hide()},setNormal:function(){this.dom().find("div[widget]").each(function(t,e){e=$(e).data("viewObj");e&&e.setNormal&&e.setNormal()})},setInfoType:function(t){this.dom().removeClass("success fail info alert").addClass(t)},getShownStatus:function(){return this.settings.shown},isFrozen:!1,freeze:function(t){this.isFrozen=!0;var e=this.getButton("ok");t?e.loading(!0):e.disable(),this.getButton("cancel").disable()},thaw:function(t){this.isFrozen=!1;var e=this.getButton("ok");t?e.loading(!1):e.enable(),this.getButton("cancel").enable()},updateTemplateStatus:function(t){var e=this.dom().find(".status-slot");if(!arguments.length)return e.addClass("hidden");t=$.su.serviceManager.get("siteTemplate").getTemplateStatusDom(t);""===t?e.addClass("hidden"):e.removeClass("hidden").html(t)}}),$.su.Widget.register("navigator",{settings:{items:{attribute:"items",defaultValue:null},itemWidget:{attribute:"item-widget",defaultValue:null},bubbleEvent:{attribute:"bubble",defaultValue:!1},level:{attribute:"level",defaultValue:null}},listeners:[{selector:"li.navigator-li-effective:not(.has-sub-navi)",event:"click",callback:$.su.debounce(function(t,e){t.stopPropagation();t=$(this).attr("navi-value");e.dom().triggerHandler("ev_navigator_clicked",[t])},400,!0)},{selector:".navigator-ul.navigator-ul-sub",event:"click",callback:function(t,e){t.stopPropagation()}},{selector:".navigator-li-level1.has-sub-navi",event:"mouseenter",callback:function(t,e){var i=$(this).attr("navi-value");e.showGlobalNav(t,i)}},{selector:".navigator-li-level1.has-sub-navi",event:"mouseleave",callback:function(t,e){t.stopPropagation(),e.globalTimer=setTimeout(()=>{e.hideGlobalNav()},200)}}],init:function(){var t=this.dom();this.addon=$.su.transferedStr(t.html()),this._hideItems=[],this.parentMap={},this.iconMap={"home":"home","dashboard":"dashboard","dashboardGlobal":"dashboard","dashboardCentral":"dashboard","dashboardMsp":"customer","sites":"site","statistics":"statistics","mapEntry":"map","devices":"device","deviceCentral":"device","accessPoints":"device","deviceProfile":"device","clients":"client","insight":"insight","license":"license","licenseCentral":"license","accountSetting-license":"license","log":"log","accountSetting-orders":"log","auditLogs":"auditLog","auditLogsCentral":"auditLog","accountSetting-auditLog":"auditLog","health":"health","abnormal":"abnormal","security":"security","firmware":"firmware","networkAnalyze":"tools","sdWan":"sd-wan","intelliRecover":"intelliRecover","networkReport":"reports","cloud":"cloud","admin":"user","settings":"settings","exportDataCentralGlobal":"export","hotspot":"hotspot","siteMsp":"site","siteProfile":"siteTemplate","maintenanceCentralGlobal":"maintenanceCentralGlobal"}},render:function(){var t=this.dom(),e=this.settings,i=(t.addClass(e.cls+"navigator-container"),""),e=(i=i+'<div class="widget-wrap-outer navigator-wrap-outer">'+'<div class="widget-wrap navigator-wrap">',e.items&&0<e.items.length&&(i+=this.createNavi(e.items,1)),i=i+"</div>"+"</div>",t.empty().append(i),$(".navigator-li-level1, .flat-nav-title"));$.each(e,function(t,e){$(e).find("div[widget=icon] .svg-icon").length||new $.su.widgets.icon({id:$(e).find("div[widget=icon]")}).render()}),0===t.find(".ps__rail-y").length&&"settingsMenu"!==this.domId&&$.su.scrollbar({ele:t[0]}),$.su.scrollbar({ele:$("#global-nav-wrapper")[0]})},createNavi:function(t,e){for(var i="navigator-ul",s=(i+=" navigator-ul-level"+e,1<e&&(i+=" navigator-ul-sub"),'<ul class="'+i+'">'),a=0;a<t.length;a++){var n=0===a?"first":a===t.length-1?"last":"";s+=this.createNaviItem(t[a],e,n)}return s=(s+="</ul>")+'<ul class="navigator-bottom">'+"</ul>"},createNaviItem:function(t,e,i){var s;return t.groupMenu?(s=(s='<div class="element-divider account-menu-x" /><div class="flat-nav"><li class="flat-nav-title">')+'<div widget="icon" svg-name="user" svg-class="sub-navigator-icon"></div>'+t.text+"</li>",t.children&&(s+=this.createNavi(t.children,e)),(s+="</div>")+'<div class="element-divider account-menu-x" />'):t.name?(s=this.iconMap[t.name],i='<li navi-value="'+t.name+'" class="navigator-li navigator-li-level'+e+" "+i+" "+(t.name===this._currentModule||this.parentMap[this._currentModule]===t.name?"selected ":"")+(t.children?" has-sub-navi":t.name?" navigator-li-effective":"")+(t.cls?" "+t.cls:"")+'"data-tip data-pointer="right"  data-tleft="52">',i=(i+="<a>")+`<div widget="icon" svg-name="${s}" svg-class="sub-navigator-icon"></div>`+'<span class="sub-navigator-text">'+t.text+'</span><span class="sub-navigator-icon-after"></span></a>',t.children&&(!this.settings.level||e<this.settings.level)&&(i+=this.createNavi(t.children,e+1)),i+"</li>"):'<li class="title">'+t.text+"</li>"},loadItems:function(t){return this.settings.items=t,this.updateParentMap(t),this.render(),$.Deferred().resolve().promise()},updateParentMap:function(t){this.parentMap={},$.each(t||[],(t,i)=>{i.children&&$.each(i.children,(t,e)=>{e.children?$.each(e.children,(t,e)=>{this.parentMap[e.name]=i.name}):this.parentMap[e.name]=i.name})})},setNotice:function(t,e){t=this.dom().find(".navigator-li-level1[navi-value="+t+"]");e?t.addClass("notice"):t.removeClass("notice")},refreshAlertNum:function(t){var e=this.dom().find('li[navi-value="log"] span.sub-navigator-icon-after');e.addClass("badge"),(t=999<t?"999+":t)?e.show()&&e.text(t):e.hide()},showToggle:function(){this.dom().toggleClass("show")},find:function(t){return this.dom().find("li.navigator-li[navi-value="+t+"]")},hasChildren:function(t){return 0<this.find(t).find("li.navigator-li").length},emptyHideItems:function(){this._hideItems=[]},showItems:function(t){var i=this;$.each(t,function(t,e){i.find(e).show();e=i._hideItems.indexOf(e);-1!==e&&i._hideItems.splice(e,1)})},hideItems:function(t){var i=this;$.each(t,function(t,e){i.find(e).hide(),-1===i._hideItems.indexOf(e)&&i._hideItems.push(e)})},select:function(t){this.dom().find("li.navigator-li").removeClass("selected"),(this.parentMap.hasOwnProperty(t)?(this.find(this.parentMap[t]).addClass("selected"),$("#global-nav-wrapper").find(".nav-item.selected").removeClass("selected"),$("#global-nav-wrapper").find('.nav-item[navi-value="'+t+'"]').addClass("selected"),$('.flat-nav li[navi-value="'+t+'"]')):this.find(t)).addClass("selected"),this._currentModule=t},isSelected:function(t){return this.find(t).hasClass("selected")},unSelect:function(t){this.find(t).removeClass("selected")},unSelectAll:function(){this.dom().find("li.navigator-li.selected").removeClass("selected")},open:function(t){this.find(t).addClass("expand")},close:function(t){this.find(t).removeClass("expand")},toggleOpen:function(t){this.find(t).toggleClass("expand")},closeAll:function(){this.dom().find("li.navigator-li.expand").removeClass("expand")},showGlobalNav:function(t,e){let i=this;var s=$("#global-nav-wrapper"),a=t.currentTarget.getBoundingClientRect(),n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=window.innerHeight-(a.top+t.currentTarget.clientHeight),t=(s.css({left:$.su.language.isRtl()?"auto":a.left+t.currentTarget.clientWidth+20,right:$.su.language.isRtl()?n-a.left+20:"auto",bottom:o+"px",opacity:0}),s.html(this.getPopOutNavHtml(e)),$("#global-nav-wrapper .nav-item").off("click").on("click",function(t){i.select(t.currentTarget.getAttribute("navi-value")),i.dom().triggerHandler("ev_navigator_clicked",t.currentTarget.getAttribute("navi-value")),i.hideGlobalNav()}),s.off("mouseenter").on("mouseenter",()=>{clearTimeout(i.globalTimer),$("#global-nav-wrapper").removeClass("u-d-none"),$("#global-nav-wrapper").css("opacity",1)}),s.off("mouseleave").on("mouseleave",()=>{i.globalTimer=setTimeout(()=>{i.hideGlobalNav()},200)}),clearTimeout(i.globalTimer),$("#global-nav-wrapper").removeClass("u-d-none"),s[0].getBoundingClientRect().height);window.innerHeight-(o+t)<56&&(o=window.innerHeight-(t+100),$("#global-nav-wrapper").css("bottom",o+"px")),$("#global-nav-wrapper").css("opacity",1)},hideGlobalNav:function(){$("#global-nav-wrapper").css("opacity",0),$("#global-nav-wrapper").addClass("u-d-none")},getPopOutNavHtml:function(i){let s=0,a=($.each(this.settings.items||[],(t,e)=>{"settings"===e.name&&(s=this.getModuleCount(e.children))}),`<div class="global-nav-container ${40<s?"most-modules":"few-modules"}">`);return $.each(this.settings.items||[],(t,e)=>{e.name===i&&$.each(e.children,(t,e)=>{-1===this._hideItems.indexOf(e.name)&&(a=(a+='<div class="block-nav-wrapper">')+'<div class="title">'+e.text+"</div>",$.each(e.children||[],(t,e)=>{if(-1===this._hideItems.indexOf(e.name)){let t="";e.name===this._currentModule&&(t="selected"),a+='<div class="nav-item '+t+'" navi-value="'+e.name+'">'+e.text+"</div>"}}),a+="</div>")})}),a+="</div>"},getModuleCount:function(t){if(!t||t.length<=0)return 0;var e=t.length;let i=0;return $.each(t||[],(t,e)=>{i+=this.getModuleCount(e.children)}),e+i},getSelected:function(){return this._currentModule}}),$.su.Widget.register("htmlLoader",{settings:{scroll:{attribute:"data-scroll",defaultValue:null}},init:function(){this.moduleName=null},render:function(){var t=this.dom(),e=this.settings;t.addClass(e.cls+"html-loader-container"),e.scroll&&$.fn.niceScroll&&t.niceScroll($.extend({arrow:!1,background:"#fff"},e.scroll))},load:function(t,e){var i=this.getContainer();i&&("object"===$.type(t)?i.append(t):"string"===$.type(t)&&i.html(t),e)&&e()},unload:function(){},setLoadingModuleName:function(t){this.moduleName=t},getLoadingModuleName:function(){return this.moduleName}}),$.su.Widget.register("mask",{settings:{},init:function(){},render:function(){this.dom().addClass("mask"),this.useMap={},this.hide()},show:function(t){var e=this.dom();t&&!this.useMap.hasOwnProperty(t)&&(this.useMap[t]=!0,e.show().addClass(t))},hide:function(t){var e=this.dom();!1===t?e.hide().removeClass().addClass("mask"):(this.useMap.hasOwnProperty(t)&&(delete this.useMap[t],e.removeClass(t)),this.checkUse()||e.hide())},checkUse:function(){var t,e=this.dom();for(t in this.useMap)if(this.useMap.hasOwnProperty(t))return e.addClass(t),!0;return!1}}),$.su.Widget.register("loading",{settings:{firstLoading:{attribute:"first-loading",defaultValue:!1},text:{attribute:"text",defaultValue:""},mask:{attribute:"mask",defaultValue:!0}},init:function(){},render:function(){var t=this.dom(),e='<div class="loading-container-wrap">';e=(e+='<div class="loading-container-inner">')+'<div class="loading-waiting-icon"></div><div class="loading-waiting-text">'+this.settings.text+"</div></div></div>",t.addClass("loading-container").append(e),this.useMap={},this.hide()},show:function(){var t=this.dom();this.settings.mask&&this.getMask().show(this.domId),t.show()},hide:function(){var t=this.dom();this.getMask().hide(this.domId),t.hide()},setText:function(t){this.dom().find(".loading-waiting-text").text(t)}}),$.su.Widget.register("echart",{settings:{type:{attribute:"type",defaultValue:"line"},width:{attribute:"width",defaultValue:480},height:{attribute:"height",defaultValue:280},chartConfigs:{attribute:"echartConfigs",defaultValue:{title:{text:"",subtext:"",x:30,y:20,textStyle:{fontSize:14}},legend:{data:[]},tooltip:{trigger:"axis"},toolbox:{show:!1},calculable:!1,series:[],animation:!1}}},init:function(){this.resizeCallback(this,this.resize)},init(){this.resizeCallback(this,this.resize)},destroy:function(){this.echart&&this.echart.clear(),$(window).off("ev_resize",this.resizeFunc)},destroy(){this.echart&&this.echart.clear(),$(window).off("ev_resize",this.resizeFunc),this.cancelResizeObserve()},render:function(t){var e=this,i=this.dom(),s=this.settings;i.addClass(s.cls+"chart-container");i.append('<div class="chart-before"></div><div class="chart-area"><div class="chart-scale"></div><div class="chart-canvas"></div></div><div class="chart-after"></div>'),void 0===window.echarts?$.su.router.loadScript("js/libs/echarts-e8eb209127.min.js",function(){$.su.router.loadScript("js/libs/s-dark-d1dd258a99.min.js",function(){"line"===s.type?e.initLine():"pie"===s.type?e.initPie():"gauge"===s.type&&e.initGauge(),t&&t()})}):window.echarts&&("line"===s.type?(e.initLine(),t&&t()):"pie"===s.type?(e.initPie(),t&&t()):"gauge"===s.type&&(e.initGauge(),t)&&t())},render(t){let e=this;var i=this.dom(),s=this.settings;i.addClass(s.cls+"chart-container");i.append('<div class="chart-before"></div><div class="chart-area"><div class="chart-scale"></div><div class="chart-canvas"></div></div><div class="chart-after"></div>'),void 0===window.echarts?$.su.router.loadScript("js/libs/echarts-e8eb209127.min.js",()=>{e.initChart(t)}):window.echarts&&e.initChart(t),this.resizeObserve()},reCreateCanvas:function(){var t=this.dom(),e=this.settings;t.find("div.chart-canvas").empty(),e.canvas=document.createElement("canvas"),e.canvas.width=e.width,e.canvas.height=e.height,t.find("div.chart-canvas").append(e.canvas),window.G_vmlCanvasManager&&(e.canvas=window.G_vmlCanvasManager.initElement(e.canvas)),this.ctx=e.canvas.getContext("2d")},reCreateCanvas(){var t=this.dom(),e=this.settings;t.find("div.chart-canvas").empty(),e.canvas=document.createElement("canvas"),e.canvas.width=e.width,e.canvas.height=e.height,t.find("div.chart-canvas").append(e.canvas),window.G_vmlCanvasManager&&(e.canvas=window.G_vmlCanvasManager.initElement(e.canvas)),this.ctx=e.canvas.getContext("2d")},resize:function(){this.echart.resize()},resize(){this.echart&&this.echart.resize()},resizeCallback:function(s,a){function t(t,e){var i=o.closest(s).width();a.call(n,e,i)}var n=this,o=this.dom();$(window).on("ev_resize",t),this.resizeFunc=t},resizeCallback(s,a){let n=this,o=this.dom();function t(t,e){var i=o.closest(s).width();a.call(n,e,i)}$(window).on("ev_resize",t),this.resizeFunc=t},getContainerSize:function(t){return this.dom().closest(t).width()},getContainerSize(t){return this.dom().closest(t).width()},initLine:function(){var t=this.dom(),e=this.settings,i=(e.chartConfigs,/^calc\(\d+% [\+|\-] \d+px\)|\d+%$/),t=t.css({width:i.test(e.width)?e.width:void 0,height:i.test(e.height)?e.height:void 0}).find(".chart-canvas").css({width:i.test(e.width)?"100%":e.width,height:i.test(e.height)?"100%":e.height}).get(0);$.appUtils.getCurrentThemeIsDark()?this.echart=echarts.init(t,"s-dark"):this.echart=echarts.init(t)},initPie:function(){var t=this.dom(),e=this.settings,i=e.chartConfigs,s=/^calc\(\d+% [\+|\-] \d+px\)|\d+%$/,t=t.css({width:s.test(e.width)?e.width:void 0,height:s.test(e.height)?e.height:void 0}).find(".chart-canvas").css({width:s.test(e.width)?"100%":e.width,height:s.test(e.height)?"100%":e.height}).get(0);$.appUtils.getCurrentThemeIsDark()?this.echart=echarts.init(t,"s-dark"):this.echart=echarts.init(t),this.setPieOption(i)},initGauge:function(){var t=this.dom(),e=this.settings,i=/^calc\(\d+% [\+|\-] \d+px\)|\d+%$/,t=t.css({width:i.test(e.width)?e.width:void 0,height:i.test(e.height)?e.height:void 0}).find(".chart-canvas").css({width:i.test(e.width)?"100%":e.width,height:i.test(e.height)?"100%":e.height}).get(0);$.appUtils.getCurrentThemeIsDark()?this.echart=echarts.init(t,"s-dark"):this.echart=echarts.init(t)},adjustDataLength:function(t,e){if(e.length>t)e.length=t;else if(e.length<t)for(;e.length<t;)e.push("-");return e},adjustDataLength(t,e){if(e.length>t)e.length=t;else if(e.length<t)for(;e.length<t;)e.push("-");return e},addData:function(t){for(var e=this.echart.getOption().series,i=t.length,s=0;s<i;s++){var a=t[s],n=e[a.seriesIndex].data,o=a.dataIndex;o>n.length-1?(n.shift(),n.push(a.data)):n[o]=a.data}this.echart.setOption({series:e}),this.resize()},addData(e){var i=this.echart.getOption().series,s=e.length;for(let t=0;t<s;t++){var a=e[t],n=i[a.seriesIndex].data,o=a.dataIndex;o>n.length-1?(n.shift(),n.push(a.data)):n[o]=a.data}this.echart.setOption({series:i}),this.resize()},setSeries:function(t){for(var e=this.echart.getOption().xAxis[0].data.length,i=0,s=t.length;i<s;i++)t[i].data=this.adjustDataLength(e,t[i].data);this.echart.setOption({series:t},!1),this.resize()},setSeries(i){var s=this.echart.getOption().xAxis[0].data.length;for(let t=0,e=i.length;t<e;t++)i[t].data=this.adjustDataLength(s,i[t].data);this.echart.setOption({series:i},!1),this.resize()},setOption:function(t,e){var i=this.settings;if((t=(e=void 0!==e&&e)?$.extend(!0,{},i.chartConfigs,t):t).xAxis){var s=t.xAxis[0].data.length;t.series=t.series||[];for(var a=0,n=i.chartConfigs.series.length;a<n;a++){var o=t.series[a]=t.series[a]||{};o.data=this.adjustDataLength(s,o.data||[])}}this.echart.setOption(t,e),this.resize()},setOption(i,t){var s=this.settings;if((i=(t=void 0!==t&&t)?$.extend(!0,{},s.chartConfigs,i):i).xAxis&&!s.dataset){var a=i.xAxis[0].data.length;i.series=i.series||[];for(let t=0,e=s.chartConfigs.series.length;t<e;t++){var n=i.series[t]=i.series[t]||{};n.data=this.adjustDataLength(a,n.data||[])}}i.textStyle={fontFamily:$.su.defaultFontFamily},this.echart.setOption(i,t),this.resize()},setPieOption:function(t,e){this.settings;this.echart.setOption(t,e),this.resize()},setPieOption(t,e){this.settings;t.textStyle={fontFamily:$.su.defaultFontFamily},this.echart.setOption(t,e),this.resize()},setLineOption:function(t,e){this.echart.setOption(t,e),this.resize()},setGaugeOption:function(t,e){this.echart.setOption(t,e),this.resize()},setGaugeOption(t,e){this.echart.setOption(t,e),this.resize()},clear:function(){this.echart.clear()},clear(){this.echart.clear()},initChart(t){let e=this;this.initCanvas(()=>{"pie"===e.settings.type?e.setPieOption(e.settings.chartConfigs):"line"===e.settings.type&&e.settings.lineChartConfigs&&e.setLineOption(e.settings.lineChartConfigs)}),t&&t()},initCanvas(t){var e=this.dom(),i=this.settings,s=/^calc\(\d+% [\+|\-] \d+px\)|\d+%$/,e=e.css({width:s.test(i.width)?i.width:void 0,height:s.test(i.height)?i.height:void 0}).find(".chart-canvas").css({width:s.test(i.width)?"100%":i.width,height:s.test(i.height)?"100%":i.height}).get(0);this.echart=echarts.init(e),t&&t()},setCustomOption(t,e){var i=this.settings;(e=void 0!==e&&e)&&(t=$.extend(!0,{},i.chartConfigs,t)),this.echart.setOption(t,e),this.resize()},getChartInstance(){return this.echart},resizeObserve:function(){var t=window.ResizeObserver,e=this.resize.bind(this);if(this.resizeObserver=new t($.su.debounce(function(){e()},100)),this.echartDoms=this.dom(),void 0!==this.echartDoms)for(var i=0;i<this.echartDoms.length;i++)this.resizeObserver.observe(this.echartDoms[i])},cancelResizeObserve:function(){if(void 0!==this.echartDoms)for(var t=0;t<this.echartDoms.length;t++)this.resizeObserver.unobserve(this.echartDoms[t])}}),$.su.Widget.register("accordion",{settings:{autoPosition:{attribute:"auto-position",defaultValue:!1},slideTime:{attribute:"slide-time",defaultValue:200},subTitle:{attribute:"sub-title",defaultValue:!1},numbering:{attribute:"numbering",default:!1}},listeners:[{selector:".accordion-header",event:"click",callback:function(t,e){var i,s=e.settings,t=$(t.target).closest(".accordion-item"),a=e.dom(),n=!0===a.data("conflict");if(!t.hasClass("disabled")){if(n)for(var o=a.find(".accordion-item.accordion-item-wrap"),r=0,d=o.length;r<d;r++)if(!$(o[r]).hasClass("collapsed")){i=$(o[r]);break}t.hasClass("collapsed")?(e.expandItem(t,s.slideTime),i&&e.collapseItem(i,s.slideTime)):e.collapseItem(t,s.slideTime),s.autoPosition&&0<e.dom().parents(".msg-container").length&&setTimeout(function(){$(window).trigger("resize")},201)}}}],init:function(){},render:function(){var t=this.dom(),e=this.settings;t.addClass(e.cls+"accordion-container"),this.renderItem()},renderItem:function(t){for(var e=this.dom(),i=this.settings,s=[],a=t?e.find("[data-name="+t+"] .accordion-item"):e.find(".accordion-item"),n="",o=0,r=a.length;o<r;o++){var d="",l=$.su.getAttrObject($.su.CHAR,$(a[o]).data("title")),c=!1!==$(a[o]).data("collapsed"),h=!!$(a[o]).attr("tip-text"),g=$(a[o]).data("name")||"accordion-name",n=$(a[o]).hasClass("u-d-none")?"u-d-none":"",d=(d=(d=(d=d+(c?'<div class="accordion-item accordion-item-wrap collapsed '+n+'" data-name="'+g+'">':'<div class="accordion-item accordion-item-wrap '+n+'" data-name="'+g+'">')+'<div class="accordion-header">')+'<div class="accordion-header-left">'+'<div class="collapse-icon"></div>')+"</div>"+('<div class="accordion-title">'+l+"</div>"))+'<div class="accordion-header-right">'+'<div class="accordion-template-status hidden"></div>',c=(i.subTitle&&(d+='<div class="accordion-sub-title">'+(c=(c=$(a[o]).attr("sub-title")||"")&&$.su.getAttrObject($.su.CHAR,c))+"</div>"),h&&(g=$(a[o]).attr("tip-text"),d+='<div widget="toolTip" id="'+(l=this.domId+"_tooltip_"+o)+'" class="accordion-tip" tip-text="'+g+'"></div>',s.push(l)),d=(d=(d+='<div class="accordion-icon"></div>')+"</div>"+"</div>")+'<div class="accordion-body"></div>'+"</div>",$(d));a[o].before(c[0]),$(c.find(".accordion-body")).append(a[o])}for(o=0;o<s.length;o++)new $.su.widgets.toolTip({id:$("#"+s[o])}).render()},loadItems:function(t){var e=this.settings,i=this.dom(),s=i,a=$();if($.isArray(t)||"object"!=typeof t||(t=[t]),$.isArray(t)&&!(t.length<0)){for(var n,o=0,r=(e.items=t).length;o<r;o++)n=t[o],a=a.add($("<div></div>").addClass("accordion-item").data("name",$.su.transSpecialChar(n.name)).data("title",$.su.transSpecialChar(n.header)).append("<p></p>").text($.su.transSpecialChar(n.content)));s.append(this._createItems(a)),i.triggerHandler("ev_view_update")}},_createItems:function(t){for(var e="",i=0,s=t.length,a="",n=[];i<s;i++){var o=$(t[i]).data("title"),o=$.su.getAttrObject($.su.CHAR,o)||o,r=!1!==$(t[i]).data("collapsed"),d=!!$(t[i]).attr("tip-text"),l=$(t[i]).data("name")||"accordion-name",e=$(t[i]).hasClass("u-d-none")?"u-d-none":"",a=(a+=r?'<div class="accordion-item accordion-item-wrap collapsed '+e+'" data-name="'+l+'">':'<div class="accordion-item accordion-item-wrap '+e+'" data-name="'+l+'">')+'<div class="accordion-header">'+'<span class="accordion-icon"></span>';this.settings.numbering&&(a+='<span class="accordion-index">'+(i+1)+".&nbsp;</span>"),a+='<span class="accordion-title">'+o+"</span>",d&&(r=$(t[i]).attr("tip-text"),a+='<div widget="toolTip" id="'+(l=this.domId+"_tooltip_"+i)+'" class="accordion-tip" tip-text="'+r+'"></div>',n.push(l)),a=(a+="</div>")+'<div class="accordion-body"></div>'+"</div>"}for(var c=$(a),i=0;i<s;i++)$(c.find(".accordion-body")[i]).append(t[i]);for(i=0;i<n.length;i++)new $.su.widgets.toolTip({id:$("#"+n[i])}).render();return c},collapseItem:function(t,e){var i;t&&(e=void 0===e?200:e,i=t.find(".accordion-body"),t.hasClass("collapsed")||(this.dom().triggerHandler("ev_accordion_collapse",[t.data("name")]),i.slideUp(e,function(){t.addClass("collapsed")})))},expandItem:function(t,e){var i,s=this;t&&(e=void 0===e?200:e,i=(t="string"===$.type(t)?this.dom().find(".accordion-item[data-name="+t+"]"):t).find(".accordion-body"),t.hasClass("collapsed"))&&i.slideDown(e,function(){s.dom().triggerHandler("ev_accordion_expand",[t.data("name")]),t.removeClass("collapsed")})},reSet:function(){for(var t=this.dom().find(".accordion-item.accordion-item-wrap"),e=0,i=t.length;e<i;e++){var s=$(t[e]);0===e?this.expandItem(s,0):this.collapseItem(s,0)}},goto:function(t){if(t)for(var e=this.dom().find(".accordion-item.accordion-item-wrap"),i=0,s=e.length;i<s;i++){var a=$(e[i]);t===a.data("name")?this.expandItem(a,0):this.collapseItem(a,0)}},showItem:function(t){this.dom().find(".accordion-item[data-name="+t+"]").removeClass("u-d-none")},hideItem:function(t){this.dom().find(".accordion-item[data-name="+t+"]").addClass("u-d-none")},disableItem:function(t){this.dom().find(".accordion-item[data-name="+t+"]").addClass("disabled")},enableItem:function(t){this.dom().find(".accordion-item[data-name="+t+"]").removeClass("disabled")},showAllItems:function(){this.dom().find(".accordion-item").removeClass("u-d-none")},hideAllItems:function(){this.dom().find(".accordion-item").addClass("u-d-none")},setTitle:function(t,e){this.dom().find(".accordion-item[data-name="+t+"] .accordion-title").text(e)},setTitleHtml:function(t,e){this.dom().find(".accordion-item[data-name="+t+"] .accordion-title").html(e)},setSubTitle:function(t,e){this.dom().find(".accordion-item[data-name="+t+"] .accordion-sub-title").text(e)},setSubTitleHtml:function(t,e){this.dom().find(".accordion-item[data-name="+t+"] .accordion-sub-title").html(e)},updateTemplateStatus:function(t,e,i){t=this.dom().find(".accordion-item[data-name="+t+"] .accordion-template-status"),e=$.su.serviceManager.get("siteTemplate").getTemplateStatusDom(e,i);""===e||void 0===e?t.addClass("hidden"):t.removeClass("hidden").html(e)}}),(()=>{var p=0,i=1,l=0,s=1,a=2,n=3,o=4,r=5,d=6,c=7,h=0,g=1,u=2,m=3,f=4,v=5,b=6,x=7,w=8;let y={_2G:"2G",_5G1:"5G1",_5G2:"5G2",_6G:"6G"},C=[y._2G,y._5G1,y._5G2,y._6G];var _="#2B2B2B",I="#FFFFFF",k="#355085",T="#00A870",S="rgba(255, 255, 255, 0.3)",P=0,A=1,R=0,E=1,M=2,D=3,O=4,H={apType:0,mac:"00-00-00-00-00-00",installType:0,height:2.4,x:0,y:0},L={dark:{RULER_COLOR:"#14D188",WALL_STRUCT:{start:0,end:0,obstacleId:"",decay2g:2,decay5g:5,decay6g:6,color:"#14D188"},MEASURE_ICON:'url("./theme/img/svg/MeasureCursorDark.svg") 8 8, auto',PEN_ICON:'url("./theme/img/svg/PenDark.svg") 10 4, auto'},light:{RULER_COLOR:T,WALL_STRUCT:{start:0,end:0,obstacleId:"",decay2g:2,decay5g:5,decay6g:6,color:T},MEASURE_ICON:'url("./theme/img/svg/MeasureCursor.svg") 8 8, auto',PEN_ICON:'url("./theme/img/svg/Pen.svg") 10 4, auto'}},N={};$.su.Widget.register("map",{settings:{showDeviceNameFlag:{attribute:"show-device-name",defaultValue:!1}},listeners:[{selector:function(){return{parent:window}},event:"ev_resize",callback:function(t,e,i){i.resize(),i.refresh()}}],init:function(){var t=sessionStorage.getItem(this.site+"_"+this.imgId+"_map-scale"),e=(this._isIE8="Microsoft Internet Explorer"==navigator.appName&&"MSIE8.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,""),this._isIpad="ipad"==navigator.userAgent.toLowerCase().match(/ipad/i),this.ApDetail=!1,this._eveMap={mousedown:this._isIpad?"touchstart":"mousedown",mousemove:this._isIpad?"touchmove":"mousemove",mouseup:this._isIpad?"touchend":"mouseup"},this.virtualApData=[],$.appUtils.getUiInterface("theme")?this.themeMap=L.dark:this.themeMap=L.light,this._imgLoaded=!1,this._imgPos={p1:0,p2:0},this.heartBeatMissMap={"Wave":"./theme/img/WaveHeartBeatMiss.png","Cloud-Square":"./theme/img/CloudSquareHeartBeatMiss.png","Outdoor-Old":"./theme/img/OutdoorOldHeartBeatMiss.png","Outdoor-New":"./theme/img/OutdoorNewHeartBeatMiss.png","n11-UK":"./theme/img/11nUKHeartBeatMiss.png","ac11-Compatible":"./theme/img/11acCompatibleHeartBeatMiss.png"},this.heartBeatMissIcon={},this);for(key in e.heartBeatMissMap){var i=new Image;i.src=e.heartBeatMissMap[key],e.heartBeatMissIcon[key]=i}this.gatewayMap={0:"./theme/img/GatewayDown.png",1:"./theme/img/GatewayUp.png",3:"./theme/img/GatewayHeartBeatMiss.png",4:"./theme/img/GatewayIsolated.png"},this.gatewayIcon={};var s=this;for(key in s.gatewayMap){var a=new Image;a.src=s.gatewayMap[key],s.gatewayIcon[key]=a}this.eap620Map={0:"./theme/img/EAP620Down.png",1:"./theme/img/EAP620Up.png",3:"./theme/img/EAP620HeartBeatMiss.png",4:"./theme/img/EAP620Isolate.png"},this.eap620Icon={};var n=this;for(key in n.eap620Map){var o=new Image;o.src=n.eap620Map[key],n.eap620Icon[key]=o}this.eap620OutdoorMap={0:"./theme/img/EAP620-Outdoor_HD_Down.png",1:"./theme/img/EAP620-Outdoor_HD_Up.png",3:"./theme/img/EAP620-Outdoor_HD_HeartBeatMiss.png",4:"./theme/img/EAP620-Outdoor_HD_Isolate.png"},this.eap620OutdoorIcon={};var r=this;for(key in r.eap620OutdoorMap){var d=new Image;d.src=r.eap620OutdoorMap[key],r.eap620OutdoorIcon[key]=d}this.eapMap={"Wave":"./theme/img/deviceIcon/Wave.png","Cloud-Square":"./theme/img/deviceIcon/Cloud-Square.png","Outdoor-Old":"./theme/img/deviceIcon/Outdoor-Old.png","Outdoor-New":"./theme/img/deviceIcon/Outdoor-New.png","n11-UK":"./theme/img/deviceIcon/n11-UK.png","ac11-Compatible":"./theme/img/deviceIcon/ac11-Compatible.png","hd620":"./theme/img/deviceIcon/hd620.png","hd620-outdoor":"./theme/img/deviceIcon/hd620-outdoor.png","eap650-wall":"./theme/img/deviceIcon/eap650-wall.png","eap655-wall":"./theme/img/deviceIcon/eap655-wall.png","eap615-we":"./theme/img/deviceIcon/eap615-we.png","eap118-lr-kit":"./theme/img/deviceIcon/eap118-lr-kit.png","ER706W":"./theme/img/deviceIcon/ER706W.png","ER706W-4G":"./theme/img/deviceIcon/ER706W-4G.png","ER706W-4G-V2":"./theme/img/deviceIcon/ER706W-4G-V2.png","ER605W":"./theme/img/deviceIcon/ER605W.png","G36W-4G":"./theme/img/deviceIcon/G36W-4G.png","DR3220v-4G":"./theme/img/deviceIcon/DR3220v-4G.png","DR3650v":"./theme/img/deviceIcon/DR3650v.png","DR3650v-4G":"./theme/img/deviceIcon/DR3650v-4G.png","ER703WP-4G-Outdoor":"./theme/img/deviceIcon/ER703WP-4G-Outdoor.png","AP8635-E":"./theme/img/deviceIcon/AP8635-E.png","AP8668-E":"./theme/img/deviceIcon/AP8668-E.png","EAP610GP-Desktop":"./theme/img/deviceIcon/EAP610GP-Desktop.png","EAP615GP-Wall":"./theme/img/deviceIcon/EAP615GP-Wall.png","EAP673-Extender":"./theme/img/deviceIcon/EAP673-Extender.png","EAP725-Wall":"./theme/img/deviceIcon/EAP725-Wall.png","EAP655-WE":"./theme/img/deviceIcon/EAP655-WE.png","EAP655-WE-AC":"./theme/img/deviceIcon/EAP655-WE-AC.png","EAP625GP-Wall":"./theme/img/deviceIcon/EAP625GP-Wall.png","EAP775-Wall":"./theme/img/deviceIcon/EAP775-Wall.png","EAP772-Outdoor":"./theme/img/deviceIcon/EAP772-Outdoor.png","EAP603GP-Desktop":"./theme/img/deviceIcon/EAP603GP-Desktop.png","EAP650_D30-Outdoor":"./theme/img/deviceIcon/EAP650_D30-Outdoor.png","ER706WP-4G":"./theme/img/deviceIcon/ER706WP-4G.png"},this.virtualApMap={"Wave":"./theme/img/virtualDeviceIcon/Wave.png","Cloud-Square":"./theme/img/virtualDeviceIcon/Cloud-Square.png","Outdoor-Old":"./theme/img/virtualDeviceIcon/Outdoor-Old.png","Outdoor-New":"./theme/img/virtualDeviceIcon/Outdoor-New.png","n11-UK":"./theme/img/virtualDeviceIcon/n11-UK.png","ac11-Compatible":"./theme/img/virtualDeviceIcon/ac11-Compatible.png","hd620":"./theme/img/virtualDeviceIcon/hd620.png","hd620-outdoor":"./theme/img/virtualDeviceIcon/hd620-outdoor.png","eap650-wall":"./theme/img/virtualDeviceIcon/eap650-wall.png","eap655-wall":"./theme/img/virtualDeviceIcon/eap655-wall.png","eap615-we":"./theme/img/virtualDeviceIcon/eap615-we.png","eap118-lr-kit":"./theme/img/virtualDeviceIcon/eap118-lr-kit.png","ER706W":"./theme/img/virtualDeviceIcon/ER706W.png","ER706W-4G":"./theme/img/virtualDeviceIcon/ER706W-4G.png","ER706W-4G-V2":"./theme/img/virtualDeviceIcon/ER706W-4G-V2.png","ER605W":"./theme/img/virtualDeviceIcon/ER605W.png","G36W-4G":"./theme/img/virtualDeviceIcon/G36W-4G.png","DR3220v-4G":"./theme/img/virtualDeviceIcon/DR3220v-4G.png","DR3650v":"./theme/img/virtualDeviceIcon/DR3650v.png","DR3650v-4G":"./theme/img/virtualDeviceIcon/DR3650v-4G.png","ER703WP-4G-Outdoor":"./theme/img/virtualDeviceIcon/ER703WP-4G-Outdoor.png","AP8635-E":"./theme/img/virtualDeviceIcon/AP8635-E.png","AP8668-E":"./theme/img/virtualDeviceIcon/AP8668-E.png","EAP610GP-Desktop":"./theme/img/virtualDeviceIcon/EAP610GP-Desktop.png","EAP615GP-Wall":"./theme/img/virtualDeviceIcon/EAP615GP-Wall.png","EAP673-Extender":"./theme/img/virtualDeviceIcon/EAP673-Extender.png","EAP725-Wall":"./theme/img/virtualDeviceIcon/EAP725-Wall.png","EAP655-WE":"./theme/img/virtualDeviceIcon/EAP655-WE.png","EAP655-WE-AC":"./theme/img/virtualDeviceIcon/EAP655-WE-AC.png","EAP625GP-Wall":"./theme/img/virtualDeviceIcon/EAP625GP-Wall.png","EAP775-Wall":"./theme/img/virtualDeviceIcon/EAP775-Wall.png","EAP772-Outdoor":"./theme/img/virtualDeviceIcon/EAP772-Outdoor.png","EAP603GP-Desktop":"./theme/img/virtualDeviceIcon/EAP603GP-Desktop.png","EAP650_D30-Outdoor":"./theme/img/virtualDeviceIcon/EAP650_D30-Outdoor.png","ER706WP-4G":"./theme/img/virtualDeviceIcon/ER706WP-4G.png"},this.allApsIcon={},this.updateAllApsIcon=function(){var t,e=this;for(key in e.eapMap)(t=new Image).crossOrigin="use-credentials",t.src=e.eapMap[key],e.allApsIcon[key]={img:t,filePath:e.eapMap[key]};for(key in e.virtualApMap)(t=new Image).crossOrigin="use-credentials",t.src=e.virtualApMap[key],e.allApsIcon[key+"-virtual"]={img:t,filePath:e.virtualApMap[key]}},this.updateAllApsIcon(),this.addMapIcon=function(t){var s=this,e=t.imgInfos,t=t.imgPathMap,a=t.smallImg,n=t.heatmapImg;$.each(e,function(t,e){if("ap"!==e.type&&"gateway"!==e.type)return!0;var i=e.imgName;e.imgBucketPathMap?(s.eapMap[i]=e.imgBucketPathMap.smallImgBucketPathForWeb,s.virtualApMap[i]=e.imgBucketPathMap.heatmapImgBucketPathForWeb):(s.eapMap[i]=a+"/"+i+".png",s.virtualApMap[i]=n+"/"+i+".png")}),s.updateAllApsIcon()},this.addMapIcon($.su.serviceManager.get("deviceInfo").getDeviceInfo()),this._fireList=[],this._globalEventList={mouseup:[],touchend:[]},this._apMoving=!1,this._mapMoving=!1,this._isPainting=!1,this.deleteWallIndex=-1,this._mapBtnStatus="",this._sourceSizeRate=.85,this._scaleRate=t?parseInt(t,10):4,this._scaleArr=[.25,.375,.5,.75,1,1.5,2,3,4],this._apUpSrc={x:10,y:71,w:40,h:40},this._apIsolatedSrc={x:692,y:158,w:40,h:40},this._apDownSrc={x:380,y:73,w:40,h:40},this._apLockSrc={x:70,y:73,w:33,h:34},this._apLockHoverSrc={x:108,y:73,w:33,h:34},this._apUnlockSrc={x:146,y:73,w:33,h:34},this._apUnlockHoverSrc={x:183,y:73,w:33,h:34},this._apSettingSrc={x:223,y:73,w:33,h:34},this._apSettingHoverSrc={x:552,y:73,w:33,h:34},this._apSettingDisableSrc={x:299,y:73,w:33,h:34},this._apRemoveSrc={x:261,y:73,w:33,h:34},this._apRemoveHoverSrc={x:514,y:73,w:33,h:34},this._apRemoveDisableSrc={x:337,y:73,w:33,h:34},this._apUnLocateSrc={x:337,y:73,w:33,h:34},this._apUnLocateHoverSrc={x:337,y:73,w:33,h:34},this._apLocateSrc={x:337,y:73,w:33,h:34},this._apLocateHoverSrc={x:337,y:73,w:33,h:34},this._apLocateDisableSrc={x:337,y:73,w:33,h:34},this._iconMap={defaultIcon:{},"Wave":{_apUpSrc:{x:10,y:460,w:38,h:38},_apDownSrc:{x:52,y:460,w:38,h:38},_apIsolatedSrc:{x:93,y:460,w:38,h:38},_apHeartBeatMissSrc:{x:-1,y:-1,w:42,h:42}},"Cloud-Square":{_apUpSrc:{x:135,y:458,w:38,h:38},_apDownSrc:{x:177,y:458,w:38,h:38},_apIsolatedSrc:{x:219,y:458,w:38,h:38},_apHeartBeatMissSrc:{x:-1,y:-1,w:42,h:42}},"Outdoor-Old":{_apUpSrc:{x:10,y:508,w:20,h:76},_apDownSrc:{x:34,y:508,w:20,h:76},_apIsolatedSrc:{x:58,y:508,w:20,h:76},_apHeartBeatMissSrc:{x:-1,y:-1,w:42,h:80}},"Outdoor-New":{_apUpSrc:{x:80,y:500,w:16,h:86},_apDownSrc:{x:100,y:500,w:16,h:86},_apIsolatedSrc:{x:118,y:500,w:16,h:86},_apHeartBeatMissSrc:{x:-1,y:-1,w:42,h:90}},"n11-UK":{_apUpSrc:{x:135,y:498,w:38,h:38},_apDownSrc:{x:177,y:498,w:38,h:38},_apIsolatedSrc:{x:219,y:498,w:38,h:38},_apHeartBeatMissSrc:{x:-1,y:-1,w:42,h:42}},"ac11-Compatible":{_apUpSrc:{x:136,y:539,w:32,h:44},_apDownSrc:{x:177,y:539,w:32,h:44},_apIsolatedSrc:{x:219,y:539,w:32,h:44},_apHeartBeatMissSrc:{x:-1,y:-1,w:42,h:50}},"hd620":{_apUpSrc:{x:2,y:2,w:42,h:42},_apDownSrc:{x:2,y:2,w:42,h:42},_apIsolatedSrc:{x:2,y:2,w:42,h:42},_apHeartBeatMissSrc:{x:2,y:2,w:42,h:42}},"hd620-outdoor":{_apUpSrc:{x:3,y:3,w:42,h:60},_apDownSrc:{x:3,y:3,w:42,h:60},_apIsolatedSrc:{x:3,y:3,w:42,h:60},_apHeartBeatMissSrc:{x:3,y:3,w:42,h:60}},"gateway":{_apUpSrc:{x:1,y:1,w:64,h:30},_apDownSrc:{x:1,y:1,w:64,h:30},_apIsolatedSrc:{x:1,y:1,w:64,h:30},_apHeartBeatMissSrc:{x:1,y:1,w:64,h:30}}},this._apOptionRePos={defaultPos:{lock:{left:-16,top:-60,w:33,h:34},setting:{left:-60,top:-16,w:33,h:34},remove:{left:-16,top:25,w:33,h:34},locate:{left:28,top:-16,w:33,h:34}},"Outdoor-Old":{lock:{left:-16,top:-75,w:33,h:34},setting:{left:-60,top:-16,w:33,h:34},remove:{left:-16,top:40,w:33,h:34},locate:{left:28,top:-16,w:33,h:34}},"Outdoor-New":{lock:{left:-16,top:-80,w:33,h:34},setting:{left:-50,top:-20,w:33,h:34},remove:{left:-16,top:40,w:33,h:34},locate:{left:18,top:-20,w:33,h:34}}},this.mapAps=[],this._apLabelSize={label:{w:130,h:40,maxW:200,pointPos:{left:4,top:-20},borderWidth:3,borderColor:"#399CC6",fillColor:"#fff",font:"14px "+$.su.defaultFont,padding:{left:13,top:24}},details:{w:240,h:140,maxDetailW:900,wrapH:140,pointPos:{left:4,top:-20},borderWidth:3,borderColor:"#399CC6",fillColor:"#fff",font:"14px "+$.su.defaultFont,padding:{left:13,top:24},lineHeight:20,valueOffset:100}},this._apDetailNames=[{name:"name",text:$.su.CHAR.MAP.NAME},{name:"mac",text:$.su.CHAR.MAP.MAC_ADDRESS},{name:"ip",text:$.su.CHAR.MAP.IP_ADDRESS},{name:"channel",text:$.su.CHAR.MAP.CHANNEL,default:"0"},{name:"userNum",text:$.su.CHAR.MAP.USERS,default:"0"},{name:"guestNum",text:$.su.CHAR.MAP.GUESTS,default:"0"}],this._dragingApLabel="",this._apLabelOffset={left:30,top:0},this._apLabelType="",this._apCoverage=!1,this.wallPoints=[],this.iconSize=void 0,this.originalWallsInfo=[],this.mapStatus=p,this.mapPreviewStatus=l,this.mapEditStatus=h,this.rulerInfo=void 0,this.showEmulateImage=!0,this.progressIndex=0,this.deviceInfosType=["name","mac","ip","status","showModel","version","uptime","clients","rate","channel","sendPower","height"],this.AP_STATUS={0:$.su.CHAR.MAP.DISCONNECTED,1:$.su.CHAR.MAP.DISCONNECTED_M,10:$.su.CHAR.MAP.PROVISION,11:$.su.CHAR.MAP.CONFIG,12:$.su.CHAR.MAP.UPGRADE,13:$.su.CHAR.MAP.REBOOT,14:$.su.CHAR.MAP.CONNECTED,15:$.su.CHAR.MAP.CONNECTED_W,16:$.su.CHAR.MAP.CONNECTED_M,17:$.su.CHAR.MAP.CONNECTED_W_M,20:$.su.CHAR.MAP.PENDING,21:$.su.CHAR.MAP.PENDING_W,22:$.su.CHAR.MAP.ADOPTING,23:$.su.CHAR.MAP.ADOPTING_W,24:$.su.CHAR.MAP.ADOPT_FAIL,25:$.su.CHAR.MAP.ADOPT_FAIL_W,26:$.su.CHAR.MAP.MANAGED_BY_OTHERS,27:$.su.CHAR.MAP.MANAGED_BY_OTHERS_W,30:$.su.CHAR.MAP.HEARTBEAT_MISSED,31:$.su.CHAR.MAP.HEARTBEAT_MISSED_W,32:$.su.CHAR.MAP.HEARTBEAT_MISSED_M,33:$.su.CHAR.MAP.HEARTBEAT_MISSED_W_M,40:$.su.CHAR.MAP.ISOLATED,41:$.su.CHAR.MAP.ISOLATED_M}},render:function(){var t=this.dom();t.addClass("ap-map"),this.canvas=document.createElement("canvas"),this.canvas.width=600,this.canvas.height=400,this._isIE8&&(this.canvas=window.G_vmlCanvasManager.initElement(this.canvas)),t.prepend(this.canvas),this.canvas.getContext&&(this.ctx=this.canvas.getContext("2d")),this.initScaleLayer(),this.resize(),this.scaleSetup=t.find('[data-name="setScaler"]'),this.powerToColorMap=$.su.serviceManager.get("heatMap").getPowerToColor(),this.colorToPowerMap=this.getColorToPowerMap(this.powerToColorMap),this.addGlobalListener(),this.setEvent()},getColorToPowerMap:function(t){var i={};return $.each(t,function(t,e){i[e.fill.split(",")[0].split("(")[1]]=t}),i},destroy:function(){this.removeGlobalListener(),this._activeAp=null,this._dragingIcon=!1,$("#"+this._dragIconId).remove(),$("body").off(this._eveMap.mousemove,this.dragMouseMove)},addGlobalListener:function(){var a=this;a._gloablEventDealer=function(t){for(var e=a._globalEventList.mouseup,i=0,s=e.length;i<s;i++)e[i].call(a,t)},$(document).on("mouseup",a._gloablEventDealer)},removeGlobalListener:function(){$(document).off(this._eveMap.mouseup,this._gloablEventDealer),$("body").off(this._eveMap.mouseup,this.globalMouseUp),$("body").off(this._eveMap.mouseup,this.confMouseUp)},listenGlobalEvent:function(t,e){for(var i=this._globalEventList[t],s=0,a=i.length;s<a;s++)if(i[s]===e)return!1;return this._globalEventList[t].push(e)},removeGlobalEvent:function(t,e){for(var i=this._globalEventList[t],s=0,a=i.length;s<a;s++)if(i[s]===e)return i.splice(s,1),!0;return!1},refresh:function(){var t=this;t.clean("main"),t.drawBackGroundImage(),t.drawEmulateImage(this.ctx),t.drawEmulateResultImage(),t.drawRestoreWall(),t.refreshAps()},setImage:function(t,e,i,s){var a=this,n=new Image,n=(n.crossOrigin="use-credentials",this.img=n,this._imgPos={},a.resize(),n.onload=function(){a.zoomSourceImage();var t=a.getImagePos();a._activeAp=null,a._imgLoaded=!0,a._imgPos=t,a.fireEvent(),a.initLastEmulateImage(),a.dom().triggerHandler("ev_scale_init"),a.isCanvasResize()?(a.dom().triggerHandler("ev_init_finish"),a.dom().triggerHandler("ev_refresh_emulate")):setTimeout(function(){a.refresh(),window.requestAnimationFrame(function(){a.refresh(),a.dom().triggerHandler("ev_init_finish")})},0)},n.src=t,a.mapInfo=e,a.site=e.site,a.imgId=e.mapId,a.channelType=e.channel,sessionStorage.getItem(this.site+"_"+this.imgId+"_map-scale"));this._scaleRate=n?parseInt(n,10):4},initLastEmulateImage:function(){var t=this;t.emulateResultImage=$.su.serviceManager.get("heatMap").getEmulateResult(t.site+"_"+t.imgId),t.emulateResultImage&&t.emulateResultImage[t.channelType]&&t.changeEmulateStatus(!0),t.dom().triggerHandler("ev_last_emulate")},initMapObstacles:function(t){this.mapObstacles=t},initMapAps:function(t){this.mapAps=t},initMapWalls:function(t){var s=this;s.originalWallsInfo=t,$.each(s.originalWallsInfo,function(t,i){$.each(s.mapObstacles,function(t,e){i.obstacleId===e.id&&(i.color=s.convertToRgba(e.colorPicker),i.obstacleId=e.id,i.decay2g=e.decay2g,i.decay5g=e.decay5g,i.decay6g=e.decay6g)})})},zoomSourceImage:function(){var t=1,e=this.img.width,i=this.img.height,s=this.canvas.width,a=this.canvas.height;(s-e)/s<(a-i)/a?(t=s*this._sourceSizeRate/e,this.zoomValue=s/e):(t=a*this._sourceSizeRate/i,this.zoomValue=a/i),this._sourceZoom=t},setEvent:function(){var i=this;$(i.canvas).off(i._eveMap.mousedown).on(i._eveMap.mousedown,function(t){i.mouseDown(t)}).off(i._eveMap.mousemove).on(i._eveMap.mousemove,function(t){i.mouseMove(t)}),i.addMousewheelEvent(),i.globalMouseUp||(i.globalMouseUp=function(){i.mapStatus===p?i.previewMouseup():i.editMouseup()}),$(i.canvas).on(i._eveMap.mouseup,i.globalMouseUp),document.onkeydown=function(t){"Enter"===t.key&&i.stopDrawWall()},window.addEventListener("unload",function(t){0<i.originalWallsInfo.length&&localStorage.setItem(i.site+"_"+i.imgId+"_map-walls",JSON.stringify(i.originalWallsInfo))}),$.su.moduleManager.get("mapEapConfig")&&$.su.moduleManager.get("mapEapConfig").on("ev_drawer_ap_highlight",function(t,e){i.updateApBackground(e)})},addMousewheelEvent:function(){var e=this;$(e.canvas).off("mousewheel").on("mousewheel",function(t){return t.ctrlKey||t.metaKey||!e.isEnableWheelScale()||(t.preventDefault(),e.scaleCanvas(t.originalEvent.wheelDelta)),t.stopPropagation(),t.preventDefault(),t.returnValue=!1}).off("DOMMouseScroll").on("DOMMouseScroll",function(t){return t.ctrlKey||t.metaKey||!e.isEnableWheelScale()||e.scaleCanvas(40*-t.originalEvent.detail),t.stopPropagation(),t.preventDefault(),t.returnValue=!1})},isEnableWheelScale:function(){var t=this;return!(t.mapPreviewStatus===s||t.mapPreviewStatus===o||t.mapPreviewStatus===c||t.mapPreviewStatus===d||t.mapEditStatus===g||t.mapEditStatus===b||t.mapEditStatus===x)},previewMouseup:function(){var t=this;switch(t.mapPreviewStatus){case a:$.su.moduleManager.get("main").trigger("ev_show_preview_settings",[t._activeAp]),t.updateApBackground(t._activeAp.id),t.changePreviewStatus(l);break;case n:t.changePreviewStatus(l);break;case s:t.rulerInfo&&t.drawRuler()&&t.stopPlottingScale();break;case o:t.rulerInfo&&t.drawRuler()&&t.stopOneRanging()}},editMouseup:function(){var t=this;switch(t.mapEditStatus){case u:var e=t.getApAbPos(t._activeAp.x,t._activeAp.y),i=t.getApAbPos(t._apMoving.x,t._apMoving.y);JSON.stringify(e)===JSON.stringify(i)?($.su.moduleManager.get("main").trigger("ev_show_edit_settings",[t._activeAp]),t.updateApBackground(t._activeAp.id),t.dom().triggerHandler("ev_end_move_without_set")):t.dom().triggerHandler("ev_map_move_ap",[$.su.clone(t._activeAp)]),t._apMoving=!1,t.changeEditStatus(h);break;case v:t.changeEditStatus(h);break;case b:t.rulerInfo&&t.drawRuler()&&t.stopPlottingScale();break;case x:t.rulerInfo&&t.drawRuler()&&t.stopOneRanging()}},updateEditStatus:function(t){var e;switch(this.mapEditStatus){case h:case m:case f:(e=this)._activeAp=e.getActiveAp(t),e._apMoving=$.su.clone(e._activeAp),e._apMoving?e.changeEditStatus(u):e.isSelectedWall(t)?e.changeEditStatus(m):e.isClickDeleteBtn(t)?e.changeEditStatus(f):e.changeEditStatus(v)}},updatePreviewStatus:function(t){var e;switch(this.mapPreviewStatus){case l:case a:(e=this)._activeAp=e.getActiveAp(t),e._activeAp?e.changePreviewStatus(a):e.changePreviewStatus(n)}},mouseDown:function(t){var e=this,i=e.getEventPosition(t);e._moveStart={x:i.x,y:i.y,imgX:e._imgPos.p1,imgY:e._imgPos.p2},e.mapStatus===p?e.previewMousedown(t,i):e.editMousedown(t,i)},previewMousedown:function(t,e){var i=this;if(0===t.button)switch(i.updatePreviewStatus(e),i.mapPreviewStatus){case l:break;case s:case o:i.addNewLine(t,"ruler");break;case n:i._mapMoving=!0;break;case d:i.rectCoveragePoints.length<2&&i.rectCoveragePoints.push(e);break;case c:void 0!==i.irregularPoints&&i.irregularPoints.push(e)}else if(2===t.button)switch(i.mapPreviewStatus){case s:case o:i.stopDrawWall();break;case d:1===i.rectCoveragePoints.length&&(i.rectCoveragePoints=[],i.refresh());break;case c:i.stopCropping()}},editMousedown:function(t,e){var i=this;if(0===t.button)switch(i.updateEditStatus(e),i.mapEditStatus){case h:break;case g:i.addNewLine(t,"wall");break;case b:case x:i.addNewLine(t,"ruler");break;case u:i.dom().triggerHandler("ev_start_move"),i.moveApTop(i._apMoving.id);break;case m:i.deleteWallIndex=i.getDeleteWallIndex(),i.refresh();break;case f:i.deleteWall(),i.refresh();break;case v:i._mapMoving=!0;break;case w:i.dom().triggerHandler("ev_copy_ap",[this.copyApId,i.convertToOriginal(i.getEventPosition(t))])}else 2===t.button&&(i.mapEditStatus===w?i.stopCopyAp():i.stopDrawWall())},mouseMove:function(t){t.preventDefault();var e=this,t=e.getEventPosition(t);(e._apMoving||e._mapMoving)&&(e._moveOffset={x:t.x-e._moveStart.x,y:t.y-e._moveStart.y}),e.mapStatus===p?e.previewMousemove(t):e.editMousemove(t)},previewMousemove:function(t){var e=this;switch(e.mapPreviewStatus){case h:e.changeCursor(t);break;case n:e.moveMap();break;case s:case o:e.recordClickPosition&&e.refresh(),e.drawLastLine(t,"ruler");break;case r:e.calculatePointPower(t);break;case d:e.rectCropping(t);break;case c:e.irregularCropping(t)}},editMousemove:function(t){var e=this;switch(e.mapEditStatus){case h:e.changeCursor(t);break;case g:e.refresh(),e.drawLastLine(t,"wall");break;case b:case x:e.recordClickPosition&&e.refresh(),e.drawLastLine(t,"ruler");break;case u:var i=e._apMoving;e._activeAp.x=i.x+e._moveOffset.x/e.getScaleRate(),e._activeAp.y=i.y+e._moveOffset.y/e.getScaleRate(),e.refresh();break;case m:e.changeCursor(t);break;case v:e.moveMap()}},moveMap:function(){var t=this,e=t._moveStart.imgX+t._moveOffset.x,i=t._moveStart.imgY+t._moveOffset.y;t._isPainting||(t._isPainting=!0,t.setImagePos(e,i),t.refresh())},changeCursor:function(t){var e=this;e.isSelectedWall(t)||e.isSelectedAp(t)?e.setCursor(e.canvas,"pointer"):e.setCursor(e.canvas,"default")},getDeleteWallIndex:function(){var t=-1,e=this.originalWallsInfo.length;if(e)for(var i=0;i<e;i++)this.originalWallsInfo[i].isSelected&&(t=i);return t},addNewLine:function(t,e){var i=this;i.mousedownPosition={x:i.getEventPosition(t).x,y:i.getEventPosition(t).y},"wall"===e?i.addWallsInfo():i.addRulerInfo(),i.recordClickPosition=i.mousedownPosition},irregularCropping:function(t){if(this.irregularPoints&&this.irregularPoints.length){var e=this.ctx,i=this.irregularPoints.length;this.refresh(),e.beginPath(),e.strokeStyle=k,e.moveTo(this.irregularPoints[0].x,this.irregularPoints[0].y);for(var s=1;s<i;s++)e.lineTo(this.irregularPoints[s].x,this.irregularPoints[s].y);t&&e.lineTo(t.x,t.y),e.closePath(),e.fillStyle=S,e.fill(),e.stroke()}},stopCropping:function(){this.irregularCropping(),this.irregularPointsSaved=$.su.clone(this.irregularPoints),this.irregularPoints=void 0},resize:function(){var t=$(this.canvas).parent().height(),e=$(this.canvas).parent().width();this.canvas.height=t,this.canvas.width=e,this.emulateResultCanvas&&(this.emulateResultCanvas.height=t,this.emulateResultCanvas.width=e),this.img&&(t=this.getImagePos()).s1&&t.s2&&this.setImagePos(t.p1,t.p2)},getImagePos:function(){var t=this,e=t.canvas.width,i=t.canvas.height,t=t._imgPos.s1&&t._imgPos.s2?[t._imgPos.s1,t._imgPos.s2]:t.scaleImage(),s=sessionStorage.getItem(this.site+"_"+this.imgId+"_map-posi"),s=(s?[(s=JSON.parse(s)).x,s.y]:[(e-t[0])/2,(i-t[1])/2]).concat(t);return{p1:s[0],p2:s[1],s1:s[2],s2:s[3]}},setImagePos:function(t,e){t=Math.floor(t),e=Math.floor(e),this._imgPos.p1=t,this._imgPos.p2=e,this._isPainting=!1,sessionStorage.setItem(this.site+"_"+this.imgId+"_map-posi",JSON.stringify({x:t,y:e}))},scaleImage:function(t){var e=this.img.width,i=this.img.height;return[e*this.getScaleRate(t),i*this.getScaleRate(t)]},getScaleRate:function(t){return this._scaleArr[t||this._scaleRate]*this._sourceZoom},drawImage:function(t,e,i,s,a,n,o,r,d){t&&(void 0===n?this.ctx.drawImage(t,0,0,t.width,t.height,e,i,s,a):this.ctx.drawImage(t,n,o,r,d,e,i,s,a))},drawEmulateResultImage:function(){this.emulateResultCtx&&(this.emulateResultCtx.clearRect(0,0,this.emulateResultCanvas.width,this.emulateResultCanvas.height),this.drawEmulateImage(this.emulateResultCtx))},scaleCanvas:function(t){var e,i=1;if(t<0&&0<this._scaleRate)--this._scaleRate,e=this.scaleImage(),i=this._scaleArr[this._scaleRate]/this._scaleArr[this._scaleRate+1];else{if(!(0<t&&this._scaleRate<8)){if(0!==t)return;this._lastScaleRate=this._scaleRate;for(var s=0;s<this._scaleArr.length;s++)if(this._scaleArr[s]*this._sourceZoom>this.zoomValue){this._scaleRate=s-1;break}e=this.scaleImage(),i=this._scaleArr[this._scaleRate]/this._scaleArr[this._lastScaleRate],sessionStorage.setItem(this.site+"_"+this.imgId+"_map-scale",this._scaleRate),this.clean("main");var a=(this.canvas.width-e[0])/2,n=(this.canvas.height-e[1])/2;return this._imgPos={p1:a,p2:n,s1:e[0],s2:e[1]},this.refresh(),this.dom().triggerHandler("ev_scale_reset"),void sessionStorage.setItem(this.site+"_"+this.imgId+"_map-posi",JSON.stringify({x:a,y:n}))}this._scaleRate+=1,e=this.scaleImage(),i=this._scaleArr[this._scaleRate]/this._scaleArr[this._scaleRate-1]}var t=this._imgPos,o=this.canvas.width/2,r=this.canvas.height/2,d=t.p1+t.s1/2,t=i*(t.p2+t.s2/2-r),a=o+i*(d-o)-e[0]/2,n=r+t-e[1]/2;sessionStorage.setItem(this.site+"_"+this.imgId+"_map-scale",this._scaleRate),this.clean("main"),this._imgPos={p1:a,p2:n,s1:e[0],s2:e[1]},this.refresh(),this.dom().triggerHandler("ev_scale_reset"),sessionStorage.setItem(this.site+"_"+this.imgId+"_map-posi",JSON.stringify({x:a,y:n}))},initScaleLayer:function(){var t=this,e=new Image,e=((t.iconImg=e).src="./theme/img/iconsX.png",new Image),e=((t.locateImg=e).src="./theme/img/Locate-normal.png",new Image),e=((t.locateHoverImg=e).src="./theme/img/Locate-hover.png",new Image),e=((t.unLocateImg=e).src="./theme/img/Unlocate-normal.png",new Image),e=((t.unLocateHoverImg=e).src="./theme/img/Unlocate-hover.png",new Image),e=(e.crossOrigin="use-credentials",(t.deleteIcon=e).src="./theme/img/delete.png",new Image),e=(e.crossOrigin="use-credentials",(t.txRateIcon=e).src="./theme/img/Uplink.png",new Image);e.crossOrigin="use-credentials",(t.rxRateIcon=e).src="./theme/img/Downlink.png"},initApAction:function(t,e){var a,i,n=this,o=($(this.canvas).offset(),{});n._apListObj=$(t).data("viewObj"),"store"===n._apListObj.dataBind[0].dataObj.tag?n._apListData=n._apListObj.dataBind[0].getData():n._apListData=n._apListObj.dataBind[0].getAllData(),n._apListData=n._apListData.concat(n.virtualApData),n._dragIconId=$.su.randomId("drag"),n._isIpad&&$(t).find(".devicesList-content-container").css("padding-right","30px"),n._actionAuth=e,n.dragMouseMove?a=n.dragMouseMove:(a=function(t){n._dragingIcon&&(t.preventDefault(),t=n.getPointerPos(t),o=t,$("#"+n._dragIconId).css({left:t.x-(n._isIpad?0:n._dragingSrc.w/2),top:t.y-(n._isIpad?0:n._dragingSrc.h/2)}))},n.dragMouseMove=a),n.dropMouseUp?i=n.dropMouseUp:n.dropMouseUp=i=function(t){var e;n._dragingIcon&&(e=(void 0===(t=n.getPointerPos(t)).x?o:t).x-$(n.canvas).offset().left,t=(void 0===t.y?o:t).y-$(n.canvas).offset().top,n._dragingIcon=!1,$("#"+n._dragIconId).remove(),n._dragingAp=null,n.isApInCanvas(e,t)?(e=n.getApAbPos(e,t),n.setAp(n._dragingApLabel,e.x,e.y),n._dragingApLabel=""):n.dom().triggerHandler("ev_end_move_without_set"))},e&&($(t).off(n._eveMap.mousedown).on(n._eveMap.mousedown,".grid-content-tr",function(t){var e,t=n.getPointerPos(t),i=$('<div id="'+n._dragIconId+'"></div>'),s=$(this).attr("data-key");s&&(s=n.getApData(s),$("body").off(n._eveMap.mousemove,a).on(n._eveMap.mousemove,a),n._dragingApLabel=s,o=t,e=n.getApIcon(s),i.css({position:"absolute",top:t.y-(n._isIpad?0:e.h/2),left:t.x-(n._isIpad?0:e.w/2),width:e.w+"px",height:e.h+"px",background:"url("+e.filePath+") no-repeat",backgroundSize:"contain"}),$("body").append(i),n._dragingIcon=!0,n._dragingAp=s,n._dragingSrc=e,n.dom().triggerHandler("ev_start_move"))}),$("body").off(n._eveMap.mouseup,i).on(n._eveMap.mouseup,i))},addVirtualApData:function(t){this.virtualApData=this.virtualApData.concat($(t).data("viewObj").dataBind[0].getAllData())},isApInCanvas:function(t,e){var i=this.canvas.width,s=this.canvas.height;return $("#menu").outerWidth()+$("#add-eap-drawer").outerWidth()-$(this.canvas).offset().left<=t&&t<=i&&0<=e&&e<=s},setAp:function(t,e,i){t=this.getSetApInfo(t,e,i);this.mapAps.push($.extend({},H,t)),this.dom().triggerHandler("ev_map_add_ap",[$.su.clone(t)]),this.drawAp()},getSetApInfo:function(t,e,i){var s,a,n=t.apType===A?(a=$.isNumeric(t.installType)?(s=t.installType,this.getInstallHeight(s)):(s=(n=this.getApInstallInfo(t)).type,n.height),$.extend(t,{apType:A,installType:s,height:a,x:e,y:i})):(s=(n=this.getApInstallInfo(t)).type,a=n.height,$.extend(t,{x:e,y:i,installType:s,height:a,name:t.showModel,apType:P}));return n},getApInstallInfo:function(t){var e=t.model.toLowerCase();return"gateway"===t.type?{type:E,height:this.getInstallHeight(E)}:e.includes("wall")?{type:D,height:this.getInstallHeight(D)}:e.includes("outdoor")||e.includes("bridge")?{type:O,height:this.getInstallHeight(O)}:{type:R,height:this.getInstallHeight(R)}},getInstallHeight:function(t){var e;switch(t){case R:e=this.mapInfo.ceilingHeight;break;case E:e=this.mapInfo.deskHeight;break;case M:e=this.mapInfo.panelHeight;break;case D:e=this.mapInfo.wallHeight;break;case O:e=this.mapInfo.poleHeight}return e},updateAps:function(t){this.mapAps=t,this.lastSelectedApId?this.updateApBackground(this.lastSelectedApId):this.refresh()},removeAp:function(t){for(var e,i=this.mapAps,s=0,a=i.length;s<a;s++)if(i[s].id===t)return(e=i.splice(s,1)[0]).id===this._activeAp.id&&(this._activeAp=!1,this._mapBtnStatus=""),this.dom().triggerHandler("ev_map_remove_ap",[t]),e},drawAp:function(){for(var t=0;t<this.mapAps.length;t++){var e=this.mapAps[t],i=this.getApIcon(e),s=void 0===this.iconSize?1:this.iconSize,a=this.convertToCanvas({x:e.x,y:e.y}).x,n=this.convertToCanvas({x:e.x,y:e.y}).y,o=Math.sqrt(Math.pow(i.w,2)+Math.pow(i.h,2))/2,r=12+o;this.emulateResultImage&&"{}"!==JSON.stringify(this.emulateResultImage)&&this.showEmulateImage&&this.emulateResultImage[this.channelType]?r=o:e.isSelected?(this.drawArc(a,n,o*s,T),this.drawArc(a,n,r*s,"rgba(0, 168, 112, 0.4)")):(this.drawArc(a,n,o*s,"rgba(37,67,125,0.8)"),this.drawArc(a,n,r*s,"rgba(37,67,125,0.3)")),this.drawImage(i.icon,a-i.w*s/2,n-i.h*s/2,i.w*s,i.h*s),this.fillApsText(e,a,n,r,s)}},getActiveAp:function(t){var e=this,t=(e._isIpad&&e.refreshBtnStatus(t),e._mapBtnStatus);if(t){if(void 0!==t.type)return e[t.type+"Click"](t,e),void e.refresh();e._activeAp=t}return e._activeAp=e.isSelectedAp(e._moveStart),e._activeAp},isSelectedAp:function(t){if(this.mapAps)for(var e=t.x,i=t.y,s=this.mapAps,a=0,n=s.length;a<n;a++){var o=s[a],r=(o.src||(o.src=this.getApIcon(o)),o.src.w/2*this.iconSize),d=o.src.h/2*this.iconSize,l=this.convertToCanvas({x:o.x,y:o.y}).x,c=this.convertToCanvas({x:o.x,y:o.y}).y;if(l-r<e&&e<l+r&&c-d<i&&i<c+d)return o}return!1},moveApTop:function(t){var t=this.getApPos(t,!0);t!==this.mapAps.length-1&&(t=this.mapAps.splice(t,1),this.mapAps.push(t[0]))},refreshAps:function(){this.mapAps&&this.drawAp()},getApData:function(t){for(var e=this._apListData,i=0,s=e.length;i<s;i++)if(e[i].mac===t||e[i].id===t)return e[i];return{}},getApPos:function(t,e){for(var i=this.mapAps,s=0,a=i.length;s<a;s++)if(i[s].id===t)return e?s:i[s];return!1},getApAbPos:function(t,e){var i=this.getScaleRate();return{x:(t-=this._imgPos.p1)/i,y:(e-=this._imgPos.p2)/i}},setActiveAp:function(e){var t,i=this;this._imgLoaded?(t=this.getApPos(e),this._activeAp=t,i.refresh()):this._fireList.push(function(){var t=i.getApPos(e);i._activeAp=t,i.refresh()})},showApOption:function(t){var e,i,s,a,n,o,r=this,d=t.data,l=this.getApOptionBtnPos(d);r._actionAuth?(d.locked?(e="lock"===this._mapBtnStatus.type?this._apLockHoverSrc:this._apLockSrc,s=this._apRemoveDisableSrc,i=this._apSettingDisableSrc,o=this._apLocateDisableSrc):(e="lock"===this._mapBtnStatus.type?this._apUnlockHoverSrc:this._apUnlockSrc,i="setting"===this._mapBtnStatus.type?this._apSettingHoverSrc:this._apSettingSrc,s="remove"===this._mapBtnStatus.type?this._apRemoveHoverSrc:this._apRemoveSrc),"locate"===this._mapBtnStatus.type?(n=!0===d.isLocating?this.unLocateHoverImg:this.locateHoverImg,o=!0===d.isLocating?this._apLocateHoverSrc:this._apUnLocateHoverSrc,1===d.status&&"gateway"!=d.type&&(a=$(this.canvas).offset(),r.dom().triggerHandler("ev_map_show_locate_tip",[r.dom(),!0===d.isLocating?$.su.CHAR.ACCESS_POINTS.CANCEL_LOCATE:$.su.CHAR.ACCESS_POINTS.LOCATE,a.left+t.x+80,a.top+t.y]))):(n=!0===d.isLocating?this.unLocateImg:this.locateImg,o=!0===d.isLocating?this._apLocateSrc:this._apUnLocateSrc,1===d.status&&r.dom().triggerHandler("ev_map_hide_locate_tip"))):i="setting"===this._mapBtnStatus.type?this._apSettingHoverSrc:this._apSettingSrc,r._actionAuth&&(this.drawImage(this.iconImg,t.x+l.lock.left,t.y+l.lock.top,e.w,e.h,e.x,e.y,e.w,e.h),this.drawImage(this.iconImg,t.x+l.remove.left,t.y+l.remove.top,s.w,s.h,s.x,s.y,s.w,s.h),1===d.status)&&"gateway"!=d.type&&this.drawImage(n,t.x+l.locate.left,t.y+l.locate.top,o.w,o.h),this.drawImage(this.iconImg,t.x+l.setting.left,t.y+l.setting.top,i.w,i.h,i.x,i.y,i.w,i.h)},isApBtnHover:function(t){$(this.canvas).offset();var e=t.x,i=t.y,s=this._activeAp;if(s){var a,n=this.getApOptionBtnPos(s.data);for(a in n)if(n.hasOwnProperty(a)){var o=s.x+n[a].left,r=s.y+n[a].top;if(o<e&&e<o+n[a].w&&r<i&&i<r+n[a].h)return{type:a,locked:s.data.locked,isLocating:s.data.isLocating,ap:s}}}return!1},lockClick:function(t,e){t.locked=!t.locked,t.ap.data.locked=t.locked,e._actionAuth&&this.dom().triggerHandler("ev_map_ap_lock",[t.locked,t.ap.id])},settingClick:function(t,e){t.locked||this.dom().triggerHandler("ev_map_ap_setting",[t.ap.id,t.ap.data.type])},removeClick:function(t,e){!t.locked&&e._actionAuth&&this.removeAp(t.ap.id)},locateClick:function(t,e){e._actionAuth&&1===t.ap.data.status&&this.dom().triggerHandler("ev_map_ap_locate",[t.ap.id,!t.isLocating,function(){t.isLocating=!t.isLocating,t.ap.data.isLocating=t.isLocating}])},setLabelType:function(t){this._apLabelType!==t&&(this._apLabelType=t,this.refresh())},measureText:function(t,e,i){var s=this.ctx;if(s.font=e.font,"label"===t)return s.measureText(i.data.name).width;if("details"===t){for(var a=this._apDetailNames,n=0,o=0,r=a.length;o<r;o++)var d=s.measureText(i.data[a[o].name]).width,n=n<d?d:n;return(n=n>this._apLabelSize.details.maxDetailW?this._apLabelSize.details.maxDetailW:n)+e.valueOffset}},wrapText:function(t,e,i,s,a){if("string"==typeof t&&"number"==typeof e&&"number"==typeof i){for(var n=this.ctx,o=n.canvas,r=(void 0===s&&(s=o&&o.width||this._apLabelSize.details.maxDetailW),void 0===a&&(a=o&&parseInt(window.getComputedStyle(o).lineHeight)||parseInt(window.getComputedStyle(document.body).lineHeight)),t.split("")),d="",l=0;l<r.length;l++){var c=d+r[l];s<n.measureText(c).width&&0<l?(n.fillText(d,e,i),d=r[l],i+=a):d=c}return n.fillText(d,e,i),i}},drawLabel:function(t){var e,i,s,a,n,o,r,d;this.ApDetail&&this.ApDetail.id==t.id&&(e=this._apLabelType,this._apLabelType="details"),this._apLabelType&&("label"!==this._apLabelType||this.settings.showDeviceNameFlag)&&(i=t.x+this._apLabelOffset.left,s=t.y+this._apLabelOffset.top,a=this.ctx,o=(n=this._apLabelSize[this._apLabelType]).pointPos.left,r="details"===this._apLabelType?(this.setDetailContent(t),n.wrapH-s-n.pointPos.top):n.h,d=(d=this.measureText(this._apLabelType,n,t)+2*n.padding.left)>n.maxW?n.maxW:d,a.save(),a.lineWidth=n.borderWidth,a.strokeStyle=n.borderColor,a.fillStyle=n.fillColor,a.beginPath(),a.moveTo(i,s),a.lineTo(i+o,s-5),a.lineTo(i+o,s+n.pointPos.top),a.lineTo(i+o+d,s+n.pointPos.top),a.lineTo(i+o+d,s+r+n.pointPos.top),a.lineTo(i+o,s+r+n.pointPos.top),a.lineTo(i+o,s+5),a.closePath(),a.stroke(),a.fill(),"label"===this._apLabelType?this.setLabelContent(t):"details"===this._apLabelType&&this.setDetailContent(t),a.restore(),this.ApDetail)&&this.ApDetail.id==t.id&&(this._apLabelType=e,this.ApDetail=!1)},setLabelContent:function(t){var e=this.ctx,i=this._apLabelSize.label,s=t.x+this._apLabelOffset.left+i.pointPos.left+i.padding.left,a=t.y+this._apLabelOffset.top+i.pointPos.top+i.padding.top,t=(e.save(),e.fillStyle=$.getUIColor("--s-color-text-primary"),e.font=i.font,$.su.abbreviateStr(t.data.name,i.maxW-i.padding.left));e.fillText(t.text,s,a),e.restore()},setDetailContent:function(t){var e=this.ctx,i=this._apLabelSize.details,s=this._apDetailNames,a=t.x+this._apLabelOffset.left+i.pointPos.left+i.padding.left,n=t.y+this._apLabelOffset.top+i.pointPos.top+i.padding.top,o=t.data;e.save(),e.fillStyle=$.getUIColor("--s-color-text-primary"),e.font=i.font;for(var r=0,d=s.length;r<d;r++)null!==o[s[r].name]&&(e.fillText(s[r].text+":",a,n),e.fillText(o[s[r].name]||s[r].convert&&s[r].convert(o)||s[r].default,a+i.valueOffset,n),n+=i.lineHeight);i.wrapH=n,e.restore()},clean:function(t){"main"===t&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},getApIcon:function(t){var e=t.iconType;return t.apType===P&&(e+="-virtual"),{w:40,h:40,icon:this.allApsIcon[e].img,filePath:this.allApsIcon[e].filePath}},getApOptionBtnPos:function(t){t=t.iconType;return t&&this._apOptionRePos[t]?this._apOptionRePos[t]:this._apOptionRePos.defaultPos},setCursor:function(t,e){$(t).css("cursor",e),"pointer"===e?$(t).addClass("canvas-hover"):$(t).removeClass("canvas-hover")},fireEvent:function(){for(var t=this._fireList,e=t.length-1;0<=e;e--)t[e].call(this),t.splice(e,1)},getPointerPos:function(t){var e;return this._isIpad?{x:((e=0!==t.originalEvent.targetTouches.length)?t.originalEvent.targetTouches[0]:t.originalEvent).pageX,y:(e?t.originalEvent.targetTouches[0]:t.originalEvent).pageY}:{x:t.pageX,y:t.pageY}},getEventPosition:function(t){var e,i;return t.layerX||0==t.layerX?(e=t.layerX,i=t.layerY):!t.offsetX&&0!=t.offsetX||(e=t.offsetX,i=t.offsetY),{x:e,y:i}},setDeviceNameShow:function(t){this.settings.showDeviceNameFlag=t,this.refresh()},startEditWall:function(t){this.chooseWallObstacle=t,this.changeEditStatus(g),this.setCursor(this.canvas,this.themeMap.PEN_ICON),$(document).on("contextmenu",function(){return!1})},stopEditWall:function(){this.stopDrawWall(),this.changeEditStatus(h)},drawArc:function(t,e,i,s,a){this.ctx.beginPath(),this.ctx.lineWidth=2,this.ctx.strokeStyle=a||s,this.ctx.fillStyle=s,this.ctx.arc(t,e,i,0,2*Math.PI),this.ctx.stroke(),this.ctx.fill()},fillApsText:function(s,t,e,i,a){for(var n,o=this.mapInfo&&this.mapInfo.deviceInfos||[],r=o.length||0,d=[],l=["2g","5g","5g1","5g2","6g"],c=0;c<r;c++)switch(this.deviceInfosType[o[c]]){case"status":s.addedInAdvanced&&0===s.status?d.push($.su.CHAR.MAP.PRECONFIGURED):$.isNumeric(s["status"])&&d.push(this.AP_STATUS[s["status"]]);break;case"clients":void 0!==s["userNum"]&&void 0!==s["guestNum"]&&d.push(s["userNum"]+" "+$.su.CHAR.CLIENTS.USERS+" / "+s["guestNum"]+" "+$.su.CHAR.CLIENTS.GUESTS);break;case"channel":$.each(l,function(t,e){var i=s["busyUtil"+e]?" / "+s["busyUtil"+e]+$.su.CHAR.MAP.PERCENT:"";s["enable"+e]&&s["channel"+e]&&d.push($.su.CHAR.MAP["AP_"+e.toUpperCase()]+" / "+s["channel"+e]+i)});break;case"sendPower":$.each(l,function(t,e){s["enable"+e]&&s["sendPower"+e]&&d.push($.su.CHAR.MAP["AP_"+e.toUpperCase()]+" / "+s["sendPower"+e]+" "+$.su.CHAR.COMMON.DBM)});break;case"height":void 0!==s["height"]&&d.push(s["height"]+$.su.CHAR.MAP.M);break;case"rate":$.isNumeric(s["txRate"])&&d.push({tx:$.su.moduleManager.get("index").transferTraffic(s["txRate"])+$.su.CHAR.DEVICES.PS}),$.isNumeric(s["rxRate"])&&d.push({rx:$.su.moduleManager.get("index").transferTraffic(s["rxRate"])+$.su.CHAR.DEVICES.PS});break;default:s[this.deviceInfosType[o[c]]]&&d.push(s[this.deviceInfosType[o[c]]])}0<=o.indexOf(0)?(this.drawRoundedRect(k,t-90,e+i*a+5,180,32,4,n=1===d.length?"all":"top"),1<d.length&&this.drawRoundedRect("rgba(255,255,255,0.5)",t-90,e+i*a+37,180,17*d.length,4,n,"bottom")):d.length&&this.drawRoundedRect("rgba(255,255,255,0.5)",t-90,e+i*a+5,180,17*(d.length+1),4,"all"),this.ctx.textAlign="center",this.ctx.textBaseline="middle";for(c=0;c<d.length;c++)0<=o.indexOf(0)?0===c?(d[0]=$.su.abbreviateStr(d[0],130).text,this.fillText("18px "+$.su.defaultFont,I,d[0],t,e+i*a+21)):this.showApOtherInfo(d,t,e+i*a,c,32):this.showApOtherInfo(d,t,e+i*a,c,23)},showApOtherInfo:function(t,i,s,a,n){var o=this;"string"==typeof t[a]?(t[a]=$.su.abbreviateStr(t[a],160).text,this.fillText("14px "+$.su.defaultFont,_,t[a],i,s+18*a+n)):$.each(t[a],function(t,e){"tx"===t?o.drawImage(o.txRateIcon,i-50,s+18*a+n-10,18,18):o.drawImage(o.rxRateIcon,i-50,s+18*a+n-10,18,18),o.ctx.save(),o.ctx.textAlign="left",o.fillText("14px "+$.su.defaultFont,_,e,i-30,s+18*a+n),o.ctx.restore()})},fillText:function(t,e,i,s,a){this.ctx.font=t,this.ctx.fillStyle=e,this.ctx.fillText(i,s,a)},drawLastLine:function(t,e){if(!this.recordClickPosition||this.rulerInfo)return!1;this.ctx.strokeStyle="ruler"===e?this.themeMap.RULER_COLOR:"#979797",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(this.mousedownPosition.x,this.mousedownPosition.y),this.ctx.lineTo(t.x,t.y),this.ctx.stroke(),"ruler"===e&&this.drawArc(this.mousedownPosition.x,this.mousedownPosition.y,3,this.themeMap.RULER_COLOR)},drawRestoreWall:function(){var t=this.originalWallsInfo.length;if(t&&this._imgPos&&void 0!==this._imgPos.p1&&void 0!==this._imgPos.s1){this.ctx.translate(this._imgPos.p1,this._imgPos.p2),this.ctx.scale(this.getScaleRate(),this.getScaleRate()),this.ctx.lineWidth=3,this.ctx.lineCap="round";for(var e=0;e<t;e++)this.originalWallsInfo[e].isSelected?(this.drawImage(this.deleteIcon,(this.originalWallsInfo[e].start.x+this.originalWallsInfo[e].end.x)/2+10,(this.originalWallsInfo[e].start.y+this.originalWallsInfo[e].end.y)/2+10,30,30),this.ctx.save(),this.ctx.beginPath(),this.ctx.globalAlpha=.5,this.ctx.strokeStyle=this.originalWallsInfo[e].color,this.ctx.moveTo(this.originalWallsInfo[e].start.x,this.originalWallsInfo[e].start.y),this.ctx.lineTo(this.originalWallsInfo[e].end.x,this.originalWallsInfo[e].end.y),this.ctx.stroke(),this.ctx.restore()):(this.ctx.beginPath(),this.ctx.strokeStyle=this.originalWallsInfo[e].color,this.ctx.moveTo(this.originalWallsInfo[e].start.x,this.originalWallsInfo[e].start.y),this.ctx.lineTo(this.originalWallsInfo[e].end.x,this.originalWallsInfo[e].end.y),this.ctx.stroke());if(this.mapStatus===i)for(e=0;e<t;e++)this.drawArc(this.originalWallsInfo[e].start.x,this.originalWallsInfo[e].start.y,2,I,_),this.drawArc(this.originalWallsInfo[e].end.x,this.originalWallsInfo[e].end.y,2,I,_);this.ctx.scale(1/this.getScaleRate(),1/this.getScaleRate()),this.ctx.translate(-this._imgPos.p1,-this._imgPos.p2)}},convertToRgba:function(t){return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},initObstacles:function(t){},stopDrawWall:function(){this.clearRulerInfo(),this.refresh()},changeMapStatus:function(t){this.mapStatus=t?i:p,t?((t=localStorage.getItem(this.site+"_"+this.imgId+"_map-walls"))&&(this.originalWallsInfo=JSON.parse(t)),$(document).on("contextmenu",function(){return!1})):$(document).off("contextmenu"),this.refresh()},changeEditStatus:function(t){this.mapEditStatus=t},changePreviewStatus:function(t){t===s||t===o||t===c||t===d?$(document).on("contextmenu",function(){return!1}):$(document).off("contextmenu"),this.mapPreviewStatus=t},saveWall:function(){this.stopEditWall();var i=[];return $.each($.su.clone(this.originalWallsInfo),function(t,e){i.push({obstacleId:e.obstacleId,start:e.start,end:e.end})}),i},isSelectedWall:function(t){if(this.mapStatus===p||!this.originalWallsInfo)return!1;for(var e=this,i=e.convertToOriginal(t).x,s=e.convertToOriginal(t).y,a=!1,n=e.originalWallsInfo.length,o=0;o<n;o++){var r=e.originalWallsInfo[o].start,d=e.originalWallsInfo[o].end,l=!1,c=Math.min(r.x,d.x),h=Math.max(r.x,d.x),g=Math.min(r.y,d.y),u=Math.max(r.y,d.y);e.originalWallsInfo[o].isSelected=!1,r.y===d.y?c<=i&&i<=h&&g-5<=s&&s<=u+5&&(l=!0):r.x===d.x?g<=s&&s<=u&&c-5<=i&&i<=h+5&&(l=!0):c<=i&&i<=h&&g-5<=s&&s<=u+5&&(10<=(c=(r.y-d.y)/(r.x-d.x))||c<=-10?(h=r.y-r.x*c,Math.abs((c*i+h-s)/c)<=5&&(l=!0)):(g=Math.atan2(d.y-r.y,d.x-r.x),u=(i-r.x)/Math.cos(g),h=Math.sin(g)*u,c=r.y+h,Math.abs(i-i)<=5&&Math.abs(s-c)<=5&&(l=!0))),l&&(e.originalWallsInfo[o].isSelected=a=!0)}return a},isClickDeleteBtn:function(t){var e,i;return-1!==this.deleteWallIndex&&(e=this.convertToOriginal(t).x,t=this.convertToOriginal(t).y,e>=((i=this.originalWallsInfo[this.deleteWallIndex]).start.x+i.end.x)/2+10)&&e<=(i.start.x+i.end.x)/2+40&&t>=(i.start.y+i.end.y)/2+10&&t<=(i.start.y+i.end.y)/2+40},deleteWall:function(){this.originalWallsInfo.splice(this.deleteWallIndex,1),this.changeEditStatus(h),this.deleteWallIndex=-1},convertToCanvas:function(t){return{x:t.x*this.getScaleRate()+this._imgPos.p1,y:t.y*this.getScaleRate()+this._imgPos.p2}},convertToOriginal:function(t){return{x:(t.x-this._imgPos.p1)/this.getScaleRate(),y:(t.y-this._imgPos.p2)/this.getScaleRate()}},addWallsInfo:function(){var t;this.recordClickPosition&&(t={start:this.convertToOriginal(this.recordClickPosition),end:this.convertToOriginal(this.mousedownPosition),obstacleId:this.chooseWallObstacle.id,decay2g:this.chooseWallObstacle.decay2g,decay5g:this.chooseWallObstacle.decay5g,decay6g:this.chooseWallObstacle.decay6g,color:this.convertToRgba(this.chooseWallObstacle.colorPicker)},this.originalWallsInfo.push($.extend({},this.themeMap.WALL_STRUCT,t)))},addRulerInfo:function(){this.recordClickPosition&&(this.rulerInfo={start:this.recordClickPosition,end:this.mousedownPosition})},adjustTransparency:function(t){this.transparency=t/100,this.refresh()},drawBackGroundImage:function(){var t=this;t.ctx.globalAlpha=this.transparency,t.drawImage(t.img,t._imgPos.p1,t._imgPos.p2,t._imgPos.s1,t._imgPos.s2),t.ctx.globalAlpha=1},drawBackGroundImageInDark:function(){var i=this;if(i.img){var s=Number(i.img.width),a=Number(i.img.height);if(s&&a){let t=document.createElement("canvas"),e=(t.width=s.toString(),t.height=a.toString(),t.getContext("2d"));e.drawImage(i.img,0,0,s,a);var n=e.getImageData(0,0,s,a);for(let t=0,e=n.data.length;t<e;t+=4)n.data[t]=255-n.data[t],n.data[t+1]=255-n.data[t+1],n.data[t+2]=255-n.data[t+2];e.putImageData(n,0,0),i.ctx.drawImage(t,0,0,s,a,i._imgPos.p1,i._imgPos.p2,i._imgPos.s1,i._imgPos.s2),setTimeout(()=>{i.tmpImg.src=t.toDataURL("image/png"),e.clearRect(0,0,i.img.width,i.img.height)},200)}}},startPlottingScale:function(){this.setCursor(this.canvas,this.themeMap.MEASURE_ICON),this.mapStatus===p?this.changePreviewStatus(s):this.changeEditStatus(b)},startRanging:function(){this.setCursor(this.canvas,this.themeMap.MEASURE_ICON),this.mapStatus===p?this.changePreviewStatus(o):this.changeEditStatus(x)},stopRanging:function(){this.mapStatus===p?this.changePreviewStatus(l):this.changeEditStatus(h),this.refresh()},fillTextDistance:function(){var t=this.mapInfo.scale,e=this.mapInfo.unit?$.su.CHAR.MAP.FT:$.su.CHAR.MAP.M,t=(this.getDistance(this.rulerInfo.start,this.rulerInfo.end)/this.getScaleRate()*t).toFixed(2)+e,e=this.getRadian(this.rulerInfo.start,this.rulerInfo.end);e<0&&(e+=Math.PI),e<=Math.PI&&e>=Math.PI/2&&(e-=Math.PI),this.ctx.translate((this.rulerInfo.start.x+this.rulerInfo.end.x)/2,(this.rulerInfo.start.y+this.rulerInfo.end.y)/2),this.ctx.rotate(e),this.ctx.font="20px "+$.su.defaultFont,this.ctx.textAlign="center",this.ctx.fillText(t,0,-20),this.ctx.rotate(-e),this.ctx.translate(-(this.rulerInfo.start.x+this.rulerInfo.end.x)/2,-(this.rulerInfo.start.y+this.rulerInfo.end.y)/2)},clearRulerInfo:function(){this.rulerInfo=void 0,this.recordClickPosition=void 0},getRadian:function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)},stopPlottingScale:function(){var t=this.getDistance(this.rulerInfo.start,this.rulerInfo.end);this.dom().triggerHandler("ev_edit_ruler_done",[t/this.getScaleRate()]),this.clearRulerInfo(),this.changePreviewStatus(l),this.changeEditStatus(h)},stopOneRanging:function(){this.fillTextDistance(),this.clearRulerInfo()},getDistance:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},drawRuler:function(){return this.ctx.beginPath(),this.ctx.strokeStyle=this.themeMap.RULER_COLOR,this.ctx.lineWidth=3,this.ctx.moveTo(this.rulerInfo.start.x,this.rulerInfo.start.y),this.ctx.lineTo(this.rulerInfo.end.x,this.rulerInfo.end.y),this.ctx.stroke(),this.drawArc(this.rulerInfo.start.x,this.rulerInfo.start.y,3,this.themeMap.RULER_COLOR),this.drawArc(this.rulerInfo.end.x,this.rulerInfo.end.y,3,this.themeMap.RULER_COLOR),!0},scaleIcon:function(t){switch(t){case 0:this.iconSize=.5;break;case 1:this.iconSize=1;break;case 2:this.iconSize=1.5}this.refresh()},saveEmulateImage:function(t,e,i){var s=this;s.progressIndex=0,s.obstacles=t,s.channelType=e,s.minDbm=i,s.emulateResultImage={},s.generateImage()},generateImage:function(){var i=this;i.getEmulateResultDeferred=$.Deferred(),$.when($.appUtils.getAntennaGainMap()).done(function(t){i.getEmulateImage(i.channelType,t)}),i.getEmulateResultDeferred.done(function(t){var e=new Image;e.crossOrigin="use-credentials",e.src=t,e.onload=function(){i.emulateResultImage[i.channelType]={img:e,canvasW:i.canvas.width,canvasH:i.canvas.height},$.extend(i.emulateResultImage,{x:i._imgPos.p1,y:i._imgPos.p2,w:i._imgPos.s1}),i.scaleCanvas(120),$.su.serviceManager.get("heatMap").setEmulateResult(i.site+"_"+i.imgId,i.emulateResultImage),i.emulateResultImage=$.su.serviceManager.get("heatMap").getEmulateResult(i.site+"_"+i.imgId),i.drawVisualImage()}})},canSimulate:function(t,e){function i(t,e){return e=e.toLowerCase(),t["enable"+e]&&$.isNumeric(t["channel"+e])&&$.isNumeric(t["sendPower"+e])}return e===y._5G1?i(t,y._5G1)||i(t,y._5G2):i(t,e)},getEmulateImage:function(s,a){var n=this,o=n.ctx,r=n.getCornersData(),d=n.getPowerTicks(),l=n.mapInfo.scale,t=n.mapInfo.unit,c=n.mapInfo.envType,h=n.mapInfo.receiveHeight,g=(1===t&&(l*=.3048),void 0),u=n.mapAps.length,p=0,e=(n.scaleCanvas(0),n.scaleCanvas(-120),setInterval(function(){n.triggerEmulateProgress(u),p===u&&clearInterval(e)},1e3));N.width=n.canvas.width,N.height=n.canvas.height,N[n.imgId]?N[n.imgId][s]={}:N[n.imgId]={[s]:{}},n.drawOneApInterval=setInterval(function(){var t,e={channel:s,envType:c,receiveHeight:h},i=n.getConvertApDataToCalculate(n.mapAps[p]);n.canSimulate(i,s)&&(t=$.su.serviceManager.get("heatMap").calculate(i,n.originalWallsInfo,r,d,l,e,a),n.drawOneApHeatmap(i,t),t=o.getImageData(0,0,n.canvas.width,n.canvas.height),g?g.data=n.doOverLap(g.data,t.data):g=t,s===y._5G1&&n.canSimulate(i,y._5G2)&&(n.clean("main"),e=Object.assign({},e,{channel:y._5G2}),e=$.su.serviceManager.get("heatMap").calculate(i,n.originalWallsInfo,r,d,l,e,a),n.drawOneApHeatmap(i,e),e=o.getImageData(0,0,n.canvas.width,n.canvas.height),g?g.data=n.doOverLap(g.data,e.data):g=e),N[n.imgId][s][i.id]={data:o.getImageData(0,0,n.canvas.width,n.canvas.height).data.slice(0),width:t.width}),p++,n.progressIndex++,p===u&&(clearInterval(n.drawOneApInterval),g?o.putImageData(g,0,0):n.clean("main"),n.getEmulateResultDeferred.resolve(n.canvas.toDataURL())),n.clean("main")},10)},getConvertApDataToCalculate:function(i){var s={};return $.each(i,function(t,e){"enable5g"===t&&e?(s.enable5g1=!0,s.sendPower5g1=i.sendPower5g,s.channel5g1=i.channel5g):s[t]=e}),s},drawVisualImage:function(t,e){var i=this;e?(i.channelType=t,i.emulateResultImage=e,i.emulateResultImage[t].onload=function(){i.refresh()}):(t&&(this.channelType=t),setTimeout(function(){i.refresh()},0))},triggerEmulateProgress:function(t){t=100*(this.progressIndex/t).toFixed(2);this.dom().triggerHandler("ev_emulate_progress",[t])},getCornersData:function(){var e=[],i={};return this.originalWallsInfo.forEach(function(t){i[JSON.stringify(t.start)]||(i[JSON.stringify(t.start)]=1,e.push(t.start)),i[JSON.stringify(t.end)]||(i[JSON.stringify(t.end)]=1,e.push(t.end))}),e},getPowerTicks:function(){for(var t=[],e=10*(this.minDbm||-80),i=-400;e<=i;i--)t.push((i/10).toFixed(1));return t},drawOneApHeatmap:function(t,e){for(var i=this,s=i.ctx,a=(i.clean("main"),s.save(),s.translate(t.x*this.getScaleRate()+i._imgPos.p1,t.y*this.getScaleRate()+i._imgPos.p2),Object.keys(e).sort(function(t,e){return t-e})),n=0;n<a.length;n++){u=g=h=c=l=d=r=o=void 0;var o=n,r=e[a[o]];if(1<r.length){var d=r.length-1,l=i.powerToColorMap[a[o]].fill,c=(s.beginPath(),s.strokeStyle=l,{x:(r[0].x+r[1].x)/2*i.getScaleRate(),y:(r[0].y+r[1].y)/2*i.getScaleRate()});s.moveTo(c.x,c.y);for(o=0;o<=d-2;o++){var h={x:r[o+1].x*i.getScaleRate(),y:r[o+1].y*i.getScaleRate()},g={x:(r[o+1].x+r[o+2].x)/2*i.getScaleRate(),y:(r[o+1].y+r[o+2].y)/2*i.getScaleRate()};s.quadraticCurveTo(h.x,h.y,g.x,g.y)}var u={x:(r[d].x+r[0].x)/2*i.getScaleRate(),y:(r[d].y+r[0].y)/2*i.getScaleRate()};s.quadraticCurveTo(u.x,u.y,c.x,c.y),s.stroke(),s.fillStyle=l,s.fill()}}s.restore()},doOverLap:function(t,e){for(var i=t.length,s=0;s<i;s+=4){var a,n=t[s+3];0!==e[s+3]&&(0===n||(n=this.rgbToHsl(t[s],t[s+1],t[s+2]),a=this.rgbToHsl(e[s],e[s+1],e[s+2]),n[0]>a[0]))&&this.changeColor(t,e,s)}return t},changeColor:function(t,e,i){t[i]=e[i],t[i+1]=e[i+1],t[i+2]=e[i+2],t[i+3]=e[i+3]},drawEmulateImage:function(t){this.emulateResultImage&&this.channelType&&this.showEmulateImage&&this.emulateResultImage[this.channelType]&&(t.globalAlpha=.8,t.drawImage(this.emulateResultImage[this.channelType].img,this._imgPos.p1-this.emulateResultImage.x*(this._imgPos.s1/this.emulateResultImage.w),this._imgPos.p2-this.emulateResultImage.y*(this._imgPos.s1/this.emulateResultImage.w),this.emulateResultImage[this.channelType].canvasW*(this._imgPos.s1/this.emulateResultImage.w),this.emulateResultImage[this.channelType].canvasH*(this._imgPos.s1/this.emulateResultImage.w)),t.globalAlpha=1)},getEmulateImageColor:function(t){return this.emulateResultCtx.getImageData(t.x,t.y,1,1).data},createEmulateResultCanvas:function(){this.emulateResultCanvas=document.createElement("canvas"),this.emulateResultCanvas.setAttribute("class","emulate-result-canvas"),$(this.emulateResultCanvas).css("display","none"),this.emulateResultCanvas.width=this.canvas.width,this.emulateResultCanvas.height=this.canvas.height,this._isIE8&&(this.emulateResultCanvas=window.G_vmlCanvasManager.initElement(this.emulateResultCanvas)),this.dom().append(this.emulateResultCanvas),this.emulateResultCanvas.getContext&&(this.emulateResultCtx=this.emulateResultCanvas.getContext("2d"))},deleteEmulateResultCanvas:function(){$(".emulate-result-canvas").remove()},changeEmulateStatus:function(t){this.showEmulateImage=t,this.refresh()},rgbToHsl:function(t,e,i){t/=255,e/=255,i/=255;var s,a=Math.max(t,e,i),n=Math.min(t,e,i),o=(a+n)/2;if(a==n)s=d=0;else{var r=a-n,d=.5<o?r/(2-a-n):r/(a+n);switch(a){case t:s=(e-i)/r+(e<i?6:0);break;case e:s=(i-t)/r+2;break;case i:s=(t-e)/r+4}s/=6}return[Math.round(360*s),d.toFixed(2),o.toFixed(2)]},updateWallsObstacles:function(e){var s=this;this.mapObstacles=e,this.originalWallsInfo&&this.originalWallsInfo.length&&($.each(this.originalWallsInfo,function(t,i){$.each(e,function(t,e){i.obstacleId===e.id&&(i.color=s.convertToRgba(e.colorPicker),i.obstacleId=e.id,i.decay2g=e.decay2g,i.decay5g=e.decay5g,i.decay6g=e.decay6g)})}),this.stopEditWall(),this.refresh())},drawRoundedRect:function(t,e,i,s,a,n,o){var r=this;r.ctx.beginPath(),r.ctx.fillStyle=t,r.ctx.strokeStyle="transparent",r.roundedRect(e,i,s,a,n,o),r.ctx.stroke(),r.ctx.fill()},roundedRect:function(t,e,i,s,a,n){var o=this;if(i<=0||s<=0)o.ctx.arc(t,e,a,0,2*Math.PI);else switch(n){case"top":o.ctx.moveTo(t+a,e),o.ctx.arcTo(t+i,e,t+i,e+s,a),o.ctx.arcTo(t+i,e+s,t,e+s,0),o.ctx.arcTo(t,e+s,t,e,0),o.ctx.arcTo(t,e,t+i,e,a);break;case"bottom":o.ctx.moveTo(t,e),o.ctx.arcTo(t+i,e,t+i,e+s,0),o.ctx.arcTo(t+i,e+s,t,e+s,a),o.ctx.arcTo(t,e+s,t,e,a),o.ctx.arcTo(t,e,t+i,e,0);break;default:o.ctx.moveTo(t+a,e),o.ctx.arcTo(t+i,e,t+i,e+s,a),o.ctx.arcTo(t+i,e+s,t,e+s,a),o.ctx.arcTo(t,e+s,t,e,a),o.ctx.arcTo(t,e,t+i,e,a)}},getScaleFactor:function(){return this._scaleArr[this._scaleRate]},cancelEmulate:function(){clearInterval(this.drawOneApInterval),this.deleteLastEmulateResult()},updateMapInfoInCanvas:function(t){$.extend(this.mapInfo,t),this.refresh()},showPointPower:function(){this.changePreviewStatus(r)},hidePointPower:function(){this.changePreviewStatus(l)},calculatePointPower:function(t){this.emulateResultImage&&this.showEmulateImage?(this.emulateResultCanvas||(this.createEmulateResultCanvas(),this.drawEmulateResultImage()),t=this.getTop10PowerList(t),this.dom().triggerHandler("ev_show_point_power",[t])):this.dom().triggerHandler("ev_show_point_power",[!1])},getPower:function(t,e){var i;return(0!==t[0]||"0.00"!==t[1]||"0.00"!==t[2])&&(i=(parseFloat(t[2])+e).toFixed(2),i=Math.round(100*i),i="hsl("+t[0]+", 100%, "+i+"%)",this.hslStrToPowerMap||(this.hslStrToPowerMap=this.getHslStrToPowerMap()),this.hslStrToPowerMap[i]||!1||this.getPower(t,e=e<=0?.01-e:-e))},getHslStrToPowerMap:function(){var i={};return $.each(this.powerToColorMap,function(t,e){i[e.fill]=t}),i},getSimulateScalePos:function(t){var e=this.scaleImage(3),i=(N.width-e[0])/2,e=(N.height-e[1])/2;return(t=this.convertToOriginal(t)).x=parseInt(t.x*this.getScaleRate(3)+i),t.y=parseInt(t.y*this.getScaleRate(3)+e),t},getTop10PowerList:function(s){var a=this,n=[];return(s=a.getSimulateScalePos(s)).x<0||s.y<0||s.x>=N.width||s.y>=N.height?n:($.each(this.mapAps,function(t,e){var i,e=a.getConvertApDataToCalculate(e);a.canSimulate(e,a.channelType)&&(i=N[a.imgId][a.channelType][e.id],i=a.rgbToHsl(i.data[4*(s.y*i.width+s.x)],i.data[4*(s.y*i.width+s.x)+1],i.data[4*(s.y*i.width+s.x)+2]),i=a.getPower(i,0))&&n.push({index:t,name:e.name,model:e.model,modelVersion:e.modelVersion,power:i})}),n.sort(function(t,e){return e.power-t.power}).slice(0,10))},getCoveragePower:function(t){return(0!==t[0]||"0.00"!==t[1])&&this.colorToPowerMap[t[0]]||!1},startRectCoverage:function(){this.rectCoveragePoints=[],this.changePreviewStatus(d)},stopDrawCoverage:function(){this.irregularPointsSaved=void 0,this.changePreviewStatus(l),this.refresh()},startIrregularShapeCoverage:function(){this.irregularPoints=[],this.changePreviewStatus(c)},rectCropping:function(t){1===this.rectCoveragePoints.length&&(this.refresh(),this.ctx.beginPath(),this.ctx.strokeStyle=k,this.ctx.rect(this.rectCoveragePoints[0].x,this.rectCoveragePoints[0].y,t.x-this.rectCoveragePoints[0].x,t.y-this.rectCoveragePoints[0].y),this.ctx.fillStyle=S,this.ctx.fill(),this.ctx.stroke())},startCalculateCrop:function(){var t=this,e=this.channelType,i={};if(this.mapPreviewStatus===d){if(2!==this.rectCoveragePoints.length)return;this.createEmulateResultCanvas(),this.drawEmulateResultImage(),i[t.channelType]=t.getCropResult(t.rectCoveragePoints[0].x,t.rectCoveragePoints[0].y,t.rectCoveragePoints[1].x-t.rectCoveragePoints[0].x,t.rectCoveragePoints[1].y-t.rectCoveragePoints[0].y)}else{if(!this.irregularPointsSaved||!this.irregularPointsSaved.length)return;var s=[],a=[],n=this.irregularPointsSaved.length;$.each(this.irregularPointsSaved,function(t,e){s.push(e.x),a.push(e.y),t===n-1&&(s=s.sort(function(t,e){return t-e}),a=a.sort(function(t,e){return t-e}))}),t.createEmulateResultCanvas(),t.clean("main"),t.clipCanvas(t.ctx),t.emulateResultCtx.clearRect(0,0,t.emulateResultCanvas.width,t.emulateResultCanvas.height),t.emulateResultCtx.save(),t.emulateResultCtx.fillStyle="black",t.emulateResultCtx.rect(0,0,t.emulateResultCanvas.width,t.emulateResultCanvas.height),t.emulateResultCtx.fill(),t.emulateResultCtx.restore(),t.clipCanvas(t.emulateResultCtx),t.refresh(),i[t.channelType]=t.getCropResult(s[0],a[0],s[n-1]-s[0],a[n-1]-a[0])}this.dom().triggerHandler("ev_coverage_done",[i,t.channelType]),this.channelType=e,this.refresh(),this.deleteEmulateResultCanvas()},getCropResult:function(t,e,i,s){return{coverageData:this.getCoverageData(t,e,i,s),coverageImage:this.getCoverageImage(t,e,i,s)}},getCoverageData:function(t,e,i,s){t=this.emulateResultCtx.getImageData(t,e,i,s);return this.calculateCoverage(t)},getCoverageImage:function(t,e,i,s){return this.refresh(),this.cropImageResultImg=this.ctx.getImageData(t,e,i,s),this.clean("main"),this.canvas.width=this.cropImageResultImg.width,this.canvas.height=this.cropImageResultImg.height,this.ctx.putImageData(this.cropImageResultImg,0,0),this.cropImageResultImg=this.canvas.toDataURL(),this.resize(),{img:this.cropImageResultImg,width:this.canvas.width,height:this.canvas.height}},clipCanvas:function(t){t.beginPath(),t.moveTo(this.irregularPointsSaved[0].x,this.irregularPointsSaved[0].y);for(var e=1;e<this.irregularPointsSaved.length;e++)t.lineTo(this.irregularPointsSaved[e].x,this.irregularPointsSaved[e].y);t.closePath(),t.stroke(),t.clip()},calculateCoverage:function(t){for(var e,i=t.data.length,s={"-40":0,"-50":0,"-60":0,"-70":0,"-80":0},a=0,n=0;n<i;n+=4)0===t.data[n]&&0===t.data[n+1]&&0===t.data[n+2]&&0!==t.data[n+3]||(e=this.rgbToHsl(t.data[n],t.data[n+1],t.data[n+2]),e=Number(this.getCoveragePower(e)),a++,0!==e&&(-40<=e?s["-40"]++:-50<=e?s["-50"]++:-60<=e?s["-60"]++:-70<=e?s["-70"]++:-80<=e&&s["-80"]++));return s["-50"]+=s["-40"],s["-60"]+=s["-50"],s["-70"]+=s["-60"],s["-80"]+=s["-70"],$.each(s,function(t,e){s[t]=(e/a*100).toFixed(2)}),{coveragePowerRange:s,allPixel:a}},exportMap:function(){var t,i,s,e,a=this;if(a.emulateResultImage)return t=a.channelType,i={},s={},e=a.showEmulateImage,a.scaleCanvas(0),i["fileLayout"]=a.getExportFileLayout(),a.changeEmulateStatus(!0),$.each(C,function(t,e){a.emulateResultImage[e]&&(a.channelType=e,a.refresh(),i["file"+e.toLowerCase()]=a.canvas.toDataURL("image/png"),s[e]=a.getExportCoverageData(e),s[e].width=a.emulateResultImage[e].canvasW,s[e].height=a.emulateResultImage[e].canvasH)}),i["data"]=$.su.clone(s),a.resize(),a.changeEmulateStatus(e),a.channelType=t,a.refresh(),i},getExportFileLayout:function(){return this.changeEmulateStatus(!1),this.canvas.toDataURL("image/png")},getExportCoverageData:function(t){return this.canvas.width=this.emulateResultImage[t].canvasW,this.canvas.height=this.emulateResultImage[t].canvasH,this.createEmulateResultCanvas(),this.drawEmulateResultImage(),this.cropImageResultData=this.emulateResultCtx.getImageData(0,0,this.canvas.width,this.canvas.height),this.deleteEmulateResultCanvas(),this.calculateCoverage(this.cropImageResultData)},getPowerRangeImage:function(){var t=this.ctx.createLinearGradient(0,0,360,0);return t.addColorStop(0,"#EA1C1C"),t.addColorStop(.25,"#FFD13A"),t.addColorStop(.5,"#24E054"),t.addColorStop(.75,"#22B1F6"),t.addColorStop(1,"#945AEC"),this.canvas.width=370,this.canvas.height=25,this.ctx.save(),this.ctx.strokeStyle=t,this.ctx.lineCap="round",this.ctx.moveTo(10,5),this.ctx.lineTo(360,5),this.ctx.lineWidth=10,this.ctx.fillText("-40",0,20),this.ctx.fillText("-50",90,20),this.ctx.fillText("-60",180,20),this.ctx.fillText("-70",270,20),this.ctx.fillText("-80",350,20),this.ctx.stroke(),this.ctx.restore(),this.canvas.toDataURL()},updateMouseCursor:function(t){"measure"===t?$(this.canvas).addClass("measure-cursor"):"wall"===t&&$(this.canvas).addClass("wall-cursor")},getLastEmulateResult:function(){return $.su.serviceManager.get("heatMap").getEmulateResult(this.site+"_"+this.imgId)},deleteLastEmulateResult:function(){this.emulateResultImage=void 0,this.refresh(),$.su.serviceManager.get("heatMap").deleteEmulateResult(this.site+"_"+this.imgId)},updateApBackground:function(i){this.lastSelectedApId=i,$.each(this.mapAps,function(t,e){i===e.id?e["isSelected"]=!0:e["isSelected"]=!1}),this.refresh()},clearMapInfo:function(){this.mapAps=[],this.originalWallsInfo=[]},startCopyAp:function(t,e){this.changeEditStatus(w),this.copyApId=t;t=this.getApIcon(e),e='url("'+t.filePath+'") '+t.w/2+" "+t.h/2+", auto";this.setCursor(this.canvas,e)},stopCopyAp:function(){this.changeEditStatus(h),this.dom().triggerHandler("ev_copy_stop"),this.setCursor(this.canvas,"default")},isCanvasResize:function(t){var e=this;return t=t||"2G",e.emulateResultImage&&e.emulateResultImage[t]&&(e.emulateResultImage[t].canvasW!==e.canvas.width||e.emulateResultImage[t].canvasH!==e.canvas.height)}})})(),$.su.Widget.register("breadCrumb",{settings:{nodeIconCls:{attribute:"node-icon-cls",defaultValue:""},separator:{attribute:"separator",defaultValue:""},separatorCls:{attribute:"separator-cls",defaultValue:""}},listeners:[{selector:".node-path",event:"click",callback:function(t,e){e.dom().triggerHandler("ev_router_change",[$(this).data("path-name")])}}],init:function(){},render:function(){var t=this.dom();this.settings;t.append('<div class="router-path-content"></div>')},loadItems:function(t,e){for(var i=this.dom(),s=this.settings,i=i.find(".router-path-content"),a=this.settings.separator,n=($.isArray(t)||(t=[]),s.items=t,i.empty(),""),o=0,r=t.length;o<r;o++)n=(n+='<span class="node-icon '+s.nodeIconCls+'"></span>')+'<span class="node-path" data-path-name="'+t[o].name+'">'+t[o].text+"</span>",o!==r-1&&(n+='<span class="node-separator '+s.separatorCls+'">'+a+"</span>");i.append(n),e&&e()},setValue:function(t){t&&this.loadItems(t)}}),$.su.Widget.register("steps",{settings:{},listeners:[],init:function(){this.step=1,this.totalStep=1},render:function(){var t=this.dom(),e=(t.addClass("step-container"),this.settings,t.find(".step-item-container")),i=t.find(".step-btn-wrap"),s="",a=(s=(s+='<div class="setup-field">')+'<div class="step-count">'+'<div class="step-list">',0),n=e.length;for(this.totalStep=n;a<n;a++){var o,r,d=$.su.getAttrObject($.su.CHAR,$(e[a]).data("title"))||$(e[a]).data("title"),s=(s=(s+='<div class="step-item step'+(a+1)+((r=0===a)?" current":"")+((o=a===n-1)?" last":"")+' u-d-inline-block u-text-center">')+'<div class="step-graph">'+('<span class="step-circle u-d-inline-block u-text-center'+(r?" current":"")+" "+($(e[a]).data("class")||"")+'"><span>'+(a+1)+"</span></span>"))+('<span class="step-text u-text-center'+(r?" current":"")+'">'+d+"</span>")+"</div>";o||(s+='<div class="step-line"></div>'),s=s+('<div class="step-tip">'+($(e[a]).attr("description")?$.su.getAttrObject($.su.CHAR,$(e[a]).attr("description"))||$(e[a]).attr("description"):"")+"</div>")+"</div>"}for(s=(s+="</div>")+"</div>"+'<div class="setup-form">',a=0;a<n;a++)s=s+('<div class="setup-step setup-step-'+(a+1)+((r=0===a)?"":" u-d-none"))+'"></div>';s+="</div></div>";for(var l=$(s),a=0;a<n;a++)$(l.find(".setup-step")[a]).append(e[a]);t.append(l),0<i.length&&t.prepend(i),$.su.scrollbar({ele:t.find(".setup-form")[0]})},switchStep:function(i,t){var s=this.dom(),a=this,e=a.step,n=$.su.getDefaultEvent(a,function(){var t="current done";s.find(".button-field").hide();for(var e=1;e<=this.totalStep;e++)s.find(".step-item.step"+e).removeClass(t),s.find(".step-item.step"+e).find("span.step-circle").removeClass(t),s.find(".step-item.step"+e).find("span.step-text").removeClass(t),e<=i&&(s.find(".step-item.step"+e).addClass(e===i?"current":"done"),s.find(".step-item.step"+e).find("span.step-circle").addClass(e===i?"current":"done"),s.find(".step-item.step"+e).find("span.step-text").addClass(e===i?"current":"done")),e===i?(s.find(".setup-step-"+e).show(),s.find(".button-field:nth-child("+e+")").show()):(s.find(".setup-step-"+e).hide(),s.find(".button-field:nth-child("+e+")").hide());a.step=i});s.triggerHandler("ev_step_switch",[n.ev,i,t,e]),n.exe()},getStep:function(){return this.step},setStepTitle:function(t,e){this.dom().find(".step-item.step"+t).find("span.step-text").text(e)}}),$.su.Widget.register("affix",{settings:{type:{attribute:"type",defaultValue:"prompt"},_title:{attribute:"affix-title",defaultValue:""},autoExpand:{attribute:"auto-expand",defaultValue:!1},autoAdapt:{attribute:"auto-adapt",defaultValue:!0},zIndex:{attribute:"z-index",defaultValue:"auto"},mask:{attribute:"mask",defaultValue:!0},msg:{attribute:"msg",defaultValue:""},htmlLoader:{attribute:"html-loader",defaultValue:!1},callback:{attribute:"callback",defaultValue:null},titleBar:{attribute:"title-bar",defaultValue:!0},closeBtn:{attribute:"close-btn",defaultValue:!0},affixIcon:{attribute:"affix-icon",defaultValue:!0}},listeners:[{selector:".collapse-outside, .collapse-inside",event:"click",callback:function(t,e){e.settings.shown?e.collapse():e.expand()}},{selector:".operation-bar-container .opt-btn",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this).attr("type");t&&e.dom().triggerHandler("ev_affix_action_click",[t,$(this)])}}],init:function(){this.settings.shown=this.settings.autoExpand},render:function(){var t=this.dom(),e=this.settings,i=(t.addClass(e.cls+" affix-container "+e.type),"ios"===$.su.platform&&t.addClass("ios"),""),s=(e.affixIcon&&(i+='<span class="collapse-outside"><span class="collapse-outside-icon"></span></span>'),i=(i=i+'<div class="affix-wrap">'+'<div class="affix-header">')+"</div>"+'<div class="affix-content-wrap">',e._title||""),s=(e.titleBar&&(i=(i+='<h3 class="widget-title affix-title"><div class="affix-title-container"><span class="icon"></span>')+'<span class="content">'+s+'</span></div><div class="operation-bar-container"><span class="collapse-inside opt-btn" type="collapse"><span class="icon"></span></span></div></h3>'),e.msg||""),s=(i=(i=(i+='<div class="widget-content affix-content-outer su-scroll">')+('<div class="affix-content">'+s+"</div>")+"</div>")+"</div>"+"</div>",$("div#msg-boxs-container"));0==s.length&&(s=$('<div id="msg-boxs-container" class="msg-boxs-container"></div>'),$("body").append(s)),s.append(t),t.append($(i)).css({"z-index":"auto"==e.zIndex?void 0:e.zIndex,"display":"none"}),e.autoExpand&&this.expand(),0<t.children("div[widget]").length&&t.children("div[widget]").appendTo(t.find("div.affix-content"))},expand:function(t){var e,i,s=this.dom(),a=this.settings;a.shown||($("div#msg-boxs-container").find(".affix-container").each(function(t,e){e=$(e).data("viewObj");e.getShownStatus()&&e.collapse()}),(e=this.getContainer()).addClass("shown"),s.parent().append(s),e.show(),s=e.find(".affix-content-wrap"),i=e.find(".affix-title"),e.find(".affix-content-outer").outerHeight(s.height()-i.outerHeight()),e.animate({right:0},200,"linear",function(){$.isFunction(t)&&t(),a.shown=!0}))},collapse:function(t,e){var i,s,a,n=this.dom(),o=this.settings;o.shown&&(i=this.getContainer(),s="function"===$.type(t)?t:null,a="boolean"===$.type(t)?t:"boolean"===$.type(e)&&e,o.shown)&&(i.animate({right:-470},200,"linear",function(){if(s)return s.call(this,this);o.shown=!1,i.removeClass("shown"),a&&n.remove()}),this.setNormal(),n.triggerHandler("ev_affix_on_close"))},setTitle:function(t,e){var i=this.dom().find(".affix-title-container .content");i&&(e?i.html(t):i.text(t))},addOperation:function(t,e){var i=this.dom().find(".operation-bar-container");e?i.append(t):i.prepend(t)},setHeader:function(t){var e=this.dom().find(".affix-header");e&&e.append(t)},getShownStatus:function(){return this.settings.shown}}),$.su.Widget.register("drawer",{settings:{_title:{attribute:"drawer-title",defaultValue:""},zIndex:{attribute:"z-index",defaultValue:"auto"},titleBar:{attribute:"title-bar",defaultValue:!0},collapseBtn:{attribute:"collapse-btn",defaultValue:!0},closeBtn:{attribute:"close-btn",defaultValue:!0},mask:{attribute:"mask",defaultValue:!1}},listeners:[{selector:".drawer-collapse-inside",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault(),e.collapse();var t=e.getActiveTabName(),i=e.tabMap[t];e.dom().triggerHandler("ev_drawer_collapse",[t,i])}},{selector:".operation-bar-container .close-icon",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault(),e.deleteAllItems()}},{selector:".drawer-single-close-icon",event:"mousedown",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=t&&$(t.currentTarget).parents(".tab-btn").attr("data-name");e.deleteItem(t),e.dom().triggerHandler("ev_close_click")}}],init:function(){this.scrollOption={suppressScrollX:!0},this.settings.shown=!1,this.tabs=[],this.tabMap={},this.tabDataMap={},this.tabCls={}},destroy:function(){$(window).off(".drawer"),this.mutationObserver=null},render:function(){var t=this.dom(),e=this.settings,i=(t.addClass(e.cls+" drawer-container"),"ios"===$.su.platform&&t.addClass("ios"),t.find(".drawer-item")),s="",a=(s=(s=(s=(s=s+'<div class="drawer-wrap-outer">'+'<div class="drawer-tab-container">')+('<div widget="tab" class="drawer-tab tab_menu_right" id="'+this.domId+'_tab">')+'<div class="tab-btn" data-name="device">aa</div>')+"</div>"+"</div>")+'<span class="drawer-dragging-icon"><span class="dragging-icon opt-btn"></span></span>'+'<div class="drawer-wrap">',e._title||""),a=(s=(s=(s=(s=e.titleBar?(s+='<h3 class="widget-title drawer-title"><div class="drawer-title-container"><div class="title-icon-container"><span class="icon"></span>')+'</div><span class="content">'+a+'</span></div><div class="operation-bar-container"><span class="close-icon opt-btn" type="close"><span class="icon"></span></span><span class="drawer-collapse-inside opt-btn" type="collapse"><span class="icon"></span></span></div></h3>':s)+'<div class="widget-content drawer-content-outer su-scroll">'+'<div class="drawer-content">')+"</div>"+"</div>")+"</div>"+"</div>",$(s)),s=(i.addClass("u-d-none"),a.find(".drawer-content").append(i),$("div#msg-boxs-container")),n=(0==s.length&&(s=$('<div id="msg-boxs-container" class="msg-boxs-container"></div>'),$("body").append(s)),s.append(t),t.append(a).css({"z-index":"auto"==e.zIndex?void 0:e.zIndex,"display":"none"}),this.tab=new $.su.widgets.tab({id:this.domId+"_tab"}),this.tab.render(),this);this.tab.dom().on("ev_tab_select",function(t,e){n.dom().triggerHandler("ev_drawer_tab_change",[e,n.tabMap[e],n.tabDataMap[e]])}),$(window).on("resize.drawer",$.su.debounce(function(t){n.updateContentHeight();var e=n.dom().find(".drawer-content-outer").data("ps");e&&e.update()},100)),n.setDrawerDraggable(!0),this.mutationObserver=new MutationObserver($.su.debounce(function(){$("#devices-drawer .ps:visible").each(function(){var t=$(this).data("ps");t&&t.update()})},50))},showItem:function(t){var e,i=this.getItems(),t=i.filter("[data-type="+t+"]");0===t.length&&(e=this.getActiveTabName(),t=i.filter("[data-type="+e+"]")),i.hide(),t.show()},addItem:function(t,e,i){this.dom().triggerHandler("ev_drawer_show"),this.tabMap[t]=e,this.tabDataMap[t]=$.su.clone(i),-1===this.tabs.indexOf(t)&&this.tabs.unshift(t),this.updateSlideTabs(),this.tab.setActive(t),$.su.serviceManager.get("capability").updateActiveDeviceTab(t)},updateData:function(t,e){$.su.serviceManager.get("capability").updateActiveDeviceTab(t),this.tabDataMap[t]=$.su.clone(e)},deleteItem:function(t){var e,i,s=this.tabs.indexOf(t);delete this.tabMap[t],delete this.tabDataMap[t],-1!==s&&(e=this.getActiveTabName(),this.tabs.splice(s,1),0===this.tabs.length?this.collapse():this.updateSlideTabs(),this.tabMap[e]?(this.tab.setActive(e),$.su.serviceManager.get("capability").updateActiveDeviceTab(e)):(e=(s=this.tabs[0])&&this.tabMap[s],i=s&&this.tabDataMap[s],this.dom().triggerHandler("ev_drawer_remove_item",[s,e,t,i])))},deleteAllItems:function(){this.tabs=[],this.tabMap={},this.tabDataMap={},this.collapse()},updateSlideTabs:function(){var s=[],a=this;$.each(a.tabs,function(t,e){var i="",i=a.tabDataMap[e]&&"switch_stack"===a.tabDataMap[e].type?"switch_stack":a.tabMap[e]+" "+a.tabCls[e];s.push({name:e,text:a.tabMap[e],cls:i,innerHtml:'<span class="drawer-single-close-icon u-d-none"><span class="close-circle-icon "></span></span>'})}),this.tab.setTabs(s)},showSettings:function(t,e,i,s){this.addItem(t,e,i),this.expand(s)},setTabStyle:function(t,e){this.tabCls[t]=e},getItems:function(){return this.dom().find(".drawer-content>.drawer-item")},getActiveTabName:function(){return this.tab.getActiveTabName()},getTabType:function(t){return this.tabMap[t]},getTabData:function(t){return this.tabDataMap[t]||{}},updateTabs:function(t){var e=$.su.clone(this.tabMap);this.tabMap={},this.tabs=[];for(var i,s=0,a=t.length;s<a;s++)void 0!==e[t[s]]&&(this.tabMap[t[s]]=e[t[s]],this.tabs.push(t[s]));0===this.tabs.length?this.collapse():(i=this.tabs[0],this.dom().triggerHandler("ev_drawer_tab_change",[i,this.tabMap[i],this.tabDataMap[i]]))},getAllTabs:function(){return this.tabs},updateContentHeight:function(){var t=this.dom(),e=t.find(".drawer-wrap"),i=t.find(".drawer-title");t.find(".drawer-content-outer").outerHeight(e.height()-i.outerHeight())},expand:function(t){var e=this,i=this.dom(),s=this.settings,a=this.getActiveTabName(),n=this.tabMap[a],o=(this.showItem(n),this.getContainer()),r=$.su.language.isRtl()?{left:0}:{right:0};o.hasClass("shown")?this.dom().triggerHandler("ev_drawer_already_show",[a,n]):(s.mask&&!s.shown&&this.getMask().show(this.domId+" su-drawer-mask"),i.parent().append(i),o.show(),this.updateContentHeight(),s.shown=!0,o.addClass("shown"),o.animate(r,200,"linear",function(){$.isFunction(t)&&t(),e.dom().triggerHandler("ev_drawer_expand_done",[a,n])}),this.dom().triggerHandler("ev_drawer_expand",[a,n]),this.mutationObserver.observe(document.querySelector("#devices-drawer"),{subtree:!0,attributes:!1,childList:!0}))},collapse:function(t,e){var i,s,a=this.dom(),n=this.settings,o=this.getContainer();o.hasClass("shown")&&(i="function"===$.type(t)?t:null,s="boolean"===$.type(t)?t:"boolean"===$.type(e)&&e,t=$.su.language.isRtl()?{left:-(o.width()+70)}:{right:-(o.width()+70)},o.animate(t,200,"linear",function(){if(i)return i.call(this,this);n.shown=!1,o.removeClass("shown"),s&&a.remove()}),this.setNormal(),n.mask&&this.getMask().hide(this.domId+" su-drawer-mask"),a.triggerHandler("ev_drawer_close"),this.mutationObserver.disconnect())},setTitle:function(t,e){var i=this.dom().find(".drawer-title-container>.content");i&&(e?i.html(t):i.text(t))},setTitleCls:function(t){this.dom().find(".drawer-title-container").removeClass().addClass("drawer-title-container "+t)},getShownStatus:function(){return this.settings.shown},supportDrawerDraggable:!0,setDrawerDraggable:function(t){this.supportDrawerDraggable=t,this.handleDrawerDraggable(this.supportDrawerDraggable)},handleDrawerDraggable:function(t){var e=this.dom(),i=e.find(".drawer-dragging-icon");t?(i.find(".dragging-icon").css({"display":"block"}),i.css({"cursor":"col-resize"}),$("html").on("mouseup",function(){$("html").off("mousemove")}),i.on("mousedown",function(t){t.preventDefault();$("html").on("mousemove",$.su.throttle(function(t){t.clientX<0||((w=$.su.language.isRtl()?t.clientX:window.innerWidth-t.clientX)<=920&&560<=w?e.find(".drawer-wrap").css({"width":w}):920<=w?e.find(".drawer-wrap").css({"width":920}):w<=560&&e.find(".drawer-wrap").css({"width":560}))},100))})):(i.find(".dragging-icon").css({"display":"none"}),i.css({"cursor":"auto"}),i.off("mousedown"),$("html").off("mouseup"))}}),$.su.Widget.register("combinationPanel",{settings:{text:{attribute:"text",defaultValue:""},tipInfo:{attribute:"tip-info",defaultValue:""},iconCls:{attribute:"icon-cls",defaultValue:""},optionOffset:{attribute:"option-offset",defaultValue:""}},listeners:[{selector:".combination-text-wrap",event:"click",callback:function(t,e){e.dom().hasClass("disabled")||(e.shown?(e.hidePanel(),e.dom().triggerHandler("ev_combination_panel_hide")):(e.showPanel(),e.dom().triggerHandler("ev_combination_panel_show")))}}],init:function(){this.shown=!1},destroy:function(){$(window).off(".combinationPanel"),$("html").off(".combinationPanel"),$("body").off(".combinationPanel")},render:function(){var t=this.dom(),e=this.settings,i=(t.addClass(e.cls+" combination-panel-container "+e.panelType),""),e=(i=(i=(i=(i=(i=(i=i+'<div class="combination-panel-container-inner">'+('<div class="combination-text-wrap" '+(0<e.tipInfo.length?'data-tip="'+e.tipInfo+'" click-operation="close"':"")+">"))+('<span class="text">'+e.text+"</span>"))+('<span class="icon '+e.iconCls+'"></span>'))+"</div>"+'<div class="combination-panel-wrap u-d-none">')+'<div class="combination-panel-content">'+"</div>")+"</div>"+"</div>",t.find("div[item-name]")),s=(t.append($(i)),t.find("div.combination-panel-content").eq(0).append(e),t.find("div.combination-panel-content>div[item-name]"));s.each(function(t){$(this).wrap('<div class="combination-item" data-item="'+$(this).attr("item-name")+'"></div>'),t+1!==s.length&&$(this).parent(".combination-item").after('<div class="item-spliter"></div>')}),this.bindEvent()},getItems:function(){return this.dom().find("div.combination-panel-content .combination-item")},bindEvent:function(){var e=this;$(window).on("resize.combinationPanel",function(){e.adjustPanel()}),$("html").on("click.combinationPanel",function(t){e.shown&&0===$(t.target||t.srcElement).closest(".combination-panel-container").length&&e.hidePanel()}),$("body").on("mousemove.combinationPanel",function(t){e.shown&&0===$(t.target||t.srcElement).closest(".combination-panel-container").length&&e.hidePanel()})},togglePanel:function(){this.shown?this.hidePanel():this.showPanel(),this.shown=!this.shown},showPanel:function(){var t=this.dom();t.find(".combination-panel-wrap").show(),t.addClass("focus"),this.adjustPanel(),this.shown=!0},hidePanel:function(){var t=this.dom();t.find(".combination-panel-wrap").hide(),t.removeClass("focus"),this.shown=!1},adjustPanel:function(){var t=this.dom(),e=t.find(".combination-text-wrap"),i=parseInt(this.settings.optionOffset),t=t.find(".combination-panel-wrap"),s=e.offset();t.offset({left:s.left+i,top:s.top+e.outerHeight()})},hideItem:function(t){this.dom();t=this.getItems().filter('[data-item="'+t+'"]');t.hide(),t.prev(".item-spliter").hide()},showItem:function(t){this.dom();t=this.getItems().filter('[data-item="'+t+'"]');t.show(),t.prev(".item-spliter").show()}}),$.su.Widget.register("draggableList",{settings:{externalSelected:{attribute:"external-selected",defaultValue:!1},connectParent:{attribute:"connect-parent",defaultValue:""},dragMatch:{attribute:"drag-match",defaultValue:""}},listeners:[],init:function(){},render:function(){var t=this.dom();t.addClass("draggable-list-container empty "+this.settings.cls),this.settings.externalSelected&&t.addClass("external-selected"),t.json2html({},[{"<>":"div","class":"list-target-container u-p-r","html":[{"<>":"p","class":"field-text","text":$.su.CHAR.DRAGGABLE_LIST.FIELDS_SELECTED},{"<>":"ul","class":"draggable-list-target connected-sortable target"},{"<>":"span","class":"draggable-list-empty",text:$.su.CHAR.DRAGGABLE_LIST.EMPTY_TIP}]},{"<>":"div","class":"list-source-container","html":[{"<>":"p","class":"field-text","text":$.su.CHAR.DRAGGABLE_LIST.FIELDS_AVAILABLE},{"<>":"ul","class":"draggable-list-source connected-sortable source"}]}]),this.sourceUl=t.find(".draggable-list-source"),this.targetUl=t.find(".draggable-list-target"),this._makeSortable()},loadItems:function(t){this.sourceData=t,this._updateDraggableList()},setValue:function(t){this._valueArray=t=t||[],this._updateDraggableList()},getValue:function(){return this._getValueFromTargetUl()},addFieldSelected:function(t){var i=this,e=this.settings.connectParent,e=e||"#"+this.domId;t.sortable({connectWith:e+" .connected-sortable",receive:function(t,e){i.dom().triggerHandler("ev_draglist_receive",[t.target,$(t.toElement||t.originalEvent.target).data("id")])},remove:function(t,e){i.dom().triggerHandler("ev_draglist_remove",[t.target])},beforeStop:this._beforeStopHandler.bind(this)})},_getValueFromTargetUl:function(){return this.targetUl.find("li").map(function(){return $(this).data("id")}).get()},_updateDraggableList:function(){var t,i;this.sourceData&&0!==this.sourceData.length&&(t={"<>":"li","text":"${name}","data-id":"${value}","drag-match":"${match}","class":function(){return(this.match?this.match+" ":"")+"draggable-list-item"}},i=$.su.clone(this._valueArray)||[],this.sourceUl.empty(),this.targetUl.empty(),this._toggleEmptySt(0===i.length),this.sourceUl.json2html(this.sourceData.filter(function(t){return i.indexOf(t.value)<0}),t),this.targetUl.json2html(this.sourceData.filter(function(t){return 0<=i.indexOf(t.value)}).sort(function(t,e){return i.indexOf(t.value)-i.indexOf(e.value)}),t))},_toggleEmptySt:function(t){var e=this.dom();t?e.addClass("empty"):e.removeClass("empty")},_beforeStopHandler:function(t){var e=this,i=$(t.toElement||t.originalEvent.target),s=i.parent(),a=i.siblings(":not(.ui-sortable-placeholder)"),n=s.hasClass("drag-single")&&0<a.length;if(!s.hasClass("draggable-list-source")&&s.attr("drag-match")!==i.attr("drag-match"))return this.dom().triggerHandler("ev_draglist_not_match",s.attr("drag-match")||i.attr("drag-match")),!1;n&&(a.appendTo($(t.target)),setTimeout(function(){e.dom().triggerHandler("ev_draglist_receive",[t.target,a.data("id")])},0))},_makeSortable:function(){var t,e=this,i=this.settings.connectParent,i=i||"#"+this.domId;this.sourceUl.add(this.targetUl).sortable({connectWith:i+" .connected-sortable",beforeStop:this._beforeStopHandler.bind(this)}),this.targetUl.on("sortupdate",function(){t=e._getValueFromTargetUl(),e.dom().triggerHandler("ev_view_change",{type:"value",value:t}),e.dom().triggerHandler("ev_view_change",{type:"valid",value:t}),e._toggleEmptySt(0===t.length)})}}),$.su.Widget.register("templateBar",{settings:{},init:function(){},listeners:[{selector:".template-link",event:"click",callback:function(t){t.stopPropagation(),$.su.serviceManager.get("siteTemplate").gotoSiteTemplate()}}],render:function(){this.dom().append('<div class="template-bar-container hidden"></div>')},updateTemplateStatus:function(e){var i=this.dom().find(".template-bar-container"),s=$.su.serviceManager.get("siteTemplate").TEMPLATE_STATUS;if("number"==typeof e&&e!==s.NOT_TEMPLATE&&$.su.serviceManager.get("siteTemplate").isBindSiteTemplate()&&!$.su.serviceManager.get("siteTemplate").isInUnsupportedSettings()){var a=$.su.CHAR.SITE_PROFILE,n=["custom","inherit","override"],o=$.su.ellipsisGridStr($.su.serviceManager.get("siteTemplate").getSiteTemplateName(),150),o=!$.su.serviceManager.get("user").isBlock("siteTemplate")?`<span class="template-link">${o}</span>`:`<span class="template-name">${o}</span>`;let t=`<span class="status-icon ${n[e]||"not-allow-override"}"></span>`;e===s.INHERIT?t+=`<p>${a.TEMPLATE_STATUS_TIP_INHERIT.replace("%templateName%",o)}</p>`:e===s.OVERRIDE?t+=`<p>${a.TEMPLATE_STATUS_TIP_OVERRIDE.replace("%templateName%",o)}</p>`:e===s.NOT_ALLOW_OVERRIDE?t+=`<p>${a.TEMPLATE_STATUS_NOT_ALLOW_OVERRIDE.replace("%templateName%",o)}</p>`:e===s.CUSTOM&&(t+=`<p>${a.TEMPLATE_STATUS_CUSTOM.replace("%templateName%",o)}</p>`),i.removeClass("hidden").html(t)}else i.addClass("hidden")}}),$.su.Widget.register("list",{settings:{multiSelect:{attribute:"multi-select",defaultValue:!1},plugins:{attribute:"plugins",defaultValue:""},configs:{attribute:"configs",defaultValue:null},backPaging:{attribute:"back-paging",defaultValue:!1}},listeners:[{selector:".grid-header",event:"mouseenter",callback:function(t,e){var i=$(this).children(".sortable");i.removeClass("hidden"),$(this).one("mouseleave",function(){$(this).hasClass("asc")||$(this).hasClass("desc")||i.addClass("hidden")})}},{selector:".grid-header .th-addon",event:"click",callback:function(t,e){t.stopPropagation(),e.dom().triggerHandler("ev_grid_header_addon_click",[$(this)])}},{selector:".grid-header",event:"click",callback:function(t,e){var i,s;"filter-icon"===t.target.className||0===$(this).children(".sortable").length||(t=e.dom()).hasClass("sort-disabled")||(i=$(this).attr("name"),s=e.settings.sorts._sortColumnName,(i="notes"===i?"note":i)===s?($(this).removeClass("asc desc"),"asc"===e.settings.sorts._sortOrder?e.settings.sorts._sortOrder="desc":"desc"===e.settings.sorts._sortOrder?e.settings.sorts._sortOrder=null:e.settings.sorts._sortOrder="asc"):(s&&t.find(".grid-header[name="+s+"]").removeClass("asc desc").children(".sortable").addClass("hidden"),e.settings.sorts._sortOrder="asc"),$(this).addClass(e.settings.sorts._sortOrder),e.settings.sorts._sortColumnName=i,t=$.su.getDefaultEvent(this,function(){this.sortData(i)}),e.dom().triggerHandler("ev_list_column_sort",[t.ev,i,e.settings.sorts._sortOrder]),t.exe())}},{selector:"a.paging-btn-num",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this);t.hasClass("disabled")||e.goTo(parseInt(t.attr("data-index"),10))}},{selector:"a.pageing-btn-prev",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault(),$(this).hasClass("disabled")||e.goPrev()}},{selector:"a.pageing-btn-next",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault(),$(this).hasClass("disabled")||e.goNext()}},{selector:"span.dots",event:"mouseenter",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this);t.hasClass("disabled")||(t.addClass("hidden"),t.parent().find(".btn-more.current").removeClass("hidden"))}},{selector:"span.btn-more",event:"mouseleave",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this);t.hasClass("disabled")||(t.addClass("hidden"),t.parent().find(".dots").removeClass("hidden"))}},{selector:"span.btn-more-left",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault(),$(this).hasClass("disabled")||(t=+e.settings.paging.currentPage,e.goTo(t=t-4<=0?0:t-4))}},{selector:"span.btn-more-right",event:"click",callback:function(t,e){var i;t.stopPropagation(),t.preventDefault(),$(this).hasClass("disabled")||(i=+(t=e.settings.paging).currentPage,i=t.totalPage-1<=4+i?t.totalPage-1:4+i,e.goTo(i))}},{selector:".paging-go .text-wrap-inner input",event:"keyup",callback:function(t,e){13===t.keyCode&&(t=e.settings.paging._pagingTextbox.getValue(),t=parseInt(t,10)-1,"number"===$.type(t)&&0<=t&&t!==e.settings.paging.currentPage&&e.goTo(t),e.settings.paging._pagingTextbox.setValue(""))}},{selector:".grid-panel-content-container",event:"mouseenter",callback:function(t,e){t.stopPropagation(),t.preventDefault(),e.dom().addClass("hover")}},{selector:".grid-panel-content-container",event:"mouseleave",callback:function(t,e){t.stopPropagation(),t.preventDefault(),e.dom().removeClass("hover")}},{selector:"tr.grid-content-tr",event:"mouseenter",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this).attr("data-key");e.dom().find("tr.grid-content-tr").removeClass("hover").filter("[data-key="+t+"]").addClass("hover")}},{selector:"tr.grid-content-tr",event:"mouseleave",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this).attr("data-key");e.dom().find("tr.grid-content-tr[data-key="+t+"]").removeClass("hover")}},{selector:"tr.grid-content-tr",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var i=$(this).attr("data-key");0===$(t.target).closest(".grid-content-td-action-column, .grid-content-td-check-column").length&&e.dom().triggerHandler("ev_grid_row_click",[[i],$(t.target)])}},{selector:"td.grid-content-td-check-column label.checkbox-label",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var i,s=e.dom(),t=$(this),a=t.closest("tr.grid-content-tr"),n=a.attr("data-key"),o=t.find("input[type=checkbox]");a.hasClass("disabled")||(!1===e.settings.multiSelect?(i=s.find("tr.grid-content-tr").find("input[type=checkbox]"),s.find("tr.grid-content-tr").each(function(){var t=$(this).closest("tr.grid-content-tr").attr("data-key");$(this).hasClass("selected")&&s.triggerHandler("ev_grid_row_unselected",[t])}),i.each(function(){$(this).prop("checked",!1),$(this).closest("label.checkbox-label").removeClass("checked imperfect"),$(this).closest("tr.grid-content-tr").removeClass("selected")}),o.prop("checked",!0),t.addClass("checked"),a.addClass("selected"),e.dom().triggerHandler("ev_grid_row_selected",[n])):!0===e.settings.multiSelect&&(a.toggleClass("selected"),a.hasClass("selected")?(e.setStatus(n,"selected",!0),o.prop("checked",!0),t.removeClass("imperfect checked").addClass("checked"),e.dom().triggerHandler("ev_grid_row_selected",[n])):(e.setStatus(n,"selected",!1),o.prop("checked",!1),t.removeClass("imperfect checked"),e.dom().triggerHandler("ev_grid_row_unselected",[n]))),s.triggerHandler("ev_grid_checkbox_clicked",[n,a.hasClass("selected")]),e.updateCheckbox(),e.updateSelectedInfo())}},{selector:"th.grid-header div.checkcolumn label.checkbox-label",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var t=e.dom(),i=$(this),s=$(this).closest("div.checkbox-group-container"),t=t.find("tr.dom-content.grid-content-tr:not(.disabled)"),a=[];if(t.hasClass("empty"))return!1;var n=e.settings.configs.key;if(s.removeClass("partial-selected"),i.removeClass("imperfect"),s.hasClass("selected")){s.removeClass("selected"),t.removeClass("selected"),t.find("label.checkbox-label").removeClass("checked"),t.find("input[type=checkbox]").prop("checked",!1),i.find("input[type=checkbox]").prop("checked",!1),i.removeClass("checked");for(var o=0,r=e._allData.length;o<r;o++){var d=e._allData[o][n];e._statusInfo[d]&&e._statusInfo[d].disabled||(e.setStatus(d,"selected",!1),a.push(d))}e.dom().triggerHandler("ev_grid_row_unselected_all",["all",a])}else{s.addClass("selected"),t.addClass("selected"),t.find("input[type=checkbox]").prop("checked",!0),t.find("label.checkbox-label").addClass("checked"),i.find("input[type=checkbox]").prop("checked",!0),i.addClass("checked");for(o=0,r=e._allData.length;o<r;o++){d=e._allData[o][n];e._statusInfo[d]&&e._statusInfo[d].disabled||(e.setStatus(d,"selected",!0),a.push(d))}e.dom().triggerHandler("ev_grid_row_selected_all",["all",a])}e.updateSelectedInfo()}},{selector:"td.grid-content-td-action-column a",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var t=$(this).data("type"),i=$(this).closest("tr.grid-content-tr").attr("data-key");e.dom().triggerHandler("ev_grid_action_click",[i,t,$(this)]),$(window).trigger("ev_remove_tip")}},{selector:"td.grid-content-td",event:"click",callback:function(t,e){t.preventDefault();var i,s=$(this).parent().attr("data-key");$(t.target).hasClass("grid-content-td")||$(t.target).hasClass("content")||$(t.target).hasClass("td-content")?$(this).trigger("ev_grid_td_click",[s]):void 0===$(t.target).data("tip")&&(i=$(t.target).data("type"),$(this).trigger("ev_grid_action_click",[s,i,$(t.target)]))}},{selector:".grid-header.filter-column .filter-icon",event:"click",callback:function(t,e){t.preventDefault(),t.stopPropagation(),e.getPlugin("filterColumns").togglePanel()}}],init:function(){this.scrollOption={suppressScrollY:!0},this._allData=[],this._statusInfo={}},destroy:function(){$(window).off(".list")},render:function(){var t=this.dom(),e=this.settings,i=e.configs.columns,s=e.configs.filterColumns,a='<style type="text/css" name="column">',n=[],o={leftFixedHtml:"",rightFixedHtml:""},r=!1,d=!1,l=(t.addClass(e.cls+"grid-container"),""),l=(l=(l+='<div  id="'+this.domId+'-panel" class="grid-panel">')+('<div class="container widget-container grid-panel-container '+e.cls+'">')+'<div class="grid-panel-wrap">')+'<div class="grid-panel-content">'+'<div class="grid-status-container"></div>';e.tbarPosition||(l+='<div class="grid-panel-tbar-container hidden"></div>'),l+='<div class="grid-panel-content-container"><div class="container grid-container"><div class="scroll-x-container su-scroll"><div class="container grid-header-container"><table class="grid-table" border="0" cellspacing="0" cellpadding="0"><tr class="grid-header-tr">';for(var c,h=0;h<i.length;h++){var g,u,p,m,f,v=i[h];v.cls=v.cls||"",v.dataIndex=v.dataIndex||"","function"==typeof v.render&&!v.render.call(this)||0==v.render?(i.splice(h,1),--h):(this.columnCount+=1,n.push(v),void 0!==v.width&&(a=(a=(a+="#"+this.domId+" th.grid-header-"+h+",")+"#"+this.domId+" td.grid-tool-td-"+h+",")+"#"+this.domId+" td.grid-content-td-"+h,"number"===$.type(v.width)?a+="{width:"+v.width+"px;":a+="{width:"+v.width+";",0===v.width&&(a+="padding: 0;"),a+="}"),g="",f=("checkcolumn"===v.xtype?(d=!0,g+='<div class="checkbox-group-container grid-header-checkbox checkcolumn inline"><div class="widget-wrap"><label class="checkbox-label"><input class="checkbox-checkbox" type="checkbox" value=""/><span class="checkbox-icon"><span class="checkbox-icon-inner"></span></span></label></div></div>',v.text=v.text||"",v.name=v.name||"select"):(v.text=v.text||"",v.name=v.name||v.dataIndex),""),u="grid-header-"+(v.xtype||"other")+(v.cls?" "+v.cls:""),p="",m=(!s||s.column!==v.dataIndex&&s.column!==v.xtype||(u+=" filter-column",p='<span class="icon filter-icon"></span>'),v.thAddon&&(p=(p+='<span class="th-addon">')+v.thAddon()+"</span>"),"actioncolumn"===v.xtype&&v.actionHeader&&(u+=" actionheader "),v.sortable?" sort":""),f=(f=f+('<th class="grid-header grid-header-'+h+" "+v.dataIndex+(h==i.length-1?" lst":"")+" "+u+m+'"  name="'+v.dataIndex+'">')+g)+('<span class="content '+(v.xtype||"")+'">'+v.text+"</span>"),v.sortable&&(this.settings.sorts={},f+='<div class="sortable hidden"><div class="sort-asc"></div><div class="sort-desc"></div></div>'),l+=f=f+p+"</th>",void 0===v.width&&v.fixed?console.error("fixed columns should configure width"):"left"!==v.fixed&&"right"!==v.fixed||(o[v.fixed+"FixedHtml"]+=f))}for(c in e.configs.columns=n,l=(l=(l=(l=(l=(l=l+"</tr>"+"</table>")+"</div>"+'<div class="grid-content-container-outer">')+'<div class="grid-content-container">'+'<table class="grid-table" border="0" cellspacing="0" cellpadding="0">')+'<tbody class="grid-content-data">'+"</tbody>")+"</table>"+"</div>")+"</div>"+"</div>",o)o.hasOwnProperty(c)&&0<o[c].length&&(l=(l=l+('<div class="grid-fixed-container fixed-'+c.replace("FixedHtml",""))+'"><div class="container grid-header-container"><table class="grid-table" border="0" cellspacing="0" cellpadding="0">')+'<tr class="grid-header-tr">'+o[c]+'</tr></table></div><div class="grid-content-container-outer"><div class="grid-content-container"><table class="grid-table" border="0" cellspacing="0" cellpadding="0"><tbody class="grid-content-data"></tbody></table></div></div></div>',r=!0);l+="</div></div>",(e.configs.paging||d)&&(l+='<div class="grid-paging-selected-container">',e.configs.paging&&(e.paging={domId:this.domId+"_paging"},$.extend(e.paging,e.configs.paging),l=(l=(l=(l=(l=l+('<div id="'+e.paging.domId)+'"><div class="container widget-container paging-container disabled"><div class="paging-wrap u-d-none"><div class="paging-wrap-inner u-d-inline-block"><div class="paging-info-container u-d-inline-block"><div class="paging-info u-d-inline-block"><span></span></div></div><div class="paging-items hidden"><span class="content u-d-inline-block"></span></div><div class="paging-btns u-d-inline-block"><a href="javascript:void(0);" class="paging-btn hidden pageing-btn-first" data-index="first"><span class="icon"></span><span class="text"><<</span></a><a href="javascript:void(0);" class="paging-btn pageing-btn-prev" data-index="prev"><span class="icon"></span><span class="text"></span></a><div class="num-buttons-container"></div><a href="javascript:void(0);" class="paging-btn pageing-btn-next" data-index="next"><span class="icon"></span><span class="text"></span></a><a href="javascript:void(0);" class="paging-btn hidden pageing-btn-last" data-index="last"><span class="icon"></span><span class="text">>></span></a>')+"</div>"+`<div class="paging-options ${!1===e.configs.paging.enablePageSize?"u-d-none":"u-d-inline-block"}">`)+'<div class="paging-select inline-block"><div id="'+e.paging.domId+'_select"  widget="combobox"></div></div></div>')+`<div class="paging-go ${!1===e.configs.paging.enableGo?"u-d-none":"u-d-inline-block"}">`+'<div widget="textbox" label-field="{GRID.PAGE_TO}"></div>')+'<div widget="button" text="'+$.su.CHAR.COMMON.GO+'"></div></div><div class="paging-separator hidden"><span class="icon"></span></div><div class="paging-total hidden"><span class="content u-d-inline-block"></span></div></div></div></div><input type="hidden" class="hidden paging-input"></div>'),d&&(l+='<div class="grid-panel-selected-container u-d-inline-block"><span class="selected-info"></span></div>'),l+="</div>"),l+="</div></div></div></div>";var b,x=$(l),w=(t.find(".grid-panel").remove(),t.append(x),t.find(".scroll-x-container")),y=this;r&&(t.on("ev_grid_row_dom_changed",function(){y.updateFixedRowOrder()}),b=w.siblings(".grid-fixed-container"),w.off("ps-x-reach-start").off("ps-x-reach-end").off("ps-scroll-left").off("ps-scroll-right").on("ps-scroll-left",function(){b.removeClass("reached")}).on("ps-scroll-right",function(){b.removeClass("reached")}).on("ps-x-reach-start",function(){b.filter(".fixed-left").addClass("reached")}).on("ps-x-reach-end",function(){b.filter(".fixed-right").addClass("reached")})),t[0]&&(a+="</style>",x.prepend($(a)),this.initStyleText=a,this.dom().hasClass("loading")||this.dom().addClass("loading"),e.plugins&&this.initPlugins(e.plugins.split("|")),(w=t.find("div.grid-header-container>table").outerWidth())&&e.xScroll&&((x=t.find(".scroll-x-container")).css("width",w+10+"px"),x.parent().css("overflow-x","auto")),e.configs.paging&&this.initPaging(),$(window).on("resize.list",$.su.debounce(function(){y.updateFixedHeight()},100)))},initPlugins:function(t){var e=this.dom(),i=this,s=this.settings;i.plugins={};for(var a=0,n=(t=$.isArray(t)?t:[t]).length;a<n;a++){var o=$.extend({},s,{objs:{grid:i},plugins:i.plugins}),r=$('<div id="'+i.domId+"_"+t[a]+'"></div>').appendTo(e);$.su.widgets[t[a]]&&(i.plugins[t[a]]=new $.su.widgets[t[a]]($.extend(o,{id:r})),i.plugins[t[a]].render())}},getPlugin:function(t){var e=this.settings.plugins.split("|");return-1!==$.inArray(t,e)&&this.plugins[t]},refreshByData:function(t,e){this._allData=(t=t||[]).slice(),this.settings.configs&&this.settings.configs.beforeLoad&&(t=this.settings.configs.beforeLoad.call(null,t)),this.bindFilterModel(),!1===this.settings.backPaging&&(t=this.getSortData(t)),this.renderRows(t,e),this.dom().triggerHandler("ev_list_after_load")},bindFilterModel:function(){var t;!this.filterModel&&(this.filterModel=this.createFilterModel(),this.dataBind[0].filterModelBind=new $.su.ModelBind(this.filterModel),t=this.dataBind[0].filterModelBind)&&(this.getPlugin("filter")&&t.bindViewObj(this.getPlugin("filter")),t.record())},getFilterModelBind:function(){return this.dataBind[0].filterModelBind},createFilterModel:function(){for(var t,e=this.settings.configs.columns,i=[],s=0;s<e.length;s++)e[s].filterable&&i.push(e[s]);return t=0<i.length?new $.su.Model({"fields":i}):t},renderRows:function(t,e){this.updatePaging(t);var i=t.length,s=this.dom(),a=s.find(".scroll-x-container tbody.grid-content-data").eq(0),n="";if(this._keysMap={},0<i){for(var o,r=s.find(".grid-fixed-container.fixed-left tbody.grid-content-data").eq(0),d=s.find(".grid-fixed-container.fixed-right tbody.grid-content-data").eq(0),l="",c="",h=0,g=(this.settings.backPaging||(h=this.settings.paging&&this.settings.paging.currentPage*this.settings.paging.numPerPage||0),i),u=(this.settings.paging&&!e&&(g=this.settings.paging.numPerPage+h>i?i:this.settings.paging.numPerPage+h),this.settings.configs.key),p=0;p<i;p++)this._keysMap[t[p][u]]=t[p],this.settings.configs.rowDisabled&&this.setStatus(t[p][u],"disabled",this.settings.configs.rowDisabled.call(null,t[p])),h<=p&&p<g&&(n+=(o=this.renderRow(t[p])).domContent,l+=o.leftFixedContent,c+=o.rightFixedContent);r.html(l),d.html(c),this.dom().removeClass("loading"),s.find(".grid-fixed-container .grid-content-container-outer").show()}else n=this.initEmptyRow(this.getColumns().length),this.dom().removeClass("loading"),s.find(".grid-fixed-container .grid-content-container-outer").hide();a.html(n),this.updateCheckbox(),this.updateSelectedInfo(),this.updateFixedHeight()},renderRow:function(t){for(var e={domContent:"",leftContent:"",rightContent:""},i=t[this.settings.configs.key],s=this.domId+"_tr_"+$.appUtils.keyHandler(i),a=this.settings.configs.rowCls&&this.settings.configs.rowCls.call(null,t)||"",n=this._statusInfo[i]&&this._statusInfo[i].selected,o=this._statusInfo[i]&&this._statusInfo[i].disabled,r=this.settings.configs.columns.length,d="",l="",c="",h=0;h<r;h++){var g=this.renderCells(i,h,t);d+=g.domContent,l+=g.leftFixedContent,c+=g.rightFixedContent}return e.domContent='<tr id="'+s+'" class="grid-content-tr  dom-content '+(n?"selected":"")+(o?" disabled":"")+" grid-content-tr-"+$.appUtils.keyHandler(i)+" "+a+'" data-key="'+i+'">'+d+"</tr>",e.leftFixedContent='<tr id="'+s+'" class="grid-content-tr '+(o?"disabled":"")+" grid-content-tr-"+$.appUtils.keyHandler(i)+" "+a+'" data-key="'+i+'">'+l+"</tr>",e.rightFixedContent='<tr id="'+s+'" class="grid-content-tr '+(o?"disabled":"")+" grid-content-tr-"+$.appUtils.keyHandler(i)+" "+a+'" data-key="'+i+'">'+c+"</tr>",e},initEmptyRow:function(t,e){var i=(i='<tr class="grid-content-tr empty">')+('<td colspan="'+t+'"><span class="content">'+(e||$.su.CHAR.COMMON.NO_ENTRY)+'</span><div class="loading-container"><span class="icon"></span></div></td>')+"</tr>";return $(i)},renderCells:function(t,e,i){var s={rowKey:t,columns:this.settings.configs.columns,cellId:e,rendererOfNull:this.settings.configs.rendererOfNull,rendererOfUndefined:this.settings.configs.rendererOfUndefined},a=s.columns[e],n=s.columns.length,o=i[a.dataIndex];switch(o){case void 0:o=s.rendererOfUndefined?s.rendererOfUndefined():"---";break;case null:o=s.rendererOfNull?s.rendererOfNull():o}var r=0===e?"fst":"",d=e===n-1?"lst":"",l="",c=a.cls||"",h=(c&&(c+=" "),""),g={domId:this.domId+"_tr_"+$.appUtils.keyHandler(t)+"_td_"+e,domContent:"",leftFixedContent:"",rightFixedContent:"",column:a,field:a.dataIndex||!1,renderer:!0===a.loading&&this.renderLoading||a.renderer||function(t){return t}};switch(a.xtype){case"checkcolumn":var u=this._statusInfo[t]&&this._statusInfo[t].selected;c+=" grid-content-td grid-content-td-"+e+" grid-content-td-check-column "+r+" "+d,h+=' name="check-column"',l=(l=(l=(l=(l+='<div class="checkbox-group-container">')+'<div class="widget-wrap">'+('<label class="checkbox-label '+(u?"checked":"")+'">'))+('<input class="checkbox-checkbox" '+(u?' checked="checked" ':" ")+' type="checkbox" value="'+t+'"/>')+'<span class="checkbox-icon"><span class="checkbox-icon-inner"></span></span>')+"</label>"+"</div>")+"</div>"+'<span class="content">--</span>';break;case"actioncolumn":this.dom().addClass("actioncolumn"),c+="grid-content-td grid-content-td-"+e+" grid-content-td-action-column "+r+" "+d,h+=' name="action-column"',l=(l+='<div class="grid-content-td-wrap action-cell" data-key="'+t+'">')+g.renderer.call(g,o,i)+"</div>";break;default:c+="grid-content-td grid-content-td-"+e+" grid-content-td-"+a.name+" "+r+" "+d+" "+a.cls,h+=' name="'+a.name+'"',l+='<div class="content content-cell">'+g.renderer.call(g,o,i)+"</div>"}return a.fixed&&void 0!==a.width?(g[a.fixed+"FixedContent"]='<td id="'+g.domId+'" class="'+c+'" '+h+'><div class="td-content">'+l+"</div></td>",g.domContent='<td class="fixed-cell fixed-'+a.fixed+" "+c+'" '+h+"></td>"):g.domContent='<td id="'+g.domId+'" class="'+c+'" '+h+'><div class="td-content">'+l+"</div></td>",g.settings=s,g},setGridWidth:function(){var t=this.dom(),e=t.find(".grid-panel"),i=this.settings.configs.columns,s='<style type="text/css" name="column">';if(0!==t.width()){e.find('style[name="column"]').remove(),e.prepend(this.initStyleText);for(var a=0,n=i.length;a<n;a++){var o=i[a],r=$(this.getClosestContainerClass("header")+" th.grid-header-"+a).outerWidth(),s=(s=(s+=this.getClosestContainerClass("header")+" th.grid-header-"+a+",")+(this.getClosestContainerClass("tool")+" td.grid-tool-td-"+a+","))+(this.getClosestContainerClass("content")+" td.grid-content-td-"+a);"left"!==o.fixed&&"right"!==o.fixed||(s=(s+=","+this.getFixedContainerClass("header")+" th.grid-header-"+a+",")+this.getFixedContainerClass("content")+" td.grid-content-td-"+a),s+="{width:"+r+"px;",0===o.width&&(s+="padding: 0;"),s+="}"}s+="</style>",e.find('style[name="column"]').remove(),e.prepend($(s))}},updateFixedHeight:function(){var s,t=this.dom(),a=this.domId,e=t.find(".grid-fixed-container");0<e.length&&(s='<style type="text/css" name="fixedColumn">',s=(s+="#"+a+" .grid-fixed-container .grid-header-tr{")+"height: "+t.find(".scroll-x-container .grid-header-tr")[0].getBoundingClientRect().height+"px;}",t.find(".scroll-x-container .grid-content-tr").each(function(t,e){var i=$(e).attr("data-key");s=(s+="#"+a+' .grid-fixed-container .grid-content-tr[data-key="'+i+'"]{')+"height: "+$(e)[0].getBoundingClientRect().height+"px;}"}),s+="</style>",e.find('style[name="fixedColumn"]').remove(),e.prepend($(s)),this.updateContentHeight())},updateContentHeight:function(){var t,e=this.dom(),s=e.find(".scroll-x-container"),e=e.find(".grid-fixed-container");0<e.length&&(t=e.find(".grid-header-tr")[0].getBoundingClientRect().height,s.find(".grid-header-tr").outerHeight(t),e.find(".grid-content-tr").each(function(t,e){var i=$(e).attr("data-key"),e=$(e)[0].getBoundingClientRect().height;s.find('.grid-content-tr[data-key="'+i+'"]').find(".grid-content-td").outerHeight(e)}))},disableRow:function(t){this.setStatus(t,"disabled",!0),this.dom().find(".grid-content-tr[data-key="+t+"]").addClass("disabled")},enableRow:function(t){this.setStatus(t,"disabled",!1),this.dom().find(".grid-content-tr[data-key="+t+"]").removeClass("disabled")},sortData:function(t){this._allData&&0!==this._allData.length&&(t=this.sortByColumn(this._allData.slice(),t),this.renderRows(t))},getSortData:function(t){return t=this.settings.sorts&&this.settings.sorts._sortColumnName?this.sortByColumn(t,this.settings.sorts._sortColumnName):t},sortByColumn:function(t,e){var i=this.dom().find("div.grid-header-container th.grid-header."+e),s=!1;if(e===this.settings.sorts._sortColumnName)if("desc"===this.settings.sorts._sortOrder)i.removeClass("sort-asc").addClass("sort-desc"),s=!0;else{if("asc"!==this.settings.sorts._sortOrder)return i.removeClass("sort-desc sort-asc"),t;i.removeClass("sort-desc").addClass("sort-asc")}else this.clearSortStatus(),i.addClass("sort-asc"),this.settings.sorts._sortColumnName=e;return this.sortValue(t,e,s)},sortValue:function(t,s,e){for(var a,n=null,i=this.settings.configs.columns,o=0,r=i.length;o<r;o++)if(s===i[o].name){i[o].sortRule&&"function"===$.type(i[o].sortRule)&&(n=i[o].sortRule),i[o].sortType&&(a=i[o].sortType);break}var d={},l=this.settings.configs.key;return $.each(t,function(t,e){var i=n?n(e[s],e):e[s];if(void 0===i&&a)switch(a){case"number":i=0;break;case"string":i=""}"string"===$.type(i)&&"string"!==a&&/^\d+$/.test(i)?d[e[l]]=parseInt(i,10):d[e[l]]=i}),e?t.sort(function(t,e){return d[t[l]]>d[e[l]]?-1:d[t[l]]<d[e[l]]?1:0}):t.sort(function(t,e){return d[t[l]]<d[e[l]]?-1:d[t[l]]>d[e[l]]?1:0}),t},setSort:function(t,e){var i=this.dom(),s=i.find(".grid-header[name="+t+"]");0===s.children(".sortable").length||i.hasClass("sort-disabled")||(t===this._sortColumnName?s.removeClass("asc desc"):this._sortColumnName&&i.find(".grid-header[name="+this._sortColumnName+"]").removeClass("asc desc").children(".sortable").addClass("hidden"),(i=this.settings.sorts)._sortOrder=e||"asc",s.addClass(i._sortOrder),i._sortColumnName=t,this.sortData(t))},initPaging:function(){var i=this.settings.paging,s=this,t=this.dom(),e=(i._numSelect=new $.su.widgets.combobox({id:i.domId+"_select"}),i._numSelect.render(),i.items=i.items||[],i.items.forEach(function(t,e){t.name+=" "+$.su.CHAR.GRID.OPTIONS_UNIT}),i._numSelect.loadItems(i.items),i.numPerPage=i._numSelect.getValue()||i.numPerPage,i._numSelect.dom().on("ev_view_change",function(t,e){i._numSelect.setValue(e.value),s.setNumPerPage(e.value)}),t.find('.paging-go div[widget="textbox"]')),t=t.find('.paging-go div[widget="button"]');i._pagingTextbox=new $.su.widgets.textbox({id:e}),i._pagingButton=new $.su.widgets.button({id:t}),i._pagingTextbox.render(),i._pagingButton.render(),i._pagingTextbox.dom().on("ev_view_change",function(){var t=i._pagingTextbox.getValue(),t=parseInt(t,10)-1;$.isNumeric(t)&&t%1==0&&0<=t?i._pagingButton.dom().removeClass("disabled"):i._pagingButton.dom().addClass("disabled")}),i._pagingButton.dom().addClass("disabled"),i._pagingButton.dom().on("ev_button_click",function(){var t=i._pagingTextbox.getValue(),t=parseInt(t,10)-1;$.isNumeric(t)&&t!==i.currentPage&&s.goTo(t),i._pagingTextbox.setValue(""),i._pagingButton.dom().addClass("disabled")}),this.updatePagingInfo()},updatePagingInfo:function(){var t=this.settings.paging;t.totalRows=this.settings.backPaging?t.totalRows:this._allData.length,t.currentPage=t.currentPage||0,t.totalPage=Math.ceil(t.totalRows/t.numPerPage)},updatePaging:function(){this.updatePagingInfo();var t=this.settings.paging;this.dom().find(".paging-total .content").text(t.totalPage),this.goToPage(t.currentPage)},goToPage:function(t){var e=this.dom(),i=this.settings.paging,s=e.find("div.paging-container"),a=isNaN(t)?0:t,t=i.numPerPage,n=i.totalPage,o=i.totalRows,i=(n<=a&&0<n?a=n-1:a<0&&(a=0),i.currentPage=a,this.updateNumBtns(),0===o?0:a*t+1),t=o<(t=0===o?0:i+t-1)?o:t,r=$.su.CHAR.COMMON.GRID_PAGING_SHOW,d=(r=(r=(r=r.replace("%start",i)).replace("%end",t)).replace("%total",o),e.find(".paging-info span").text(r),s.find("a.paging-btn.pageing-btn-prev")),l=s.find("a.paging-btn.pageing-btn-next"),c=s.find("a.paging-btn.pageing-btn-first"),h=s.find("a.paging-btn.pageing-btn-last"),i=s.find("a.paging-btn-num"),t=s.find("span.dots"),o=s.find("span.btn-more");i.removeClass("current"),o.removeClass("current").addClass("hidden"),t.addClass("hidden"),i.filter("[data-index="+a+"]").addClass("current"),7<n&&(e=n-1,r=a-1,o=a+1,a<=3?(r=0,o=4):n-4<=a&&(r=n-5,o=n),0!==r&&((t=s.find(".pageing-btn-0").next(".dots-container")).find(".dots").removeClass("hidden"),t.find(".btn-more-left").addClass("current")),o!==e)&&((i=s.find(".pageing-btn-"+o).next(".dots-container")).find(".dots").removeClass("hidden"),i.find(".btn-more-right").addClass("current")),setTimeout(function(){d.removeClass("disabled"),l.removeClass("disabled"),c.removeClass("disabled"),h.removeClass("disabled"),0===a&&(c.addClass("disabled"),d.addClass("disabled")),n-1<=a&&(l.addClass("disabled"),h.addClass("disabled"))},180)},goTo:function(t){this.settings.paging.currentPage=t;var e=$.su.getDefaultEvent(this,function(){this.refreshByData(this._allData)});this.dom().triggerHandler("ev_list_paging_goto",[e.ev,t]),e.exe()},goPrev:function(){var t=this.settings.paging;t.currentPage=t.currentPage-1<0?0:t.currentPage-1,this.goTo(t.currentPage)},goNext:function(){var t=this.settings.paging;t.currentPage=t.totalPage<=t.currentPage+1?t.totalPage:t.currentPage+1,this.goTo(t.currentPage)},setPageSize:function(t){this.settings.paging.numPerPage=t,this.settings.paging._numSelect.setValue(t)},setPaging:function(t){$.extend(this.settings.paging,t)},getPaging:function(){return $.su.clone(this.settings.paging)},setNumPerPage:function(t){this.settings.paging.numPerPage=t,this.dom().triggerHandler("ev_grid_paging_size",[t]),this.refreshByData(this._allData)},updateNumBtns:function(){var t=this.settings.paging,e=t.currentPage,i=t.totalPage,t=this.dom().find("div.paging-wrap"),s=t.find("div.num-buttons-container");if(0==i)t.addClass("disabled").hide();else{t.removeClass("disabled").show();var a="",n=0;if(5<i){var t=i-1,o=e-1,r=e+1;for(e<=3?(o=0,r=4):i-4<=e&&(o=i-5,r=i-1),0!==o&&d(0),n=o;n<=r;n++)d(n);r!==t&&d(t)}else for(n=0;n<i;n++)d(n)}function d(t){a=(a=(a=(a=(a+='<a href="javascript:void(0);" class="paging-btn paging-btn-num pageing-btn-'+t+'" data-index="'+t+'">')+'<span class="icon"></span><span class="text">'+(t+1)+"</span>")+'</a><div class="dots-container u-d-inline-block">')+'<span class="btn-more-left btn-more hidden"></span><span class="dots"></span>')+'<span class="btn-more-right btn-more hidden"></span></div>'}s.empty().append($(a))},setUnSelectAll:function(){var t,e=this.dom(),i=e.find("tr.grid-header-tr label.checkbox-label"),s=i.closest("div.checkbox-group-container"),i=(i.removeClass("checked imperfect"),s.removeClass("selected partial-selected"),e.find("tr.grid-content-tr.selected")),s=i.find("label.checkbox-label"),e=s.find("input[type=checkbox]");for(t in i.removeClass("selected"),e.prop("checked",!1),s.removeClass("checked"),this._keysMap)this._keysMap.hasOwnProperty(t)&&this._statusInfo[t]&&this._statusInfo[t].selected&&this.setStatus(t,"selected",!1);this.updateSelectedInfo()},setUnselected:function(t){t=$.isArray(t)?t:[t],this.unSelectCheckbox(t)},unSelectCheckbox:function(t){for(var e=this.dom(),i=0,s=t.length;i<s;i++){var a,n,o=e.find('tr.grid-content-tr[data-key="'+t[i]+'"]');this._statusInfo[t[i]]&&this._statusInfo[t[i]].disabled||this.setStatus(t[i],"selected",!1),!o.hasClass("disabled")&&o.hasClass("selected")&&(n=(a=o.find("label.checkbox-label")).find("input[type=checkbox]"),o.removeClass("selected"),n.prop("checked",!1),a.removeClass("checked"))}this.dom().triggerHandler("ev_grid_row_unselected",[t]),this.updateCheckbox(),this.updateSelectedInfo()},setSelected:function(t){if(1!==(t=$.isArray(t)?t:[t]).length&&!1===this.settings.multiSelect)return!1;this.selectCheckbox(t)},selectCheckbox:function(t){var e=this.dom();if(!1===this.settings.multiSelect){if((s=e.find('tr.dom-content.grid-content-tr[data-key="'+t[0]+'"]')).hasClass("disabled")||s.hasClass("selected"))return;var i=(a=s.find("label.checkbox-label")).find("input[type=checkbox]");e.find("tr.grid-content-tr").find("input[type=checkbox]").each(function(){$(this).prop("checked",!1),$(this).closest("label.checkbox-label").removeClass("checked"),$(this).closest("tr.grid-content-tr").removeClass("selected")}),i.prop("checked",!0),a.addClass("checked"),s.addClass("selected"),this.dom().triggerHandler("ev_grid_row_selected",[t[0]])}else if(!0===this.settings.multiSelect){for(var s,a,n=0,o=t.length;n<o;n++)this._statusInfo[t[n]]&&this._statusInfo[t[n]].disabled||this.setStatus(t[n],"selected",!0),(s=e.find('tr.dom-content.grid-content-tr[data-key="'+t[n]+'"]')).hasClass("disabled")||s.hasClass("selected")||(i=(a=s.find("label.checkbox-label")).find("input[type=checkbox]"),s.addClass("selected"),i.prop("checked",!0),a.addClass("checked"));this.dom().triggerHandler("ev_grid_row_selected",[t])}this.updateCheckbox(),this.updateSelectedInfo()},updateCheckbox:function(){var t,e=this.dom().find("th.grid-header div.checkcolumn label.checkbox-label"),i=e.closest("div.checkbox-group-container"),s=0,a=0;for(t in this._keysMap)this._keysMap.hasOwnProperty(t)&&(this._statusInfo[t]&&this._statusInfo[t].selected&&s++,this._statusInfo[t])&&this._statusInfo[t].disabled&&a++;0<s?s!=this._allData.length-a?(i.removeClass("selected").addClass("partial-selected"),e.removeClass("checked").addClass("imperfect")):(i.removeClass("partial-selected").addClass("selected"),e.removeClass("imperfect").addClass("checked")):(i.removeClass("selected partial-selected"),e.removeClass("checked imperfect"))},updateSelectedInfo:function(){var t=this.dom().find(".grid-panel-selected-container .selected-info"),e=0,i=0,i=(this.settings.backPaging?(e=this.settings.paging.totalRows,this.settings.configs&&this.settings.configs.getAllSelectedKeys?this.settings.configs:this):(e=this._allData.length,this)).getAllSelectedKeys().length,i=(i=$.su.CHAR.GRID.SELECTED_INFO.replace("%selected",i)).replace("%total",e);t.text(i)},getAllSelectedKeys:function(){var t,e=[];for(t in this._statusInfo)this._statusInfo.hasOwnProperty(t)&&(this._keysMap[t]?this._statusInfo[t].selected&&e.push(t):delete this._statusInfo[t]);return e},getAllSelectedData:function(){var t,e=[];for(t in this._statusInfo)this._statusInfo.hasOwnProperty(t)&&(this._keysMap[t]?this._statusInfo[t].selected&&e.push(this._keysMap[t]):delete this._statusInfo[t]);return e},getDataByKey:function(t){return this._keysMap[t]||null},getAllData:function(){return this._allData},setStatus:function(t,e,i){this._statusInfo[t]||(this._statusInfo[t]={}),this._statusInfo[t][e]=!!i},showSelectedInfo:function(){0===this.dom().find(".grid-panel-selected-container").find(".selected-info").text().length&&this.updateSelectedInfo(),this.dom().find(".grid-panel-selected-container").removeClass("hidden")},hideSelectedInfo:function(){this.dom().find(".grid-panel-selected-container").addClass("hidden")},hideFilterColumns:function(i,t){var s,a="",n="#"+this.domId+" ",e=this.dom().find("div.grid-container").eq(0);e.children("style.column-group-hide-style[name="+t+"]").remove(),a+='<style class="column-group-hide-style" name="'+t+'">',$.each(i,function(t,e){switch(s=t===i.length-1?"":", ",e){case"actioncolumn":a=a+(n+"th.grid-header-actioncolumn, ")+(n+"td[name=action-column]"+s);break;case"checkcolumn":a=a+(n+"th.grid-header-checkcolumn, ")+(n+"td[name=check-column]"+s);break;default:a=a+(n+"th[name="+e+"],")+(n+"td[name="+e+"]"+s)}}),a+="{display: none;}</style>",e.append(a),this.updateFixedHeight()},setHeaderAddon:function(t,e){var t=this.dom().find(".grid-header[name="+t+"]"),i=t.find(".th-addon");0<i.length?i.html(e):t.append('<span class="th-addon">'+e+"</span>")},getColumns:function(){return this.settings.configs.columns},setLoadingStatus:function(){var t=this.dom().find(".scroll-x-container tbody.grid-content-data").eq(0),e=this.initEmptyRow(this.getColumns().length,this,$.su.CHAR.COMMON.LOADING);this.dom().hasClass("loading")||this.dom().addClass("loading"),t.empty(),this.dom().find(".grid-fixed-container.fixed-left tbody.grid-content-data").eq(0).empty(),this.dom().find(".grid-fixed-container.fixed-right tbody.grid-content-data").eq(0).empty(),t.append(e)},setColLoadingStatus:function(i,s){var t=this.settings,t=(i=$.isArray(i)?i:[i],t.configs.columns);$.each(t,function(t,e){-1!==i.indexOf(e.dataIndex)&&(e.loading=s)})},renderLoading:function(){return'<span class="icon loading"></span>'}}),$.su.Widget.register("grid",{settings:{operation:{attribute:"operation",defaultValue:null},plugins:{attribute:"plugins",defaultValue:""},minLines:{attribute:"min-lines",defaultValue:0},multiSelect:{attribute:"multi-select",defaultValue:!1},selectTotal:{attribute:"select-total",defaultValue:"onePage"},selectType:{attribute:"select-type",defaultValue:"checkbox"},xScroll:{attribute:"x-scroll",defaultValue:!1},maxLines:{attribute:"max-lines",defaultValue:!1},showPrompt:{attribute:"show-prompt",defaultValue:!0},configs:{attribute:"configs",defaultValue:null},tbarPosition:{attribute:"tbar-position",defaultValue:""},allowDrag:{attribute:"allow-drag",defaultValue:!1},selectAll:{attribute:"select-all",defaultValue:!1}},listeners:[{selector:".grid-panel-content-container",event:"mouseenter",callback:function(t,e){t.stopPropagation(),t.preventDefault(),e.dom().addClass("hover")}},{selector:".grid-header .th-addon",event:"click",callback:function(t,e){t.stopPropagation(),e.dom().triggerHandler("ev_grid_header_addon_click",[$(this)])}},{selector:".grid-panel-content-container",event:"mouseleave",callback:function(t,e){t.stopPropagation(),t.preventDefault(),e.dom().removeClass("hover")}},{selector:"tr.grid-content-tr",event:"mouseenter",callback:function(t,e){t.stopPropagation(),t.preventDefault();var t=$(this),i=t.attr("data-key");t.find(".grid-content-td:not('.fixed-cell')").hasClass("prevent-hover")||e.dom().find("tr.grid-content-tr").removeClass("hover").filter('[data-key="'+i+'"]').addClass("hover")}},{selector:"tr.grid-content-tr",event:"mouseleave",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this).attr("data-key");e.dom().find('tr.grid-content-tr[data-key="'+t+'"]').removeClass("hover")}},{selector:"tr.grid-content-tr",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var i=$(this).attr("data-key");0===$(t.target).closest(".grid-content-td-action-column, .grid-content-td-check-column").length&&e.dom().triggerHandler("ev_grid_row_click",[[i],$(t.target)])}},{selector:"tr.grid-content-tr.allow-drag td.grid-content-td:not(.grid-content-td-action-column)",event:"mousedown",callback:function(t,e){t.stopPropagation(),t.preventDefault();var d,l,a,n,o,c,h,g,u,p=$(this).closest("tr.grid-content-tr");p.hasClass("disabled")||0<p.closest(".grid-fixed-container").length||!e.settings.allowDrag||(d=e.getKeyById(p.attr("id")),l=e.dom(),a=l.find('.grid-content-tr[data-key="'+d+'"]'),n=l.find(".grid-content-container"),o=p.offset(),c=$(".site__main").offset().top,h=p.closest(".grid-container"),g=h.outerHeight(),u=t.clientY,a.addClass("draggable"),n.off("mousemove").on("mousemove",function(t){t.stopPropagation(),t.preventDefault();var e,i=p.offset(),s=p.outerHeight(),a=t.clientY,n=i.top,i=i.top+s,s=p.closest(".grid-content-container").find("tr.grid-content-tr:visible"),o=h.offset().top,r=document.body.clientHeight;o<=c&&a<u&&a<=c+80&&($(".site__main")[0].scrollTop-=50),r<o+g&&u<a&&r-80<=a&&($(".site__main")[0].scrollTop+=50),(u=a)<n?(e=s.first().offset().top>a?s.first():$(t.target||t.srcElement).closest("tr.grid-content-tr")).hasClass("draggable")||(e.before(p),l.triggerHandler("ev_grid_row_dom_changed",[d])):i<a&&((e=s.last().offset().top+s.last().outerHeight()<a?s.last():$(t.target||t.srcElement).closest("tr.grid-content-tr")).hasClass("draggable")||(e.after(p),l.triggerHandler("ev_grid_row_dom_changed",[d])))}),$("body").one("mouseup",function(){var t=n.find(".grid-content-tr:not(.empty)"),e=[];if(0!==t.length){for(var i=0;i<t.length;i++)e.push($(t[i]).attr("data-key"));n.off("mousemove"),a.removeClass("draggable");var s=p.offset();o.top!==s.top&&l.triggerHandler("ev_grid_row_moved",[d,e])}}))}},{selector:"td.grid-content-td-check-column label.checkbox-label",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var i=e.dom(),s=$(this),a=s.closest("tr.grid-content-tr"),n=e.getKeyById(a.attr("id")),o=s.find("input[type=checkbox]");a.hasClass("disabled")||(t=$.su.getDefaultEvent(e,function(){var t;!1===e.settings.multiSelect?(t=i.find("tr.grid-content-tr").find("input[type=checkbox]"),i.find("tr.grid-content-tr").each(function(){var t=e.getKeyById($(this).attr("id"));$(this).hasClass("selected")&&i.triggerHandler("ev_grid_row_unselected",[t])}),t.each(function(){$(this).prop("checked",!1),$(this).closest("label.checkbox-label").removeClass("checked imperfect"),$(this).closest("tr.grid-content-tr").removeClass("selected")}),o.prop("checked",!0),s.addClass("checked"),a.addClass("selected"),e.dom().triggerHandler("ev_grid_row_selected",[n])):!0===e.settings.multiSelect&&(a.toggleClass("selected"),a.hasClass("selected")?(o.prop("checked",!0),s.removeClass("imperfect checked").addClass("checked"),e.dom().triggerHandler("ev_grid_row_selected",[n]),e.updateSelectedList([n])):(o.prop("checked",!1),s.removeClass("imperfect checked"),e.dom().triggerHandler("ev_grid_row_unselected",[n]),e.updateUnselectedList([n]))),i.triggerHandler("ev_grid_checkbox_clicked",[n,a.hasClass("selected")]),e.checkSelected(),e.updateRowNumber(),e.updateSelectedInfo()}),e.dom().triggerHandler("ev_before_selected_change",[t.ev,n,a.hasClass("selected")]),t.exe())}},{selector:"th.grid-header div.checkcolumn label.checkbox-label",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var t=e.dom(),i=$(this),s=$(this).closest("div.checkbox-group-container"),a=t.find(".scroll-x-container tr.grid-content-tr:not(.disabled)"),n=[];if(a.hasClass("empty"))return!1;if(s.removeClass("partial-selected"),i.removeClass("imperfect"),s.hasClass("selected")){s.removeClass("selected"),a.removeClass("selected"),a.find("label.checkbox-label").removeClass("checked"),a.find("input[type=checkbox]").prop("checked",!1),i.find("input[type=checkbox]").prop("checked",!1),i.removeClass("checked");for(var o=0;o<a.length;o++)n.push(e.getKeyById($(a[o]).attr("id")));e.dom().triggerHandler("ev_grid_row_unselected_all",["all",n]),e.updateUnselectedList(n)}else{s.addClass("selected"),a.addClass("selected"),a.find("input[type=checkbox]").prop("checked",!0),a.find("label.checkbox-label").addClass("checked"),i.find("input[type=checkbox]").prop("checked",!0),i.addClass("checked");for(o=0;o<a.length;o++)n.push(e.getKeyById($(a[o]).attr("id")));e.dom().triggerHandler("ev_grid_row_selected_all",["all",n]),e.updateSelectedList(n)}e.checkSelected(),e.updateSelectedInfo()}},{selector:"td.grid-content-td-action-column a",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var t=$(this).data("type"),i=$(this).closest("tr.grid-content-tr"),i=e.getKeyById(i.attr("id"));e.dom().triggerHandler("ev_grid_action_click",[i,t,$(this)]),$(window).trigger("ev_remove_tip")}},{selector:"td.grid-content-td",event:"click",callback:function(t,e){t.preventDefault();var i,s=$(this).parent().attr("data-key");$(t.target).hasClass("grid-content-td")||$(t.target).hasClass("content")||$(t.target).hasClass("td-content")?$(this).trigger("ev_grid_td_click",[s]):void 0===$(t.target).data("tip")&&(i=$(t.target).data("type"),$(this).trigger("ev_grid_action_click",[s,i,$(t.target)]))}},{selector:".grid-header.filter-column .filter-icon",event:"click",callback:function(t,e){t.preventDefault(),t.stopPropagation(),e.getPlugin("filterColumns").togglePanel()}},{selector:".grid-header.actionheader .actioncolumn",event:"click",callback:function(t,e){t.preventDefault(),t.stopPropagation(),e.dom().triggerHandler("ev_grid_action_header_click")}},{selector:".grid-content-btn-edit, .grid-content-btn-view",event:"click",callback:function(t,e){t.preventDefault();var i=$(t.target).hasClass("grid-content-btn-view")?"view":"",s=$(this).closest("tr.grid-content-tr"),a=e.getKeyById(s.attr("id")),n=e.getPlugin("editor");!n||n.isEditing()||!1===a||s.hasClass("disabled")||(t.stopPropagation(),s=$.su.getDefaultEvent(e,function(){n.startEdit(a),e.dom().triggerHandler("ev_grid_edit",i?[a,i]:[a])}),e.dom().triggerHandler("ev_grid_before_edit",[s.ev,a]),s.exe())}},{selector:".grid-content-btn-delete",event:"click",callback:function(t,e){t.preventDefault(),t.stopPropagation();var t=$(this).closest("tr.grid-content-tr"),i=e.getKeyById(t.attr("id"));t.hasClass("disabled")||!1===i||(e.dom().triggerHandler("ev_grid_msg_before_show",i),e.confirm(e.settings.configs.removeConfirmText||$.su.CHAR.GRID.CONFIRM_REMOVE,function(){e.dom().triggerHandler("ev_grid_before_delete"),e.dom().triggerHandler("ev_grid_delete",[[i]])}))}},{selector:"",event:"ev_widget_show",callback:function(t,e){e.setGridHeight()}},{selector:function(){return{parent:window,target:""}},event:"ev_resize",callback:function(t,e,i){i.setGridWidth(),i.updateFixedHeight()}},{selector:".selected-all-page",event:"click",callback:function(t,e){e.settings.selectAll&&("exclude"===e.selectedType&&0===e.selectedList.length?(e.setUnselected(e.getKeys()),e.setUnSelectAll(),e.updateUnselectedList()):(e.setSelected(e.getKeys()),e.setSelectAll(),e.updateSelectedList()))}}],init:function(){this.scrollOption={suppressScrollY:!0};this.objs={},(this.objs.grid=this).objs.modelMap={},this.columnCount=0;var t=$('<tr id="'+$.su.randomId("trTool")+'"></tr>'),e=$('<td id="'+$.su.randomId("tdTool")+'"></td>');this.objs.row=new $.su.widgets.row({id:t,objs:this.objs}),this.objs.cell=new $.su.widgets.cell({id:e}),this._keys=[],this._renderMap={},this.objs.rows=[],this.triggerUpdated=!0,this.initSelect(),this.initResizeObserver()},render:function(){var t=this.dom(),e=this.settings,i=e.configs.columns,s=e.configs.filterColumns,a='<style type="text/css" name="column">',n=[],o={leftFixedHtml:"",rightFixedHtml:""},r=!1,d=!1,l=(t.addClass(e.cls+"grid-container"),""),l=(l=(l+='<div  id="'+this.domId+'-panel" class="grid-panel">')+('<div class="container widget-container grid-panel-container '+e.cls+'">')+'<div class="grid-panel-wrap">')+'<div class="grid-panel-content">'+'<div class="grid-status-container"></div>';e.tbarPosition||(l+='<div class="grid-panel-tbar-container hidden"></div>'),l+='<div class="grid-panel-content-container"><div class="container grid-container"><div class="scroll-x-container su-scroll"><div class="container grid-header-container"><table class="grid-table" border="0" cellspacing="0" cellpadding="0"><tr class="grid-header-tr">';for(var c=0;c<i.length;c++){var h=i[c];if(h.cls=h.cls||"",h.dataIndex=h.dataIndex||"",!1===h.colspan)i.splice(c,1),--c;else{if("function"==typeof h.render){if(!h.render.call(this)){i.splice(c,1),--c;continue}}else if(0==h.render){i.splice(c,1),--c;continue}this.columnCount+=1,n.push(h),void 0!==h.width&&(a=(a=(a+="#"+this.domId+" th.grid-header-"+c+",")+"#"+this.domId+" td.grid-tool-td-"+c+",")+"#"+this.domId+" td.grid-content-td-"+c,"number"===$.type(h.width)?a+="{width:"+h.width+"px;":a+="{width:"+h.width+";",0===h.width&&(a+="padding: 0;"),a+="}");var g="",u=h.display?'data-display="'+h.display+'"':"";switch(h.xtype){case"checkcolumn":d=!0,g=(g=(g=(g=g+'<div class="checkbox-group-container grid-header-checkbox checkcolumn inline">'+'<div class="widget-wrap">')+'<label class="checkbox-label">'+'<input class="checkbox-checkbox" type="checkbox" value=""/>')+'<span class="checkbox-icon"><span class="checkbox-icon-inner"></span></span>'+"</label>")+"</div>"+"</div>",h.text=h.text||"",h.name=h.name||"select";break;case"rownumberer":h.text=h.text||$.su.CHAR.GRID.ID,h.name=h.name||"seq";break;case"settings":h.text=h.text||$.su.CHAR.GRID.MODIFY,h.name=h.name||"settings";break;default:h.text=h.text||"",h.name=h.name||h.dataIndex}var p,m,f="";h.thRenderer?f+=h.thRenderer():(p="grid-header-"+(h.xtype||"other")+(h.cls?" "+h.cls:""),m="",!s||s.column!==h.dataIndex&&s.column!==h.xtype||(p+=" filter-column",m='<span class="icon filter-icon"></span>'),"actioncolumn"===h.xtype&&h.actionHeader&&(p+=" actionheader "),f=(f=f+('<th class="grid-header grid-header-'+c+" "+h.dataIndex+(c==i.length-1?" lst":"")+" "+p+'" '+(h.colspan?'colspan="'+h.colspan+'"':"")+' name="'+h.dataIndex)+'" '+u+">"+g)+'<span class="content '+(h.xtype||"")+'">'+h.text+"</span>"+m,h.tip&&(f+='<span class="info-icon-tip" data-tip="'+h.tip+'"></span>'),f+="</th>"),l+=f,void 0===h.width&&h.fixed?console.error("fixed columns should configure width"):"left"!==h.fixed&&"right"!==h.fixed||(o[h.fixed+"FixedHtml"]+=f)}}e.configs.columns=n,l+='</tr></table></div><div class="grid-tool-container hidden"></div><div class="grid-content-container-outer"><div class="grid-content-container"><table class="grid-table" border="0" cellspacing="0" cellpadding="0"><tbody class="grid-content-data"></tbody></table></div></div></div></div></div><div class="grid-panel-fbar-container"></div>',(e.configs.paging||d)&&(l+='<div class="grid-paging-selected-container">',e.configs.paging&&(l+='<div class="grid-panel-paging-container"></div>'),d&&(l+='<div class="grid-panel-selected-container u-d-inline-block hidden"><span class="selected-info"></span>',e.configs.selfSetSelectLabel&&(l=l+('<span class="selected-all-page">'+$.su.CHAR.OPERATION.SELECT_ALL)+"</span>"),l+="</div>"),l+="</div>"),l+="</div></div></div></div>";var v,b,x,w,y=$(l),C=(t.find(".grid-panel, .grid-prompt-msg").remove(),t.append(y),t.find(".scroll-x-container"));for(v in o)o.hasOwnProperty(v)&&0<o[v].length&&(b=(b='<div class="grid-fixed-container fixed-'+v.replace("FixedHtml","")+'"><div class="container grid-header-container"><table class="grid-table" border="0" cellspacing="0" cellpadding="0">')+'<tr class="grid-header-tr">'+o[v]+'</tr></table></div><div class="grid-content-container-outer"><div class="grid-content-container"><table class="grid-table" border="0" cellspacing="0" cellpadding="0"><tbody class="grid-content-data"></tbody></table></div></div></div>',C.after($(b)),r=!0,"right"===v.replace("FixedHtml",""))&&C.find(".content").last().css("visibility","hidden");r&&(x=this,t.on("ev_grid_row_dom_changed",function(){x.updateFixedRowOrder()}),w=C.siblings(".grid-fixed-container"),C.off("ps-x-reach-start").off("ps-x-reach-end").off("ps-scroll-left").off("ps-scroll-right").on("ps-scroll-left",function(){w.removeClass("reached")}).on("ps-scroll-right",function(){w.removeClass("reached")}).on("ps-x-reach-start",function(){w.filter(".fixed-left").addClass("reached")}).on("ps-x-reach-end",function(){w.filter(".fixed-right").addClass("reached")})),t[0]&&(this.msgId=t[0].id+"-prompt-msg",this.confirmId=t[0].id+"-confirm-msg",0===$("#"+this.msgId).length&&t.append($('<div class="grid-prompt-msg global-alert" widget="msg" type="info" info-type="alert" id = "'+this.msgId+'"></div>')),0===$("#"+this.confirmId).length&&t.append($('<div class="grid-confirm-msg global-confirm" widget="msg" type="confirm" id = "'+this.confirmId+'"></div>')),a+="</style>",y.prepend($(a)),this.initStyleText=a,this.dom().hasClass("loading")||this.dom().addClass("loading"),e.plugins&&this.initPlugins(e.plugins.split("|")),(y=t.find("div.grid-header-container>table").outerWidth())&&e.xScroll&&((t=t.find(".scroll-x-container")).css("width",y+10+"px"),t.parent().css("overflow-x","auto")),e.configs.currentDisplay&&this.showColumn(e.configs.currentDisplay,!0),this.resizeObserve())},initPlugins:function(t){var e=this.dom(),i=this,s=this.settings;i.plugins={};for(var a=0,n=(t=$.isArray(t)?t:[t]).length;a<n;a++){o=d=r=void 0;var o,r=t[a],d=$.extend({},s,{objs:i.objs,plugins:i.plugins});"tBar"===r?($.extend(d,{custom:s.configs.tBar}),o=$('<div id="'+i.domId+'_bar" operation="'+s.operation+'"></div>').appendTo(e),"bottom"===s.tbarPosition?e.find(".grid-panel-content").append($("<div class='grid-panel-tbar-container'></div>")):e.find(".grid-panel-tbar-container").removeClass("hidden"),i.plugins.tBar=new $.su.widgets.tBar($.extend(d,{id:o})),i.plugins.tBar.render()):(o=$('<div id="'+i.domId+"_"+r+'"></div>').appendTo(e),$.su.widgets[r]&&(i.plugins[r]=new $.su.widgets[r]($.extend(d,{id:o})),i.plugins[r].render()))}},destroy:function(){this.cancelResizeObserve()},getValue:function(){return this.objs.rows},setValue:function(){return 0},syncData:function(e,i,s){try{this.handleSyncData(e,i,s)}catch(t){setTimeout(()=>{this.handleSyncData(e,i,s)},300)}},handleSyncData:function(t,e,i){var s=this,a=this.dom(),n=s.getPlugin("paging");s.objs.rows=[],s.objs.modelMap={},s._keys=t,s._keyProperty="",this._renderMap={},n&&n.updateRowPage(t),this.rerender=!!i,a.triggerHandler("ev_store_render_items",[t])},renderModels:function(t,e,i){var s=this,a=this.settings,n="",o="",r="",d=[],l=$.extend({},a,{objs:s.objs}),c=this.dom().find(".scroll-x-container tbody.grid-content-data").eq(0),h=this.dom().find(".grid-fixed-container.fixed-left tbody.grid-content-data").eq(0),g=this.dom().find(".grid-fixed-container.fixed-right tbody.grid-content-data").eq(0),u=[],p=s.getPlugin("paging"),m=p?p._pageMap:{},f=p?p.settings:null;s._keyProperty=t;for(var v=0,b=e.length;v<b;v++){var x=e[v][t].getValue(),w=m[x];s.objs.modelMap[x]=e[v],a.selfHandle&&f&&w!==f.currentPage||(w=s.objs.row.initRow(x,l),d.push(w),this._renderMap[x]=!0,n+=w.domContent,o+=w.leftFixedContent,r+=w.rightFixedContent)}this.dom().triggerHandler("ev_grid_items_before_remove"),c.html(n),h.html(o),g.html(r),s.objs.rows=[];for(var y=0,C=d.length;y<C;y++){var _=d[y].domId,I=d[y].key,k=new $.su.widgets.row({id:_}),T=d[y].settings.cellObjs;p&&(_=k.dom().attr("data-key"),this.dom().find('.grid-panel-content-container .grid-container tr[data-key="'+_+'"]').attr("data-page",m[I])),$.extend(k,d[y]),s.objs.rows.push({key:I,obj:k}),u.push({key:I,obj:k});for(var S=0,P=T.length;S<P;S++){var A=T[S].domId,A=new $.su.widgets.cell({id:A});$.extend(A,T[S]),T[S].callback&&T[S].callback.call(A),k.cells.push(A)}}for(var R=0;R<u.length;R++){var E,M=u[R].obj,t=u[R].key;M&&(a.selfHandle&&f?(E=f.currentPage*f.numPerPage+1+R,M.dom().find("span.grid-row-numberer").html(E)):M.dom().find("span.grid-row-numberer").html($.inArray(t,this._keys)+1))}this.settings.operation&&-1!==this.settings.operation.indexOf("columns")&&this.objs.tool.renderDefaultCol(this),i(u),this.setGridWidth(),this.updateFixedHeight(),this.updateRowNumber()},reRenderModels:function(){this.rerender=!0,this.dom().triggerHandler("ev_store_render_items",[this._keys])},createRow:function(t,e){var i=this,s=this.settings,a={},s=$.extend({},s,{objs:i.objs}),n={},o=i.dom().find("tbody.grid-content-data").eq(0),r=(n[t]=[],i.objs.cells=n,i.objs.modelMap[t]=e,i.objs.row.initRow(a.key=t,s));o.append(r.domContent),a.obj=new $.su.widgets.row({id:r.domId}),$.extend(a.obj,r);for(var d=0,l=r.settings.cellObjs.length;d<l;d++){var c=r.settings.cellObjs[d],h=c.domId,h=new $.su.widgets.cell({id:h});$.extend(h,c),c.callback&&c.callback.call(h),a.obj.cells.push(h)}return i.objs.rows.push(a),i.updateRowNumber(),i.dom().triggerHandler("ev_grid_row_created",[i.objs.rows]),a.obj},updateRowNumber:function(){var t=this,e=(clearTimeout(t._updateRow),this.triggerUpdated);t._updateRow=setTimeout(function(){0<t.dom().length&&(t.updateRow(),e)&&t.dom().triggerHandler("ev_grid_updated")},0)},updateRow:function(){var t=this.dom(),e=t.find("tbody.grid-content-data").eq(0),i=t.find("th.grid-header div.checkcolumn label.checkbox-label"),s=i.closest("div.checkbox-group-container"),a=this.getPlugin("paging"),n=t.find("table"),o=a?a.settings:null,r=(a&&(a.updateBtns(),a.getRowNumberOffset()),this.getPlugin("toolRow"),this.objs.rows),d=r.length;if(0==d&&0===this._keys.length){if(0===e.find("tr.grid-content-tr.empty").length)return a=this.objs.row.initEmptyRow(this.getColumns().length,this),e.append(a),s.removeClass("selected partial-selected"),i.removeClass("checked imperfect"),this.setGridHeight(),void this.checkSelected()}else this.dom().hasClass("loading")||t.find(".grid-content-tr.empty").each(function(){$(this).closest(".grid-container").attr("id")===t.attr("id")&&$(this).remove()});for(u=0;u<d;u++){var l,c=r[u].obj,h=r[u].key;c&&(this.settings.selfHandle&&o?(l=o.currentPage*o.numPerPage+1+u,c.dom().find("span.grid-row-numberer").html(l)):c.dom().find("span.grid-row-numberer").html($.inArray(h,this._keys)+1))}var g,u=0,p=0;for(g in this.objs.modelMap)this.objs.modelMap.hasOwnProperty(g)&&(this.objs.modelMap[g].selected&&u++,this.objs.modelMap[g].disabled)&&p++;this.settings.configs.selfSetCheckbox||(0<u?u!=this._keys.length-p?(s.removeClass("selected").addClass("partial-selected"),i.removeClass("checked").addClass("imperfect")):(s.removeClass("partial-selected").addClass("selected"),i.removeClass("imperfect").addClass("checked")):(s.removeClass("selected partial-selected"),i.removeClass("checked imperfect"))),$.su.isIe&&(n.css("display","inline-table"),setTimeout(function(){n.css("display","")},0)),this.setGridHeight(),this.checkSelected(),this.settings.selectAll&&this.settings.selfHandle&&this.updateHeaderSelectedStatus()},getClosestContainerClass:function(t,e){return"#"+(e||this.domId)+" > .grid-panel > .grid-panel-container > .grid-panel-wrap > .grid-panel-content > .grid-panel-content-container > .grid-container > .scroll-x-container > "+("content"===t?".grid-content-container-outer ":" ")+".grid-"+t+"-container > table > tbody > tr > "},getFixedContainerClass:function(t){return"#"+this.domId+" .grid-fixed-container .grid-"+t+"-container > table > tbody > tr > "},updateFixedHeight:function(){var s,t,e=this.dom();0!==e.height()&&null!==e[0].offsetParent&&0<(s=e.find(".grid-fixed-container")).length&&(t=e.find(".scroll-x-container .grid-header-tr")[0].getBoundingClientRect().height,s.find(".grid-header-tr").outerHeight(t),e.find(".scroll-x-container .grid-content-tr").each(function(t,e){var i=$(e).attr("data-key"),e=$(e)[0].getBoundingClientRect().height;s.find('.grid-content-tr[data-key="'+i+'"]').outerHeight(e)}),s.removeClass("reached"),this.updateContentHeight())},updateContentHeight:function(){var t,e=this.dom(),s=e.find(".scroll-x-container"),e=e.find(".grid-fixed-container");0<e.length&&(t=e.find(".grid-header-tr")[0].getBoundingClientRect().height,s.find(".grid-header-tr").outerHeight(t),e.find(".grid-content-tr").each(function(t,e){var i=$(e).attr("data-key"),e=$(e)[0].getBoundingClientRect().height;s.find('.grid-content-tr[data-key="'+i+'"]').find(".grid-content-td").outerHeight(e)}))},updateFixedRowOrder:function(){var t=this.dom(),e=t.find(".scroll-x-container .grid-content-tr"),s=t.find(".grid-fixed-container .grid-content-tr"),a=t.find(".grid-fixed-container .grid-content-container .grid-content-data");e.each(function(t,e){var i=$(e).attr("data-key"),i=s.filter('[data-key="'+i+'"]');0===t?a.prepend(i):(t=$(e).prev().attr("data-key"),s.filter("[data-key="+t+"]").after(i))})},setGridWidth:function(){var t=this.dom(),e=t.find(".grid-panel"),i=this.settings.configs.columns,s='<style type="text/css" name="column">';if(0!==t.width()){e.find('style[name="column"]').remove(),e.prepend(this.initStyleText);for(var a=0,n=i.length;a<n;a++){var o=i[a],r=Math.max($(this.getClosestContainerClass("header")+" th.grid-header-"+a).outerWidth(),o.minWidth||0);0===r&&(r=$(this.getClosestContainerClass("header",t.parents(".grid-container.widget-container").eq(0).attr("id"))+" th.grid-header-"+(a+1)).outerWidth()),s=(s=(s+=this.getClosestContainerClass("header")+" th.grid-header-"+a+",")+(this.getClosestContainerClass("tool")+" td.grid-tool-td-"+a+","))+(this.getClosestContainerClass("content")+" td.grid-content-td-"+a),"left"!==o.fixed&&"right"!==o.fixed||(s=(s+=","+this.getFixedContainerClass("header")+" th.grid-header-"+a+",")+this.getFixedContainerClass("content")+" td.grid-content-td-"+a),s+="{width:"+r+"px;",0===o.width&&(s+="padding: 0;"),s+="}"}s+="</style>",e.find('style[name="column"]').remove(),e.prepend($(s))}},setGridHeight:function(){for(var t=this.settings,e=this.getContainer(),i=e.find(".grid-content-container")[0],s=i.scrollTop,a=(0<e.find("style[name=grid]").length&&e.find("style[name=grid]").remove(),'<style type="text/css" name="grid">'),n=(a+="div#"+this.domId+" div.grid-content-container{",e.find("tr.grid-content-tr")),o=null,r=0,d=n.length;r<d;r++){for(var l=n.eq(r),c=l.find("td"),h=!1,g=0,u=c.length;g<u;g++)if(1<c.eq(g).attr("rowspan")){h=!0;break}if(!h){o=l;break}}var p=0;o&&(p=o.outerHeight()),t.minLines&&(a+="min-height:"+t.minLines*p+"px;"),t.maxLines&&(a+="max-height:"+t.maxLines*p+"px;",e.addClass("allow-scroll")),a+="}</style>",e.prepend($(a)),i.scrollTop=s,$(i).height()<$(i).find("table").height()?this._resetWidth||(t=$(i).width()-$(i).children("table").width(),this._resetWidth=!0,e.find(".grid-header-container").css("padding-right",t),e.find(".grid-tool-container").css("padding-right",t)):this._resetWidth&&(this._resetWidth=!1,e.find(".grid-header-container").css("padding-right",0),e.find(".grid-tool-container").css("padding-right",0))},setGridColumnName:function(t){var e=this.dom(),i=this.settings.configs.columns;if($.isArray(t))for(var s=0,a=t.length;s<a;s++){var n=parseInt(t[s].index),o=t[s].text,r=e.find(".grid-header-container th").get(n);r&&$(r).find("span.content").text(o),i[n].text=o}},setEmptyRowContent:function(t){this.settings.emptyContent=t},reRenderColumn:function(t){for(var e=this.objs.rows,i=this.objs.modelMap,s=0,a=e.length;s<a;s++)for(var n=e[s].key,o=e[s].obj.cells,r=i[n].getData()[t],d=0,l=o.length;d<l;d++)o[d].field===t&&o[d].setValue(r)},getKeys:function(){var t,e=[],i=this.objs.modelMap,s=this._keyProperty;for(t in i)i.hasOwnProperty(t)&&e.push(i[t][s].getValue());return e},getRow:function(t){var e=this.objs.rows;if(void 0===t)return e;for(var i=0,s=e.length;i<s;i++)if(t===e[i].key)return e[i].obj;return!1},disableRow:function(t){var e=this.getRow(t);e&&(e.dom().addClass("disabled"),this.dom().find(".grid-fixed-container").find('.grid-content-tr[data-key="'+t+'"]').addClass("disabled")),-1!==this._keys.indexOf(t)&&this.dom().triggerHandler("ev_grid_row_disabled",[t])},enableRow:function(t){var e=this.getRow(t);e&&(e.dom().removeClass("disabled"),this.dom().find(".grid-fixed-container").find('.grid-content-tr[data-key="'+t+'"]').removeClass("disabled")),-1!==this._keys.indexOf(t)&&this.dom().triggerHandler("ev_grid_row_enabled",[t])},addRowClass:function(t,e){var i=this.getRow(t);i&&(i.dom().addClass(e),this.dom().find(".grid-fixed-container").find('.grid-content-tr[data-key="'+t+'"]').addClass(e))},removeRowClass:function(t,e){var i=this.getRow(t);i&&(i.dom().removeClass(e),this.dom().find(".grid-fixed-container").find('.grid-content-tr[data-key="'+t+'"]').removeClass(e))},getAllSelectedKeys:function(){var t,e=[],i=this.objs.modelMap,s=this._keyProperty;for(t in i)i.hasOwnProperty(t)&&i[t].selected&&e.push(i[t][s].getValue());return e},showSelectedInfo:function(){0===this.dom().find(".grid-panel-selected-container").find(".selected-info").text().length&&this.updateSelectedInfo(),this.dom().find(".grid-panel-selected-container").removeClass("hidden")},hideSelectedInfo:function(){this.dom().find(".grid-panel-selected-container").addClass("hidden")},updateSelectedInfo:function(){var t,e,i=this.dom().find(".grid-panel-selected-container .selected-info"),s=this.dom().find("span.selected-all-page");"allPage"===this.settings.selectTotal?(t=this.getPlugin("paging").settings.totalRows||this._keys.length,"all"==this.selectedType?(e=t,s.text($.su.CHAR.OPERATION.UN_SELECT_ALL)):"include"==this.selectedType?(e=this.selectedNum,s.text($.su.CHAR.OPERATION.SELECT_ALL)):"exclude"==this.selectedType&&(e=t-this.selectedNum,s.text($.su.CHAR.OPERATION.SELECT_ALL)),this.allPageSelectNum=e):(t=this._keys.length,e=this.getAllSelectedKeys().length),t===e&&s.text($.su.CHAR.OPERATION.UN_SELECT_ALL);s=(s=$.su.CHAR.GRID.SELECTED_INFO.replace("%selected",e)).replace("%total",t);i.text(s),this.dom().triggerHandler("ev_grid_select_update",[e])},getRows:function(){for(var t=this.objs.rows,e=[],i=0,s=t.length;i<s;i++)e.push(t[i].obj);return e},getPlugin:function(t){try{var e=this.settings.plugins.split("|");if("editor"===t){if(-1!==$.inArray("editor",e))return this.plugins["editor"];if(-1!==$.inArray("popEditor",e))return this.plugins["popEditor"]}return-1!==$.inArray(t,e)?this.plugins[t]:!1}catch(t){console.log(t)}},getColumns:function(){try{return this.settings.configs.columns}catch(t){console.log(t)}},getAllSelected:function(){return this.allPageSelectNum},getSelected:function(){var i=this,t=this.dom().find("tr.grid-content-tr.selected"),s=[];return t.each(function(t,e){var e=$(e);e.hasClass("empty")||e.hasClass("disabled")||(e=e.attr("id"),e=i.getKeyById(e),s.push(e))}),s},getUnSelected:function(){var i=this,t=this.dom().find("tr.grid-content-tr:not(.selected)"),s=[];return t.each(function(t,e){var e=$(e);e.hasClass("empty")||e.hasClass("disabled")||(e=e.attr("id"),e=i.getKeyById(e),s.push(e))}),s},checkSelected:function(){var t=this,e=this.getSelected(),i=this.getPlugin("tBar");i&&!t.settings.selectAll&&(0===e.length?i.disable(["delete","edit"]):1===e.length?i.enable(["delete","edit"]):1<e.length&&(i.disable("edit"),i.enable("delete"))),clearTimeout(this._checkStatusEvent),this._checkStatusEvent=setTimeout(function(){t.dom().triggerHandler("ev_grid_check_status")},10)},setSelectAll:function(){var t=this.dom().find("tr.grid-header-tr label.checkbox-label");t.closest("div.checkbox-group-container").removeClass("partial-selected").addClass("selected"),t.removeClass("imperfect").addClass("checked"),this.updateSelectedInfo()},setUnSelectAll:function(){var t=this.dom().find("tr.grid-header-tr label.checkbox-label"),e=t.closest("div.checkbox-group-container");t.removeClass("checked imperfect"),e.removeClass("selected partial-selected"),this.updateSelectedInfo()},setPartialSelectAll:function(){var t=this.dom().find("tr.grid-header-tr label.checkbox-label");t.closest("div.checkbox-group-container").removeClass("selected").addClass("partial-selected"),t.removeClass("checked").addClass("imperfect"),this.updateSelectedInfo()},setSelected:function(t){if(void 0===t&&(t=this._keys),1!==(t=$.isArray(t)?t:[t]).length&&!1===this.settings.multiSelect)return!1;this.selectCheckbox(t)},setUnselected:function(t){void 0===t&&(t=this._keys),t=$.isArray(t)?t:[t],this.unSelectCheckbox(t)},selectCheckbox:function(t){var e=this.dom().find(".scroll-x-container");if(!1===this.settings.multiSelect){if((s=e.find('tr.grid-content-tr[data-key="'+t[0]+'"]')).hasClass("disabled")||s.hasClass("selected"))return;var i=(a=s.find("label.checkbox-label")).find("input[type=checkbox]");e.find("tr.grid-content-tr").find("input[type=checkbox]").each(function(){$(this).prop("checked",!1),$(this).closest("label.checkbox-label").removeClass("checked"),$(this).closest("tr.grid-content-tr").removeClass("selected")}),i.prop("checked",!0),a.addClass("checked"),s.addClass("selected"),this.dom().triggerHandler("ev_grid_row_selected",[t[0]])}else if(!0===this.settings.multiSelect){for(var s,a,n=0,o=t.length;n<o;n++)(s=e.find('tr.grid-content-tr[data-key="'+t[n]+'"]')).hasClass("disabled")||s.hasClass("selected")||(i=(a=s.find("label.checkbox-label")).find("input[type=checkbox]"),s.addClass("selected"),i.prop("checked",!0),a.addClass("checked"));this.dom().triggerHandler("ev_grid_row_selected",[t])}this.checkSelected(),this.updateRowNumber(),this.updateSelectedInfo()},unSelectCheckbox:function(t){for(var e=this.dom().find(".scroll-x-container"),i=0,s=t.length;i<s;i++){var a,n,o=e.find('tr.grid-content-tr[data-key="'+t[i]+'"]');!o.hasClass("disabled")&&o.hasClass("selected")&&(n=(a=o.find("label.checkbox-label")).find("input[type=checkbox]"),o.removeClass("selected"),n.prop("checked",!1),a.removeClass("checked"))}this.dom().triggerHandler("ev_grid_row_unselected",[t]),this.checkSelected(),this.updateRowNumber(),this.updateSelectedInfo()},getDisplay:function(){var t=this.dom().find("input.grid-display");return 0<t.length?t:null},search:function(t){if(!t)return null},updateRowId:function(){this.dom().find("tbody.grid-content-data tr.grid-content-tr").each(function(t,e){$(e).find("span.grid-row-numberer").text(t+1)})},moveRow:function(t,e){var i=this.dom(),t=i.find('tr.grid-content-tr[data-key="'+t+'"]'),i=i.find("tbody.grid-content-data tr.grid-content-tr").get(e);$(i).before(t),this.updateRowId()},runProgress:function(){var t=this.getPlugin("tBar").dom().find("div.gird-prompt-progressbar"),e=t.find("div.progressbar-value");e.stop(),e.css("width","0px"),t.clearQueue().fadeIn(100,function(){e.animate({width:"50%"},5e3)})},prompt:function(t,e){var i,s=this,a=this.dom(),n=a.find(".grid-prompt-msg");n.get(0)&&((n=new $.su.widgets.msg({id:$(n[0])})).render(),n.setContent(e).show(),(i=n.dom()).on("ev_msg_close",function(){i.remove(),a.append($('<div class="grid-prompt-msg" widget="msg" type="info" info-type="alert" id = "'+s.msgId+'"></div>'))}))},confirm:function(t,e){var i=this,s=$("#"+i.confirmId);i.confirmCallback=e,(s.data("viewObj")?(s.data("viewObj").setTitle(s.data("viewObj")._titleText||$.su.CHAR.OPERATION.DELETE),s.data("viewObj").setContent(s.data("viewObj")._contentText||t),s.data("viewObj").show(),s.data("viewObj")):((e=new $.su.widgets.msg({id:i.confirmId})).render(),e._gridObj=this,e.setContent(t),e.setTitle($.su.CHAR.OPERATION.DELETE),e.setContent(t),e.show(),e)).dom().off("ev_msg_ok").on("ev_msg_ok",function(){i.confirmCallback&&i.confirmCallback()})},setConfirm:function(t){var e=$("#"+this.confirmId).data("viewObj");e||((e=new $.su.widgets.msg({id:this.confirmId})).render(),e._gridObj=this),t.title&&(e._titleText=t.title),t.content&&(e._contentText=t.content)},insert:function(t,e){var i=this.dom(),s=this.settings,a=i.find("tbody.grid-content-data");t=parseInt(t,10)||0,e=e||[{}],(e=$.isArray(e)?e:[e]).reverse();for(var n=0,o=e.length;n<o;n++){var r=s.row.initRow(t+n,e[n]);0==t?a.prepend(r):r.insertBefore(this.objs.rows[t]),this.objs.rows.splice(t,0,r)}this.updateRowNumber(),i.triggerHandler("ev_insert",[t,e])},remove:function(t){var e,i,s=this.objs.rows;if(t){for(e=s.length-1;0<=e;e--)s[e].key===t&&(s[e].obj.dom().remove(),s.splice(e,1));delete this.objs.modelMap[t]}else{for(e=0,i=s.length;e<i;e++)s[e].obj.dom().remove();s.length=0,this.objs.modelMap=[]}this.updateRowNumber()},getEditStatus:function(){var t=this.getPlugin("editor");return!t.isEditing()||""===t.getEditingId()?0:"add"===t.getEditingId()?2:1},getKeyByDom:function(t){return $(t).closest(".grid-content-tr").attr("data-key")},getKeyById:function(t){for(var e=this.objs.rows,i=0,s=e.length;i<s;i++)if(t===e[i].obj.domId)return e[i].key;return!1},rowSpan:function(t,e){var i=this.dom(),s={};if(void 0===e)s["0"]=this.objs.rows.length;else for(var a=0,n=e.length;a<n;a++){var o=e[a];s[o[0]]=o.length}i.find("td.grid-content-td-"+t).each(function(t,e){$(e).show(),s[t]?$(e).attr("rowspan",s[t]):$(e).hide()})},colSpan:function(t,e){var i=this.dom(),s={},a=[],n=[];if(void 0===e)for(var o=0,r=this.objs.rows.length;o<r;o++)a.push(this.objs.rows[o].key);else a=$.isArray(e)?e:[e];for(var d=0,l=t.length;d<l;d++){var c=t[d];s[c[0]]=c.length,n=n.concat(c.slice(1))}for(var h=0,g=a.length;h<g;h++){var u=i.find('tr.grid-content-tr[data-key="'+a[h]+'"]');0<u.length&&u.find("td.grid-content-td").each(function(t,e){var i=$(e).attr("name");"btn-column"!==i&&($(e).show(),s[i]?$(e).attr("colspan",s[i]):(-1!==$.inArray(i,n)&&$(e).hide(),$(e).removeAttr("colspan")))})}},enableColumn:function(t){this.dom().find("td.grid-content-td-"+t).removeClass("disabled")},disableColumn:function(t){this.dom().find("td.grid-content-td-"+t).addClass("disabled")},showColumn:function(t,e){var i="",s="#"+this.domId+" ",a=this.dom().find("div.grid-container").eq(0);e?(a.children("style.column-hide-style").remove(),a.append((i+='<style class="column-hide-style">')+(s+"th[data-display],")+(s+"td[data-display]")+"{display: none;}"+(s+"th[data-display="+t+"],")+(s+"td[data-display="+t+"]")+"{display: table-cell;}</style>")):a.children("style.column-hide-style").remove(),this.setGridWidth(),this.updateFixedHeight()},hideColumn:function(i,s){var a="",n="#"+this.domId+" ",t=this.dom().find("div.grid-container").eq(0);i instanceof Array||(i=[i]),t.children("style.column-hide-style").remove(),a+='<style class="column-hide-style">',$.each(i,function(t,e){a=s?(a=(a+=n+"th[data-display],")+n+"td[data-display]{display: table-cell;}")+n+"th[data-display="+e+"],"+n+"td[data-display="+e+"]":(a+=n+"th.grid-header."+e+", ")+n+"td.grid-content-td-"+e+", "+n+"td.grid-tool-td-"+e,t<i.length-1&&(a+=", ")}),a+="{display: none;}</style>",t.append(a),this.setGridWidth(),this.updateFixedHeight()},hideCheckbox:function(t){var e="",i="#"+this.domId+" ",s=this.dom().find("div.grid-container").eq(0);s.children("style.column-hide-style").remove(),s.append(e+'<style class="column-hide-style">'+(i+"th.grid-header.grid-header-checkcolumn, ")+(i+"td.grid-content-td-check-column")+"{display: none;}</style>"),this.hideSelectedInfo(),this.setGridWidth(),this.updateFixedHeight()},hideFilterColumns:function(i,t){var s,a="",n="#"+this.domId+" ",e=this.dom().find("div.grid-container").eq(0);e.children("style.column-group-hide-style[name="+t+"]").remove(),a+='<style class="column-group-hide-style" name="'+t+'">',$.each(i,function(t,e){switch(s=t===i.length-1?"":", ",e){case"actioncolumn":a=a+(n+"th.grid-header-actioncolumn, ")+(n+"td[name=action-column]"+s);break;case"checkcolumn":a=a+(n+"th.grid-header-checkcolumn, ")+(n+"td[name=check-column]"+s);break;default:a=(a+=n+"th[name="+e+"],")+(n+"td[name="+e+"],")+(n+".grid-content-td-"+e+s)}}),a+="{display: none;}</style>",e.append(a),this.setGridWidth(),this.updateFixedHeight()},loading:function(t){var e,i;this.dom().hasClass("loading")||(e=this.dom().find(".scroll-x-container tbody.grid-content-data").eq(0),i=this.objs.row.initEmptyRow(this.getColumns().length,this,$.su.CHAR.COMMON.LOADING),this.dom().addClass("loading"),0===this.objs.rows.length||t?e.empty():this.remove(),this.dom().find(".grid-fixed-container.fixed-left tbody.grid-content-data").eq(0).empty(),this.dom().find(".grid-fixed-container.fixed-right tbody.grid-content-data").eq(0).empty(),e.append(i))},setSort:function(t,e){var i=this.plugins.sorts;i&&i.setSort(t,e)},getSortName:function(){var t=this.plugins.sorts;return!!t&&t.getSortName()},getSortRuleByName:function(t){if(this.plugins.sorts)for(var e=this.settings.configs.columns,i=0,s=e.length;i<s;i++)if(t===e[i].name&&e[i].sortRule&&"function"===$.type(e[i].sortRule))return e[i].sortRule;return null},resort:function(){this.settings.configs&&this.settings.configs.forbidRefresh||this.plugins.sorts&&this.plugins.sorts.resortByData()},unTriggerUpdatedEvent:function(){this.triggerUpdated=!1},triggerUpdatedEvent:function(){this.triggerUpdated=!0},setSelectedNum:function(t,e){this.selectedType=t,this.selectedNum=e,this.updateSelectedInfo()},show:function(){this.dom().show(),this.setGridWidth(),setTimeout(()=>{this.updateFixedHeight()},0),this.dom().triggerHandler("ev_widget_show")},setSelfHandle:function(t){this.settings.selfHandle=!!t},getCurrentPageNum:function(){var t=this.getPlugin("paging");if(t)return t.getCurrentPageNum()},setPageNum:function(t){var e=this.getPlugin("paging");e&&e.goTo(t)},initSelect:function(){this.selectedType="include",this.selectedList=[],this.selectedNum=0},updateSelectedList:function(t){var i;this.settings.selectAll&&"allPage"===this.settings.selectTotal&&(i=this,t?$.each(t,function(t,e){"include"===i.selectedType?-1===i.selectedList.indexOf(e)&&i.selectedList.push(e):-1!==(e=i.selectedList.indexOf(e))&&i.selectedList.splice(e,1)}):(this.selectedType="exclude",this.selectedList=[]),this.updateSelectAllStatus())},updateUnselectedList:function(t){var i;this.settings.selectAll&&"allPage"===this.settings.selectTotal&&(i=this,t?$.each(t,function(t,e){"exclude"===i.selectedType?-1===i.selectedList.indexOf(e)&&i.selectedList.push(e):-1!==(e=i.selectedList.indexOf(e))&&i.selectedList.splice(e,1)}):(this.selectedType="include",this.selectedList=[]),this.updateSelectAllStatus())},updateSelectAllStatus:function(){this.selectedList.length&&this.selectedList.length===this.getPlugin("paging").settings.totalRows&&(this.selectedType="include"===this.selectedType?"exclude":"include",this.selectedList=[]),this.setSelectedNum(this.selectedType,this.selectedList.length),this.dom().triggerHandler("ev_grid_select_status_change",[this.getSelectedInfo()])},getSelectedInfo:function(){return this.settings.selectAll&&"allPage"===this.settings.selectTotal?{selectAll:"include"!==this.selectedType,selectedList:$.su.clone(this.selectedList)}:{}},selectChecked:function(){var i=this,t=this.getPlugin("paging").settings.totalRows;$.isNumeric(t)&&t?this.showSelectedInfo():this.hideSelectedInfo(),this.settings.selectAll&&"allPage"===this.settings.selectTotal&&(t=this.getKeys(),$.each(t,function(t,e){"include"===i.selectedType?0<=i.selectedList.indexOf(e)?i.setSelected(e):i.setUnselected(e):-1===i.selectedList.indexOf(e)?i.setSelected(e):i.setUnselected(e)}),i.updateSelectAllStatus())},removeKeyFromSelectedList:function(t){t=this.selectedList.indexOf(t);0<=t&&this.selectedList.splice(t,1),this.setSelectedNum(this.selectedType,this.selectedList.length)},setSelectedPageSize:function(t){var e=this.getPlugin("paging");if(e)return e.setSelectedPageSize(t)},setHeaderAddon:function(t,e){var t=this.dom().find(".grid-header[name="+t+"]"),i=t.find(".th-addon");0<i.length?i.html(e):t.append('<span class="th-addon">'+e+"</span>")},updateHeaderSelectedStatus:function(){var i=0,s=0,t=this.dom().find("th.grid-header div.checkcolumn label.checkbox-label"),e=t.closest("div.checkbox-group-container");e.removeClass("selected partial-selected"),t.removeClass("checked imperfect"),this.dom().find(".grid-content-tr").each(function(t,e){s++,$(e).hasClass("selected")&&i++}),0<i?i!==s?(e.removeClass("selected").addClass("partial-selected"),t.removeClass("checked").addClass("imperfect")):(e.removeClass("partial-selected").addClass("selected"),t.removeClass("imperfect").addClass("checked")):(e.removeClass("selected partial-selected"),t.removeClass("checked imperfect"))},setSelectedInfo:function(t){t=$.su.clone(t),this.selectedType=t.selectAll?"exclude":"include",this.selectedList=t.selectedList},initResizeObserver:function(){var t=window.ResizeObserver,e=this.setGridWidth.bind(this),i=this.updateFixedHeight.bind(this);this.resizeObserver=new t($.su.debounce(function(){e(),i()},100))},resizeObserve:function(){if(this.gridDoms=this.dom().find(".grid-container"),this.gridDoms&&this.gridDoms.length)for(var t=0;t<this.gridDoms.length;t++)this.resizeObserver.observe(this.gridDoms[t])},cancelResizeObserve:function(){if(this.gridDoms&&this.gridDoms.length)for(var t=0;t<this.gridDoms.length;t++)this.resizeObserver.unobserve(this.gridDoms[t])}}),$.su.Widget.register("tBar",{settings:{operation:{attribute:"operation",defaultValue:""}},listeners:[{selector:"a.btn-add",event:"click",callback:function(t,e){var i,s;t.stopPropagation(),t.preventDefault(),$(this).hasClass("disabled")||!(i=(e=(t=e.settings).objs.grid).getPlugin("editor"))||$(this).hasClass("disabled")||"function"==$.type(t.beforeStartAdd)&&!t.beforeStartAdd()||!1!==i.isEditing()||(t=t.configs.paging,s=e.plugins.paging,t&&t.isPaging&&s.goToPage(0),i.startEdit("add"),e.dom().triggerHandler("ev_grid_edit",["add"]))}},{selector:"a.btn-delete",event:"click",callback:function(t,s){t.stopPropagation(),t.preventDefault();var a=s.settings.objs.grid,n=a.getPlugin("paging"),o=a.objs.rows,t=a.getPlugin("editor"),r=a.getSelected();$(this).hasClass("disabled")||t&&!1===t.isEditing()&&(a.confirm($.su.CHAR.COMMON.DELETE_CONFIRM_CONTENT),$("#"+a.confirmId).one("ev_msg_ok",function(){for(var t=o.length-1;0<=t;t--){var e=o[t].obj;-1!==$.inArray(e.dom().attr("data-key"),r)&&(e.dom().remove(),o.splice(t,1))}a.updateRowNumber(),n&&n.updateBtns();var i=$.su.getDefaultEvent(s,function(){a.dom().triggerHandler("ev_grid_delete",[r])});a.dom().triggerHandler("ev_grid_before_delete",[i.ev]),i.exe(),a.dom().triggerHandler("ev_grid_after_delete"),$(this).off("ev_msg_no")}).one("ev_msg_no",function(){$(this).off("ev_msg_ok")}))}},{selector:"a.btn-edit",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var t=e.settings.objs.grid,e=t.getSelected(),i=t.getPlugin("editor");i&&!$(this).hasClass("disabled")&&0<e.length&&i&&!i.isEditing()&&(i.startEdit(e[0]),t.dom().triggerHandler("ev_grid_edit",[e[0]]))}},{selector:"a.btn-delete-all",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=e.settings.objs.grid,e=t.getPlugin("editor");if(e&&!1===e.isEditing()){for(var i=[],e=t.getPlugin("paging"),s=t.objs.rows,a=s.length-1;0<=a;a--)i.push(s[a].key),s[a].obj.dom().remove(),s.splice(a,1);t.updateRowNumber(),e&&e.updateBtns(),t.dom().triggerHandler("ev_grid_delete",[i])}}},{selector:"input.search-text",event:"focus",callback:function(t){t.stopPropagation(),$(this).closest("div.search-container").addClass("focus")}},{selector:"input.search-text",event:"blur",callback:function(t){t.stopPropagation(),$("div.search-container").removeClass("focus")}},{selector:"a.operation-btn",event:"click",callback:function(t,e){t.preventDefault(),t.stopPropagation(),$(this).hasClass("disabled")||(t=e.settings.objs.grid,e=$(this).attr("tbar-name"),t.dom().triggerHandler("ev_grid_tbar_"+e))}},{selector:"a.search-switch",event:"click",callback:function(t,e){t.stopPropagation();t=e.settings.objs.grid,e=$(this).prevAll("input.search-text").val();t.search(e)}}],init:function(t){this.settings=t},render:function(){var t=this.dom(),e=t.parent().find("div.grid-panel-tbar-container"),i=this.settings,s=$.type(i.operation),a=[];if(i.objs.grid.dom().addClass("grid-tbar"),"string"===s)a=i.operation.split("|");else if("array"===s)a=i.operation;else if(!i.custom)return null;i.operation=a,e.removeClass("hidden");for(var n='<div class="operation-container" id="'+this.domId+'">',o=0,r=a.length;o<r;o++){var d=0===o?"fst":"",l=o===r-1?"lst":"";switch(a[o]){case"add":n=(n=n+('<a href="javascript:void(0);" tbar-name="add" class="operation-btn btn-add '+d+" "+l+'">')+'<span class="icon"></span>')+('<span class="text">'+$.su.CHAR.OPERATION.ADD+"</span>")+"</a>",i.maxRulesMsgText;break;case"edit":n=(n=n+('<a href="javascript:void(0);" tbar-name="edit" class="operation-btn btn-edit '+d+" "+l+'">')+'<span class="icon"></span>')+('<span class="text">'+$.su.CHAR.OPERATION.EDIT+"</span>")+"</a>";break;case"prompt":n=(n=(n=(n=(n+='<div class="grid-prompt hidden widget-container successed inline-block left">')+'<div class="content">'+'<span class="icon"></span>')+('<span class="text text-successed">'+i.promptTextSuccessed+"</span>"))+('<span class="text text-failed">'+i.promptTextFailed+"</span>"))+"</div>"+"</div>",i.showPrompt=!0;break;case"delete":n=(n=n+('<a href="javascript:void(0);" tbar-name="delete" class="operation-btn btn-delete '+d+" "+l+'">')+'<span class="icon"></span>')+('<span class="text">'+$.su.CHAR.OPERATION.DELETE+"</span>")+"</a>",'<div class="grid-warning-msg warning">'+'<h4 class="title">'+'<span class="icon"></span>'+('<span class="text">'+i.noneSelectedMsgText+"</span>")+"</h4>"+"</div>",'<div class="grid-warning-msg warning">'+'<h4 class="title">'+'<span class="icon"></span>'+('<span class="text">'+i.deleteConfirmMsgText+"</span>")+"</h4>"+"</div>";break;case"deleteAll":n=(n=n+('<a href="javascript:void(0);" tbar-name="deleteAll" class="operation-btn btn-delete-all '+d+" "+l+'">')+'<span class="icon"></span>')+('<span class="text">'+$.su.CHAR.OPERATION.DELETE_ALL+"</span>")+"</a>",'<div class="grid-warning-msg warning">'+'<h4 class="title">'+'<span class="icon"></span>'+('<span class="text">'+i.noneSelectedMsgText+"</span>")+"</h4>"+"</div>",'<div class="grid-warning-msg warning">'+'<h4 class="title">'+'<span class="icon"></span>'+('<span class="text">'+i.deleteAllConfirmMsgText+"</span>")+"</h4>"+"</div>";break;case"enable":n=(n=n+('<a href="javascript:void(0);" tbar-name="enable" class="operation-btn btn-enable '+d+" "+l+'">')+'<span class="icon"></span>')+('<span class="text">'+$.su.CHAR.OPERATION.ENABLE+"</span>")+"</a>";break;case"disable":n=(n=n+('<a href="javascript:void(0);" tbar-name="disable" class="operation-btn btn-disable '+d+" "+l+'">')+'<span class="icon"></span>')+('<span class="text">'+$.su.CHAR.OPERATION.DISABLE+"</span>")+"</a>";break;case"search":n=(n=(n=(n=n+'<div class="container widget-container text-container search-container inline">'+'<span class="widget-wrap text-wrap search-wrap">')+('<input type="text" class="text-text search-text" value="'+$.su.CHAR.OPERATION.SEARCH+'" />'))+'<span class="pos"></span>'+'<a href="javascript:void(0);" class="search-switch"></a>')+"</span>"+"</div>";break;case"refresh":n=(n=n+('<a href="javascript:void(0);" tbar-name="refresh" class="operation-btn btn-refresh '+d+" "+l+'">')+'<span class="icon"></span>')+('<span class="text">'+$.su.CHAR.OPERATION.REFRESH+"</span>")+"</a>";break;default:var c=a[o].xtype;c&&(n+='<input operation-index="'+o+'" class="operation-user-defined operation-'+o+" "+d+" "+l+" "+c+'"/>')}}n+="</div>";var h,g,u,p,s=$(n);for(h in e.append(s),t.remove(),this.settings.custom)this.settings.custom.hasOwnProperty(h)&&(p='<a href="javascript:void(0);" tbar-name="'+h+'" class="operation-btn btn-'+h+" "+(g=this.settings.custom[h]).cls+'" data-tip="'+(g.hoverText||"")+'">',!1!==g.status)&&(p=(p+='<span class="icon" data-tip="'+(g.tip||"")+'"></span>')+'<span class="text">'+(g.text||"")+"</span></a>",void 0!==g.index?(u=this.dom().children(),0===g.index?this.dom().prepend($(p)):g.index<=u.length?$(u.get(g.index-1)).after($(p)):this.dom().append($(p))):this.dom().append($(p)));this.disable(["delete","edit"])},disable:function(t){for(var e=0,i=(t=$.isArray(t)?t:[t]).length;e<i;e++){var s=".operation-btn.btn-"+t[e];this.dom().find(s).addClass("disabled")}},enable:function(t){for(var e=0,i=(t=$.isArray(t)?t:[t]).length;e<i;e++){var s=".operation-btn.btn-"+t[e];this.dom().find(s).removeClass("disabled")}},show:function(t){for(var e=0,i=(t=$.isArray(t)?t:[t]).length;e<i;e++){var s=".operation-btn.btn-"+t[e];this.dom().find(s).removeClass("u-d-none")}},hide:function(t){for(var e=0,i=(t=$.isArray(t)?t:[t]).length;e<i;e++){var s=".operation-btn.btn-"+t[e];this.dom().find(s).addClass("u-d-none")}},setName:function(t,e){t=".operation-btn.btn-"+t;this.dom().find(t).find(".text").text(e)}}),$.su.Widget.register("searchBar",{settings:{},listeners:[],init:function(t){this.settings=$.extend(this.settings,t),this.shown=!1,this.filterFunc={},this.columns=null},render:function(){var t,e=this.dom(),i=this,s=this.settings,a=s.objs.grid,n=a.settings.configs.searchBar,o=n.hintText||"",r=n.maxLength||128;if(s.objs.grid.dom().addClass("grid-search-bar"),n.columns||!1===n.columns){e.addClass(s.cls+" search-bar-container");s='<div class="widget-wrap-outer searchbar-wrap-outer">',s=(s=(s+='<div class="widget-wrap searchbar-wrap">')+'<div class="searchbar-text">'+('<div widget="textbox" id="'+a.domId+'-search-input" hint="'+o+'" class="grid-search-text" autocomplete="off"></div>'))+'<div class="search-icon"></div>'+"</div>";if(n.columns&&(s=(s+='<div class="searchbar-column">')+'<div widget="combobox" id="'+a.domId+'-search-column"></div></div>'),e.append(s=s+"</div>"+"</div>"),this._textObj=new $.su.widgets.textbox({id:a.domId+"-search-input"}),this._textObj.render(),e.on("click",".search-icon",function(t,e){clearTimeout(i.throttle),i.throttle=setTimeout(function(){i.setFilter()},200)}),e.find(".text-wrap-inner input").attr("maxlength",r),e.on("keyup",function(t,e){13!==t.keyCode&&108!==t.keyCode||(clearTimeout(i.throttle),i.throttle=setTimeout(function(){i.setFilter()},200))}),"string"==typeof n.columns)i.columns=n.columns;else if(Array.isArray(n.columns)){this._columnObj=new $.su.widgets.combobox({id:a.domId+"-search-column"}),this._columnObj.render(),this._columnObj.loadItems(n.columns);for(var d=0,l=n.columns.length;d<l;d++)n.columns[d].func&&(this.filterFunc[n.columns[d].value]=n.columns[d].func);this._columnObj.dom().on("ev_view_change",function(t,e){e.value!==i._columnObj.getValue()&&(i._columnObj.setValue(e.value),i.setFilter())})}a.dom().find(".grid-panel-tbar-container").removeClass("hidden").append(e)}else n.content&&($(n.content).addClass("grid-conplex-search"),o='<a href="javascript:void(0);" tbar-name="search" class="operation-btn btn-search fst ">',o='<a href="javascript:void(0);" tbar-name="search" class="operation-btn btn-search fst "><span class="icon"></span><span class="text">'+$.su.CHAR.COMMON.SEARCH+'</span><span class="search-arrow"></span></a>',a.dom().find(".grid-panel-tbar-container").removeClass("hidden").append('<div class="search-btn operation-container">'+o+"</div>"),$(n.content).append('<div class="search-btn operation-container">'+o+"</div>"),t=a.dom().find(".grid-panel-tbar-container .search-btn"),a.dom().find(".search-btn").on("click",function(){!1===i.shown?($(n.content).removeClass("hidden"),i.shown=!0,t.hide()):!0===i.shown&&($(n.content).addClass("hidden"),i.shown=!1,t.show())}),$(n.content).find(".search-btn.operation-container").on("click",function(){$(n.content).addClass("hidden"),i.shown=!1,t.show()}))},setValue:function(t){this._textObj.setValue(t)},getValue:function(){return this._textObj.getValue()},setFilter:function(){var t=this.settings.objs.grid,e=this.columns||this._columnObj&&this._columnObj.getValue(),i={value:this._textObj.getValue(),column:e};this.filterFunc[e]&&(i.func=this.filterFunc[e]),t.dom().triggerHandler("ev_grid_filter",[i,!1,{id:t.domId,columns:t.settings.configs.columns}])}}),$.su.Widget.register("row",{settings:{},init:function(t){this.objs=t.objs,this.cells=[]},render:function(){},initRow:function(t,e){for(var i=e.configs.columns,s={inited:!0,columns:i,objs:e.objs,cells:[],cellObjs:[]},a=e.objs.modelMap[t].getData(),n=e.configs.rowCls&&e.configs.rowCls.call(null,a)||"",o=e.objs.modelMap[t].selected,r=e.objs.modelMap[t].disabled,a=(e.configs.rowDisabled&&(r=r||e.configs.rowDisabled.call(null,a)),e.objs.modelMap[t].disabled=r,e.allowDrag),d=i.length,i=(s.objs.grid.dom().find("tbody.grid-content-data").eq(0),{domId:s.objs.grid.domId+"_tr_"+$.appUtils.keyHandler(t),key:t,domContent:"",leftFixedContent:"",rightFixedContent:""}),l="",c="",h="",g=0;g<d;g++)s.cellObjs[g]=s.objs.cell.initCell(t,g,e),l+=s.cellObjs[g].domContent,c+=s.cellObjs[g].leftFixedContent,h+=s.cellObjs[g].rightFixedContent;return i.domContent='<tr id="'+i.domId+'" class="grid-content-tr '+(o?"selected":"")+(r?" disabled":"")+(a?" allow-drag":"")+" grid-content-tr-"+$.appUtils.keyHandler(t)+" "+n+'" data-key="'+t+'">'+l+"</tr>",i.leftFixedContent='<tr id="'+i.domId+'" class="grid-content-tr '+(r?"disabled":"")+(a?" allow-drag":"")+" grid-content-tr-"+$.appUtils.keyHandler(t)+" "+n+'" data-key="'+t+'">'+c+"</tr>",i.rightFixedContent='<tr id="'+i.domId+'" class="grid-content-tr '+(r?"disabled":"")+(a?" allow-drag":"")+" grid-content-tr-"+$.appUtils.keyHandler(t)+" "+n+'" data-key="'+t+'">'+h+"</tr>",i.settings=s,i},getAllFields:function(){return this.cells},initEmptyRow:function(t,e,i){var s='<tr class="grid-content-tr empty">',s=(e.dom().find("tr.grid-header-tr th"),s+('<td colspan="'+t+'"><span class="content">'+(i||this.objs.grid.settings.emptyContent||$.su.CHAR.COMMON.NO_ENTRY)+'</span><div class="loading-container"><span class="icon"></span></div></td>')+"</tr>");return $(s)},disableRow:function(){var t=this.dom(),e=this.settings.columns,i=t;if(i){i.addClass("disabled");for(var s=0,a=e.length;s<a;s++){var n=e[s],o=n.items;if("actioncolumn"===n.xtype)for(var r=0,d=o.length;r<d;r++){var l=o[r].xtype,c=n.dataIndex,c=i.find("input[data-property="+c+"][data-type="+l+"]");c&&"function"==$.type(c[l])&&c[l]("disable")}}}},enableRow:function(){var t=this.dom(),e=this.settings.columns,i=t;if(i){i.removeClass("disabled");for(var s=0,a=e.length;s<a;s++){var n=e[s],o=n.items;if("actioncolumn"===n.xtype&&o)for(var r=0,d=o.length;r<d;r++){var l=o[r].xtype,c=n.dataIndex,c=i.find("input[data-property="+c+"][data-type="+l+"]");c&&"function"==$.type(c[l])&&c[l]("enable")}}}}}),$.su.Widget.register("cell",{settings:{},init:function(){},render:function(){},initCell:function(t,e,i){var a={rowKey:t,columns:i.configs.columns,cellId:e,objs:i.objs,rendererOfNull:i.configs.rendererOfNull,rendererOfUndefined:i.configs.rendererOfUndefined},s=i.objs.modelMap[t].getData(),n=a.columns[e],o=a.columns.length,r=s[n.dataIndex];switch(r){case void 0:r=a.rendererOfUndefined?a.rendererOfUndefined():"---";break;case null:r=a.rendererOfNull?a.rendererOfNull():r}var d=0===e?"fst":"",l=e===o-1?"lst":"",c="",h=n.cls||"",g=(h&&(h+=" "),""),u={domId:a.objs.grid.domId+"_tr_"+$.appUtils.keyHandler(t)+"_td_"+e,domContent:"",leftFixedContent:"",rightFixedContent:"",column:n,field:n.dataIndex||!1,renderer:n.renderer||function(t){return $.su.transSpecialChar(t)}};switch(n.display&&(g+='data-display="'+n.display+'"'),n.xtype){case"rownumberer":h+="grid-content-td grid-content-td-"+e+" grid-content-td-row-numberer "+d+" "+l+" "+n.cls,g+=' name="row-numberer"',c+='<span class="grid-row-numberer content"></span>';break;case"checkcolumn":var p=i.objs.modelMap[t].selected;h+=" grid-content-td grid-content-td-"+e+" grid-content-td-check-column "+d+" "+l,g+=' name="check-column"',c=(c=(c=(c=(c+='<div class="checkbox-group-container">')+'<div class="widget-wrap">'+('<label class="checkbox-label '+(p?"checked":"")+'">'))+('<input class="checkbox-checkbox" '+(p?' checked="checked" ':" ")+' type="checkbox" value="'+t+'"/>')+'<span class="checkbox-icon"><span class="checkbox-icon-inner"></span></span>')+"</label>"+"</div>")+"</div>"+'<span class="content">--</span>';break;case"settings":a.objs.grid.dom().addClass("settings"),h+="grid-content-td grid-content-td-"+e+" grid-content-td-settings-column "+d+" "+l,g+=' name="settings-column"',c+='<div class="grid-btn-container">',void 0!==n.items&&-1===$.inArray("edit",n.items)||(c=c+('<a href="javascript:void(0);" data-type="edit" data-index="'+e+'" data-key="'+t+'" class="grid-content-btn grid-content-btn-edit btn-edit" data-tip="'+$.su.CHAR.OPERATION.EDIT)+'"><span class="icon"></span></a>'),void 0!==n.items&&-1===$.inArray("delete",n.items)||(c=c+('<a href="javascript:void(0);" data-type="delete" data-index="'+e+'" data-key="'+t+'" class="grid-content-btn grid-content-btn-delete btn-delete" data-tip="'+$.su.CHAR.OPERATION.DELETE)+'"><span class="icon"></span></a>'),c+="<div>";break;case"actioncolumn":a.objs.grid.dom().addClass("actioncolumn"),h+="grid-content-td grid-content-td-"+e+" grid-content-td-action-column "+d+" "+l,g+=' name="action-column"',c=(c+='<div class="grid-content-td-wrap action-cell" data-key="'+t+'">')+u.renderer.call(u,r,a.objs.modelMap[t].getData())+"</div>";break;case"editcolumn":h+="grid-content-td grid-content-td-"+e+" grid-content-td-edit-column "+d+" "+l,c=(c=(c=(c=c+('<div class="content-text">'+u.renderer.call(u,r,a.objs.modelMap[t].getData())+"</div>")+'<div class="content-edit u-d-none">')+('<div widget="textbox" id="'+$.su.randomId("cell-edit")+'" label-field="{false}"></div>'))+('<a class="content-edit-save" data-tip="'+$.su.CHAR.OPERATION.CONFIRM+'">Save</a>'))+('<a class="content-edit-cancel" data-tip="'+$.su.CHAR.OPERATION.CANCEL+'">Cancel</a>')+"</div>";break;case"customWidget":p=n.widgetName;if(h+="grid-content-td grid-content-td-"+e+" grid-content-td-"+n.name+" "+d+" "+l+" "+n.cls,p){if(g+=' name="'+p+'"',"object"==typeof n.widgetProps){var m=" ";for(f in n.widgetProps)m+=f+'="'+n.widgetProps[f]+'" '}else if("function"==typeof n.widgetProps){var f,v=n.widgetProps(a.objs.modelMap[a.rowKey].getData()),m=" ";for(f in v)m+=f+'="'+v[f]+'" '}c+='<div widget="'+p+'" id="'+$.su.randomId("grid-content-custom-widget")+'"'+m||"></div>"}else c+='<div class="content action-cell">'+u.renderer.call(u,r,a.objs.modelMap[t].getData())+"</div>";break;default:h+="grid-content-td grid-content-td-"+e+" grid-content-td-"+n.name+" "+d+" "+l+" "+n.cls,g+=' name="'+n.name+'"',c+='<div class="content content-cell">'+u.renderer.call(u,r,a.objs.modelMap[t].getData())+"</div>"}return n.fixed&&void 0!==n.width?(u[n.fixed+"FixedContent"]='<td id="'+u.domId+'" class="'+h+'" '+g+'><div class="td-content">'+c+"</div></td>",u.domContent='<td class="fixed-cell fixed-'+n.fixed+" "+h+'" '+g+"></td>"):u.domContent='<td id="'+u.domId+'" class="'+h+'" '+g+'><div class="td-content">'+c+"</div></td>",u.callback=function(){var t,s=this,e=$("#"+u.domId).find("div[widget]");0<e.length&&(t=s.dom().attr("name")||e.attr("widget"),s.customWidget=new $.su.widgets[t]({id:e,customSettings:s.column.settings}),s.customWidget.render()),$("#"+u.domId).find("div[widget=switch]").on("ev_switch_change",function(t,e,i){a.objs.grid.dom().triggerHandler("ev_grid_switch_change",[e,i,s.customWidget,a.rowKey,n])}),$("#"+u.domId).find("div[widget]").on("ev_view_change",function(t,e){s.dom().triggerHandler("ev_view_change",[e]),a.objs.grid.dom().triggerHandler("ev_grid_custom_change",[e,s.customWidget,a.rowKey,n])}),"editcolumn"===n.xtype&&($("#"+u.domId).on("click",".content-edit-save",function(){var t=s.customWidget.getValue(),e=$.su.getDefaultEvent(s,function(){s.editCell(!1)});a.objs.grid.dom().triggerHandler("ev_grid_editcolumn_save",[e.ev,t,s.customWidget,a.rowKey,n]),e.exe()}),$("#"+u.domId).on("click",".content-edit-cancel",function(){s.editCell(!1)}))},u.settings=a,u},getValue:function(){this.dom();return this.customWidget?this.customWidget.getValue():this.dom().find("div.content").text()},setValue:function(t){this.dom();var e=this.settings,i=e.cellId,i=e.columns[i],s=this.settings.objs.modelMap[this.settings.rowKey].getData();switch(this._value=t){case void 0:t=e.rendererOfUndefined?e.rendererOfUndefined():"--";break;case null:t=e.rendererOfNull?e.rendererOfNull():t}s=this.renderer(t,s,e.objs.rows.length-1);this.customWidget?i.renderer&&!1!==s?(this.customWidget.hide(),this.dom().find("div.content").show().html(s)):(this.dom().children("div.content").hide(),this.customWidget.show(),this.customWidget.setValue(t)):this.dom().find("div.content").html(s)},reRender:function(){var t=this.settings,e=this._value,i=this.settings.objs.modelMap[this.settings.rowKey].getData();switch(e){case void 0:e=t.rendererOfUndefined?t.rendererOfUndefined():"---";break;case null:e=t.rendererOfNull?t.rendererOfNull():e}i=this.renderer(e,i,t.objs.rows.length-1),this.dom().find("div.content").html(i)},hideButton:function(t){this.dom().find(t).hide()},showButton:function(t){this.dom().find(t).show()},getInnerWidget:function(){return this.customWidget},getDisplay:function(){var t=this.dom();if(!this.customWidget)return t.find("div.content").text();switch(this.customWidget.type){case"grid":return this.customWidget;case"combobox":return this.customWidget.getText();default:return this.customWidget.getValue()}},editCell:function(t){var e=this.dom();(void 0===t?e.find(".content-text").hasClass("u-d-none"):!t)?(e.find(".content-text").removeClass("u-d-none"),e.find(".content-edit").addClass("u-d-none")):(e.find(".content-text").addClass("u-d-none"),e.find(".content-edit").removeClass("u-d-none"),this.customWidget.setValue(this._value),this.customWidget&&this.customWidget.show())},setError:function(t){this.customWidget&&this.customWidget.setError(t)},disable:function(){this.customWidget&&this.customWidget.disable()}}),$.su.Widget.register("editor",{settings:{},listeners:[],init:function(t){var a=this,e=$(t.configs[this._type].content).find("div[widget][name]");this.widgets=[],this.settings=t,e.each(function(t,e){var i=$(e).attr("name"),s=$(e).attr("widget");a.widgets.push({id:$(e).attr("id"),name:i,widget:s})}),this.setEditing(!1)},getAllFields:function(){for(var t=[],e=0,i=this.widgets.length;e<i;e++){var s=$("#"+this.widgets[e].id),a=(this.widgets[e].widget,this.widgets[e].name);a&&((s=s.data("viewObj")).field=a,t.push(s))}return t},hide:function(){this.dom().detach().css("display","none")},startEdit:function(t){this.dom();var e=this.settings,t=t||"add",i=(e.objs.grid.dom(),this.getAllFields());e.configs[this._type];this.hide(),this.key=t,this.setEditing(!0),this.setEditingId(t);for(var s=0,a=i.length;s<a;s++)i[s].setNormal()},loadData:function(t){this.settings;for(var e=this.widgets,i=0,s=e.length;i<s;i++)$("#"+e[i].id).data("viewObj").setValue(t[e[i].name])},completeEdit:function(){this.setEditing(!1),this.setEditingId("")},cancelEdit:function(){this.setEditing(!1),this.setEditingId("")},setEditing:function(t){this.settings.configs[this._type].editing=t},isEditing:function(){return this.settings.configs[this._type].editing},setEditingId:function(t){this.settings.configs[this._type].editingIndex=t},getEditingId:function(){return this.settings.configs[this._type].editingIndex}}),(()=>{var e=$.su.Widget.register("rowEditor",{extend:["editor"],settings:{},listeners:[{selector:function(){return{parent:this.settings.objs.grid.dom(),target:"tr.grid-content-tr:not(.empty)"}},event:"click",callback:function(t,e){}},{selector:function(){return{parent:this.settings.objs.grid.dom(),target:""}},event:"ev_grid_before_delete",callback:function(t,e){e.cancelEdit()}},{selector:function(){return{parent:this.settings.objs.grid.dom(),target:""}},event:"ev_grid_before_save",callback:function(t,e,i){i.cancelEdit()}},{selector:function(){return{parent:this.settings.objs.grid.dom(),target:""}},event:"ev_grid_items_before_remove",callback:function(t,e){e.cancelEdit()}}],init:function(t){e.superclass.init.call(this,t)},render:function(){var t=this.dom(),e=this.settings,i=(e.objs.cell,e.objs.grid),e=e.configs.rowEditor;t.parent().find("tbody.grid-content-data");this.tr=$('<tr class="editor-container" id="'+this.domId+'_tr"><td colspan="'+i.columnCount+'"></td></tr>'),t.append(this.tr),this.tr.find("td").eq(0).empty().append($(e.content)),this.dom().css("display","none")},startEdit:function(t,e){var i=this.settings.objs.grid;this._editorShow=t,this.tr.insertAfter(e),this.tr.show(),i.dom().triggerHandler("ev_grid_rowEditor_show",[t])},cancelEdit:function(t){var e=this.settings.objs.grid;this.dom().append(this.tr),this._editorShow=!1,e.dom().triggerHandler("ev_grid_rowEditor_hide",[t])}})})(),(()=>{var i=$.su.Widget.register("popEditor",{extend:["editor"],settings:{},listeners:[],init:function(t){i.superclass.init.call(this,t),this.cells=[]},render:function(){var s=this,t=this.dom(),e=this.settings,i=(e.configs.columns,e.objs.grid),e=e.configs.popEditor,a=$('<div class="editor-container" id="'+this.domId+'"><div widget="msg" type="window" close-btn="{true}" msg-title="'+(e.title||"")+'" class="editor-container '+e.cls+'" id="'+this.domId+'-msg" title-bar="{true}"></div></div>'),n=i.dom().find(".grid-panel-content-container .grid-container"),n=($("#"+this.domId+"-msg").remove(),n.append(a),t.remove(),$("#"+this.domId+"-msg")),a=(n.append($(e.content)),$('<div widget="fieldset" class="inline-container btn-container"></div>').appendTo(n)),t=$('<div id="'+i.domId+'-save-button" widget="button" class="btn-submit button-button" text= "{OPERATION.APPLY}" label-field={false}></div>');t.appendTo(a),new $.su.widgets.fieldset({id:a}).render(),this.containerMsg=new $.su.widgets.msg({id:n}),this.saveObj=new $.su.widgets.button({id:t}),this.containerMsg.render(),this.saveObj.render(),n.off("ev_msg_close").on("ev_msg_close",function(){var t=s.getEditingId();i.dom().triggerHandler("ev_grid_cancel",[t]),s.cancelEdit()}),this.saveObj.dom().off("ev_button_click").on("ev_button_click",function(){$(this);var e=s.settings.objs.grid,i=s.getEditingId(),t=$.su.getDefaultEvent(s,function(){var t=$.su.getDefaultEvent(s,function(){s.completeEdit()});e.dom().triggerHandler("ev_grid_save",[t.ev,i]),t.exe()});e.dom().triggerHandler("ev_grid_before_save",[t.ev]),t.exe(),e.dom().triggerHandler("ev_grid_after_save")})},startEdit:function(t){var e=this.dom(),t=(this.settings.objs.grid.dom(),this.getAllFields(),i.superclass.startEdit.call(this,t),this.containerMsg.show(),e.height());this.saveObj.dom().css("top",t)},completeEdit:function(){var t=this.settings.objs.grid;i.superclass.completeEdit.call(this),t.updateRowNumber()},cancelEdit:function(){var t=this.settings.objs.grid;i.superclass.cancelEdit.call(this),t.updateRowNumber()},setTitle:function(t){this.containerMsg.setTitle(t)}})})(),$.su.Widget.register("paging",{settings:{numPerPage:{attribute:"num-per-page",defaultValue:10},enableGo:{attribute:"enable-go",defaultValue:!0},enablePageSize:{attribute:"enable-page-size",defaultValue:!0}},listeners:[{selector:"a.paging-btn-num",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var t=e.settings,i=t.objs.grid,s=$(this),a=parseInt(s.attr("data-index"),10),n=t.plugins.editor||t.plugins.rowEditor,i=i.getPlugin("editor")?t.configs.editor:t.configs.rowEditor;s.hasClass("disabled")||(i&&i.editing&&n.cancelEdit(),e.goTo(a))}},{selector:"a.pageing-btn-prev",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();e.settings.objs.grid;$(this).hasClass("disabled")||e.goPrev()}},{selector:"a.pageing-btn-next",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();e.settings.objs.grid,$(this);$(this).hasClass("disabled")||e.goNext()}},{selector:"a.pageing-btn-first",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();e.settings.objs.grid;$(this).hasClass("disabled")||e.goTo(0)}},{selector:"a.pageing-btn-last",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();e.settings.objs.grid,$(this);$(this).hasClass("disabled")||e.goTo(1/0)}},{selector:"span.dots",event:"mouseenter",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this);$(this).hasClass("disabled")||(t.addClass("hidden"),t.parent().find(".btn-more.current").removeClass("hidden"))}},{selector:"span.btn-more",event:"mouseleave",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this);$(this).hasClass("disabled")||(t.addClass("hidden"),t.parent().find(".dots").removeClass("hidden"))}},{selector:"span.btn-more-left",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=(t=+e.settings.currentPage)-4<=0?0:t-4;$(this).hasClass("disabled")||e.goTo(t)}},{selector:"span.btn-more-right",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var t=e.settings,i=+t.currentPage,i=t.totalPage-1<=4+i?t.totalPage-1:4+i;$(this).hasClass("disabled")||e.goTo(i)}},{selector:".paging-go .text-wrap-inner input",event:"keyup",callback:function(t,e){13===t.keyCode&&(t=e._pagingTextbox.getValue(),t=parseInt(t,10)-1,"number"===$.type(t)&&0<=t&&t!==e.currentPage&&e.goTo(t),e._pagingTextbox.setValue(""))}}],init:function(t){this.dom();var e=this.settings;this._totalPage=0,this._pageMap={},$.extend(e,t,t.configs.paging)},render:function(){var i=this,t=this.dom(),e=t.parent().find("div.grid-panel-paging-container"),s=(this.settings.objs.grid,this.settings),a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a='<div class="container widget-container paging-container disabled">')+'<div class="paging-wrap u-d-none">'+'<div class="paging-wrap-inner u-d-inline-block">')+'<div class="paging-info-container u-d-inline-block">'+'<div class="paging-info u-d-inline-block">')+"<span></span>"+"</div>")+"</div>"+'<div class="paging-items hidden">')+'<span class="content u-d-inline-block"></span>'+"</div>")+'<div class="paging-btns u-d-inline-block">'+'<a href="javascript:void(0);" class="paging-btn hidden pageing-btn-first" data-index="first">')+'<span class="icon"></span>'+'<span class="text"><<</span>')+"</a>"+'<a href="javascript:void(0);" class="paging-btn pageing-btn-prev" data-index="prev">')+'<span class="icon"></span>'+'<span class="text"></span>')+"</a>"+'<div class="num-buttons-container">')+"</div>"+'<a href="javascript:void(0);" class="paging-btn pageing-btn-next" data-index="next">')+'<span class="icon"></span>'+'<span class="text"></span>')+"</a>"+'<a href="javascript:void(0);" class="paging-btn hidden pageing-btn-last" data-index="last">')+'<span class="icon"></span>'+'<span class="text">>></span>')+"</a>"+"</div>";a=(a=(s.enablePageSize?(a+='<div class="paging-options u-d-inline-block">')+'<div class="paging-select inline-block"><div id="'+this.domId+'_select"  widget="combobox"></div></div></div>':a)+'<div class="paging-go u-d-inline-block"><div widget="textbox" label-field="{GRID.PAGE_TO}"></div>')+'<div widget="button" text="'+$.su.CHAR.COMMON.GO+'"></div>',t.append($(a=(a=(a=(a=(a=(a+="</div>")+'<div class="paging-separator hidden">'+'<span class="icon"></span>')+"</div>"+'<div class="paging-total hidden">')+'<span class="content u-d-inline-block"></span>'+"</div>")+"</div>"+"</div>")+"</div>"+'<input type="hidden" class="hidden paging-input">')),e.append(t),s.enablePageSize&&(this._numSelect=new $.su.widgets.combobox({id:this.domId+"_select"}),this._numSelect.render(),s.items=s.items||[],s.items.forEach(function(t,e){t.name+=" "+$.su.CHAR.GRID.OPTIONS_UNIT}),this._numSelect.loadItems(s.items),s.numPerPage=this._numSelect.getValue()||s.numPerPage,this._numSelect.dom().on("ev_view_change",function(t,e){i._numSelect.setValue(e.value),i.setNumPerPage(e.value),i.settings.selfHandle&&(s.currentPage>=i._totalPage&&(s.currentPage=i._totalPage-1),i.settings.objs.grid.reRenderModels())})),s.objs.grid.updateRowNumber(),s.enableGo&&(a=t.find('.paging-go div[widget="textbox"]'),e=t.find('.paging-go div[widget="button"]'),this._pagingTextbox=new $.su.widgets.textbox({id:a}),this._pagingButton=new $.su.widgets.button({id:e}),this._pagingTextbox.render(),this._pagingButton.render(),this._pagingTextbox.dom().on("ev_view_change",function(){var t=i._pagingTextbox.getValue(),t=Number(t)-1;$.isNumeric(t)&&t%1==0&&0<=t?i._pagingButton.dom().removeClass("disabled"):i._pagingButton.dom().addClass("disabled")}),this._pagingButton.dom().addClass("disabled"),this._pagingButton.dom().on("ev_button_click",function(){var t=i._pagingTextbox.getValue(),t=parseInt(t,10)-1;$.isNumeric(t)&&t!==s.currentPage&&i.goTo(t),i._pagingTextbox.setValue(""),i._pagingButton.dom().addClass("disabled")}))},setPageSize:function(t){this._numSelect.setValue(t),this.setNumPerPage(t)},setSelectedPageSize:function(t){this._numSelect.setValue(t)},setNumPerPage:function(t){var e=this.settings,i=e.objs.grid;e.numPerPage=t||e.numPerPage,this._totalPage=Math.ceil(e.totalRows/e.numPerPage),this.updateRowPage(i._keys),e.objs.grid.updateRowNumber(),i.dom().triggerHandler("ev_grid_paging_size",[e.numPerPage,{id:e.objs.grid.domId}])},setTotalPage:function(t,e){this._totalPage=t,e.currentPage&&(this.settings.currentPage=e.currentPage-1),!e.totalRows&&0!==e.totalRows||(this.settings.totalRows=e.totalRows),e.currentPageSize&&(this.settings.numPerPage=e.currentPageSize,this.settings.enablePageSize||void 0===e.selfHandle||this.setNumPerPage()),void 0!==e.selfHandle&&(this.settings.selfHandle=e.selfHandle),this.dom().find(".page-total .content").text($.su.CHAR.GRID.PAGE_INFO.replace("%num",t)),this.updateBtns()},updateBtns:function(){var t=this.settings,e=t.objs.grid,i=t.currentPage,s=this._totalPage;t.totalPage=s,e.dom().find("tr.grid-content-tr").show(),this.dom().find(".paging-total .content").text(s),s<i&&(i=t.currentPage=s),this.goToPage(i)},updateNumBtns:function(){var t=this.settings,e=t.currentPage,i=t.totalPage,t=this.dom().find("div.paging-wrap"),s=t.find("div.num-buttons-container");if(0==i)t.addClass("disabled").hide();else{t.removeClass("disabled").show();var a="",n=0;if(5<i){var t=i-1,o=e-1,r=e+1;for(e<=3?(o=0,r=4):i-4<=e&&(o=i-5,r=i-1),0!==o&&d(0),n=o;n<=r;n++)d(n);r!==t&&d(t)}else for(n=0;n<i;n++)d(n)}function d(t){a=(a=(a=(a=(a+='<a href="javascript:void(0);" class="paging-btn paging-btn-num pageing-btn-'+t+'" data-index="'+t+'">')+'<span class="icon"></span><span class="text">'+(t+1)+"</span>")+'</a><div class="dots-container u-d-inline-block">')+'<span class="btn-more-left btn-more hidden"></span><span class="dots"></span>')+'<span class="btn-more-right btn-more hidden"></span></div>'}s.empty().append($(a))},goToPage:function(t){var e=this.dom(),i=this.settings,s=e.find("div.paging-container"),a=i.objs.grid.dom(),n=(i.objs.rows,isNaN(t)?0:t),t=i.numPerPage,o=i.totalPage,r=(a.find("tbody.grid-content-data"),i.objs.grid._keys.length),d=(o<=n&&0<o?n=o-1:n<0&&(n=0),i.currentPage=n,this.updateNumBtns(),0===r?0:n*t+1),t=0===r?0:d+t-1,l=(t=(r=this.settings.selfHandle?r:this.settings.totalRows)<t?r:t,$.su.CHAR.COMMON.GRID_PAGING_SHOW),c=(l=(l=(l=l.replace("%start",d)).replace("%end",t)).replace("%total",r),e.find(".paging-info span").text(l),s.find("a.paging-btn.pageing-btn-prev")),h=s.find("a.paging-btn.pageing-btn-next"),g=s.find("a.paging-btn.pageing-btn-first"),u=s.find("a.paging-btn.pageing-btn-last"),d=s.find("a.paging-btn-num"),t=s.find("span.dots"),r=s.find("span.btn-more");d.removeClass("current"),r.removeClass("current").addClass("hidden"),t.addClass("hidden"),d.filter("[data-index="+n+"]").addClass("current"),7<=o&&(e=o-1,l=n-1,r=n+1,n<=3?(l=0,r=4):o-4<=n&&(l=o-5,r=o),0!==l&&((t=s.find(".pageing-btn-0").next(".dots-container")).find(".dots").removeClass("hidden"),t.find(".btn-more-left").addClass("current")),r!==e)&&((d=s.find(".pageing-btn-"+r).next(".dots-container")).find(".dots").removeClass("hidden"),d.find(".btn-more-right").addClass("current")),setTimeout(function(){c.removeClass("disabled"),h.removeClass("disabled"),g.removeClass("disabled"),u.removeClass("disabled"),0===n&&(g.addClass("disabled"),c.addClass("disabled")),o-1<=n&&(h.addClass("disabled"),u.addClass("disabled"))},180),a.triggerHandler("ev_grid_paging_changed",[n,{id:i.objs.grid.domId}])},goTo:function(t){this.goToPage(t),this.settings.selfHandle&&(this.settings.objs.grid.reRenderModels(),this.settings.selectAll)&&this.settings.objs.grid.selectChecked()},goPrev:function(){var t=this.settings.currentPage;--t<0||this.goTo(t)},goNext:function(){var t=this.settings,e=t.currentPage;t.totalPage<=++e||this.goTo(e)},goFirst:function(){var t=this.settings;t.totalPage;this.goTo(t.currentPage=0)},goLast:function(){var t=this.settings,e=t.totalPage;t.currentPage=1<e?e-1:e,this.goTo(t.currentPage)},getRowNumberOffset:function(){var t=this.settings.currentPage;return this.settings.numPerPage*t||0},updateRowPage:function(t){for(var e=this,i=this.settings,s=i.objs.grid,a=i.numPerPage,i=s.dom().find("tbody.grid-content-data").children("tr"),n=0,o=t.length;n<o;n++){var r=Math.floor(n/a);this._pageMap[t[n]]=r}return i.each(function(){var t=$(this).attr("data-key");$(this).attr("data-page",e._pageMap[t])}),this._pageMap},getCurrentPageNum:function(){return this.settings.currentPage}}),$.su.Widget.register("sorts",{settings:{},listeners:[{selector:function(){return{parent:this.settings.objs.grid.dom(),target:".grid-header"}},event:"click",callback:function(t,e){var i,s=e.settings.objs.grid;0===$(this).children(".sortable").length||s.dom().hasClass("sort-disabled")||((i=$(this).attr("name"))===e._sortColumnName?($(this).removeClass("asc desc"),"asc"===e._sortOrder?e._sortOrder="desc":"desc"===e._sortOrder?e._sortOrder=null:e._sortOrder="asc"):(e._sortColumnName&&e.resetSortView(),e._sortOrder="asc"),$(this).addClass(e._sortOrder),e._sortColumnName=i,s.settings.configs.sortByData?(e.sortByColumn(i),s.dom().triggerHandler("ev_grid_data_sort")):(i={id:s.domId,column:e._sortColumnName},e._sortOrder&&(i.order=e._sortOrder),s.dom().triggerHandler("ev_grid_sort",[i])))}},{selector:function(){return{parent:this.settings.objs.grid.dom(),target:".grid-header"}},event:"mouseenter",callback:function(t,e){var i=$(this).children(".sortable");i.removeClass("hidden"),$(this).one("mouseleave",function(){$(this).hasClass("asc")||$(this).hasClass("desc")||i.addClass("hidden")})}}],init:function(t){this.settings=$.extend({},this.settings,{objs:t.objs}),this._sortColumnName=null,this._sortOrder="asc",this._sortKeys=[]},render:function(){for(var t=this.settings.objs.grid,e=t.settings.configs.columns,i=0,s=e.length;i<s;i++)e[i].sortable&&t.dom().find(".grid-header[name="+e[i].dataIndex+"]").addClass("sort").append('<div class="sortable hidden"><div class="sort-asc"></div><div class="sort-desc"></div></div>')},clearSortStatus:function(){var t=this._sortColumnName,e=this.settings.objs.grid;null!==t&&e.dom().find("div.grid-header-container th.grid-header."+t).removeClass("sort-asc sort-desc")},setSort:function(t,e){var i=$(".grid-header[name="+t+"]"),s=this.settings.objs.grid;0===i.children(".sortable").length||s.dom().hasClass("sort-disabled")||(t===this._sortColumnName?i.removeClass("asc desc"):this._sortColumnName&&s.dom().find(".grid-header[name="+this._sortColumnName+"]").removeClass("asc desc").children(".sortable").addClass("hidden"),this._sortOrder=e||"asc",i.addClass(this._sortOrder),this._sortColumnName=t,s.settings.configs.sortByData?(this.sortByColumn(t),s.dom().triggerHandler("ev_grid_data_sort")):s.dom().triggerHandler("ev_grid_sort",[{id:s.domId,column:this._sortColumnName,order:this._sortOrder}]))},getSortName:function(){var t;return this._sortColumnName?(t=this.settings.objs.grid.dom().find("div.grid-header-container th.grid-header."+this._sortColumnName),{name:this._sortColumnName,asc:t.hasClass("sort-asc")}):""},sortByColumn:function(t){var e=this.settings.objs.grid,i=e.dom().find("div.grid-header-container th.grid-header."+t);e.dom().find("tbody.grid-content-data");t===this._sortColumnName?"desc"===this._sortOrder?(i.removeClass("sort-asc").addClass("sort-desc"),this.sortValue(t,!0)):(i.removeClass("sort-desc").addClass("sort-asc"),this.sortValue(t)):(this.clearSortStatus(),i.addClass("sort-asc"),this.sortValue(t)),this._sortColumnName=t,this.settings.objs.grid.syncData(this._sortKeys,void 0,!0)},sortValue:function(t,e){var i,s=this.settings.objs.grid,a=this.settings.objs.modelMap,n={},o=s.getKeys();if(o&&0===o.length&&(this._sortKeys=[]),o&&0!==o.length){for(var r,d=null,l=s.settings.configs.columns,c=0,h=l.length;c<h;c++)if(t===l[c].name){l[c].sortRule&&"function"===$.type(l[c].sortRule)&&(d=l[c].sortRule),l[c].sortType&&(i=l[c].sortType);break}for(r in a)if(a.hasOwnProperty(r)){var g=a[r].getData(),u=d?d(g[t],g):g[t];if(void 0===u&&i)switch(i){case"number":u=0;break;case"string":u=""}"string"===$.type(u)&&"string"!==i&&/^\d+$/.test(u)?n[r]=parseInt(u,10):n[r]=u}e?o.sort(function(t,e){return n[e]<n[t]?-1:n[t]<n[e]?1:0}):o.sort(function(t,e){return n[t]<n[e]?-1:n[e]<n[t]?1:0}),this._sortKeys=o}},resortByData:function(){var t=this.settings.objs.grid;t.settings.configs.sortByData&&this._sortColumnName&&(this.sortByColumn(this._sortColumnName),t.dom().triggerHandler("ev_grid_data_sort"))},resetSortView:function(){this.settings.objs.grid.dom().find(".grid-header[name="+this._sortColumnName+"]").removeClass("asc desc").children(".sortable").addClass("hidden"),this._sortOrder="asc"},getSortOrder:function(){return this._sortOrder}}),$.su.Widget.register("filter",{settings:{},listeners:[{selector:function(){return{parent:this.settings.objs.grid.dom(),target:".grid-header.filter .filter-icon"}},event:"click",callback:function(t,e){t.preventDefault(),t.stopPropagation(),e.toggleOptions($(this).parent().attr("name"))}},{selector:function(){return{parent:this.settings.objs.grid.dom(),target:".grid-filter-btn"}},event:"click",callback:function(t,e){var i=$(this).data("type"),s=$(this).data("name"),a=e.settings.objs.grid;"reset"===i?e.resetOption(s):e.applyOption(s,a)}},{selector:function(){return{parent:"body",target:""}},event:"click",callback:function(t,e){var i=$(".grid-container .filter-container, .grid-header .filter-icon"),s=e.settings.objs.grid.dom();i.is(t.target)||0!==i.has(t.target).length||(i=$.su.getDefaultEvent(e,function(){e.toggleOptions(!1)}),s.triggerHandler("ev_grid_column_filter_click_body",[i.ev,t]),i.exe())}}],init:function(t){this.useSelectAll=t.configs&&t.configs.filter&&t.configs.filter.useSelectAll,this.settings=$.extend({},this.settings,{objs:t.objs}),this.treeSelects={},this.treeSelectArr=[]},destroy:function(){$(document).off(".filter.grid")},render:function(){for(var t,e=this.settings.objs.grid,i=e.getColumns(),s=0,a=i.length;s<a;s++)i[s].filterOptions&&(t=i[s].dataIndex,e.dom().find(".grid-header[name="+t+"]").addClass("filter").append('<div class="filter-icon"></div>'),i[s].filterOptions.bindViewObj(this._renderFilter(t,e,i[s].treeSelectWithoutChildren)))},resetOption:function(t){this.treeSelects[t].treeSelect.unSelectAll(),this.toggleOptions(t),this.triggerFilter()},setFilterData:function(t,e){this.treeSelects[t].treeSelect.setValue(e),this.updateFilterIcons(t)},setFilterSelectData:function(t,e){this.treeSelects[t].treeSelect.selectData(e),this.updateFilterIcons(t)},applyOption:function(t){this.toggleOptions(t),this.triggerFilter()},triggerFilter:function(){var t=this.settings.objs.grid,e=t.dataBind[0].filterModelBind;e&&e.isDirty()&&(t.dom().triggerHandler("ev_grid_column_filter",[this.getFilterData(),{id:t.domId}]),e.record())},getFilterData:function(){var t,e,i={},s=this.settings.objs.grid.settings.configs.filterSerialize;for(t in this.treeSelects)0<(e=this.treeSelects[t].treeSelect.getValue()).length&&(i["filters."+t]=$.map(e,function(t,e){return t.value}).join(","));return i="function"==typeof s?s(i):i},getAllFields:function(){return this.treeSelectArr},_renderFilter:function(t,e,i){var s,a,i=this.getFilterHtml(this.domId,t,i);return e.dom().find(".grid-panel-content-container .grid-container").append($(i)),(i=new $.su.widgets.treeSelect({id:this.domId+"_"+t})).field=t,this.treeSelectArr.push(i),i.render(),s=new $.su.widgets.button({id:this.domId+"_"+t+"_reset"}),a=new $.su.widgets.button({id:this.domId+"_"+t+"_apply"}),this.treeSelects[t]={container:e.dom().find(".filter-container").last(),treeSelect:i,resetBtn:s,_shown:!1},s.render(),a.render(),i},adjustPosition:function(t){var e=this.treeSelects[t].container,i=this.settings.objs.grid,t=i.dom().find(".grid-header."+t);$.su.language.isRtl()?e.css({right:i.dom().innerWidth()-t.position().left-t.innerWidth()+15}):e.css({left:t.position().left+15})},toggleOptions:function(t){var e,i=this.settings.objs.grid.dom();if(!1===t)for(e in this.treeSelects)this.treeSelects[e]._shown&&this.toggleOptions(e);else{var s=this.treeSelects[t],a=$.su.getDefaultEvent(this,function(){s._shown?(s.container.slideUp(200),this.updateFilterIcons(t),this.triggerFilter()):(s.container.slideDown(200),this.adjustPosition(t))});i.triggerHandler("ev_grid_column_filter_show",[a.ev,t,s._shown]),a.exe(),s._shown=!s._shown}},updateFilterIcons:function(t){var e=this.treeSelects[t],t=this.settings.objs.grid.dom().find(".grid-header."+t);0<e.treeSelect.getValue().length?t.addClass("active"):t.removeClass("active")},getFilterHtml:function(t,e,i){var s="";return(s+='<div class="filter-container u-d-none">')+this.getTreeSelectHtml(t,e,i)+this.getResetBtnHtml(t,e)+this.getApplyBtnHtml(t,e,i)+"</div>"},getTreeSelectHtml:function(t,e,i){var s="";return s+='<div widget="treeSelect" select-type="multiple" allow-select-all="{'+this.useSelectAll+'}" independent="{true}" id="'+t+"_"+e+'" class="filter-type ',i&&(s+="tree-select-without-children "),s+='u-label-none m-b-0"></div>'},getResetBtnHtml:function(t,e){var i="";return i+='<div widget="button" id="'+t+"_"+e+'_reset" data-type="reset" data-name="'+e+'" class="grid-filter-btn skip-button u-d-inline-block secondary-button" text="'+$.su.CHAR.OPERATION.RESET+'"></div>'},getApplyBtnHtml:function(t,e,i){var s="";return s+='<div widget="button" id="'+t+"_"+e+'_apply" data-type="apply" data-name="'+e+'" class="grid-filter-btn ',i&&(s+="tree-select-without-children-btn "),s+='apply u-d-inline-block" text="'+$.su.CHAR.OPERATION.CONFIRM+'"></div>'}}),$.su.Widget.register("statusBar",{settings:{},listeners:[{selector:function(){return{parent:this.settings.objs.grid.dom(),target:""}},condition:function(t){return!!t.settings.objs.grid.getPlugin("statusBar")},event:"ev_grid_checkbox_clicked ev_grid_row_selected_all ev_grid_row_unselected_all ev_grid_delete",callback:function(t,e,i){i.refreshStatus()}},{selector:function(){return{parent:this.settings.objs.grid.dom(),target:""}},condition:function(t){return!!t.settings.objs.grid.getPlugin("statusBar")},event:"ev_store_bound",callback:function(t,e){e.refreshStatus()}},{selector:function(){return{parent:this.settings.objs.grid.dom(),target:""}},event:"ev_grid_save",callback:function(t,e,i,s){setTimeout(function(){s.refreshStatus()},100)}},{selector:function(){return{parent:this.settings.objs.grid.dom(),target:""}},event:"ev_grid_row_created",callback:function(t,e,i){var s=i.dom();clearTimeout(i._updateTotal),i._updateTotal=setTimeout(function(){s.find("td.grid-status-td span.status-total-num").text(e.length)},100)}},{selector:function(){return{parent:this.settings.objs.grid.dom(),target:""}},event:"ev_grid_check_status",callback:function(t,e){e.refreshStatus()}}],init:function(t){this.settings=$.extend({},this.settings,{objs:t.objs},t.configs.statusBar);this.settings.objs.grid},render:function(){var t=this.dom(),e=this.settings.objs.grid,i=!1!==this.settings.total,s=e.settings.configs.columns,a=t.parent().find("div.grid-status-container"),n=(n='<table border="0" cellspacing="0" cellpadding="0">')+'<tr class="status-row">'+('<td class="grid-status-td" colspan="'+(s.length-e.columnOffset)+'">');i&&(n+='<span class="status-total">'+$.su.CHAR.GRID.TOTAL+': <span class="status-total-num"></span></span>'),t.append(n=(n=n+'<span class="status-selected status-selected-text hidden"><span class="status-selected-num"></span></span>'+"</td>")+"</tr>"+"</table>").addClass("grid-status-bar-container"),a.append(t),t.find("td.grid-status-td span.status-total-num").text(this.settings.objs.rows.length)},refreshStatus:function(){var t=this.dom(),e=this.settings.objs.grid,i=e.getSelected(),s=e._keys.length;e.getPlugin("paging");0<i.length?(1==i.length?t.find("td.grid-status-td span.status-selected-num").text($.su.CHAR.GRID.SELECTED_ONE):t.find("td.grid-status-td span.status-selected-num").text($.su.CHAR.GRID.SELECTED.replace("%n%",i.length)),t.find("td.grid-status-td span.status-selected").show()):t.find("td.grid-status-td span.status-selected").hide(),this.toolEnable&&(0<i.length?t.find("td.grid-status-td span.status-btns").show():(i=$.su.getDefaultEvent(this,function(){t.find("td.grid-status-td span.status-btns").hide()}),e.dom().triggerHandler("ev_grid_tool_status_hide",[i.ev]),i.exe())),t.find("td.grid-status-td span.status-total-num").text(s)}}),$.su.Widget.register("filterColumns",{settings:{},listeners:[],init:function(t){this.settings=t,this._shown=!1},destroy:function(){this.unbindEvent()},render:function(){var i=this.settings,s=i.objs.grid,t="",a=(t=(t=(t=(t=(t+='<div class="filter-panel-container u-d-none">')+('<div widget="radio" id="'+this.domId+'-type" columns="{5}" class="filter-type u-label-none m-b-0"></div>')+'<div class="filter-separator"></div>')+'<div class="filter-columns-container">'+'<div class="filter-columns-inner">')+('<div widget="checkboxGroup" id="'+this.domId+'-columns"  class="u-label-none m-b-0"></div>')+"</div>")+"</div>"+"</div>",s.dom().find(".grid-panel-content-container .grid-container").append($(t)),this.filterType=new $.su.widgets.radio({id:this.domId+"-type"}),this.filterType.render(),this.filterType.loadItems(this.getTypes()),this);this.filterType.dom().on("ev_view_change",function(t,e){a.filterType.setValue(e.value),a.updateColumns(e.value),s.dom().triggerHandler("ev_grid_fiter_type_change",[e.value,{id:i.objs.grid.domId},a.filterColumns.getValue()])}),this.filterColumns=new $.su.widgets.checkboxGroup({id:this.domId+"-columns"}),this.filterColumns.render(),this.filterColumns.loadItems(this.getColumns()),this.filterColumns.dom().on("ev_view_change",function(t,e){a.setSelectedColumns(e.value),a.filterType.setValue(3),$.extend(a.customColumns,e.value),s.dom().triggerHandler("ev_grid_fiter_columns_change",[e.value,{id:i.objs.grid.domId}])}),this.initColumns(),this.bindEvent(),this.initScrollOption()},initScrollOption:function(){var t=this.settings.objs.grid.dom().find(".grid-panel-content-container .grid-container .filter-panel-container .filter-columns-inner");0===t.find(".ps__rail-y").length&&$.su.scrollbar({ele:t[0]})},getTypes:function(){var i=this.settings.configs.filterColumns,t=i.type||["default","all","custom"],s="",a=-1,n=[];return $.each(t,function(t,e){switch(e){case"default":s=i.defaultText||$.su.CHAR.DEVICES.DEFAULT_COLUMNS,a=1;break;case"all":s=i.allText||$.su.CHAR.DEVICES.ALL_COLUMNS,a=2;break;case"custom":s=i.customText||$.su.CHAR.DEVICES.CUSTOMIZE_COLUMNS,a=3;break;default:s=e.label,a=e.value}n.push({boxlabel:s,value:a})}),n},getColumns:function(){var t=this.settings.configs.columns,i=[];return $.each(t,function(t,e){void 0===e.xtype&&i.push({value:e.dataIndex,name:e.dataIndex,boxlabel:e.filterText||e.text})}),i},togglePanel:function(){this._shown?this.hidePanel():this.showPanel()},showPanel:function(){var t=this.settings.objs.grid.dom(),e=t.find(".grid-panel-content-container .grid-container .filter-panel-container");t.find(".grid-header .filter-icon").last().addClass("active"),e.show(),this._shown=!0,this.adjustPanel()},hidePanel:function(){var t=this.settings.objs.grid.dom(),e=t.find(".grid-panel-content-container .grid-container .filter-panel-container");t.find(".grid-header .filter-icon").last().removeClass("active"),e.hide(),this._shown=!1},hidePanelIcon:function(){this.settings.objs.grid.dom().find(".grid-header .filter-icon").last().hide()},showPanelIcon:function(){this.settings.objs.grid.dom().find(".grid-header .filter-icon").last().show()},adjustPanel:function(){var t,e=this.settings.objs.grid.dom().find(".grid-panel-content-container .grid-container"),i=e.find(".grid-header .filter-icon").last(),s=e.find(".filter-panel-container");this._shown&&(e=e.offset(),t=i.offset(),s.css({top:t.top-e.top+i.outerHeight()+10,left:$.su.language.isRtl()?t.left-e.left:t.left-e.left+i.outerWidth()-s.outerWidth()}))},initColumns:function(){var t=this.settings.configs.columns,i=this,e=this.settings.configs.filterColumns,t=(this.oriColumns={},this.allColumns={},this.defaultColumns={},this.customColumns={},$.each(t,function(t,e){void 0===e.xtype&&(i.oriColumns[e.dataIndex]=!1,i.allColumns[e.dataIndex]=!0)}),this.setColumns("default",e.default),this.setColumns("custom",e.custom),e.type||["default","all","custom"]);$.each(t,function(t,e){e&&e.columns&&i.setColumns(e.value,e.columns)})},setColumns:function(t,e){this[t+"Columns"]=$.su.clone(this.oriColumns),$.extend(this[t+"Columns"],e)},bindEvent:function(){var t=this.settings.objs.grid.dom(),t=(t.find(".grid-header .filter-icon").last(),t.find(".grid-panel-content-container .grid-container .filter-panel-container")),e=this;$(window).on("resize.filterConf",function(){e._shown&&e.adjustPanel()}),$("body").on("click.filterConf",function(t){e._shown&&0===$(t.target).closest(".filter-panel-container").length&&e.hidePanel()}),t.on("mouseleave",function(t){e._shown&&null!==t.relatedTarget&&e.hidePanel()})},unbindEvent:function(){$(window).off(".filterConf"),$("body").off(".filterConf")},hideType:function(e){Array.isArray(e)||(e=[e]),this.hideTypeArr=e,this.filterType.loadItems(this.getTypes().filter(function(t){return!e.includes(t.value)}))},showType:function(e){var i=this;e?(Array.isArray(e)||(e=[e]),i.hideTypeArr&&(i.hideTypeArr=i.hideTypeArr.filter(t=>!e.includes(t)),this.filterType.loadItems(this.getTypes().filter(function(t){return!i.hideTypeArr.includes(t.value)})))):this.filterType.loadItems(this.getTypes())},hideColumn:function(e){Array.isArray(e)||(e=[e]),this.dataIndexArr=e,this.filterColumns.loadItems(this.getColumns().filter(function(t){return!e.includes(t.value)}))},showColumn:function(e){var i=this;e?(Array.isArray(e)||(e=[e]),i.dataIndexArr&&(i.dataIndexArr=i.dataIndexArr.filter(t=>!e.includes(t)),this.filterColumns.loadItems(this.getColumns().filter(function(t){return!i.dataIndexArr.includes(t.value)})))):this.filterColumns.loadItems(this.getColumns())},updateColumns:function(t){var e="",i=t||this.filterType.getValue();switch(i){case 1:e="default";break;case 2:e="all";break;case 3:e="custom";break;default:e=i}this.setSelectedColumns(this[e+"Columns"])},getHideColsArr:function(t){var i=[];return $.each(t,function(t,e){!1===e&&i.push(t)}),i},setFilterType:function(t){t=t||1;this.filterType.setValue(t),this.updateColumns(t)},setSelectedColumns:function(t){this.filterColumns.setValue(t);t=this.getHideColsArr(t);this.settings.objs.grid.hideFilterColumns(t,"filterColumns"),this.adjustPanel()},disableColumn:function(t){this.filterColumns.disableItem(t)},hideFilterColumns:function(t){this.filterColumns.hideItem(t)},resetFilterColumns:function(){this.filterColumns.loadItems(this.getColumns())},disableColumnByName:function(i){var s=this,t=this.getColumns();t&&t.length&&$.each(t,function(t,e){i===e.name&&s.filterColumns.disableItem(t)})}}),$.su.Widget.register("calendarCard",{settings:{dateType:{attribute:"date-type",defaultValue:"day"},selfHandle:{attribute:"self-handle",defaultValue:!1},timeZoneType:{attribute:"time-zone-type",defaultValue:"site"}},listeners:[{selector:function(){return{parent:window,target:""}},event:"ev_resize",callback:function(t,e,i){i.setGridWidth(),i.setTimeLineHeight(),i.setContentLineHeight()}},{selector:".grid-header-tr .row-header-title",event:"click",callback:function(t,e){var t=(t.target||t.srcElement).closest(".row-header-title"),i=t.getAttribute("data-key"),s=e.setProxyPara(i),a=e.settings.id+"-"+i+"-pager",n=e.dom().find(".grid-content-container-"+i),o=e.dom().find(".time-line-hour-"+i);n.hasClass("fold")?(e.dom().triggerHandler("ev_calendarcard_row_header_click",[s,e.settings.dateType]),e.setDetailLoading(i)):e.cancelDetailLoading(i),n.hasClass("fold")?(n.removeClass("fold"),n.addClass("unfold"),$(t).removeClass("fold"),$(t).addClass("unfold"),o.addClass("expand")):(n.removeClass("unfold"),n.addClass("fold"),$(t).removeClass("unfold"),$(t).addClass("fold"),o.removeClass("expand")),e.showPager(a,!0),e.setTimeLineHeight(),e.setContentLineHeight()}},{selector:".grid-header-tr .grid-header.actionheader",event:"click",callback:function(t,e){e.dom().triggerHandler("ev_calendarcard-header-click")}},{selector:'td.grid-content-td[name="action-column"] a',event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var t=$(this).data("type"),i=$(this).closest("tr.grid-content-tr"),s=i.attr("data-key"),i=i.closest("div.grid-content-container.grid-outer").data("index");e.dom().triggerHandler("ev_calendarcard_action_click",[s,t,$(this),i]),$(window).trigger("ev_remove_tip")}},{selector:"tr.grid-content-tr",event:"mouseenter",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this).attr("data-key");"null"!=t&&"undefined"!=t&&e.dom().find("tr.grid-content-tr").removeClass("hover").filter("[data-key="+t+"]").addClass("hover")}},{selector:"tr.grid-content-tr",event:"mouseleave",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this).attr("data-key");e.dom().find("tr.grid-content-tr[data-key="+t+"]").removeClass("hover")}}],init:function(t){this.timezoneOffset=null,"function"==typeof this.settings.configs.timezoneGetter&&(this.timezoneOffset=this.settings.configs.timezoneGetter()),this.regMap=new Array(24),this.noEntry=!0,this.currentDate=new Date($.su.serviceManager.get("time").getSiteLocalTimeFromUTC($.su.serviceManager.get("time").getNowTimeStamp())),this.dayRange=[],this.weekRange=[],this.dayCardRowLength=24,this.weekCardRowLength=7,this.natureValue=null,this.initStyleText=null,this.weekTimeLine=[$.su.CHAR.LOG.SIMPLE_WEEK_7,$.su.CHAR.LOG.SIMPLE_WEEK_1,$.su.CHAR.LOG.SIMPLE_WEEK_2,$.su.CHAR.LOG.SIMPLE_WEEK_3,$.su.CHAR.LOG.SIMPLE_WEEK_4,$.su.CHAR.LOG.SIMPLE_WEEK_5,$.su.CHAR.LOG.SIMPLE_WEEK_6]},renderCalendarCard:function(){var t=this.dom(),e=this.settings,i=(e.configs.columns,t.addClass(e.cls+"calendar-card-container container "+e.dateType),""),i=(i=(i=(i=(i+='<div id="'+e.id+'-panel" class="grid-panel">')+('<div class="container widget-container'+e.cls+'">'))+'<div class="calendar-card-wrap">'+'<div class="calendar-card-content">')+this.renderHeader()+"</div></div></div>")+this.renderDayCard()+"</div>";t.empty().append(i),t.find('.grid-panel style[name="column"]').remove().prepend(this.initStyleText),this.setGridWidth(),"day"===e.dateType?this.setTimeLine():this.setWeekTimeLine()},renderHeader:function(){var t=this.settings.configs.columns,e="",i='<style type="text/css" name="column">';e+='<div class="container grid-header-container"><table class="grid-table no-border" cellspacing="0" cellpadding="0" style="width:100%"><tbody><tr class="grid-header-tr">';for(var s,a=0;a<t.length;a++)void 0!==t[a].render&&!t[a].render||(void 0!==t[a].width&&(i=(i+="#"+this.domId+" th.grid-header-"+a+",")+"#"+this.domId+" td.grid-content-td-"+a,"number"===$.type(t[a].width)?i+="{width:"+t[a].width+"px;":i+="{width:"+t[a].width+";",0===t[a].width&&(i+="padding: 0;"),i+="}"),this.initStyleText=i,s="",e=(e=(e=e+('<th class="grid-header grid-header-'+a+" "+(s=t[a].actionHeader?"actionheader":s)+" "+(t[a].cls||""))+'" data-index="'+a+'"')+' name="'+("actionColumn"!==t[a].xtype&&t[a].dataIndex||"action-column")+'">')+'<span class="content" >'+t[a].text+"</div></th>");return e+="</tr></tbody></table></span>"},renderDayCard:function(){var t=this.settings.configs.columns,e="",i="day"===this.settings.dateType?this.dayRange.length:this.weekCardRowLength;e+='<div class="grid-content-container-outer">';for(var s=0;s<i;s++){e=(e=e+('<div data-index="'+s+'" class="grid-outer grid-content-container grid-content-container-'+s+'">')+'<div class="content-line">')+"<span></span>"+"</div>",0==s&&(e+='<div class="empty-content"><span></span></div>');for(var e=e+('<table id="'+this.domId+"-"+s+'" class="grid-table no-border grid-table-'+s+'" border="0" cellspacing="0" cellpadding="0">')+'<thead><tr class="grid-header-tr" >',a=0;a<t.length;a++)void 0!==t[a].render&&!t[a].render||(e=e+'<th class="grid-header grid-header-'+a+'"><span class="content" ></span></th>');e=(e=(e=(e+="</tr></thead>")+'<tbody class="grid-content-data">'+"</tbody>")+"</table>"+'<div class="content-loading hidden"><span class="icon"></span></div>')+('<div id="'+this.domId+"-"+s+'-pager" class="calendar-pager-cantainer"></div>')+"</div>"}return e},renderRowHeader:function(t,e){var i=this.domId+"-"+e,i=this.dom().find("#"+i+" .grid-header-0 .content"),s="";s+='<div class="row-header-title" data-key="'+e+'">',this.settings.configs.renderHeader?s+=this.settings.configs.renderHeader(t):s=s+('<span class="text">'+length)+'</span><span class="icon collapse-inside"></span>',s+="</div>",i.empty().prepend(s)},setTimeLine:function(){for(var t="",e=this.dom(),i=this.dayRange.length,t=(t=t+'<div class="grid-time-line-container">'+('<div id="'+this.domId+'-hour-999" class="time-line-hour time-line-hour-999">'))+'<span class="time-line-content day-time-line time-line-content-999">'+"</span></div>",s=0;s<i;s++)t=(t=(t=t+(s===i-1?'<div id="'+this.domId+"-hour-"+s+'" class="time-line-hour time-line-hour-last">':'<div id="'+this.domId+"-hour-"+s+'" class="time-line-hour time-line-hour-'+s+'">')+'<span class="time-line-content day-time-line time-line-content-'+s+'">')+this.transformTime24To12(this.dayRange[s].timeStart))+'</span><span class="time-line-circle time-line-circle-'+s+'"></span>',s==i-1&&(t=(t+='<span class="time-line-content day-time-line time-line-content-last">')+this.transformTime24To12(this.dayRange[s].timeEnd+1)+'</span><span class="time-line-circle-last"></span>'),t+="</div>";e.prepend(t+="</div>"),e.find(".grid-panel").css($.su.language.isRtl()?{"padding-right":"86px"}:{"padding-left":"86px"}),this.setGridWidth()},setWeekTimeLine:function(){for(var t="",e=this.dom(),t=(t=t+'<div class="grid-time-line-container">'+('<div id="'+this.domId+'-hour-999" class="time-line-hour time-line-hour-999">'))+'<span class="time-line-content time-line-content-999">'+"</span></div>",i=0;i<this.weekCardRowLength;i++)t=(t=(t=t+('<div id="'+this.domId)+"-hour-"+i+'" class="time-line-hour time-line-hour-'+i+'"><span class="time-line-content week-time-line time-line-content-'+i+'">')+this.weekTimeLine[i]+"</span>")+'<span class="time-line-circle time-line-circle-'+i+'"></span></div>';e.prepend(t+="</div>"),e.find(".grid-panel").css($.su.language.isRtl()?{"padding-right":"86px"}:{"padding-left":"86px"}),this.setGridWidth()},loadItems:function(t){this.noEntry=!1,this.natureValue=t,this.clearTimeLineExpand(),"day"!==this.settings.dateType&&"week"!==this.settings.dateType||this.convertValueByDay(t)},clearTimeLineExpand:function(){this.dom().find(".time-line-hour").removeClass("expand")},convertValueByDay:function(t){this.settings.configs.timeIndex;var s=!0,a="day"===this.settings.dateType?this.dayValue=[]:this.weekValue=[],n=this;t.forEach(function(t,e){var i={key:e};t.key=e,t.data&&0!==t.data.length&&t.data.length<=("day"===n.settings.dateType?1:3)?(i.data=t.data.slice(),s=!1):(i.errorNum=t.errorNum||0,i.warningNum=t.warningNum||0,i.infoNum=t.infoNum||0,(i.errorNum||i.warningNum||i.infoNum)&&(s=!(i.hasLargeData=!0))),a.push(i)}),s&&(this.noEntry=s),this.renderCellByDay(),this.setTimeLineHeight(),this.setContentLineHeight()},renderCellByDay:function(){var i,s=this.dom(),a=this,n=(this.settings.configs.columns,this.settings.id);this.settings.dateType;("day"===this.settings.dateType?this.dayValue:this.weekValue).forEach(function(t){i=n+"-"+t.key,s.find("#"+i+" .grid-content-data"),s.find("#"+i+" .grid-header-0 .content").empty(),s.find("#"+i+"-pager").empty();var e=$.extend([],t.data);$.isArray(e)||(e=[e]),t.hasLargeData?(s.find("#"+i).addClass("fold-table"),a.renderRowHeader({errorNum:t.errorNum,warningNum:t.warningNum,infoNum:t.infoNum},t.key),s.find(".grid-content-container-"+t.key).addClass("fold")):(s.find("#"+i).removeClass("fold-table"),s.find(".grid-content-container-"+t.key).removeClass("fold"),s.find("#"+i).attr("row",e.length||0)),a.loadTableData(e,t.key)}),this.setEmptyStyle(),this.cancelEmptyStyle()},loadTableData:function(t,e){var i,s=this.dom(),a="day"===this.settings.dateType?1:3,n=this,o=this.settings.id+"-"+e,s=s.find("#"+o+" .grid-content-data"),o=o+"-pager",r=t.length;this.getSinglePager(o,t,e),a<r?(this.showPager(o,!0),this.refreshByData(e)):(this.showPager(o,!1),i="",t.forEach(function(t,e){i=(i+='<tr class="grid-content-tr" data-key="'+(t&&t.id)+'">')+n.renderColumns(t)+"</tr>"}),s.empty().prepend(i))},showPager:function(t,e){t=this.dom().find("#"+t);e?t.removeClass("hidden"):t.addClass("hidden")},setProxyPara:function(t){var e={},i=(e.currentPage=this.regMap[t].currentPage,e.currentPageSize=this.regMap[t].currentPageSize,"day"===this.settings.dateType?this.dayRange:this.weekRange);return e.timeStart=i[t].timeStart,e.timeEnd=i[t].timeEnd,e.key=t,e},getSinglePager:function(t,e,s,i){var a,n=this;try{a=this.settings.configs.paging.numPerPage}catch(t){a=50}t=new $.su.widgets.simplePaging($.extend({},this.settings,{id:t,numPerPage:a,enablePageSize:!1,objs:this,key:s}));return t.render(),t.dom().on("ev_calendarCard_paging_changed",function(t,e){var i;n.dom().find(".grid-content-container-"+s).hasClass("fold")||(n.settings.selfHandle&&(i=e.numPerPage*e.currentPage,n.regMap[e.key].renderSlice=[i,e.numPerPage*(e.currentPage+1)]),n.regMap[e.key].currentPageSize=e.numPerPage,n.regMap[e.key].currentPage=e.currentPage+1,n.settings.selfHandle?n.refreshByPaging(s):n.dom().triggerHandler("ev_calendarcard_row_pager_click",[n.setProxyPara(e.key),n.settings.dateType]),n.setDetailLoading(s),n.setTimeLineHeight(),n.setContentLineHeight())}),this.regMap[s]={totalRows:e.length,totalPages:Math.ceil(e.length/a),currentPageSize:a,currentPage:1,paging:t,renderSlice:[0,a],data:e}},updateData:function(t,e,i){this.cancelDetailLoading(t),this.regMap[t].data=e.data,this.regMap[t].totalRows=e.totalRows||e.data&&e.data.length||0,this.regMap[t].totalPages=Math.ceil(this.regMap[t].totalRows/50),i&&this.refreshByData(t),this.refreshByPaging(t),this.setTimeLineHeight(),this.setContentLineHeight()},refreshByPaging:function(t){var e,i,s="",a=this,n=this.regMap[t].data,n=(a.settings.selfHandle&&(e=this.regMap[t].renderSlice[0],i=this.regMap[t].renderSlice[1]),n.slice(e,i).forEach(function(t,e){s=(s+='<tr class="grid-content-tr" data-key="'+(t&&t.id)+'">')+a.renderColumns(t)+"</tr>"}),this.settings.id+"-"+t);this.dom().find("#"+n+" .grid-content-data").empty().prepend(s)},refreshByData:function(t){t=this.regMap[t];t.paging.setTotalPage(t.totalPages,{currentPage:t.currentPage,currentPageSize:t.currentPageSize,selfHandle:this.settings.selfHandle,totalRows:t.totalRows})},renderColumns:function(t){for(var e,i=this.settings.configs.columns,s="",a=0;a<i.length;a++)void 0!==i[a].render&&!i[a].render||(s=(s+='<td class="grid-content-td grid-content-td-'+a+" "+((e=i[a]).cls||"")+'"')+' name="'+("actionColumn"!==e.xtype&&e.dataIndex||"action-column")+'"><div class="td-content">',e.dataIndex&&t?s+=e.renderer?e.renderer(t[e.dataIndex],t):$.su.escapeHtml(t[e.dataIndex]||""):e.xtype&&"actionColumn"===e.xtype?s+=e.renderer?e.renderer("---",t):"":s+="",s+="</div></td>");return s},setGridWidth:function(){var t=this.dom(),e=t.find(".grid-panel"),i=this.settings.configs.columns,s='<style type="text/css" name="column">';if(0!==t.width()){e.find('style[name="column"]').remove(),e.prepend(this.initStyleText);for(var a=0,n=i.length;a<n;a++){var o=i[a],r=$(this.getClosestContainerClass("header")+" th.grid-header-"+a).outerWidth(),s=(s=(s+=this.getClosestContainerClass("header")+" th.grid-header-"+a+",")+(this.getClosestContainerClass("content")+" th.grid-header-"+a+","))+(this.getClosestContainerClass("content")+" td.grid-content-td-"+a)+("{width:"+(0===a?r-15:r)+"px;");0===o.width&&(s+="padding: 0;"),s+="}"}s+="</style>",e.find('style[name="column"]').remove(),e.prepend($(s))}},setTimeLineHeight:function(){var t=this.dom(),e=t.find(".grid-panel"),i="day"===this.settings.dateType?this.dayRange.length:this.weekCardRowLength,s='<style type="text/css" name="time-line">';if(0!==t.height()&&0!==this.dayRange.length){t=window.getComputedStyle($("#"+this.domId+" .grid-header-container")[0]).height;s+=this.getClosestContainerClass("time-line")+"> .time-line-hour-999 {height:"+t+"}";for(var a=0,n=i;a<n;a++)var o=window.getComputedStyle($("#"+this.domId+" .grid-content-container-"+a)[0]).height,s=s+(this.getClosestContainerClass("time-line")+" > .time-line-hour-"+a)+("{height:"+o+"} ");s+="</style>",e.find('style[name="time-line"]').remove(),e.prepend(s)}},setContentLineHeight:function(){var t=this.dom(),e=t.find(".grid-panel");if(this.noEntry)e.find('style[name="content-line"]').remove();else{var i=this.settings,s="day"===this.settings.dateType?1:3,i="day"===i.dateType?this.dayRange.length:this.weekCardRowLength,a='<style type="text/css" name="content-line">';if(0!==t.height()){for(var n,o,r=0,d=i;r<d;r++)Number($("#"+this.domId+"-"+r).attr("row"))<=s||(o=window.getComputedStyle($("#"+this.domId+"-"+r)[0]).height,n=window.getComputedStyle($("#"+this.domId+"-"+r+" thead")[0]).height,o=Number(o.slice(0,-2))-Number(n.slice(0,-2)),a=(a=(a=(a=(a+="#"+this.domId+" .grid-content-container-"+r+" > .content-line > span")+"{height:"+(Number(o)-54)+"px; ")+`border-right:  2px solid ${$.getUIColor("--s-color-border-active")};`)+`background: ${$.getUIColor("--s-color-background-active")};`)+"top:"+(Number(n.slice(0,-2))+25)+"px;} ");a+="</style>",e.find('style[name="content-line"]').remove(),e.prepend(a)}}},setEmptyStyle:function(){var t,e;this.noEntry&&(t="#"+this.domId+" .grid-content-container-0 > .empty-content",(t=$(t)).addClass("enable"),t=t.find("span"),e="function"==typeof this.settings.configs.emptyContent?this.settings.configs.emptyContent():"string"==typeof this.settings.configs.emptyContent?this.settings.configs.emptyContent:$.su.CHAR.COMMON.NO_ENTRY,t.empty().append(e))},cancelEmptyStyle:function(){var t;this.noEntry||(t="#"+this.domId+" .grid-content-container-0 > .empty-content",$(t).removeClass("enable"))},getValue:function(){return this.natureValue},getClosestContainerClass:function(t){return"#"+this.domId+" .grid-"+t+"-container "},show:function(){this.dom().show(),this.setGridWidth(),this.setTimeLineHeight(),this.dom().triggerHandler("ev_widget_show")},setDate:function(t){this.settings.timeZoneType=$.su.serviceManager.get("user").isSiteView()?"site":"controller",this.currentDate=moment(t),this.setTimeRange()},getDate:function(){return"day"===this.settings.dateType?this.dayRange:this.weekRange},setTimeRange:function(){var t=moment(this.currentDate),e=moment(this.currentDate).subtract(1,"d"),i=moment(this.currentDate).add(1,"d"),s=moment(t).startOf("week"),a=36e5,n=(this.settings.timeZoneType,$.su.serviceManager.get("time").siteTimeInfo.dstOffset),o=(this.dayRange=[],$.su.serviceManager.get("time").getStartUTCTimeInDay(t,this.settings.timeZoneType)),r=$.su.serviceManager.get("time").getEndUTCTimeInDay(t,this.settings.timeZoneType)+1,t=$.su.serviceManager.get("time").getStartUTCTimeInDay(e,this.settings.timeZoneType),e=$.su.serviceManager.get("time").getEndUTCTimeInDay(e,this.settings.timeZoneType)+1,d=$.su.serviceManager.get("time").getStartUTCTimeInDay(i,this.settings.timeZoneType),i=$.su.serviceManager.get("time").getEndUTCTimeInDay(i,this.settings.timeZoneType)+1;if(r-o<864e5&&e-t<864e5||r-o<864e5&&i-d<864e5){var l=Math.ceil((r-o)/a),c=o%a,e=r%a;if(c)for(var h=0;h<l;h++)timeEnd=0===h?o+(a-c):o+a,0!==h||18e5!==n&&54e5!==n||(timeEnd+=18e5),this.dayRange.push({timeStart:o,timeEnd:timeEnd-1}),o=timeEnd;else if(e)for(h=0;h<l;h++)timeEnd=h===l-1?r:o+a,this.dayRange.push({timeStart:o,timeEnd:timeEnd-1}),o=timeEnd}else{for(var l=Math.floor((r-o)/a),g=(r-o)%a,h=0;h<l;h++)timeEnd=o+a,"00"!=$.su.serviceManager.get("time").getTextFromUTC(timeEnd,this.settings.timeZoneType,{pattern:"MM dd, yyyy hh:mm hc"}).slice(-5,-3)&&(timeEnd+=g,g=0),this.dayRange.push({timeStart:o,timeEnd:timeEnd-1}),o=timeEnd;g&&this.dayRange.push({timeStart:r-g,timeEnd:r-1})}this.weekRange=[];for(h=0;h<this.weekCardRowLength;h++)this.weekRange.push({timeStart:$.su.serviceManager.get("time").getStartUTCTimeInDay(s,this.settings.timeZoneType),timeEnd:$.su.serviceManager.get("time").getEndUTCTimeInDay(s,this.settings.timeZoneType)}),s.add(1,"d")},hideColumns:function(t){var t=$(this.getClosestContainerClass("header")+'th[name="'+t+'"').attr("data-index"),e=this.dom();e.find(".grid-header-"+t).hide(),e.find(".grid-content-td-"+t).hide()},showColumns:function(t){var t=$(this.getClosestContainerClass("header")+'th[name="'+t+'"').attr("data-index"),e=this.dom();e.find(".grid-header-"+t).show(),e.find(".grid-content-td-"+t).show(),this.setGridWidth()},getDetailByKey:function(t){return this.regMap[t]},transformTime24To12:function(t){var e;return $.appUtils.getUiInterface("use24hour")?0===(e=parseInt($.su.serviceManager.get("time").getTextFromUTC(t,this.settings.timeZoneType,{pattern:"MM dd, yyyy hh:mm"}).slice(-5,-3)))||24===e?e="12:00 AM":e<12?(e=e<10?"0"+e:e,e+=":00 AM"):12===e?e="12:00 PM":(e=e%12<10?"0"+e%12:e%12,e+=":00 PM"):e=$.su.serviceManager.get("time").getTextFromUTC(t,this.settings.timeZoneType,{pattern:"MM dd, yyyy hh:mm hc"}).slice(-8).toUpperCase(),e},setDetailLoading:function(t){t=this.dom().find(".grid-content-container-"+t);t.find(".grid-content-data").addClass("hidden"),t.find(".content-loading").removeClass("hidden")},cancelDetailLoading:function(t){t=this.dom().find(".grid-content-container-"+t);t.find(".grid-content-data").removeClass("hidden"),t.find(".content-loading").addClass("hidden")}}),$.su.Widget.register("simplePaging",{settings:{numPerPage:{attribute:"num-per-page",defaultValue:10},enableGo:{attribute:"enable-go",defaultValue:!0},enablePageSize:{attribute:"enable-page-size",defaultValue:!0}},listeners:[{selector:"a.paging-btn-num",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();e.settings;t=$(this),t=parseInt(t.attr("data-index"),10);e.goTo(t)}},{selector:"a.pageing-btn-prev",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault(),e.goPrev()}},{selector:"a.pageing-btn-next",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault(),e.goNext()}},{selector:"a.pageing-btn-first",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault(),e.goTo(0)}},{selector:"a.pageing-btn-last",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault(),e.goTo(1/0)}},{selector:"span.dots",event:"mouseenter",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this);$(this).hasClass("disabled")||(t.addClass("hidden"),t.parent().find(".btn-more.current").removeClass("hidden"))}},{selector:"span.btn-more",event:"mouseleave",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=$(this);$(this).hasClass("disabled")||(t.addClass("hidden"),t.parent().find(".dots").removeClass("hidden"))}},{selector:"span.btn-more-left",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();t=(t=+e.settings.currentPage)-4<=0?0:t-4;$(this).hasClass("disabled")||e.goTo(t)}},{selector:"span.btn-more-right",event:"click",callback:function(t,e){t.stopPropagation(),t.preventDefault();var t=e.settings,i=+t.currentPage,i=t.totalPage-1<=4+i?t.totalPage-1:4+i;$(this).hasClass("disabled")||e.goTo(i)}},{selector:".paging-go .text-wrap-inner input",event:"keyup",callback:function(t,e){13===t.keyCode&&(t=e._pagingTextbox.getValue(),t=parseInt(t,10)-1,"number"===$.type(t)&&0<=t&&t!==e.currentPage&&e.goTo(t),e._pagingTextbox.setValue(""))}}],init:function(t){this.dom();var e=this.settings;this._totalPage=0,this._pageMap={},$.extend(e,t,t.configs.paging)},render:function(){var i=this,t=this.dom(),e=t.parent().find("div.grid-panel-content"),s=this.settings,a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a='<div class="container widget-container paging-container disabled">')+'<div class="paging-wrap u-d-none">'+'<div class="paging-wrap-inner u-d-inline-block">')+'<div class="paging-info-container u-d-inline-block">'+'<div class="paging-info u-d-inline-block">')+"<span></span>"+"</div>")+"</div>"+'<div class="paging-items hidden">')+'<span class="content u-d-inline-block"></span>'+"</div>")+'<div class="paging-btns u-d-inline-block">'+'<a href="javascript:void(0);" class="paging-btn hidden pageing-btn-first" data-index="first">')+'<span class="icon"></span>'+'<span class="text"><<</span>')+"</a>"+'<a href="javascript:void(0);" class="paging-btn pageing-btn-prev" data-index="prev">')+'<span class="icon"></span>'+'<span class="text"></span>')+"</a>"+'<div class="num-buttons-container">')+"</div>"+'<a href="javascript:void(0);" class="paging-btn pageing-btn-next" data-index="next">')+'<span class="icon"></span>'+'<span class="text"></span>')+"</a>"+'<a href="javascript:void(0);" class="paging-btn hidden pageing-btn-last" data-index="last">')+'<span class="icon"></span>'+'<span class="text">>></span>')+"</a>"+"</div>";a=(a=(s.enablePageSize?(a+='<div class="paging-options u-d-inline-block">')+'<div class="paging-select inline-block"><div id="'+this.domId+'_select"  widget="combobox"></div></div></div>':a)+'<div class="paging-go u-d-inline-block"><div widget="textbox" label-field="{GRID.PAGE_TO}"></div>')+'<div widget="button" text="'+$.su.CHAR.COMMON.GO+'"></div>',t.append($(a=(a=(a=(a=(a=(a+="</div>")+'<div class="paging-separator hidden">'+'<span class="icon"></span>')+"</div>"+'<div class="paging-total hidden">')+'<span class="content u-d-inline-block"></span>'+"</div>")+"</div>"+"</div>")+"</div>"+'<input type="hidden" class="hidden paging-input">')),e.append(t),s.enablePageSize&&(this._numSelect=new $.su.widgets.combobox({id:this.domId+"_select"}),this._numSelect.render(),s.items=s.items||[],s.items.forEach(function(t,e){t.name+=" "+$.su.CHAR.GRID.OPTIONS_UNIT}),this._numSelect.loadItems(s.items),s.numPerPage=this._numSelect.getValue()||s.numPerPage,this._numSelect.dom().on("ev_view_change",function(t,e){i._numSelect.setValue(e.value),i.setNumPerPage(e.value),i.settings.selfHandle})),s.enableGo&&(a=t.find('.paging-go div[widget="textbox"]'),e=t.find('.paging-go div[widget="button"]'),this._pagingTextbox=new $.su.widgets.textbox({id:a}),this._pagingButton=new $.su.widgets.button({id:e}),this._pagingTextbox.render(),this._pagingButton.render(),this._pagingTextbox.dom().on("ev_view_change",function(){var t=i._pagingTextbox.getValue(),t=parseInt(t,10)-1;$.isNumeric(t)&&t%1==0&&0<=t?i._pagingButton.dom().removeClass("disabled"):i._pagingButton.dom().addClass("disabled")}),this._pagingButton.dom().addClass("disabled"),this._pagingButton.dom().on("ev_button_click",function(){var t=i._pagingTextbox.getValue(),t=parseInt(t,10)-1;$.isNumeric(t)&&t!==i.currentPage&&(i.goTo(t),i._pagingButton.dom().addClass("disabled"))}))},setPageSize:function(t){this._numSelect.setValue(t),this.setNumPerPage(t)},setNumPerPage:function(t){var e=this.settings;e.numPerPage=t||e.numPerPage,this._totalPage=Math.ceil(e.totalRows/e.numPerPage)},setTotalPage:function(t,e){this._totalPage=t,e.currentPage&&(this.settings.currentPage=e.currentPage-1),!e.totalRows&&0!==e.totalRows||(this.settings.totalRows=e.totalRows),e.currentPageSize&&(this.settings.numPerPage=e.currentPageSize,this.settings.enablePageSize||void 0===e.selfHandle||this.setNumPerPage()),void 0!==e.selfHandle&&(this.settings.selfHandle=e.selfHandle),this.dom().find(".page-total .content").text($.su.CHAR.GRID.PAGE_INFO.replace("%num",t)),this.updateBtns()},updateBtns:function(){var t=this.settings,e=t.currentPage,i=this._totalPage;t.totalPage=i,this.dom().find(".paging-total .content").text(i),i<e&&(e=t.currentPage=i),this.goToPage(e)},updateNumBtns:function(){var t=this.settings,e=t.currentPage,i=t.totalPage,t=this.dom().find("div.paging-wrap"),s=t.find("div.num-buttons-container");if(0==i)t.addClass("disabled").hide();else{t.removeClass("disabled").show();var a="",n=0;if(5<i){var t=i-1,o=e-1,r=e+1;for(e<=3?(o=0,r=4):i-4<=e&&(o=i-5,r=i-1),0!==o&&d(0),n=o;n<=r;n++)d(n);r!==t&&d(t)}else for(n=0;n<i;n++)d(n)}function d(t){a=(a=(a=(a=(a+='<a href="javascript:void(0);" class="paging-btn paging-btn-num pageing-btn-'+t+'" data-index="'+t+'">')+'<span class="icon"></span><span class="text">'+(t+1)+"</span>")+'</a><div class="dots-container u-d-inline-block">')+'<span class="btn-more-left btn-more hidden"></span><span class="dots"></span>')+'<span class="btn-more-right btn-more hidden"></span></div>'}s.empty().append($(a))},goToPage:function(t){var e=this.dom(),i=this.settings,s=e.find("div.paging-container"),a=(i.objs.dom(),isNaN(t)?0:t),t=i.numPerPage,n=i.totalPage,o=i.totalRows,r=(n<=a&&0<n?a=n-1:a<0&&(a=0),i.currentPage=a,this.updateNumBtns(),0===o?0:a*t+1),t=0===o?0:r+t-1,d=(t=(o=this.settings.selfHandle?o:this.settings.totalRows)<t?o:t,$.su.CHAR.COMMON.GRID_PAGING_SHOW),l=(d=(d=(d=d.replace("%start",r)).replace("%end",t)).replace("%total",o),e.find(".paging-info span").text(d),s.find("a.paging-btn.pageing-btn-prev")),c=s.find("a.paging-btn.pageing-btn-next"),h=s.find("a.paging-btn.pageing-btn-first"),g=s.find("a.paging-btn.pageing-btn-last"),r=s.find("a.paging-btn-num"),t=s.find("span.dots"),o=s.find("span.btn-more");r.removeClass("current"),o.removeClass("current").addClass("hidden"),t.addClass("hidden"),r.filter("[data-index="+a+"]").addClass("current"),7<n&&(e=n-1,d=a-1,o=a+1,a<=3?(d=0,o=4):n-4<=a&&(d=n-5,o=n),0!==d&&((t=s.find(".pageing-btn-0").next(".dots-container")).find(".dots").removeClass("hidden"),t.find(".btn-more-left").addClass("current")),o!==e)&&((r=s.find(".pageing-btn-"+o).next(".dots-container")).find(".dots").removeClass("hidden"),r.find(".btn-more-right").addClass("current")),setTimeout(function(){l.removeClass("disabled"),c.removeClass("disabled"),h.removeClass("disabled"),g.removeClass("disabled"),0===a&&(h.addClass("disabled"),l.addClass("disabled")),n-1<=a&&(c.addClass("disabled"),g.addClass("disabled"))},180),this.dom().triggerHandler("ev_calendarCard_paging_changed",{currentPage:a,numPerPage:i.numPerPage,key:i.key})},goTo:function(t){this.goToPage(t)},goPrev:function(){var t=this.settings.currentPage;--t<0||this.goTo(t)},goNext:function(){var t=this.settings,e=t.currentPage;t.totalPage<=++e||this.goTo(e)},goFirst:function(){var t=this.settings;t.totalPage;this.goTo(t.currentPage=0)},goLast:function(){var t=this.settings,e=t.totalPage;t.currentPage=1<e?e-1:e,this.goTo(t.currentPage)},getRowNumberOffset:function(){var t=this.settings.currentPage;return this.settings.numPerPage*t||0},updateRowPage:function(t){for(var e=this,i=this.settings,s=i.objs.grid,a=i.numPerPage,i=s.dom().find("tbody.grid-content-data").children("tr"),n=0,o=t.length;n<o;n++){var r=Math.floor(n/a);this._pageMap[t[n]]=r}return i.each(function(){var t=$(this).attr("data-key");$(this).attr("data-page",e._pageMap[t])}),this._pageMap}}),$.su.Widget.register("monthCard",{settings:{timeZoneType:{attribute:"time-zone-type",defaultValue:"site"}},listeners:[{selector:"td.month-card-content-td",event:"mousedown",callback:function(t,e){t.stopPropagation(),$(this).hasClass("disabled")||$(this).hasClass("select")||$(this).addClass("clicked")}},{selector:"td.month-card-content-td",event:"mouseup mouseleave",callback:function(t,e){t.stopPropagation(),$(this).addClass("clicked")&&$(this).removeClass("clicked")}},{selector:"td.month-card-content-td",event:"click",callback:function(t,e){t.preventDefault(),$(this).hasClass("disabled")?t.stopPropagation():(t=$(this).attr("date"),e.selectDate=t,e.updateMonthCard(),e.dom().triggerHandler("ev_month_card_select",[t]))}}],init:function(t){var e=$.su.CHAR.MONTH_CARD;this.timezoneOffset=null,"function"==typeof this.settings.configs.timezoneGetter&&(this.timezoneOffset=this.settings.configs.timezoneGetter()),this.rowLength=6,this.columnlength=7,this.monthValue={},this.headTitle=[e.SUNDAY_ABBR,e.MONDAY_ABBR,e.TUESDAY_ABBR,e.WEDNESDAY_ABBR,e.THURSDAY_ABBR,e.FRIDAY_ABBR,e.SATURDAY_ABBR],this.dayMap=[],this.selectDate=null},render:function(){var t=this.dom(),e=this.settings,i=(t.addClass(e.cls+"month-card-container container"),""),i=(i=(i=(i=(i+='<div class="container widget-container'+e.cls+'">')+'<div class="month-card-wrap">'+'<div class="month-card-content">')+'<div class="container month-card-header-container">'+'<table class="month-card-table no-border" cellspacing="0" cellpadding="0" style="width:100%">')+this.renderHeader())+this.renderBody()+"</table></div></div></div>";t.empty().append(i)},renderHeader:function(){for(var t=(t="")+"<thead>"+'<tr class="month-card-tr">',e=0;e<this.columnlength;e++)t=(t+='<th class="month-card-header-th month-card-header-th-'+e+'">')+this.headTitle[e]+"</th>";return t+="</tr></thead>"},renderBody:function(){var t="";t+="<tbody>";for(var e=0;e<this.rowLength;e++){t+='<tr class="month-card-tr month-card-content-tr month-card-tr-'+e+'">';for(var i=0;i<this.columnlength;i++)t=(t=t+('<td class="month-card-content-td" date-index="'+(7*e+i)+'">')+'<span class="date-number"></span>')+'<div class="slot"></div>'+"</td>";t+="</tr>"}return t+="</tbody>"},setDayMap:function(){this.dayMap=[];for(var t,e=moment(this.formatDate(this.currentYear,this.currentMonth+1,1)).day(),i=moment(this.formatDate(this.currentYear,this.currentMonth+1,1)).subtract(1,"months"),s=i.month(),a=i.year(),n=moment(this.formatDate(this.currentYear,this.currentMonth+1,1)).add(1,"months"),o=n.month(),r=n.year(),d=moment(this.formatDate(this.currentYear,this.currentMonth+1,1)).endOf("month").date(),l=i.endOf("month").date(),c=0;c<42;c++)c<e?this.dayMap.push({key:t=l+c-e+1,month:"prev-month",date:this.formatDate(a,s+1,t)}):e+d-1<c?this.dayMap.push({key:t=c-e-d+1,month:"next-month",date:this.formatDate(r,o+1,t)}):this.dayMap.push({key:t=c-e+1,month:"current-month",date:this.formatDate(this.currentYear,this.currentMonth+1,t)})},getDate:function(){for(var t=this.dayMap.filter(function(t,e){return"current-month"==t.month}),e=[],i=0;i<t.length;i++){var s=$.su.serviceManager.get("time").getStartUTCTimeInDay(moment(t[i].date),this.settings.timeZoneType),a=$.su.serviceManager.get("time").getEndUTCTimeInDay(moment(t[i].date),this.settings.timeZoneType);e.push({timeStart:s,timeEnd:a})}return e},updateMonthCard:function(){for(var t=this.dom(),e=t.find(".month-card-content-td"),i=0;i<e.length;i++){var s=$(e[i]);s.addClass(this.dayMap[i].month),s.attr("date",this.dayMap[i].date),s.hasClass("select")&&this.dayMap[i].date!==this.selectDate&&s.removeClass("select"),this.dayMap[i].date===this.selectDate&&s.addClass("select"),s.hasClass("today")&&this.dayMap[i].date!==this.today&&s.removeClass("today"),this.dayMap[i].date===this.today&&s.addClass("today"),s.find(".date-number").empty().append(this.dayMap[i].key)}t=t.find(".month-card-tr-5");"next-month"==this.dayMap[35].month?t.addClass("u-d-none"):t.show()},setDate:function(t){this.settings.timeZoneType=$.su.serviceManager.get("user").isSiteView()?"site":"controller";var e=moment($.su.serviceManager.get("time").getTextFromUTC($.su.serviceManager.get("time").getNowTimeStamp(),this.settings.timeZoneType,{pattern:"yyyy-MM-dd",transferMonth:!1}));this.today=this.formatDate(e.year(),e.month()+1,e.date()),this.date=moment(t),this.currentYear=this.date.year(),this.currentMonth=this.date.month(),this.currentDate=this.date.date(),this.setDayMap(),this.clearTbody(),this.updateMonthCard()},clearTbody:function(){this.selectDate=null;var t=this.dom().find(".month-card-table");t.find("tbody").remove(),t.append(this.renderBody())},formatDate:function(t,e,i){return t+"-"+(e=e<10?"0"+e:e)+"-"+(i=i<10?"0"+i:i)},loadItems:function(t){var i,e,s;t&&0!=t.length&&(e=(i=this).settings.configs.timeIndex,this.value=$.extend([],t),this.convertData(this.value,e),t=this.dom().find(".month-card-content-tr .month-card-content-td"),s=this.settings.configs.renderItems,$.each(t,function(t,e){e=$(e).find(".slot");s?e.append(s(i.dayMap[t].data)):e.append(this.dayMap[t].data.length)}))},convertData:function(t,e){for(var i=0;i<this.dayMap.length;i++)"current-month"===this.dayMap[i].month&&(this.dayMap[i].data=t.shift())},getItemData:function(t,e,i,s){var a;return a=t||this.formatDate(e,i,s),this.dayMap.filter(function(t,e){return t.date===a})[0].data},setSelectDate:function(t){var e,i,s;"[object Date]"==Object.prototype.toString.call(t)&&(e=t.getFullYear(),i=t.getMonth(),s=t.getDate(),t=this.formatDate(e,i+1,s)),this.selectDate=t,this.updateMonthCard(),this.dom().triggerHandler("ev_month_card_select",[t])}}),jQuery,$.su.Widget.register("score",{settings:{maxCommentLen:{attribute:"max-comment-length",defaultValue:2e3},placeholder:{attribute:"placeholder",defaultValue:""},textareaTip:{attribute:"textarea-tip",defaultValue:""}},listeners:[{selector:".score-icon",event:"click",callback:function(t,e){e.dom().hasClass("disabled")||(e.dom().triggerHandler("ev_view_change",[{type:"value",value:Number($(t.target).data("score")||0)}]),e.dom().triggerHandler("ev_view_change",[{type:"valid",value:Number($(t.target).data("score")||0)}]),e.setValue(Number($(t.target).data("score")||0)))}},{selector:".comment-icon-outer",event:"click",callback:function(t,e){e.dom().find(".score-comment").toggleClass("active")}}],init:function(){this.scoreNotes=[],this.value=null},render:function(){var t=this.dom(),e=this.settings,i=!1===e.labelField?"label-empty":"",t=(t.addClass(e.cls+"score-container "+i),"");e.labelField&&(t=(t+='<div class="widget-fieldlabel-wrap '+e.labelCls+'">')+'<label class="widget-fieldlabel text-fieldlabel">'+$.su.escapeHtml(e.labelField)+"</label>",e.labelField&&(t+='<span class="widget-separator">'+e.separator+"</span>"),t+="</div>"),t=(t+='<div class="widget-wrap-outer score-wrap-outer"><div class="widget-wrap score-wrap"><div class="score-icons"><div class="score-icon" data-score="1"></div><div class="score-icon" data-score="2"></div><div class="score-icon" data-score="3"></div><div class="score-icon" data-score="4"></div><div class="score-icon" data-score="5"></div></div><div class="score-tip"></div></div>')+'<div widget="errortip" error-cls="'+e.errorTipsCls+'"></div></div>',this.dom().html(t)},setValue:function(t){if(t=Number(t),!(!$.isNumeric(t)||t<0||5<t||isNaN(t))){this.dom().find(".score-icon").removeClass("active");for(var e=1;e<=t;e++)this.dom().find(".score-icon").eq(e-1).addClass("active");this.value=t,void 0!==this.scoreNotes[this.value-1]&&null!==this.scoreNotes[this.value-1]?this.dom().find(".score-tip").text(this.scoreNotes[this.value-1]):this.dom().find(".score-tip").text("")}},getValue:function(){return this.value},loadScoreNotes:function(t){this.scoreNotes=t||[],void 0===this.scoreNotes[this.value-1]&&null===this.scoreNotes[this.value-1]||this.dom().find(".score-tip").text(this.scoreNotes[this.value-1])},loadScoreComment:function(t){var e,i,s=this.dom(),a=(this.commentArea||(a=this.settings.placeholder,e=this.settings.textareaTip,i=(i=(i='<div class="score-comment"><div class="comment-icon-outer u-cursor-pointer"><span class="icon"></span>')+'<span class="text">'+$.su.CHAR.FORM_AUTH.WRITE_COMMENT+"</span>")+'</div><div widget="textarea" id="'+this.domId+'-comment-area" class="comment-area u-label-none" '+(a?'placeholder="'+a+'" ':"")+"></div>",e&&(i+='<span class="textarea-tip">'+e+"</span>"),i+="</div>",s.find(".score-wrap").append($(i)),this.commentArea=new $.su.widgets.textarea({id:s.find("#"+this.domId+"-comment-area")}),this.commentArea.render(),this.commentArea.setMaxLength(this.settings.maxCommentLen)),s.find(".score-comment"));t?(this.commentArea.setValue(t),a.addClass("active")):(this.commentArea.setValue(""),a.removeClass("active"))},getComments:function(){return this.commentArea?this.commentArea.getValue():""}}),(()=>{var a=$.su.CHAR.FORM_AUTH;$.su.Widget.register("questionEditor",{settings:{defaultTitle:{attribute:"default-title",defaultValue:a.ENTER_A_QUESTION},scroll:{attribute:"scroll",defaultValue:!1},maxItemNum:{attribute:"max-item-num",defaultValue:20}},listeners:[{selector:".question-card-operator .btn-delete",event:"click",callback:function(t,e){t.stopPropagation(),e.dom().trigger("ev_card_delete",[e._value,e.dom()])}},{selector:".card-footer .add-btn.single",event:"click",callback:function(t,e){$(this).hasClass("disabled")||e.addChoice("")}},{selector:".card-footer .batch-add.batch",event:"click",callback:function(t,e){$(this).hasClass("disabled")||e.showBatchAddMsg()}},{selector:".card-footer .batch-add.others",event:"click",callback:function(t,e){$(this).hasClass("disabled")||e.addChoice(a.OTHERS,"others")}},{selector:".card-footer .btn-edit-link",event:"click",callback:function(t,e){e.showScoreEditMsg()}},{selector:".card-main-container",event:"click",callback:function(t,e){var i;$(t.target).hasClass("btn-remove-item")&&(t.stopPropagation(),i=!!$(t.target).closest(".choice-item-container.others").length,e.removeChoice($(t.target).closest(".choice-item-container").data("key"),i))}}],init:function(){this._value={index:"",type:0,title:"",titleEmptyText:a.ENTER_A_QUESTION,choices:[],choiceEmptyText:$.su.CHAR.FORM_AUTH.ENTER_AN_CHOICE_ANSWER,others:null,scoreNotes:[]},this.defaultScoreNotes=[a.DEFAULT_POINT_TIP_1,a.DEFAULT_POINT_TIP_2,a.DEFAULT_POINT_TIP_3,a.DEFAULT_POINT_TIP_4,a.DEFAULT_POINT_TIP_5],this.choicesMap=[],this.other=null,this.scoreTextInput=[]},render:function(){var s=this,t=this.dom(),e=this.settings,i=!1===e.labelField?"label-empty":"",i=(t.addClass(e.cls+"question-card-container "+i),""),i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i+='<div class="widget-wrap-outer question-card-wrap-outer">')+'<div class="widget-wrap question-card-wrap">'+('<div class="question-card-index">'+this._value.index+"</div>"))+'<div class="card-title">'+('<div widget="textboxEditor" id="'+this.domId+'-question-card-title" class="question-card-title" allow-blank="{false}" empty-text="'+e.defaultTitle+'"></div>'))+'<div class="question-card-operator">'+'<div class="btn-drag u-d-inline-block"><span class="icon"></span></div>')+'<div class="btn-delete u-d-inline-block u-cursor-pointer"><span class="icon"></span></div>'+"</div>")+"</div>"+'<div class="card-main-container"></div>')+'<div class="card-footer">'+'<div class="operation-btn add-btn btn-add-circle single u-d-inline-block u-cursor-pointer">')+'<span class="icon"></span>'+('<span class="text">'+a.ADD_SINGLE_ITEM+"</span>"))+"</div>"+'<div class="operation-btn add-btn batch-add batch-add-btn batch u-d-inline-block u-cursor-pointer">')+'<span class="icon"></span>'+('<span class="text">'+a.BATCH_ADD_ITEMS+"</span>"))+"</div>"+'<div class="operation-btn add-btn batch-add btn-add-circle others u-d-inline-block u-cursor-pointer">')+'<span class="icon"></span>'+('<span class="text">'+a.ADD_OTHER_ITEM+"</span>"))+"</div>"+'<div class="operation-btn btn-edit-link others u-d-inline-block u-cursor-pointer">')+'<span class="icon"></span>'+('<span class="text">'+a.EDIT_SCORE+"</span>"))+"</div>"+('<div widget="checkbox" box-label="'+a.REQUIRED+'" class="u-label-none u-d-inline-block question-card-required" id="'+this.domId+'-question-card-required"></div>'))+('<div class="card-item-limit-note u-d-none">'+a.ITEM_LIMIT_NOTE.replace("%num",this.settings.maxItemNum)+"</div>")+"</div>")+"</div>"+"</div>";t.empty().append(i),this.titleInput=new $.su.widgets.textboxEditor({id:t.find("#"+this.domId+"-question-card-title")}),this.titleInput.render(),this.titleInput.dom().on("ev_view_change",function(t,e){var i=$.su.clone(s._value);i.title=e.value,s.valueChange(i)}),this.requiredCheck=new $.su.widgets.checkbox({id:t.find("#"+this.domId+"-question-card-required")}),this.requiredCheck.render(),this.requiredCheck.dom().on("ev_view_change",function(t,e){var i=$.su.clone(s._value);i.required=e.value,s.valueChange(i)})},getValue:function(){return this._value},setValue:function(t){t&&(this._value=t,this.updateView(t),this.titleInput.setEmptyText(t.titleEmptyText),this.titleInput.setValue(t.title),5!==t.type)&&this.requiredCheck.setValue(t.required)},updateView:function(t){switch(this.getContainer().removeClass("single-card multiple-card combobox-card input-card score-card note-card").addClass(["single-card","multiple-card","combobox-card","input-card","score-card","note-card"][t.type]),t.type){case 0:case 1:case 2:this.loadChoices(t.choices,t.others),this.getContainer().find(".card-footer").show().find(".add-btn").show(),this.getContainer().find(".card-footer .btn-edit-link").hide(),this.updateAddBtnStatus(t);break;case 3:this.getContainer().find(".card-footer").show().find(".operation-btn").hide(),this.requiredCheck.show(),this.input||(this.input=this.dom().find(".card-main-container").append('<div class="choice-input"></div>'));break;case 4:this.getContainer().find(".card-footer").show().find(".add-btn").hide(),this.getContainer().find(".card-footer .btn-edit-link").show(),this.loadScore();break;case 5:this.getContainer().find(".card-footer").hide()}2===t.type&&this.hideOthersBtn(),this.dom().find(".question-card-index").text(t.index||""),this.updateRemoveIcon()},hideOthersBtn:function(){this.getContainer().find(".card-footer .batch-add.others").hide()},updateAddBtnStatus:function(t){var e=null!=t.others?1:0,t=t.choices.length+e>=this.settings.maxItemNum,i=this.getContainer(),s=i.find(".card-footer .add-btn"),a=s.filter(".others"),i=i.find(".card-item-limit-note");t?(s.addClass("disabled"),i.show()):(s.removeClass("disabled"),i.hide()),e||t?a.addClass("disabled"):a.removeClass("disabled")},updateRemoveIcon:function(){var t=this.getContainer().find(".card-main-container .choice-item-container"),e=t.find(".btn-remove-item");t.length<=1?e.hide():e.show()},loadScore:function(){this.score||(this.getContainer().find(".card-main-container").empty().append("<div widget='score' id='"+this.domId+"_score'></div>"),this.score=new $.su.widgets.score({id:this.domId+"_score"}),this.score.render())},loadChoices:function(t,e){this._value.choices=this._value.choices||[],t=t||this._value.choices;var s=this._value.choiceEmptyText,i=this.dom(),a=this,n=i.find(".card-main-container");this._value.choices.length>t.length&&(this.choicesMap=[],n.find(".choice-item-container:not(.others)").remove());for(var o,r,d=0;d<t.length;d++)this.choicesMap[d]?this._value.choices[d]!==t[d]&&(this._value.choices[d]=t[d],this.choicesMap[d].widget.setValue(t[d])):(r="<div class='choice-item-container' data-key='"+(o=this.domId+"-"+$.su.randomId("choice"))+"'><span class='choice-type-icon'></span><div widget='textboxEditor' allow-blank='{false}' id='"+o+"' class='choice-item'></div><span class='btn-remove-item'></span></div>",n.find(".choice-item-container.others").length?n.find(".choice-item-container.others").before($(r)):n.append($(r)),this.choicesMap[d]={key:o,widget:new $.su.widgets.textboxEditor({id:i.find("#"+o)})},this.choicesMap[d].widget.render(),this.choicesMap[d].widget.setEmptyText(s),this.choicesMap[d].widget.setValue(t[d]),(s=>{a.choicesMap[s].widget.dom().on("ev_view_change",function(t,e){a.choicesMap[s].widget.setValue(e.value);var i=$.su.clone(a._value);i.choices[s]=e.value,a.valueChange(i)})})(d));null!=e?(null==this.other&&(o=this.domId+"-"+$.su.randomId("choice"),n.append("<div class='choice-item-container others' data-key='"+o+"'><span class='choice-type-icon'></span><div widget='textboxEditor' allow-blank='{false}' id='"+o+"' class='choice-item'></div><div class='choice-others-input'></div><span class='btn-remove-item'></span></div>"),this.other=new $.su.widgets.textboxEditor({id:i.find("#"+o)}),this.other.render(),this.other.dom().on("ev_view_change",function(t,e){a.other.setEmptyText(s),a.other.setValue(e.value);var i=$.su.clone(a._value);i.others=e.value,a.valueChange(i)})),this.other.setValue(e)):this.other&&(this.other._destroy(),this.other=null)},addChoice:function(t,e){t=Array.isArray(t)?t:[t];var i=$.su.clone(this._value);if(e){if(this._value.others)return;i.others=t[0]}else Array.prototype.push.apply(i.choices,t);this.cutChoices(i),this.valueChange(i)},cutChoices:function(t){var e=t.others?this.settings.maxItemNum-1:this.settings.maxItemNum;t.choices.splice(e)},removeChoice:function(t,e){this.dom().find(".card-main-container").find(".choice-item-container[data-key="+t+"]").remove();var i=$.su.clone(this._value);if(e)i.others=null,this.other._destroy(),this.other=null;else{for(var s=this.choicesMap.length-1;0<=s;s--)if(this.choicesMap[s].key===t){this.choicesMap.splice(s,1);break}i.choices.splice(s,1)}this.valueChange(i)},showBatchAddMsg:function(){var i=this;i.batchAddMsg||(i.dom().append($('<div class="batch-add-msg" widget="msg" type="prompt" yes-text="{OPERATION.APPLY}" id = "'+i.domId+'_batch-add-msg" msg-title="{FORM_AUTH.BATCH_ADD_ITEMS}" close-btn="{false}"><div widget="simpleDom" class="batch-add-note m-b-12">'+a.BATCH_ADD_TIP+'</div><div widget="textarea" class="u-label-none batch-add-textarea m-b-0" id="'+i.domId+'_batch-add-input"></div></div><div class="batch-add-confirm-msg" widget="msg" type="confirm" yes-text="{OPERATION.CONFIRM}" id = "'+i.domId+'_batch-add-confirm-msg" msg-title="{FORM_AUTH.BATCH_ADD_ITEMS}" close-btn="{false}" '+`msg="${a.BATCH_ADD_LIMIT_TIP.replace("%num",this.settings.maxItemNum)}">`+"</div>")),i.batchAddMsg=new $.su.widgets.msg({id:i.domId+"_batch-add-msg"}),i.batchAddMsg.render(),i.batchAddContent=new $.su.widgets.textarea({id:i.domId+"_batch-add-input"}),i.batchAddContent.render(),i.batchAddMsg.dom().on("ev_msg_ok",function(t,e){e.preventDefault();e=i.batchAddValidate();e.valid?(i.batchAddContent.setNormal(),i.batchAddConfirmMsg.show()):i.batchAddContent.setError(e.text)}).on("ev_msg_cancel",function(t){i.batchAddContent.setValue(null)}),i.batchAddConfirmMsg=new $.su.widgets.msg({id:i.domId+"_batch-add-confirm-msg"}),i.batchAddConfirmMsg.render(),i.batchAddConfirmMsg.dom().on("ev_msg_ok",function(t){i.batchAddMsg.close(),i.addChoice(i.batchAddContent.getValue().split("\n").filter(function(t){return""!==t}).map(function(t){return t.trim()})),i.batchAddContent.setValue(null)})),i.batchAddMsg.show()},batchAddValidate:function(){var t=(this.batchAddContent.getValue()||"").trim();if(!t)return{valid:!1,text:$.su.CHAR.VTYPETEXT.NOT_EMPTY};for(var e=0,i=(t=t.split("\n")).length;e<i;e++)if(2e3<$.su.len(t[e]))return{valid:!1,text:a.INPUT_MAX_LENGTH_ERR.replace("%num",2e3)};return{valid:!0}},showScoreEditMsg:function(){var s=this;if(s.editScoreMsg){for(e=1;e<=5;e++)s.scoreTextInput[e-1]&&s.scoreTextInput[e-1].setValue(s._value.scoreNotes[e-1]);var t=s.scoreInMsg.getValue();t&&s.editScoreMsg.dom().find("#"+s.domId+"_score-tips-content").text(s.scoreTextInput[t-1].getValue()||s.defaultScoreNotes[t-1])}else{s.dom().append($('<div class="edit-score-msg msg_s_lg" widget="msg" type="prompt" yes-text="{OPERATION.APPLY}" id = "'+s.domId+'_edit-score-msg" title-bar="{false}" close-btn="{false}"><div widget="simpleDom" class="scrore-in-msg-wrap"><div widget="score" class="score-in-msg" id="'+s.domId+'_score-in-msg"></div><div widget="simpleDom" class="score-tips-content" id="'+s.domId+'_score-tips-content"></div></div><div widget="tab" class="tab-in-score-msg" id="'+s.domId+'_tab-in-score-msg"><div class="tab-btn selected" data-name="1">'+a.POINT_1+'</div><div class="tab-btn" data-name="2">'+a.POINT_2+'</div><div class="tab-btn" data-name="3">'+a.POINT_3+'</div><div class="tab-btn" data-name="4">'+a.POINT_4+'</div><div class="tab-btn" data-name="5">'+a.POINT_5+'</div></div><div widget="simpleDom" class="score-tip-container"><div widget="textbox" data-point="1" label-field="{FORM_AUTH.POINT_TIP}" class="point-text-input u-label-block" id="'+s.domId+'_score-point-text-1"></div><div widget="textbox" data-point="2" label-field="{FORM_AUTH.POINT_TIP}" class="point-text-input u-label-block u-d-none" id="'+s.domId+'_score-point-text-2"></div><div widget="textbox" data-point="3" label-field="{FORM_AUTH.POINT_TIP}" class="point-text-input u-label-block u-d-none" id="'+s.domId+'_score-point-text-3"></div><div widget="textbox" data-point="4" label-field="{FORM_AUTH.POINT_TIP}" class="point-text-input u-label-block u-d-none" id="'+s.domId+'_score-point-text-4"></div><div widget="textbox" data-point="5" label-field="{FORM_AUTH.POINT_TIP}" class="point-text-input u-label-block u-d-none" id="'+s.domId+'_score-point-text-5"></div></div></div></div>')),s.editScoreMsg=new $.su.widgets.msg({id:s.domId+"_edit-score-msg"}),s.editScoreMsg.render(),s.scoreInMsg=new $.su.widgets.score({id:s.domId+"_score-in-msg"}),s.scoreInMsg.render(),s.scoreInMsg.loadScoreComment(),s.scoreInMsg.dom().on("ev_view_change",function(t,e){s.editScoreMsg.dom().find("#"+s.domId+"_score-tips-content").text(s.scoreTextInput[e.value-1].getValue()||s.defaultScoreNotes[e.value-1])}),s.scoreTab=new $.su.widgets.tab({id:s.domId+"_tab-in-score-msg"}),s.scoreTab.render(),s.scoreTab.dom().on("ev_tab_select",function(t,i){s.scoreTextInput.forEach(function(t,e){e===i-1?t.show():t.hide()})});for(var e=1;e<=5;e++)s.scoreTextInput[e-1]=new $.su.widgets.textbox({id:s.domId+"_score-point-text-"+e}),s.scoreTextInput[e-1].render(),s.scoreTextInput[e-1].setMaxLength(2e3),s.scoreTextInput[e-1].setValue(s._value.scoreNotes[e-1]||s.defaultScoreNotes[e-1]),s.scoreTextInput[e-1].dom().on("ev_view_change",function(t,e){s.scoreInMsg.getValue()==$(t.target).data("point")&&s.editScoreMsg.dom().find("#"+s.domId+"_score-tips-content").text(e.value||s.defaultScoreNotes[s.scoreInMsg.getValue()-1])});s.editScoreMsg.dom().on("ev_msg_ok",function(t){for(var e=$.su.clone(s._value),i=1;i<=5;i++)e.scoreNotes[i-1]=s.scoreTextInput[i-1].getValue();s.valueChange(e),s.editScoreMsg.close()}).on("ev_msg_cancel",function(t){s.editScoreMsg.close()})}s.editScoreMsg.show()},validate:function(){if(!this.titleInput.validate())return!1;for(var t=this.choicesMap,e=0;e<t.length;e++)if(!t[e].widget.validate())return!1;return!(null!=this.other&&!this.other.validate())},valueChange:function(t){this.dom().triggerHandler("ev_view_change",[{value:t,type:"value"}])}})})(jQuery),jQuery,$.su.Widget.register("textboxEditor",{settings:{emptyText:{attribute:"empty-text",defaultValue:$.su.CHAR.FORM_AUTH.PLEASE_INPUT},allowBlank:{attribute:"allow-blank",defaultValue:!0}},listeners:[{selector:".title-text-container",event:"click",callback:function(t,e){t.preventDefault(),e.status=0,e.textbox.dom().fadeIn(200),e.textbox.dom().find(".text-wrap-inner input").click().focus(),e.dom().find(".title-text-container").hide(),e.dom().triggerHandler("ev_view_change",[{"type":"valid","value":e.textbox.getValue()}])}},{selector:".text-wrap-inner input.text",event:"blur",callback:function(t,e){e.validate()}}],init:function(){this.status=1,this.value=null,this.emptyText=this.settings.emptyText,this.allowBlank=this.settings.allowBlank},render:function(){var i=this,t=this.dom(),e=this.settings,s=!1===e.labelField?"label-empty":"",s=(t.addClass(e.cls+"text-editor-container "+s),"");e.labelField&&(s=(s+='<div class="widget-fieldlabel-wrap '+e.labelCls+'">')+'<label class="widget-fieldlabel text-fieldlabel">'+$.su.escapeHtml(e.labelField)+"</label>",e.labelField&&(s+='<span class="widget-separator">'+e.separator+"</span>"),s+="</div>"),s=(s=(s+='<div class="widget-wrap-outer text-editor-wrap-outer">')+'<div class="widget-wrap text-editor-wrap hover-errortip"><div widget="textbox" id="'+this.domId+'-textbox" class="u-label-none u-d-none m-b-0"></div><div class="title-text-container"><span class="text"></span></div></div>')+'<div widget="errortip" error-cls="'+e.errorTipsCls+'"></div></div>',e.tipText&&(s+='<div widget="toolTip"></div>',t.addClass("has-tool-tip")),t.empty().append(s),this.textbox=new $.su.widgets.textbox({id:t.find('div[widget="textbox"]')}),this.textbox.render(),this.textbox.setMaxLength(2e3),this.textbox.dom().on("ev_view_change",function(t,e){i.dom().triggerHandler("ev_view_change",e)}).on("ev_textbox_blur",function(){i.status=1,i.textbox.dom().hide(),i.dom().find(".title-text-container").fadeIn(200)})},setValue:function(t){this.value=t,this.textbox.setValue(t),this.dom().find(".title-text-container span.text").text(t||this.emptyText)},setEmptyText:function(t){this.emptyText=t},validate:function(){var t;return!!this.allowBlank||""!==(t=this.textbox.getValue())&&null!=t&&(this.dom().find(".title-text-container").removeClass("error"),!!/^[^+@=\-]/.test(t))||(this.dom().find(".title-text-container").addClass("error"),!1)}}),(()=>{var a="http://www.w3.org/2000/svg",n=["xmlns:xlink","xlink:href"],o=["CLIPPATH"],r="svgPosition",i="svgViewBox",d="currentStatus",l=1,c=2,h=3,g="M",u="L",p="H",m="V",f="Z",v=/^[a-z]$/,e=/([astvzqmhlc])([^astvzqmhlc]*)/gi,b=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi,x={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},w="line",y="path",C="polygon",_="rect",I={"height":10,"width":10,"fill":"#00A870","stroke":"#00A870","stroke-width":5,"opacity":.4},k="stroke-dasharray",s="svg-cal-wrapper";function T(i,s){var e,t=$(i)[0].attributes;$.each(t,function(t,e){-1===n.indexOf(e.name)&&$(s).attr(e.name,$(i).attr(e.name))}),t=s,e=$(i).attr("id"),$(t).find("[id]").each(function(){var t=$(this)[0].tagName.toUpperCase();t&&-1===o.indexOf(t)&&$(this).attr("id",$(this).attr("id")+"_"+e)}),s=t,$(i).replaceWith($(s))}function S(t,e){var i=$(document.createElementNS(a,"circle"));return i.attr({cx:t.x,cy:t.y,r:e}),i}function P(t,e,i,s){var a={},n={};return a.x=Number(t),a.y=Number(e),n.x=a.x+Number(i),n.y=a.y+Number(s),{start:a,end:n}}function A(t,e){return $.su.getFloat(t,e)}function R(t,e){var i={},s={};switch($.type(t)){case"array":i.x=t[0],i.y=t[1],s.x=e[0],s.y=e[1];break;case"object":i=$.su.clone(t),s=$.su.clone(e)}return{start:{x:Number(i.x),y:Number(i.y)},end:{x:Number(s.x),y:Number(s.y)}}}function E(t,e){return A(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)))}function M(t){return'[id="'+t+'"]'}$.su.Widget.register("svg",{init:function(){this.svgDom=null,this.globalInfo={},this.setGlobalInfo(d,l),this.layerMap={}},destroy:function(){this.clearDom()},clearDom:function(){var t=this.dom();t.off(".cadEvt"),this.unbindMoveEvent(),this.unbindClipEvent(),t.empty()},render:function(t){this.dom().addClass(this.settings.cls+"svg-container")},renderImg:function(t){return this.init(),this.dom().empty().attr("visibility","hidden").html(t),this.svgDom=this.dom().find("svg"),this.dom().empty().removeAttr("visibility"),this.initViewbox(),this.initEvent(),this.parseUseEle(),this.initLayerMap(),this.initStyles(),this.dom().empty().append(this.svgDom),$.Deferred().resolve(this.getLayers())},initViewbox:function(){var t=this.svgDom[0].viewBox.baseVal;this.setGlobalInfo(i,{x:t.x,y:t.y,width:t.width,height:t.height})},getSvgViewbox:function(){return this.getSvgDom().viewBox.baseVal},setSvgViewbox:function(t){var i=this.getSvgViewbox();$.each(t,function(t,e){i[t]=e})},initEvent:function(){var t=this.dom(),i=this;t.on("contextmenu.cadEvt",function(){return!1}),t.on("selectstart.cadEvt",function(){return!1}),t.on("mousedown.cadEvt",function(t){var e=$(t.target).closest("svg");if(0<e.length&&0===t.button)switch(i.getGlobalInfo(d)){case l:i.bindMoveEvent(t);break;case h:i.clipRect(t)}}),t.on("mousemove.cadEvt",function(t){0<$(t.target).closest("svg").length&&i.changeDomStyle(t)}),t.on("mousewheel.cadEvt DOMMouseScroll.cadEvt",function(t){0<$(t.target).closest("svg").length&&((t=t.originalEvent).wheelDelta&&0<t.wheelDelta||t.detail&&t.detail<0?i.zoom(1.5,{x:t.clientX,y:t.clientY}):i.zoom(.5,{x:t.clientX,y:t.clientY}))})},bindMoveEvent:function(t){var e=this,i=this.dom();this.setGlobalInfo(r,{x:t.clientX,y:t.clientY}),this.setGlobalInfo(d,c),i.on("mousemove.cadDrag",function(t){0===t.button&&e.move(t)}),i.on("mouseup.cadDrag",function(t){0===t.button&&(e.unbindMoveEvent(),e.setGlobalInfo(d,l))})},unbindMoveEvent:function(){this.dom().off(".cadDrag")},move:function(t){var e=this.getGlobalInfo(r),e=this.getSvgCoord(e.x,e.y),i=this.getSvgCoord(t.clientX,t.clientY),s=this.getSvgViewbox();s.x=s.x-(i.x-e.x),s.y=s.y-(i.y-e.y),this.setGlobalInfo(r,{x:t.clientX,y:t.clientY})},clipRect:function(t){var e,i;this.isInRect(t)||(t=this.getSvgCoord(t.clientX,t.clientY),this.createRect(t.x,t.y),i=(e=this).dom(),this.setGlobalInfo(r,{x:t.x,y:t.y}),i.on("mousemove.cadClip",function(t){0===t.button&&e.drawRect(t.clientX,t.clientY)}),i.on("mouseup.cadClip",function(t){0===t.button&&e.drawRectDone()}),i.find("svg").on("mouseleave.cadClip",function(t){e.changeDomStyle(t),e.getGlobalInfo(d)===h&&e.drawRectDone()}))},isInRect:function(t){return!!t&&0<$(t.target).closest(M(this.domId+"_rector")).length},createRect:function(t,e){var i,s;this.removeRect(),$(this.getSvgDom()).append((t=t,e=e,i=this.domId,(s=$(document.createElementNS(a,"rect"))).attr($.extend({x:t,y:e,id:i+"_rector"},I)),s))},drawRect:function(t,e){var t=this.getSvgCoord(t,e),e=this.getGlobalInfo(r),i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y),a=this.getRect();0<a.length&&(a.attr({"width":i,"height":s}),t.x<e.x&&a.attr("x",e.x-i),t.y<e.y)&&a.attr("y",e.y-s)},drawRectDone:function(){this.unbindClipEvent()},getRect:function(){return $(this.getSvgDom()).find(M(this.domId+"_rector"))},removeRect:function(){$(this.getSvgDom()).children("rect").remove()},unbindClipEvent:function(){var t=this.dom();t.off(".cadClip"),t.find("svg").off(".cadClip")},getSvgCoord:function(t,e){var i=this.getSvgDom(),s=i.getScreenCTM().inverse(),i=i.createSVGPoint();return i.x=t,i.y=e,i.matrixTransform(s)},getSvgEleCoord:function(t){var e=this.getSvgDom(),i=e.getCTM(),e=e.createSVGPoint(),t=(e.x=t.x,e.y=t.y,e.matrixTransform(i));return{x:A(t.x),y:A(t.y)}},getActualCoord:function(t){var e=t.closest("svg").offset(),t=t.offset();return{x:t.left-e.left,y:t.top-e.top}},getSvgDom:function(){return this.dom().children("svg")[0]},reset:function(){this.setSvgViewbox(this.getGlobalInfo(i))},zoom:function(t,e){var i,t=1<t?(i=.2,.8):(i=-.2,1.2),s=this.getSvgViewbox(),e=(e=e||this.getSvgCenterPoint(),this.getSvgCoord(e.x,e.y));this.setSvgViewbox({x:s.x*t+i*e.x,y:s.y*t+i*e.y,width:s.width*t,height:s.height*t})},getSvgCenterPoint:function(){var t=this.getSvgDom().getBoundingClientRect();return{x:t.left+(t.right-t.left)/2,y:t.top+(t.bottom-t.top)/2}},startClip:function(){this.setGlobalInfo(d,h)},stopClip:function(){this.setGlobalInfo(d,l)},clearClip:function(){this.stopClip(),this.removeRect()},parseUseEle:function(){this.initDefsMap(),this.transferUseEle(),this.removeDefs()},initDefsMap:function(){var i=this;this.setDefsEle(),this.svgDom.find("defs").each(function(t,e){$(e).children("[id]").each(function(t,e){i.setDefsEle(e)})})},setDefsEle:function(t){t?this.defs[$(t).attr("id")]=$(t):this.defs={}},getDefsEle:function(t){return this.defs[t].clone()},transferUseEle:function(){for(;0<this.svgDom.find("use").length;)this.replaceUseEleByDefs(this.svgDom.find("use").eq(0))},replaceUseEleByDefs:function(t){var e=$(t).attr("xlink:href").slice(1);T(t,this.getDefsEle(e))},removeDefs:function(){this.svgDom.find("defs").remove(),this.setDefsEle()},initLayerMap:function(){var i=this;this.layerMap={},this.getLayerWrapper().children("g[id]").each(function(t,e){i.setLayerMap(e)})},getLayerWrapper:function(){return this.svgDom.children("g[id=draft]")},setLayerMap:function(t){this.layerMap[$(t).attr("id")]={obstacleId:!1,dom:$(t),color:this.getLayerInitColor(t)}},getLayerInitColor:function(t){var e=$(t).attr("stroke");return-1===e.indexOf("currentColor")?e:$(t).attr("color")},getLayerInfo:function(t){return t?(t="object"===$.type(t)?$(t).attr("id"):t,this.layerMap[t]||{}):$.su.clone(this.layerMap)},setLayerInfo:function(i,t){var s;this.layerMap[i]&&(s=this,$.each(t,function(t,e){s.layerMap[i][t]=e}))},getLayers:function(){var t=this.getLayerInfo(),i={};return $.each(t,function(t,e){i[t]={color:e.color}}),i},initStyles:function(){this.changeDomStyle()},changeDomStyle:function(t){var e=this.getGlobalInfo(d),i=$(this.getSvgDom()),s="";switch(e){case l:s="grab";break;case c:s="grabbing";break;case h:s=this.isInRect(t)?"default":"crosshair"}i.css("cursor",s)},setGlobalInfo:function(t,e){t&&(this.globalInfo[t]=e)},getGlobalInfo:function(t){return this.globalInfo[t]||null},toggleLayers:function(t){var i=this;$.each(t,function(t,e){t=i.getLayerDom(t);e?t.removeAttr("visibility"):t.attr("visibility","hidden")})},getLayerDom:function(t){return this.getLayerInfo(t).dom&&this.dom().find(M(t))},toggLayerObstacle:function(t){var n=this;$.each(t,function(t,e){var i,s=n.getLayerDom(t),a=n.getLayerInfo(t),a=e.reset?(i=a.color,!1):(i=e.color,e.obstacleId);s.attr("color",i),n.setLayerInfo(t,{"obstacleId":a})})},parse:function(){this.reset();var t=this.getSvgScaleRate(),e=(this.renderCalDom(t),this.getSvgSize()),i=this.parseLayers(),s=(this.clearCalDom(),this.getSvgHtml());return $.Deferred().resolve({svg:s,size:e,scaleRate:t,walls:i})},renderCalDom:function(t){var e=$(this.getSvgDom()).clone(),i=(e.find("[id]").each(function(){var t=$(this).attr("id");$(this).attr("id",t+"_cal")}),$('<div class="'+s+'"></div>')),e=(i.append(e),this.getSvgSize());i.css({width:e.width*t,height:e.height*t,position:"absolute",top:0,left:0,zIndex:-99}),this.clearCalDom(),this.dom().append(i)},clearCalDom:function(){this.dom().children("."+s).remove()},getSvgHtml:function(){return this.clearSvgStyle(),$.su.decodeHtml(this.dom().html())},clearSvgStyle:function(){$(this.getSvgDom()).css("cursor","")},getSvgSize:function(){var t=this.getSvgDom().getBoundingClientRect();return{width:A(t.width),height:A(t.height)}},getSvgScaleRate:function(){var t=this.getSvgSize(),t=Math.max(t.width,t.height);return 1e4<t?1e4/t:1},getRange:function(){var t=this.getRect(),e=null;return e=0<t.length?P(t.attr("x"),t.attr("y"),t.attr("width"),t.attr("height")):P((t=this.getGlobalInfo(i)).x,t.y,t.width,t.height),{start:this.getSvgEleCoord(e.start),end:this.getSvgEleCoord(e.end)}},parseLayers:function(){var t=this.getLayerInfo(),i=this,s=[];return $.each(t,function(t,e){e.obstacleId&&(t=i.parseLayer(t,e),s.push(t))}),this.serializeLines(s)},serializeLines:function(t){var s=[];return $.each(t,function(t,e){var i=e.obstacleId;$.each(e.lines,function(t,e){s.push({obstacleId:i,start:{x:A(e.start.x),y:A(e.start.y)},end:{x:A(e.end.x),y:A(e.end.y)}})})}),s},parseLayer:function(t,e){var i,s,t=this.dom().find(M(t+"_cal"));return 0<t.length&&(i=[],s=this,t.find("*").each(function(){var t=[];switch($(this)[0].tagName){case w:t=s.parseLine($(this));break;case y:t=s.parsePath($(this));break;case C:t=s.parsePolygon($(this));break;case _:t=s.parseRect($(this))}t=s.getActualLines(t,$(this)),$.merge(i,t)})),{lines:i,obstacleId:e.obstacleId}},parseLine:function(t){return[R({x:(t=$(t)).attr("x1"),y:t.attr("y1")},{x:t.attr("x2"),y:t.attr("y2")})]},parsePath:function(t){var i,s,a,n,t=$(t).attr("d"),o=[],t=(n=[],t.replace(e,function(t,e,i){var s=e.toLowerCase();for(i=(t=>(t=t.match(b))?t.map(Number):[])(i),"m"==s&&2<i.length&&(n.push([e].concat(i.splice(0,2))),s="l",e="m"==e?"l":"L");;){if(i.length==x[s])return i.unshift(e),n.push(i);if(i.length<x[s])throw new Error("malformed path data");n.push([e].concat(i.splice(0,x[s])))}}),n);return $.each(t,function(t,e){switch(a=(o[t-1]||{start:{x:0,y:0},end:{x:0,y:0}}).end,s=((t,e)=>v.test(t)?$.su.clone(e):{x:0,y:0})(e[0],a),e[0].toUpperCase()){case g:i={end:{x:s.x+e[1],y:s.y+e[2]}};break;case u:i={start:$.su.clone(a),end:{x:s.x+e[1],y:s.y+e[2]}};break;case p:i={start:$.su.clone(a),end:{x:s.x+e[1],y:a.y}};break;case m:i={start:$.su.clone(a),end:{x:a.x,y:s.y+e[1]}};break;case f:i={start:$.su.clone(a),end:(t=>{for(var e=(t=$.su.clone(t)).length-1;0<=e;e--)if(!t[e].start)return $.su.clone(t[e].end);return $.su.clone(t[0].end)})(o)};break;default:return!(o=[])}o.push(i)}),$.map(o,function(t){return t.start&&t.end?R(t.start,t.end):null})},parsePolygon:function(t){t=$(t);for(var e=$.map(t.attr("points").split(/\s/),function(t){if(t=t.trim())return[$.map(t.split(","),Number)]}),i=[],s=0,a=e.length-1;s<a;s++)e[s]&&e[s+1]&&i.push(R(e[s],e[s+1]));return s===a&&i.push(R(e[a],e[0])),i},parseRect:function(t){var t=P((t=$(t)).attr("x"),t.attr("y"),t.attr("width"),t.attr("height")),e=t.start,t=t.end,i={x:e.x+t.x,y:e.y},s={x:e.x,y:e.y+t.y};return[R(e,i),R(i,s),R(s,t),R(t,e)]},parseDasharray:function(t,e){var i,s=(e.attr(k)||e.closest("["+k+"]").attr(k)||"").trim();return s?(s=$.map(s.split(","),Number),i=[],$.each(t,function(t,e){$.merge(i,((t,e)=>{for(var i=E(t.start,t.end),s=0,a=0,n=e.length,o=[t.start];s<i;)s+=e[a],o.push(((t,e,i)=>{i=i||E(e.start,e.end);var s=t*(e.end.x-e.start.x)/i+e.start.x,t=t*(e.end.y-e.start.y)/i+e.start.y;return{x:A(s),y:A(t)}})(s,t,i)),a=(a+1)%n;o.push(t.end);for(var r=[],d=1,l=o.length;d<l;d+=2)r.push({start:$.su.clone(o[d-1]),end:$.su.clone(o[d])});return r})(e,s))}),i):t},getActualLines:function(t,i){var s=this,a=[],e=this.getSvgSize(),n=1/Math.max(e.width,e.height,1e4);return $.each(t,function(t,e){a.push(s.getActualLine(e,i,n))}),a},getActualLine:function(t,e,i){var s={};return e.before(S(t.start,i)),s.start=this.getActualCoord(e.prev()),e.before(S(t.end,i)),s.end=this.getActualCoord(e.prev()),s}})})(),(()=>{var e=[{name:$.su.CHAR.STATISTICS.MINUTES_5,value:0,selected:!0},{name:$.su.CHAR.STATISTICS.HOURLY,value:1},{name:$.su.CHAR.STATISTICS.DAILY,value:2}],r="%header%";$.su.Widget.register("chartCard",{settings:{title:{attribute:"title-text",defaultValue:""},time:{attribute:"time",defaultValue:!1},tipText:{attribute:"tip-text",defaultValue:""}},init:function(){$.su.serviceManager.get("license").isLite()&&(e[0].name=$.su.CHAR.STATISTICS.MINUTES_10),this.timeCombo=null},render:function(t){var i=this,e=this.dom(),s=this.settings,a=(s.title=this.settings.configs&&this.settings.configs.title||this.settings.title,e.addClass(s.cls+"chart-card-container"),""),n=(a=(a=(a=(a+='<div class="card-wrap">')+'<div class="card-header">'+r)+"</div>"+'<div class="card-body">')+"</div>"+"</div>",""),o=e.children(".chart-item");$.each(o,function(t,e){s.title||(n+=i.getItemHeaderHtml(e,t)),$(e).addClass("card-item-"+t)}),s.title&&(n+=i.getHeaderHtml(s.title,s.time)),a=a.replace(r,n),e.append(a),e.find(".card-body").append(o),this.settings.tipText&&new $.su.widgets.toolTip({id:this.dom().find(".card-title").children("div[widget=toolTip]").not(".tooltip-container"),tipText:this.settings.tipText}).render(),i.initTimeCombo(),i.initTab()},getHeaderHtml:function(t,e,i){var s=(s='<div class="card-title-outer '+($.isNumeric(i)?"card-title-"+i:"")+'">')+'<div class="card-title">'+("<span>"+t+"</span>");if(this.settings.tipText&&(s+='<div widget="toolTip"></div>'),s=s+"</div>"+'<div class="card-title-tools">',e&&(s+='<div id="'+this.domId+'_time" widget="combobox" class="chart-time u-label-none u-d-inline-block combobox_m m-b-0"></div>'),this.settings.configs&&this.settings.configs.tab){var a=this.settings.configs.tab;s+='<div id="'+this.domId+'_tab" widget="tab" class="chart-tab u-label-none u-d-inline-block m-b-0">';for(let t=0;t<a.opts.length;t++){var n=a.opts[t];s+='<div class="tab-btn" data-name="'+n.value+'">'+$.su.escapeHtml(n.text)+"</div>"}s+="</div>"}return s=s+"</div>"+"</div>"},getItemHeaderHtml:function(t,e){var i=(i=$(t).attr("title-text")||"")&&$.su.getAttrObject($.su.CHAR,i);return this.getHeaderHtml(i,!!$(t).attr("time"),e)},initTimeCombo:function(){var i=this,s=this.dom(),t=s.find(".chart-time");0<t.length&&(i.timeCombo=new $.su.widgets.combobox({id:t.attr("id")}),i.timeCombo.render(),i.timeCombo.loadItems(e),i.timeCombo.dom().on("ev_view_change",function(t,e){i.timeCombo.setValue(e.value),s.triggerHandler("ev_time_change",[e.value])}))},initTab:function(){var i=this.dom(),t=i.find(".chart-tab");0<t.length&&(this.tab=new $.su.widgets.tab({id:t.attr("id")}),this.tab.render(),this.tab.dom().on("ev_tab_select",function(t,e){i.triggerHandler("ev_tab_change",[e])}))},setLegend:function(t){var i='<div class="chart-legend">';$.each(t,function(t,e){i=(i=(i+='<div class="legend-item" data-index="'+t+'">')+'<span class="point" style="background:'+e.color+';"></span>')+'<span class="text">'+e.text+"</span></div>"}),i+="</div>",this.dom().find(".chart-legend").remove(),this.dom().find(".card-title-tools").prepend(i),this.bindSelectEvent()},bindSelectEvent:function(){var t=this;this.dom().find(".card-title-tools .legend-item").on("click",function(){$(this).toggleClass("selected"),t.toggleSelectStatus($(this))})},toggleSelectStatus:function(t){var e=this.dom().find(".line-chart-container").data("viewObj").getChartInstance(),i=t.hasClass("selected")?"legendUnSelect":"legendSelect";e.dispatchAction({type:i,name:"item"+(+t.attr("data-index")+1)})},getGranularity:function(){return this.timeCombo&&this.timeCombo.getValue()},getChildWidget:function(t){t=this.dom().find('.chart-item [widget="'+t+'"]');return 0<t.length?t.data().viewObj:null},getTimeCombo:function(){return this.timeCombo},getTab:function(){return this.tab}})})(),$.su.Widget.register("lineChart",{settings:{timeZoneType:{attribute:"time-zone-type",defaultValue:"site"}},init:function(){this.fields=[],this.formatter=this.settings.configs&&this.settings.configs.formatter||function(t){return t},this.colors=this.settings.configs&&this.settings.configs.itemColor||[$.getUIColor("--s-color-blue-10"),$.getUIColor("--s-color-blue-20"),$.getUIColor("--s-color-blue-30"),$.getUIColor("--s-color-blue-40"),$.getUIColor("--s-color-blue-50"),$.getUIColor("--s-color-blue-60")],this.labels=this.settings.configs&&this.settings.configs.labels},render:function(t){var e=$.Deferred(),i=this.dom();return i.addClass(this.settings.cls+"line-chart-container"),i.append('<div widget="echart" id="'+this.domId+'_line_chart" type="line" width="410" height="280" class="m-b-0"></div>'),this.chart=new $.su.widgets.echart({id:this.domId+"_line_chart"}),this.chart.render().then(e.resolve),e},loadItems:function(t){if("array"===$.type(t)&&0<t.length){this.chartData=$.su.clone(t),this.updateFields();for(var e=t.length,i=$.su.clone(t),s=this.getInitailSeries(),a=0,n=[],t={},o=0;o<e;o++)i[o].time=1e3*i[o].time,n.push(i[o].time),a=this.getMaxNum(a,i[o]),this.updateSeries(s,i[o]);t.max=10*(Math.floor(a/10)+1),t.interval=t.max/5,this.setLine(n,t,s),this.yMax=t.max}else this.chart.getChartInstance()&&this.setLine([],{max:10,interval:2},[])},updateFields:function(){var e=/^item/;this.fields=Object.keys(this.chartData[0]).filter(function(t){return e.test(t)})},getInitailSeries:function(){var t=[];return $.each(this.fields,function(){t.push([])}),t},updateSeries:function(i,s){$.each(this.fields,function(t,e){i[t].push({name:s.time,value:s[e]})})},getMaxNum:function(i,s){return $.each(this.fields,function(t,e){$.isNumeric(s[e])&&(i=Math.max(i,s[e]))}),i},setLine:function(t,e,i,s){var a=this.getDefaultSettings(e),n=$.extend({},a);n.xAxis[0].data=t,e&&(n.yAxis[0].max=e.max,n.yAxis[0].interval=e.interval),$.each(this.fields,function(t,e){n.series[t].data=i[t]}),this.chart.clear(),this.chart.setOption(n),this._options=n},getOptions:function(){return this._options},getDefaultSettings:function(n){var o=this,r=this.settings.timeZoneType,{backgroundColor:t,textColor:e}=$.su.moduleManager.get("main").getEchartTooltipColor();return{legend:{show:!1,data:o.fields},tooltip:{show:!0,padding:10,trigger:"axis",axisPointer:{lineStyle:{color:$.appUtils.useDarkTheme.getTooltip().axisPointerLineColor,width:$.appUtils.useDarkTheme.getTooltip().axisPinterLineWidth}},backgroundColor:t,textStyle:{color:e,fontSize:13},extraCssText:"box-shadow: 0 0 4px 0 var(--s-color-tooltips-chart-shadow), 0 4px 4px 0 var(--s-color-tooltips-chart-shadow);",formatter:function(t){for(var e=!1,i='<table style="border-collapse:collapse;background: var(--s-color-tooltips-chart-background);"><tr style="font-size: 16px;"><td style="border-bottom: 1px solid;padding:5px 0;">'+$.su.serviceManager.get("time").getTextFromUTC(+t[0].name,r,{pattern:"MM dd, yyyy"})+'&nbsp</td><td style="text-align:'+($.su.language.isRtl()?"left":"right")+";border-bottom: 1px solid;padding:"+($.su.language.isRtl()?"5px 15px 5px 0px":"5px 0px 5px 15px")+';">'+$.su.serviceManager.get("time").getTextFromUTC(+t[0].name,r,{pattern:"hh:mm hc"})+"</td></tr>",s=0,a=t.length;s<a;s++)$.isNumeric(t[s].value)&&(e=!0,i+='<tr style="font-size: 14px;"><td style="padding:5px 0;"><div style="margin-'+($.su.language.isRtl()?"left":"right")+": 4px;width: 8px;height: 8px;border-radius: 4px;background-color:"+t[s].color+';display: inline-block"></div>'+o.labels[t[s].seriesName]+'</td><td style="text-align:'+($.su.language.isRtl()?'left; padding: 5px 15px 5px 0px;">':'right; padding: 5px 0px 5px 15px;">')+o.formatter(t[s].value,n.max)+"</td></tr>");return i+="</table>",e?i:""}},color:this.colors,grid:{left:100,top:15,bottom:30},xAxis:[{type:"category",inverse:!!$.su.language.isRtl(),boundaryGap:!1,axisLine:{lineStyle:{color:"rgb(172, 172, 172)",type:"solid"}},axisTick:{show:!1},splitLine:{show:!0,lineStyle:{type:"solid"}},axisLabel:{color:"rgb(172, 172, 172)",margin:10,showMaxLabel:!0,showMinLabel:!0,formatter:function(t,e){return $.su.serviceManager.get("time").getTextFromUTC(+t,r,{pattern:"MM dd, yyyy hh:mm:ss hc"})}}}],yAxis:[{nameLocation:"end",nameTextStyle:{fontSize:15},type:"value",position:$.su.language.isRtl()?"right":"left",min:0,max:10,interval:2,splitNumber:5,axisLine:{lineStyle:{color:"rgb(172, 172, 172)",type:"solid"}},axisTick:{show:!1},splitLine:{lineStyle:{type:"solid"}},axisLabel:{color:"rgb(172, 172, 172)",margin:10,formatter:function(t){return o.formatter(t,n.max)}}}],series:this.getSeriesStyle()}},getSeriesStyle:function(){var i=[];return $.each(this.fields,function(t,e){i.push({animation:!$.su.isIe,name:e,type:"line",symbol:"circle",symbolSize:5,smooth:!0})}),i},getLegend:function(){var i=this,s=[];return $.each(this.fields,function(t,e){i.labels[e]&&s.push({color:i.colors[t],text:i.labels[e]})}),s},getChartInstance:function(){return this.chart.getChartInstance()},setLabel:function(t){this.labels=t}}),$.su.Widget.register("pieChart",{settings:{scale:{attribute:"scale",defaultValue:240},tooltipPosition:{attribute:"tooltip-position",defaultValue:$.su.language.isRtl()?"left":"right"}},init:function(){this.formatter=this.settings.configs&&this.settings.configs.formatter||function(t){return t},this.totalFormater=this.settings.configs&&this.settings.configs.totalFormater||this.formatter,this.colors=this.settings.configs&&this.settings.configs.itemColor||[$.getUIColor("--s-color-chart-deep-green"),$.getUIColor("--s-color-chart-mint-green"),$.getUIColor("--s-color-chart-yellow-green"),$.getUIColor("--s-color-chart-purple"),$.getUIColor("--s-color-chart-magenta"),$.getUIColor("--s-color-chart-tawny")],this.radius=this.settings.configs&&this.settings.configs.radius||["65%","100%"],this.settings.configs&&this.settings.configs.tooltipPosition&&(this.settings.tooltipPosition=this.settings.configs.tooltipPosition),this.clickedIndex=null},destroy:function(){this.clickedIndex=null,this.unbindLegendEvent(),this.unbindClickEvent()},render:function(t){var e=$.Deferred(),i=this.dom(),s=this,a=this.settings.scale,n=(i.addClass(this.settings.cls+"pie-chart-container"),'<div class="pie-chart-content u-d-none">'),n=(n=(n=(n+='<div widget="echart" id="'+this.domId+'_pie_chart" type="pie" width="'+a+'" height="'+a+'"></div>')+'<div class="pie-info-outer"></div>'+"</div>")+'<div class="empty-chart-content u-d-none">'+'<div class="empty-icon"></div>')+('<div class="text">'+$.su.CHAR.COMMON.NO_DATA+"</div>");return i.append($(n+="</div>")),this.chart=new $.su.widgets.echart({id:this.domId+"_pie_chart"}),this.chart.render().then(function(){e.resolve(),s.bindClickEvent()}),e},setValue:function(i){var s;this.isEmptyChart(i)?this.hideChart():(this.showChart(),this.chartData=$.su.clone(i),this.updateFields(),this.updateItemLabels(),s=[],$.each(this.fields,function(t,e){s.push({name:t+""+i[e].text,value:i[e].value})}),this.setPie(s),this.updateLegend())},isEmptyChart:function(t){if(!t)return!0;for(var e in t)if(t.hasOwnProperty(e)){e=t[e].value;if(null==e)return!0}return!1},showChart:function(){var t=this.dom();t.find(".pie-chart-content").show(),t.find(".empty-chart-content").hide()},hideChart:function(){var t=this.dom();t.find(".empty-chart-content").show(),t.find(".pie-chart-content").hide()},updateFields:function(){var e=/^item/;this.fields=Object.keys(this.chartData).filter(function(t){return e.test(t)})},updateItemLabels:function(){var e=this;this.labels=this.fields.map(function(t){return e.chartData[t].text})},setPie:function(t){var e=this.chartData,i=this.formatter,s=this,e={title:{text:this.totalFormater(e.total.value),textStyle:{fontSize:17,color:$.appUtils.getCurrentThemeIsDark()?"#ffffff":"#7d7e80"},subtext:$.su.breakStr(e.total.text,this.getMaxWidth(),"15px "+$.su.defaultFont),subtextStyle:{fontSize:15,color:"#868e93"},x:"center",y:"center"},tooltip:{position:s.settings.tooltipPosition,trigger:"item",transitionDuration:0,formatter:function(t){return`<table style="border-collapse:collapse;table-layout: auto;background:${$.appUtils.useDarkTheme.getTooltip().bgColor};">`+'<tr style="font-size: 14px;">'+`<td style="padding:5px;color:${$.appUtils.useDarkTheme.getTooltip().valueColor};">`+'<div class="pie-chart-tooltip-dot" style="background-color: '+t.color+'"></div>'+$.su.escapeHtml(s.labels[t.dataIndex])+'</div></td><td class="pie-chart-tooltip-text">'+i(t.value)+"</td></tr></table>"},textStyle:{color:$.appUtils.useDarkTheme.getTooltip().valueColor,fontSize:13},backgroundColor:$.appUtils.useDarkTheme.getTooltip().bgColor,extraCssText:`box-shadow: ${$.appUtils.useDarkTheme.getTooltip().shadowColor};`},color:this.colors,selectedMode:"single",emphasis:{itemStyle:{shadowBlur:3,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},series:{type:"pie",clockwise:!0,selectedOffset:0,hoverAnimation:!$.su.isIe,center:["50%","50%"],minAngle:4,radius:this.radius,minShowLabelAngle:10,label:{show:!1}}};e.series.data=t,this.chart.setPieOption(e),this._options=e},getOptions:function(){return this._options},updateLegend:function(){var i=this.chartData,t=this.dom(),s=this.colors,a=this.formatter,n='<div class="pie-info-content su-scroll">',o=this,r=this.fields.length-1,d=(o.total=0,this.chartData.total.value),e=($.each(this.fields,function(t,e){n=(n=(n=(n=(n=n+'<div class="info-item" data-index="'+t+'"><div class="info-label">')+'<span class="point" style="background: '+s[t]+';"></span><span class="text">')+$.su.ellipsisGridStr(i[e].text,105)+'</span></div><div class="info-text">')+a(i[e].value))+(0<d?" ("+o.getPercent(i[e].value,t===r)+")":"")+"</div></div>"}),n+="</div>",this.dom().find(".pie-info-outer").empty().append($(n)),t.find(".pie-info-content"));0===t.find(".ps__rail-y").length&&$.su.scrollbar({ele:e[0]}),this.bindLegendEvent()},getPercent:function(t,e){var i,s=this.chartData.total.value;return e?i=1e4-this.total:(i=+(t/s*100).toFixed(2).split(".").join(""),this.total+=i),i=((i+="").slice(0,-2)||"0")+"."+i.slice(-2)+($.su.language.isRtl()?"":"")+"%"},bindClickEvent:function(){var i=this;this.chart.getChartInstance().on("click",function(t){var e=$.su.getDefaultEvent(i,i.clickPie,t);i.dom().triggerHandler("ev_before_pie_click",[e.ev,t]),e.exe()})},clickPie:function(t){this.unsetHighlightStatus(),this.updateClickStatus(t.dataIndex),this.setHighlightStatus(t.dataIndex),this.dom().triggerHandler("ev_pie_click",[{index:t.dataIndex,value:t.value}])},updateClickStatus:function(t){this.clickedIndex=t;var e=this.dom().find(".info-item");e.filter(".active").removeClass("active"),e.filter('[data-index="'+t+'"]').addClass("active")},unbindClickEvent:function(){this.chart.getChartInstance().off("click")},bindLegendEvent:function(){var i=this,t=this.dom().find(".info-item");t.on("mouseenter",function(){i.setHighlightStatus(+$(this).attr("data-index"),!0)}).on("mouseleave",function(){i.unsetHighlightStatus(+$(this).attr("data-index"))}),t.on("click",function(){var t=+$(this).attr("data-index"),e=i.chartData["item"+(1+t)];e&&(t={dataIndex:t,value:e.value},e=$.su.getDefaultEvent(i,i.clickPie,t),i.dom().triggerHandler("ev_before_pie_click",[e.ev,t]),e.exe())})},unbindLegendEvent:function(){this.dom().find(".info-item").off()},setHighlightStatus:function(t,e){var i=this.chart.getChartInstance();i.dispatchAction({type:"highlight",seriesIndex:0,dataIndex:t}),e&&i.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:t})},unsetHighlightStatus:function(t){var e=this.chart.getChartInstance();this.clickedIndex!==t&&e.dispatchAction({type:"downplay",seriesIndex:0,dataIndex:t}),e.dispatchAction({type:"hideTip",seriesIndex:0,dataIndex:t})},setColors:function(t){this.colors=t},getMaxWidth:function(){var t=this.settings.scale,e=this.radius instanceof Array?this.radius[0]:this.radius;return"string"==typeof e&&(0<=e.indexOf("%")?e=t/2*Number(this.radius[0].replace(/%/g,""))/100:0<=e.indexOf("px")?e=Number(this.radius[0].replace(/px/g,"")):$.isNumeric(this.radius[0])&&(e=Number(this.radius[0]))),2*Math.pow(Math.pow(e,2)-Math.pow(23.5,2),.5)}}),(()=>{var e=["#0492eb","#6236FF","#61a0a8","#46c179"];$.su.Widget.register("radar",{settings:{width:{attribute:"width",defaultValue:"100%"},height:{attribute:"height",defaultValue:450},radius:{attribute:"radius",defaultValue:"75%"}},init:function(){this.initRadarInfos()},render:function(){var t=$.Deferred(),e=this.dom();return e.addClass(this.settings.cls+" radar-container"),e.append('<div widget="echart" id="'+this.domId+'_radar_chart" width="'+this.settings.width+'" height="'+this.settings.height+'"></div>'),this.chart=new $.su.widgets.echart({id:this.domId+"_radar_chart"}),this.chart.render().then(t.resolve),t},initRadarInfos:function(){var t=this.getFields();this.radarInfos={fields:t,fieldsText:this.getFieldsText(t),colors:this.getColors(),legends:this.getLegends(),indicator:this.getIndicator(t),formatter:this.settings.configs.formatter||function(t){return t}}},getFields:function(){var t=this.settings.configs,t=t&&t.content||{};return Object.keys(t)},getFieldsText:function(t){t=t||this.getFields();var i={},e=this.settings.configs,s=e&&e.content||{};return $.each(t,function(t,e){i[e]=s[e].text||""}),i},getColors:function(){var t=this.settings.configs;return t&&t.colors||e},getLegends:function(){var t=this.settings.configs;return t&&t.legendLabels||[]},getIndicator:function(t){t=t||this.getFields();var e=this.settings.configs,s=$.isNumeric(e.max)?e.max:100,a=e&&e.contents||{},n=[];return $.each(t,function(t,e){var i=a[e]&&a[e].max;n.push({name:e,max:$.isNumeric(i)?i:s})}),n},loadItems:function(t){t&&0<t.length&&(this.initRadarInfos(),this.updateRadarData(t),this.setOption())},updateRadarData:function(t){var s=[],a=this.radarInfos.legends,n=this.radarInfos.fields,o=n.length;$.each(t,function(t,e){var i=new Array(o);$.each(e,function(t,e){t=n.indexOf(t);-1!==t&&(i[t]=e)}),s.push({name:a[t],value:i})}),$.extend(!0,this.radarInfos,{data:s})},setOption:function(){var a=this.radarInfos||{},{backgroundColor:t,textColor:e}=$.su.moduleManager.get("main").getEchartTooltipColor();option={legend:{data:a.legends,align:$.su.language.isRtl()?"right":"left",bottom:0,textStyle:{color:"#868E93"}},tooltip:{position:function(t,e,i,s,a){var n=a.contentSize[1],t=t[1],a=a.viewSize[0];return[a=$.su.language.isRtl()?-a:a,t-n/2]},trigger:"item",padding:10,backgroundColor:t,textStyle:{color:e,fontSize:13},extraCssText:"box-shadow: 0 0 4px 0 var(--s-color-tooltips-chart-shadow), 0 4px 4px 0 var(--s-color-tooltips-chart-shadow);",formatter:function(i){var s='<table style="border-collapse:collapse;"><tr style="font-size: 16px;"><td style="border-bottom: 1px solid;padding:5px 0;">'+i.name+'</td><td style="border-bottom: 1px solid;">'+$.su.CHAR.HEALTH.SCORE+"</td></tr>";return $.each(a.fields,function(t,e){s+='<tr style="font-size: 14px;"><td style="radar-tooltip-name">'+a.fieldsText[e]+'</td><td class="radar-tooltip-value">'+a.formatter(i.value[t])+"</td></tr>"}),s+="</table>"}},color:a.colors,radar:{name:{formatter:function(t){return a.fieldsText[t].replace(/\s+/g,"\n")},color:"#ACACAC"},splitArea:{areaStyle:{color:"#FFFFFF",shadowColor:"rgba(0, 0, 0, 0.2)",shadowBlur:10}},splitLine:{lineStyle:{color:"#ACACAC"}},indicator:a.indicator,radius:this.settings.radius},series:[{type:"radar",symbol:"circle",lineStyle:{width:1},areaStyle:{normal:{opacity:.2}},data:a.data}]},this.chart&&this.chart.setOption(option)}})})(),(()=>{var a=[3.5,7.5],d=$.su.CHAR.HEALTH.HEALTH_SCORE,n=$.su.CHAR.GATEWAY_SETTINGS.INCIDENTS_AFFECT_HEALTH,o=0,r=1,l=2,c=3,e={},h=(e[o]=.3,e[r]=.3,e[l]=.3,e[c]=.3,67),g=67;$.su.Widget.register("lineScatter",{settings:{timeZoneType:{attribute:"time-zone-type",defaultValue:"site"},multiLine:{attribute:"multi-line",defaultValue:!1},width:{attribute:"width",defaultValue:"100%"},height:{attribute:"height",defaultValue:280},lineColor:{attribute:"line-color",defaultValue:$.getUIColor("--s-color-chart-single-type")},showSegment:{attribute:"show-segment",defaultValue:!1},showLineHeader:{attribute:"show-line-header",defaultValue:!1},hideScatter:{attribute:"hide-scatter",defaultValue:!1},clickable:{attribute:"clickable",defaultValue:!1},showLegend:{attribute:"show-legend",defaultValue:!1},stack:{attribute:"stack",defaultValue:!1},healthScore:{attribute:"health-score",defaultValue:!1},notMerge:{attribute:"not-merge",defaultValue:!1}},init:function(){this._savedOption,this._dataIndexHighlight,this.resetOptionFunc=null,this._eventBound=!1},render:function(){var t=$.Deferred(),e=this.dom(),i=this.settings;return e.addClass(i.cls+"line-scatter-container"),e.append('<div widget="echart" id="'+this.domId+'_line_scatter" width="'+i.width+'" height="'+i.height+'" class="m-b-0"></div>'),this.chart=new $.su.widgets.echart({id:this.domId+"_line_scatter",settings:{dataset:i.multiLine}}),this.chart.render().then(t.resolve),t},setValue:function(t){t&&(this.settings.healthScore&&(t=this.formatHealthScore(t)),this.settings.multiLine?(t.dimensions.unshift("timeStamp"),this._setMultiLine(t)):this._setSingleLineScatter(t))},formatHealthScore:function(i){return $.each(i,function(t,e){e.lineData&&e.lineData.value===$.appUtils.HEALTH_NO_DATA_SCORE&&(i[t].lineData.value="noData")}),i},_setMultiLine:function(t){var e=t.dimensions,i=this.getDefaultSettings(e.length-1),i=(this.overrideSettings(i),$.extend({},i));i.dataset={dimensions:e,source:t.data},this.settings.notMerge&&(i.legend.data=i.dataset.dimensions),this.chart.setOption(i,this.settings.notMerge),this._savedOption=i},_setSingleLineScatter:function(t){var t=this._handleSingleLineScatterData(t),e=t.timeArray,i=t.lineData,t=t.scatterData,s=this.getDefaultSettings(1),s=(this.overrideSettings(s),$.extend({},s));s.series[0].data=i,s.series[1]&&(s.series[1].data=t),s.xAxis[0].data=e,s.xAxis[1].data=e,this.chart.setOption(s),this._savedOption=s},_handleSingleLineScatterData:function(t){return{timeArray:t.map(function(t){return t.timeStamp}),lineData:t.map(function(t){return t.lineData}),scatterData:t.map(function(t){return{value:e[t.status],status:t.status}})}},_timeFormatter:function(t){t=t.value||t;return $.su.serviceManager.get("time").getTextFromUTC(+t,this.settings.timeZoneType,{pattern:"MM dd, yyyy hh:mm hc"})},getDefaultSettings:function(t){this.settings.timeZoneType=$.su.serviceManager.get("user").isSiteView()?"site":"controller";var i=this.settings.timeZoneType,e=$.getUIColor("--s-color-chart-axis-line"),s={color:e},e={color:e,showMaxLabel:!0,showMinLabel:!0,margin:10,formatter:this._timeFormatter.bind(this)},a={color:$.appUtils.useDarkTheme.getTooltip().axisPointerLineColor,width:$.appUtils.useDarkTheme.getTooltip().axisPinterLineWidth},n={type:"line",symbol:"circle",symbolSize:5},t=new Array(t||0).toString().split(",").map(function(){return $.su.clone(n)}),{backgroundColor:o,textColor:r}=$.su.moduleManager.get("main").getEchartTooltipColor(),a={axisPointer:{link:[{xAxisIndex:"all"}],lineStyle:a},tooltip:{axisPointer:{lineStyle:a},backgroundColor:o,textStyle:{color:r,fontSize:13},extraCssText:"box-shadow: 0 0 4px 0 var(--s-color-tooltips-chart-shadow), 0 4px 4px 0 var(--s-color-tooltips-chart-shadow);"},color:[$.getUIColor("--s-color-theme-status-success"),$.getUIColor("--s-color-theme-status-remind"),$.getUIColor("--s-color-theme-status-error"),"#A5ABB4"],grid:[{left:h,right:g,top:"5%",height:"68%"},{left:h,right:g,top:"73%",height:"16%"}],xAxis:[{type:"category",gridIndex:0,axisLine:{lineStyle:s},axisTick:{show:!1},axisLabel:$.su.clone(e),splitLine:{show:!0},boundaryGap:!1},{type:"category",gridIndex:1,boundaryGap:!1,axisLine:{lineStyle:s},axisTick:{show:!1},axisLabel:$.su.clone(e)}],yAxis:[{type:"value",gridIndex:0,axisLine:{lineStyle:s},axisTick:{show:!1}},{type:"value",nameGap:-23,axisLine:{show:!1,lineStyle:s},splitLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},max:1,min:0,gridIndex:1}],series:t};return $.su.language.isRtl()&&(a.xAxis[0].inverse=!0,a.xAxis[1].inverse=!0,a.yAxis[0].position="right",a.yAxis[1].position="right"),this.settings.multiLine?a.tooltip.formatter=function(t){var e=t[0].name;return'<table style="border-collapse:collapse;">'+('<tr style="padding:5px 0;font-weight: bold;border-bottom: 1px solid rgba(189, 189, 189, 0.5)"><td>'+$.su.serviceManager.get("time").getTextFromUTC(+e,i,{pattern:"MM dd, yyyy hh:mm hc"})+"</td></tr>")+t.map(function(t,e){var i=t.value[t.dimensionNames[t.encode.y[0]]];return'<tr style="padding:5px 0;"><td><span class="tooltip-marker" style="background-color: '+t.color+'"></span>'+t.seriesName+' </td><td class="u-text-right">'+i+"</td></tr>"}).join("")+"</table>"}:n.name=d,a},overrideSettings:function(t){var e,i=this.settings,s=i.configs;-1!==i.lineColor.indexOf("--s-color")?t.color[0]=$.getUIColor(i.lineColor):t.color[0]=i.lineColor,i.showLineHeader&&(t.grid[0].top="15%",t.grid[0].height="58%",t.yAxis[0].name=d),i.showSegment&&(t.visualMap={seriesIndex:0,show:!1,top:50,right:10,pieces:[{gte:0,lte:a[0],color:$.getUIColor("--s-color-theme-status-error")},{gt:a[0],lte:a[1],color:$.getUIColor("--s-color-theme-status-remind")},{gt:a[1],lte:10,color:$.getUIColor("--s-color-theme-status-success")}],outOfRange:{color:"#999"}}),i.hideScatter||this.settings.multiLine?(t.grid[0].height="80%",t.grid[1].height=0,t.xAxis[1].show=!1):(t.xAxis[0].axisLabel.show=!1,t.yAxis[1].name=n,t.yAxis[1].nameTextStyle={align:"left",padding:[0,0,0,-60]},t.series[t.series.length]={name:n,type:"scatter",data:[],silent:!0,xAxisIndex:1,yAxisIndex:1,symbolSize:10,itemStyle:{color:function(t){var e="";switch(t.data.status){case o:e=$.getUIColor("--s-color-theme-status-error");break;case r:e=$.getUIColor("--s-color-theme-status-warn");break;case l:e=$.getUIColor("--s-color-theme-status-remind");break;case c:e=$.getUIColor("--s-color-theme-main-pale-hover")}return e},shadowColor:"rgba(0, 0, 0, 0.3)"},tooltip:{show:!1}}),i.clickable?(e={show:!0,label:{show:!1},lineStyle:{color:$.getUIColor("--s-color-theme-main-pale"),width:1.5}},t.tooltip.trigger="axis",t.grid[0].top="15%",t.grid[0].height="58%",t.xAxis[0].axisPointer=e,t.xAxis[1].axisPointer=e,t.series[0].markPoint={symbol:"rect",symbolSize:[2,208],itemStyle:{color:$.getUIColor("--s-color-theme-main-pale")},data:[{name:"mark",y:146}]},this.resetOptionFunc=function(t){delete t.series[0].markPoint.data[0].coord},this._bindClickEvent()):t.tooltip.trigger="axis",i.showLegend&&(t.legend={type:"plain",right:0,textStyle:{color:$.appUtils.getCurrentThemeIsDark()?"#ffffff":$.getUIColor("--s-color-text-primary")}},t.grid[0]={top:30,left:h,right:g},$.su.language.isRtl()?(t.legend.left=0,t.legend.align="right"):(t.legend.right=0,t.legend.align="left")),i.stack&&t.series.forEach(function(t){t.stack="total",t.lineStyle={opacity:0},t.areaStyle={}}),s&&(s.toolTipFormatter&&(t.tooltip.formatter=s.toolTipFormatter),s.yLabelFormatter&&(t.yAxis[0].axisLabel={formatter:s.yLabelFormatter}),s.color&&(t.color=s.color),s.markerPosition&&(t.series[0].markPoint.symbolSize[1]=s.markerPosition.height,t.series[0].markPoint.data[0].y=s.markerPosition.position),s.legendPosition&&($.su.language.isRtl()?t.legend.left="auto":t.legend.right="auto",$.extend(t.legend,s.legendPosition)),s.overrideOption)&&s.overrideOption(t)},_bindClickEvent:function(){var e,i,s;this.eventBound||(i=(e=this).chart.getChartInstance(),s=e.dom(),i.on("highlight",function(t){t.batch&&(t.batch[0].seriesIndex,t=t.batch[0].dataIndex,e._dataIndexHighlight=t)}),i.getZr().on("click",function(t){e._clickHandler(t)}),i.getZr().on("mousemove",function(t){t=[t.offsetX,t.offsetY];i.containPixel({gridIndex:[0,1]},t)?s.addClass("show-cursor"):s.removeClass("show-cursor")}),this.eventBound=!0)},_clickHandler:function(t){var e,i,s,a,n=!t.hasOwnProperty("offsetX");n&&(this._dataIndexHighlight=t.dataIndex),null!=(e=this._dataIndexHighlight)&&(t=[t.offsetX,t.offsetY],this._savedOption.series[0].data?(s=this._savedOption.xAxis[0].data[e],a=this._savedOption.series[0].data[e]):this._savedOption.dataset&&(s=(i=this._savedOption.dataset.source[e]).timeStamp,a=i),n||this.chart.getChartInstance().containPixel({gridIndex:[0,1]},t))&&(this._savedOption.series[0].markPoint.data[0].coord=[e],this.chart.setOption(this._savedOption),this.dom().triggerHandler("ev_line_time_update",[s,$.su.clone(a),e]))},triggerClickHandler:function(t){this._clickHandler({dataIndex:t})},refresh:function(){this._savedOption&&(this._dataIndexHighlight=null,this.resetOptionFunc&&this.resetOptionFunc(this._savedOption),this.chart.clear(),this.chart.setOption(this._savedOption))},updateValue:function(t){this.setValue(t)},getChartInstance:function(){return this.chart.getChartInstance()}})})(),$.su.Widget.register("barChart",{settings:{height:{attribute:"height",defaultValue:380},yMax:{attribute:"y-max"},barWidth:{attribute:"bar-width",defaultValue:60},yName:{attribute:"y-name",defaultValue:""},xName:{attribute:"x-name",defaultValue:""},clickable:{attribute:"clickable",defaultValue:!1},ellipsisXLabel:{attribute:"ellipsis-x-label",defaultValue:!1},tooltip:{attribute:"tooltip",defaultValue:{}}},init:function(){this.chartConfig=this.settings.configs&&this.settings.configs.option||{},this.colors=this.settings.configs&&this.settings.configs.colors||[$.getUIColor("--s-color-chart-single-type")]},destroy:function(){this.chart.getChartInstance().off("click")},render:function(){var t=$.Deferred(),e=this.dom(),i=this.settings;return e.append('<div widget="echart" id="'+this.domId+'_bar_chart" width="100%" height="'+i.height+'" class="m-b-0"></div>'),this.chart=new $.su.widgets.echart({id:this.domId+"_bar_chart"}),this.chart.render().then(t.resolve),t},loadItems:function(t){this.chartData=$.su.clone(t),$.isArray(t)||(this.chartData=[this.chartData]);var s=[],a=[];$.each(this.chartData,function(i,t){a[i]=[],$.each(t,function(t,e){0===i&&s.push(t),e.color&&(e.itemStyle={color:e.color},delete e.color),a[i].push(e)})}),this.setBar(s,a)},setBar:function(t,e){var i=this,s={tooltip:this.settings.tooltip,xAxis:[{name:this.settings.xName,data:t,axisLine:{lineStyle:{color:"rgb(172, 172, 172)",type:"solid"}},axisTick:{show:!1},axisLabel:{interval:0,fontSize:14,formatter:function(t){return $.isNumeric(i.settings.ellipsisXLabel)?$.su.ellipsisStr(t,i.settings.ellipsisXLabel):t}}}],yAxis:{name:this.settings.yName,type:"value",axisTick:{show:!1},minInterval:1,axisLine:{lineStyle:{color:"rgb(172, 172, 172)",type:"solid"}},min:0,splitNumber:6},series:[],emphasis:{itemStyle:{shadowBlur:5,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.7)"}},color:this.colors},a=($.su.language.isRtl()&&(s.xAxis[0].inverse=!0,s.yAxis.position="right"),{type:"bar",barWidth:$.isNumeric(this.settings.barWidth)&&this.settings.barWidth});$.each(e,function(t,e){s.series.push($.extend({},a,{data:e,stack:"stack",name:"item"+t}))}),this.settings.clickable&&this.bindClickEvent(),$.isNumeric(this.settings.yMax)&&(s.yAxis.max=this.settings.yMax),this.chart.setOption($.extend(!0,s,this.chartConfig))},bindClickEvent:function(){var i=this,s=this.dom(),t=this.chart.getChartInstance();t.off("click"),t.on("click",function(t){var e={name:t.name,value:t.value,dataIndex:t.dataIndex};i.setHighlight(t.dataIndex),s.triggerHandler("ev_bar_click",[e])})},clearHighlightStatus:function(t,e){t.dispatchAction({type:"downplay",seriesIndex:0,dataIndex:e})},setHighlightStatus:function(t,e){t.dispatchAction({type:"highlight",seriesIndex:0,dataIndex:e})},setBarColor:function(t){t&&(this.colors=t)},overrideSettings:function(t){var i=this;$.each(t,function(t,e){void 0!==i.settings[t]&&(i.settings[t]=e)})},setHighlight:function(t){var e=this.chart.getChartInstance();this.clearHighlightStatus(e),this.setHighlightStatus(e,t)},getChartInstance:function(){return this.chart.getChartInstance()}}),(()=>{var a=["HEALTH_GOOD","HEALTH_FAIR","HEALTH_POOR","HEALTH_NO_DATA","HEALTH_OFFLINE","HEALTH_DISABLED"],n=["#00A870","#ffcb00","#ee385c","#BFC3C9","#A5ABB4","#E2E5E7","transparent"],o=["rgba(13, 201, 1, 0.8)","rgba(255, 149, 0, 0.8)","rgba(255, 41, 84, 0.8)","rgba(191,195,201,1.0)","rgba(165, 171, 180, 0.8)","rgba(226, 229, 231, 0.8)","transparent"],r=["c-health-good","c-health-fair","c-health-poor","c-health-no-data","c-health-offline","c-health-disabled"];$.su.Widget.register("blockChart",{settings:{timeZoneType:{attribute:"time-zone-type",defaultValue:"site"}},init:function(){},render:function(){var t=$.Deferred(),e=this.dom();return e.addClass(this.settings.cls+"block-chart-container"),e.append('<div widget="echart" id="'+this.domId+'_block_chart" width="100%" height="100%" class="m-b-0"></div>'),this.chart=new $.su.widgets.echart({id:this.domId+"_block_chart"}),this.chart.render().then(t.resolve),t},setValue:function(t){var e;t&&(e=t[0].data.map(function(t){return t.end}),this.setBlock(e,t))},setBlock:function(t,e){var i=$.su.clone(e[0]),s=new Array(2).toString().split(",").map(function(){return i}),s=(i.name="emptyBlock",i.data.forEach(function(t){t.status=n.length-1}),e=s.concat(e),this.getDefaultSettings()),s=(this.overrideSettings(s),$.extend({},s)),a=e.length;e.reverse().forEach(function(t){t.data=t.data.map(function(t){return{value:1,status:t.status,start:t.start,end:t.end,itemStyle:{color:n[t.status]||n[0]},emphasis:{itemStyle:{color:o[t.status]||o[0]}}}}),t.type="bar",t.silent=!0,t.stack="total",t.barWidth=20,t.barMinHeight=20,t.itemStyle={borderColor:$.appUtils.getCurrentThemeIsDark()?$.getUIColor("-s-color-background-secondary"):"#fff",borderWidth:5}}),s.xAxis[0].data=t,s.series=e,t=20*a+5*(a-2)*2,this.chart.dom().height(t),this.chart.setOption(s),this.chart.resize()},getDefaultSettings:function(){var i=this.settings.timeZoneType,{backgroundColor:t,textColor:e}=$.su.moduleManager.get("main").getEchartTooltipColor();return{tooltip:{trigger:"axis",axisPointer:{type:"none"},backgroundColor:t,textStyle:{color:e,fontSize:13},extraCssText:"box-shadow: 0 0 4px 0 var(--s-color-tooltips-chart-shadow), 0 4px 4px 0 var(--s-color-tooltips-chart-shadow);",formatter:function(t){var i,e=t[0].data.end-t[0].data.start,s="",e='<tr style="padding:5px 0;font-weight: bold;border-bottom: 1px solid rgba(189, 189, 189, 0.5)"><td>'+$.su.getTimeRangeText(t[0].data.end,e)+"</td></tr>";return t.reverse().forEach(function(t,e){e<2||(i=t.data.status,s+='<tr style="padding:5px 0;"><td>'+$.su.escapeHtml(t.seriesName)+' </td><td style="text-align:right;" class="'+r[i]+'">'+$.su.CHAR.COMMON[a[i]]+"</td></tr>")}),'<table style="border-collapse:collapse;">'+e+s+"</table>"}},grid:{top:0,left:0,right:0,bottom:33},xAxis:[{type:"category",inverse:!!$.su.language.isRtl(),data:[],splitLine:{show:!0},axisTick:{show:!1},axisLine:{show:!1},offset:0,axisLabel:{interval:0,color:"#9B9B9B",showMaxLabel:!0,showMinLabel:!0,formatter:function(t,e){t=$.su.serviceManager.get("time").getTextFromUTC(+t,i,{pattern:"MM dd, yyyy hh:mm hc"}).split(" ");return t.splice(3,0,"\n"),t.join(" ")}}}],yAxis:{type:"value",show:!1},series:[]}},overrideSettings:function(t){this.settings}})})(),(()=>{var e=[0,300],i=[300,3e3];$.su.Widget.register("journey",{settings:{timeZoneType:{attribute:"time-zone-type",defaultValue:"site"},hideScatter:{attribute:"hide-scatter",defaultValue:!1},gridLeft:{attribute:"grid-left",defaultValue:67},gridRight:{attribute:"grid-right",defaultValue:67},width:{attribute:"width",defaultValue:"100%"},height:{attribute:"height",defaultValue:212},hideScroll:{attribute:"hide-scroll",defaultValue:!1},hideUpTime:{attribute:"hide-up-time",defaultValue:!1},splitNumber:{attribute:"split-number",defaultValue:4}},init:function(t){this.settings.configs=t&&t.configs},render:function(t){var e=$.Deferred(),i=this.dom(),s=this.settings.configs,a=this.settings.hideScatter,n=this.settings.hideScroll,o=this.settings.hideUpTime,s=(i.addClass(this.settings.cls+"journey-container"),s&&s.upTitle?s.upTitle:$.su.CHAR.JOURNEY.ONLINE_TIME),a='<div class="journey-style-container '+(a?"hide-scatter":"")+(n?" hide-scroll":"")+(o?" hide-up-time":"")+'" style="width:'+this.settings.width+'"> <div class="journey-style-container-inner" style="margin-left:'+this.settings.gridLeft+"px;margin-right:"+this.settings.gridRight+'px;"><span class="journey-title uptime-title">'+s+'</span><div class="journey-background uptime-background"></div><span class="journey-title roaming-title">'+$.su.CHAR.JOURNEY.ROAMING+'</span><div class="journey-background roaming-background"></div><div class="data-zoom-backgroud"></div></div></div>',n='<div widget="echart" id="'+this.domId+'_journey" type="custom" width="'+this.settings.width+'" height="'+this.settings.height+'" class="m-b-0"></div>';return i.append(a+n),this.chart=new $.su.widgets.echart({id:this.domId+"_journey"}),this.chart.render().then(e.resolve),e},setValue:function(t){var e,i,s,a,n;t&&(e=t.onlineTimeData||[],n=t.roamingData||[],i=t.tipData||[],s=this.getDefaultSettings(),this.initDefaultSettings(s),s=$.extend({},s),a=this.settings.hideScroll?this.settings.splitNumber:10*this.settings.splitNumber,n=this._handleOnlineTimeRoamingData(e,n),this.allData=n.allData,this.startPointOffset=t.startPointOffset,this.hideLastPointDownInfo=t.hideLastPointDownInfo,this.hideFirstPointUpInfo=t.hideFirstPointUpInfo,this.firstDurationTime=e.length&&[e[0].start,e[0].end],this.lastDurationTime=e.length&&[e[e.length-1].start,e[e.length-1].end],s.yAxis[0].axisLabel.formatter=$.su.CHAR.JOURNEY.ONLINE_TIME,s.yAxis[1].axisLabel.formatter=$.su.CHAR.JOURNEY.ROAMING,s.series[0].data=n.onlineTimeData,s.series[1]&&(s.series[1].data=n.roamingData),s.xAxis[0].min=this.xMin,s.xAxis[0].max=this.xMax,s.xAxis[1].min=this.xMin,s.xAxis[1].max=this.xMax,s.xAxis[0].interval=(this.xMax-this.xMin)/a,s.xAxis[1].interval=(this.xMax-this.xMin)/a,this.settings.configs&&this.settings.configs.overrideOption&&this.settings.configs.overrideOption(s),this.chart.setCustomOption(s),this.showTip(e[0]&&e[0].start,i))},_handleOnlineTimeRoamingData:function(e,s){var i=[],a={},n=-1/0,o=1/0;return this.settings.hideUpTime&&(e=[]),$.each(s,function(t,e){i.push(e.start),n=Math.max(n,e.start),o=Math.min(o,e.start)}),$.each(e,function(t,e){i.push(e.start,e.end),n=Math.max(n,e.end),o=Math.min(o,e.start)}),this.xMax=$.isNumeric(this.settings.configs&&this.settings.configs.xMax)?this.settings.configs.xMax:n,this.xMin=$.isNumeric(this.settings.configs&&this.settings.configs.xMin)?this.settings.configs.xMin:o,$.each(i,function(t,i){a[i]={},$.each(e,function(t,e){i>=e.start&&i<=e.end&&(a[i].onlineTimeData=e)}),$.each(s,function(t,e){i===e.start&&(a[i].roamingData=e)})}),this.settings.hideScatter&&(s=[]),$.each(i,function(t,e){for(var i=0;i<s.length;i++)if(e===s[i].start)return;s.push({start:e})}),{onlineTimeData:this.convertOnlineTimeData(e),roamingData:this.convertRoamingData(s),allData:a}},convertOnlineTimeData:function(t){return t.map(function(t){return{value:["onlineTimeData",t.start,t.end,t.duration],itemStyle:{normal:{color:$.getUIColor("--s-color-theme-status-success")}}}})},convertRoamingData:function(t){var i=this;return t.map(function(t){var e;return e=i.settings.hideUpTime?void 0===t.duration?-1:.5:void 0===t.duration?-1:.13,{value:[t.start,e],color:i.getColor(t.duration)}})},getColor:function(t){return $.isNumeric(t)?t>=e[0]&&t<=e[1]?$.getUIColor("--s-color-theme-status-success"):t>i[0]&&t<=i[1]?"#F7B500":"#FF2954":"transparent"},getDefaultSettings:function(){var r=this,d=this.settings.timeZoneType,t=this.settings.gridLeft,e=this.settings.gridRight,{backgroundColor:i,textColor:s}=$.su.moduleManager.get("main").getEchartTooltipColor(),i={dataZoom:[{type:"slider",filterMode:"none",showDataShadow:!1,top:192,labelFormatter:"",xAxisIndex:[0,1],backgroundColor:"#EBECED",height:16,fillerColor:$.getUIColor("--s-color-blue-00"),borderColor:"transparent",zoomLock:!0,maxSpan:10,handleStyle:{borderWidth:0,color:$.getUIColor("--s-color-blue-00")},left:8+r.settings.gridLeft,right:8+r.settings.gridRight,handleIcon:"path://M512,512m-448,0a448,448,0,1,0,896,0a448,448,0,1,0,-896,0Z"}],tooltip:{axisPointer:{lineStyle:{color:$.appUtils.useDarkTheme.getTooltip().axisPointerLineColor,width:$.appUtils.useDarkTheme.getTooltip().axisPinterLineWidth}},padding:10,backgroundColor:i,textStyle:{color:s,fontSize:13},formatter:function(t){var e,i,s,a=t[0].value[0],n=r.allData[a],o="",a='<tr style="font-size: 16px;border-bottom: 1px solid;"><td style="padding:5px 0;">'+$.su.serviceManager.get("time").getTextFromUTC(+a,d,{pattern:"MM dd, yyyy hh:mm:ss hc"})+"</td></tr>";return n.onlineTimeData&&(i=t[0].axisValue>=r.lastDurationTime[0]&&t[0].axisValue<=r.lastDurationTime[1],t=t[0].axisValue>=r.firstDurationTime[0]&&t[0].axisValue<=r.firstDurationTime[1],e=r.hideFirstPointUpInfo&&t,i=r.hideLastPointDownInfo&&i,s=+n.onlineTimeData.start,t&&(s=n.onlineTimeData.start+(r.startPointOffset||0)),e||(o+='<tr style="font-size: 14px"><td class="p-t-5 p-r-15 p-b-5 p-l-0">'+$.su.CHAR.JOURNEY.CONNECTION_TIME+' </td><td class="u-text-right" style="padding:5px 0;">'+$.su.serviceManager.get("time").getTextFromUTC(s,d,{pattern:"MM dd, yyyy hh:mm:ss hc"})+"</td></tr>"),i||(o+='<tr style="font-size: 14px"><td class="p-t-5 p-r-15 p-b-5 p-l-0">'+$.su.CHAR.JOURNEY.DISCONNECTED_TIME+' </td><td class="u-text-right" style="padding:5px 0;">'+$.su.serviceManager.get("time").getTextFromUTC(+n.onlineTimeData.end,d,{pattern:"MM dd, yyyy hh:mm:ss hc"})+"</td></tr>"),i||e||(o+='<tr style="font-size: 14px"><td class="p-t-5 p-r-15 p-b-5 p-l-0">'+$.su.CHAR.JOURNEY.ONLINE_TIME+' </td><td class="u-text-right" style="padding:5px 0;">'+$.appUtils.transferTime(Math.round(n.onlineTimeData.duration)/1e3)+"</td></tr>")),n.roamingData&&!r.settings.hideScatter&&(o+='<tr style="font-size: 14px"><td style="padding:5px 15px 5px 0;">'+$.su.CHAR.JOURNEY.ROAMING_DURATION+' </td><td class="u-text-right" style="padding:5px 0;">'+n.roamingData.duration+" "+$.su.CHAR.JOURNEY.MS+"</td></tr>"),r.settings.configs&&r.settings.configs.extraDimensions&&$.each(r.settings.configs.extraDimensions,function(t,e){null===n.onlineTimeData[e]&&void 0===n.onlineTimeData[e]||(o+='<tr style="font-size: 14px"><td style="padding:5px 15px 5px 0;">'+e+' </td><td class="u-text-right" style="padding:5px 0;">'+n.onlineTimeData[e]+"</td></tr>")}),'<table style="border-collapse:collapse;">'+a+o+"</table>"},extraCssText:"box-shadow: 0 0 4px 0 var(--s-color-tooltips-chart-shadow), 0 4px 4px 0 var(--s-color-tooltips-chart-shadow);"},grid:[{left:t,right:e,top:36,height:27},{left:t,right:e,top:36,height:108}],xAxis:[{show:!1,scale:!0,gridIndex:0,axisLabel:{formatter:function(t,e){return $.su.serviceManager.get("time").getTextFromUTC(+t,d,{pattern:r.settings.configs&&r.settings.configs.timeFormat?r.settings.configs.timeFormat:"MM dd, yyyy hh:mm hc"})}}},{type:"value",scale:!0,gridIndex:1,splitLine:{show:!1},axisLine:{show:!1,lineStyle:{color:$.appUtils.getCurrentThemeIsDark()?"rgba(255, 255, 255, 0.64)":$.getUIColor("--s-color-chart-axis-label")}},axisTick:{length:6},axisLabel:{margin:16,formatter:function(t,e){return $.su.serviceManager.get("time").getTextFromUTC(+t,d,{pattern:r.settings.configs&&r.settings.configs.timeFormat?r.settings.configs.timeFormat:"MM dd, yyyy hh:mm hc"})},color:$.appUtils.getCurrentThemeIsDark()?"rgba(255, 255, 255, 0.64)":$.getUIColor("--s-color-chart-axis-label")},axisPointer:{show:!0,label:{show:!1},lineStyle:{color:$.appUtils.useDarkTheme.getTooltip().axisPointerLineColor,width:$.appUtils.useDarkTheme.getTooltip().axisPinterLineWidth},snap:!0},data:[]}],yAxis:[{show:!1,axisLabel:{formatter:""},data:["onlineTimeData"]},{type:"value",nameGap:-23,axisLine:{show:!1},splitLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},max:1,min:0,gridIndex:1}],series:[{type:"custom",renderItem:function(t,e){var i=e.value(0),s=e.coord([e.value(1),i]),i=e.coord([e.value(2),i]),i=echarts.graphic.clipRectByRect({x:$.su.language.isRtl()?s[0]+i[0]-s[0]:s[0],y:s[1]-13.5,width:$.su.language.isRtl()?-(i[0]-s[0]):i[0]-s[0],height:27},{x:t.coordSys.x,y:t.coordSys.y,width:t.coordSys.width,height:t.coordSys.height});return r.perValueLength=e.size([1,0])[0],i&&(i.r=[5]),i&&{type:"rect",transition:["shape"],shape:i,style:e.style()}},itemStyle:{opacity:.8},encode:{x:[1,2],y:0},data:[],tooltip:{show:!1,trigger:"none"},axisPointer:{show:!1}},{name:1,type:"scatter",data:[],silent:!0,xAxisIndex:1,yAxisIndex:1,symbolSize:16,itemStyle:{color:function(t){return t.data.color},borderType:"solid",borderWidth:2,borderColor:"#ffffff"}}]};return this.settings.hideScroll&&delete i.dataZoom,$.su.language.isRtl()&&(i.xAxis[0].inverse=!0,i.xAxis[1].inverse=!0),i},initDefaultSettings:function(t){var e=this.settings;e.hideScatter&&(t.grid[1].height=81,t.grid[1].show=!1,t.yAxis[1].show=!1,e.hideScroll||(t.dataZoom[0].top=165)),e.hideUpTime&&(t.grid[1].height=t.grid[1].height-27,t.xAxis[1].axisPointer.lineStyle.color="transparent",e.hideScroll||(t.dataZoom[0].top=t.dataZoom[0].top-27)),(e.hideScatter||e.hideUpTime)&&(t.grid[1].height=t.grid[1].height-54,e.hideScroll||(t.dataZoom[0].top=t.dataZoom[0].top-54))},showTip:function(a,t){var n=this;$.each(t,function(t,e){var i=n.perValueLength*(e.start-a),e=n.perValueLength*(e.end-e.start),s=$.su.randomId(),i='<div id="'+s+'" class="tip-wrapper" style="'+($.su.language.isRtl()?"right":"left")+":"+i+"px;width:"+e+'px"><div widget="toolTip" class="journey-tip"></div><div class="tip-line" style="width:'+e+'px"></div><div>';n.dom().find(".journey-style-container-inner").append(i),new $.su.widgets.toolTip({id:$("#"+s).children("div[widget=toolTip]"),tipText:n.settings.configs.tipText,widgetSize:"m"}).render()})}})})(),(()=>{var a=1,s=0,n=1,t=2,o=1,i=0,r=1,d={};d[s]="ap",d[n]="switch",d[t]="gateway",$.su.Widget.register("topology",{settings:{},init:function(){},render:function(t){$.Deferred();this.dom().addClass(this.settings.cls+"topology-container")},setValue:function(i){var s,a;i&&(s=this,a="",$.each(i,function(t,e){t=t===i.length-1;a+=s.createTopologyNodeDom(e,t)}),this.dom().empty().append(a),$.su.scrollbar({ele:".topology-container"}))},createTopologyNodeDom:function(t,e){var i="",s={},s=t.nodeType===a?t.clientInfo:t.deviceInfo,i=(i+='<div class="node-info-container">')+this.createBasicInfoDom(s,t.nodeType);return e||(i+=this.createConnectInfoDom(s,t.nodeType)),i+="</div>"},createBasicInfoDom:function(t,e){var i="",s="",s=e===a?t.name||$.su.CHAR.CLIENTS.UNKNOWN:t.name||t.mac;return i+='<div class="device-basic-info">',i=e===a?(i+='<div class="client-icon">')+'<div class="client-type '+$.appUtils.getClientIconType(t.clientType,t.model,t.modelVersion,t.parentId)+'"><span class="icon"></span></div></div>':(i+='<div class="device-icon">')+'<div class="device-type '+d[t.deviceType]+" "+$.appUtils.getDeviceIconType(t.model,t.modelVersion,d[t.deviceType])+'"><span class="icon"></span></div></div>',i=(i=(i=(i+='<div class="device-Name">'+$.su.ellipsisGridStr(s,120)+"</div>")+('<div class="health-status health-level-'+$.appUtils.getHealthLevel(t.healthScore)+'">'))+$.appUtils.getHealthStatus(t.healthScore,e===a?"client":"device"))+"</div>"+"</div>"},createConnectInfoDom:function(t,e){var i="";return e===a?t.upDeviceType===s&&t.upApInfo?i+=this.createClientUpApInfo(t.upApInfo):t.upDeviceType===n&&t.upOswInfo?i+=this.createWireUpLinkInfo(t.upOswInfo):i+=this.createWireUpLinkInfo():t.deviceType===s&&t.apInfo?t.apInfo.wiredUpLink?i+=this.createWireUpLinkInfo(t.apInfo.wiredUpLink):t.apInfo.wirelessUpLink&&(i+=this.createWirelessUpLink(t.apInfo.wirelessUpLink)):t.deviceType===n&&t.switchInfo&&(i+=this.createWireUpLinkInfo(t.switchInfo)),i},createClientUpApInfo:function(t){var e="",i={0:$.su.CHAR.MAIN.HZ24,1:$.su.CHAR.MAIN.HZ5,2:$.su.CHAR.MAIN.HZ5_2,3:$.su.CHAR.MAIN.HZ6};return t.support5g2&&(i["1"]=$.su.CHAR.MAIN.HZ5_1),e+'<div class="connection-info">'+('<div class="connection-channel">'+t.channel+"</div>")+'<div class="connection-radio">'+('<span class="radio-text">'+i[t.radio]+"</span>")+"</div>"+'<div class="connection-ssid">'+("<span>"+$.su.ellipsisGridStr(t.ssid,120)+"</span>")+"</div>"+"</div>"},createWireUpLinkInfo:function(t){t=t||{};var e,i="",s="";return $.isNumeric(t.port)?i="->#"+t.port:!$.isNumeric(t.upPort)&&$.isNumeric(t.upLinkPort)?i="->#"+t.upLinkPort:$.isNumeric(t.upPort)&&$.isNumeric(t.upLinkPort)&&(i="#"+t.upPort+"<->#"+t.upLinkPort),e=this.createSpeedText(t.linkSpeed,t.duplex),s=s+('<div class="connection-info wire '+this.getSpeedClass(t.linkSpeed)+'">')+'<div class="connection-link">',i&&(s+='<span class="connection-link-port">'+i+"</span>"),s+="</div>",e&&(s+='<span class="connection-link-speed">'+e+"</span>"),s+="</div>"},createWirelessUpLink:function(t){var e="";return(e+='<div class="connection-info">')+('<div class="connection-tx-rate">'+this.createRateText(t.txRate,i)+"</div>")+('<div class="connection-rx-rate">'+this.createRateText(t.rxRate,r)+"</div>")+('<div class="connection-rssi">'+this.createRssiText(t.rssi,t.rssiPercent)+"</div>")+"</div>"},createSpeedText:function(t,e){var i="";return $.isNumeric(t)&&$.isNumeric(e)&&(i=["",10,100,1e3,2500,1e4,5e3][t]+(e===o?$.su.CHAR.CLIENTS_SETTINGS.HDX:$.su.CHAR.CLIENTS_SETTINGS.FDX)),i},getSpeedClass:function(t){var e="";return $.isNumeric(t)&&(e=["","mbps10","mbps100","mbps1000","gb25","gb10","gb5"][t]),e},createRateText:function(t,e){return(e===i?"":"")+(t=t.replace(/(\d+)/g,"$1 "))},createRssiText:function(t,e){return e+"% ("+t+$.su.CHAR.CLIENTS.DBM+")"}})})(),$.su.Widget.register("cause",{settings:{},listeners:[{selector:".cause-header",event:"click",callback:function(t,e){var i,s=$(t.target).closest(".cause-item"),t=s.attr("data-key");s.hasClass("expand")?e.collapseItem(s):(i=$.su.getDefaultEvent(e,function(){e.collapseItem(),e.expandItem(s)}),e.dom().triggerHandler("ev_cause_expand",[i.ev,t]),i.exe())}},{selector:".operation-useful",event:"click",callback:function(t,e){$(this).hasClass("highlight")||e.triggerSuggestionClick(this,!0)}},{selector:".operation-useless",event:"click",callback:function(t,e){$(this).hasClass("highlight")||e.triggerSuggestionClick(this,!1)}},{selector:"a.go-to",event:"click",callback:function(t,e){t.preventDefault(),e.dom().triggerHandler("ev_go_to_click",[$(this).attr("data-key")])}},{selector:".suggestion-content span.link-detail",event:"click",callback:function(t,e){t.preventDefault();var t=$(this).attr("data-type"),i=$(this).attr("data-key"),s=$(this).attr("active-tab");e.dom().triggerHandler("ev_go_to_device_settings",[t,i,s])}}],init:function(){},render:function(){var t=this.dom(),e=this.settings;t.addClass(e.cls+"cause-container");t.append('<div class="cause-wrap"></div>')},loadItem:function(t){var i,s;t&&t.length&&(i=this,s=(s="")+'<div class="cause-main-title">'+$.su.CHAR.ABNORMAL_INCIDENT.POSSIBLE_CAUSES+'</div><div class="cause-items">',$.each(t,function(t,e){s+=i.getCauseHtml(t,e)}),s+="</div>",this.dom().find(".cause-wrap").empty().append(s))},getCauseHtml:function(t,e){var i="";return e.expand?i+='<div class="cause-item cause-item-wrap expand" data-key="'+e.key+'">':i+='<div class="cause-item cause-item-wrap" data-key="'+e.key+'">',i=(i=(i=i+'<div class="cause-header">'+('<span class="cause-title">'+(t+1)+". "+(e.name||"")+"</span>"))+'<span class="cause-icon"></span>'+"</div>")+'<div class="cause-body"></div>'+"</div>"},expand:function(t){this.dom().find('.cause-item[data-key="'+t+'"] .cause-header').trigger("click")},expandItem:function(t){var e;t&&!t.hasClass("expand")&&(t.addClass("expand"),e=this.dom(),t.find(".cause-body").slideDown(200,function(){e.triggerHandler("ev_cause_expanded",[t.attr("data-key")])}))},collapseItem:function(t){var e=this.dom();(t=t||e.find(".cause-item.expand"))&&t.hasClass("expand")&&(t.removeClass("expand"),t.find(".cause-body").slideUp(200,function(){e.triggerHandler("ev_cause_collapse",[t.attr("data-key")])}))},setCauseContent:function(t,e){var i=this,s=this.getGlobalCauseHtml(e),a=this.dom();a.find(".global-cause-content").remove(),a.find('.cause-item[data-key="'+t+'"] .cause-body').empty().append(s),this.renderContentWidgets(e),$.each(e.suggestion,function(t,e){i.setHelpful(e.adviceCode,e.helpful),i.executeAdviceCallBack(e)})},renderContentWidgets:function(t){t=t.content||"",t=$.isArray(t)?t:[t];$.each(t,function(t,e){var i=e.html,s=e.callback,e=e.callbackData;$(i).attr("widget")?(i=new $.su.widgets[$(i).attr("widget")]({id:$(i).attr("id")}),s&&s(i,e)):s&&s(e)})},executeAdviceCallBack:function(t){t.callback&&t.callback()},getGlobalCauseHtml:function(t){var i=this,s='<div class="global-cause-content">',e=t.content||"";return 1===(e=$.isArray(e)?e:[e]).length&&""===e[0].text||(s+='<div class="cause-content">',$.each(e,function(t,e){s+='<div class="cause-content-item-wrapper">',e.text?$.each(e.text.split("\n"),function(t,e){s+='<div class="cause-content-text-item">'+e.trim()+"</div>"}):e.html&&(s+=e.html),s+="</div>"}),s+='</div><div class="extend-content-container"></div>'),t.suggestion&&(e="array"===$.type(t.suggestion)?t.suggestion:[t.suggestion],s+='<div class="suggestion-wrap">',e.length&&(s=(s+='<div class="suggestion-title">')+$.su.CHAR.ABNORMAL.OPERATION_SUGGESTION+"</div>"),s+='<div class="suggestion-content">',$.each(e,function(t,e){s=(s=(s=(s+='<div class="suggestion-item-wrapper" data-key="'+e.adviceCode+'">')+'<div class="suggestion-item">'+(t+1)+". "+e.adviceText+"</div>")+(e.adviceHtml||""))+i.getUsefulHtml()+"</div>"}),s+="</div></div>"),s+="</div>"},getUsefulHtml:function(){return'<div class="suggestion-operation-wrap"><div class="suggestion-operation operation-useful"><span class="icon"></span></div><div class="suggestion-operation operation-useless"><span class="icon"></span></div></div>'},setHelpful:function(t,e){t=this.dom().find('.suggestion-item-wrapper[data-key="'+t+'"]');t.find(".suggestion-operation").removeClass("highlight"),e===$.appUtils.ADVICES_USEFUL_STATUS.USEFUL?t.find(".operation-useful").addClass("highlight"):e===$.appUtils.ADVICES_USEFUL_STATUS.USELESS&&t.find(".operation-useless").addClass("highlight")},triggerSuggestionClick:function(t,e){var e=e?$.appUtils.ADVICES_USEFUL_STATUS.USEFUL:$.appUtils.ADVICES_USEFUL_STATUS.USELESS,i=$(t).closest(".cause-item").attr("data-key"),t=$(t).parents(".suggestion-item-wrapper").attr("data-key");this.setHelpful(t,e),this.dom().triggerHandler("ev_cause_suggestion_click",[i,t,e])},addExtendHtml:function(t){this.dom().find(".extend-content-container").html(t)}}),(()=>{var g=$.su.defaultFont;$.su.Widget.register("protocolFlowChart",{settings:{width:{attribute:"width",defaultValue:800}},listeners:[],init:function(){},render:function(){this.dom().addClass(this.settings.cls+"protocol-flow-chart-container")},loadItems:function(t,e){var i='<div class="flow-chart-container">',i=(i=i+('<canvas id="'+e+'" width="'+this.settings.width+'"></canvas>')+"</div>",this.dom().append(i),this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),t.process),e=i.length;this.canvas.height=50*(e+1)+60+18,this.drawStation(t,e),this.drawStep(i)},drawStation:function(t,i){var s=this,e=this.ctx,t=t.stations,a=(this.settings.width-140)/(t.length-1);s.stationOfxAxis={},e.textAlign="center",e.textBaseline="top",$.each(t,function(t,e){t=70+t*a;s.stationOfxAxis[e]=t,s.drawText(e,t,30,18,"#00A870","#00A870","#FFFFFF",120),s.drawStationLine(t,30,i)})},drawStep:function(t){var r=this;$.each(t,function(t,e){var i,s;switch(e.duration){case-1:i="#FF2954",s="rgba(255,41,84,0.1)";break;case-2:i="#BEC3C5",s="rgba(242,244,247,0.50)";break;case 0:i="#22B819",s="rgba(34,184,25,0.1)";break;default:i="#FFBB00",s="rgba(255,187,0,0.1)"}var a=r.stationOfxAxis[e.source],t=50*(t+2),n=r.stationOfxAxis[e.target],o=(r.drawLineArrow(a,t,n,t,i),(a+n)/2),t=t-7;r.drawText(e.flowName,o,t,14,s,i,i,Math.abs(n-a)-36),0<e.duration&&r.drawDelayTime(e.duration,o,t)})},drawText:function(t,e,i,s,a,n,o,r){var d=this.ctx,l=(d.font=s+"px "+g,d.measureText(t).width),c=Math.ceil(l/r),h=e-(l=(l=1<c?r:l)<40?40:l)/2-5,i=i-(c-1)*s/2;this.delayTimeY=i-2,this.drawRoundedRect(a,n,h,i-2,l+10,s*c+4,3),d.fillStyle=o,this.wrapText(t,e,i,r,s)},drawRoundedRect:function(t,e,i,s,a,n,o){var r=this.ctx;r.beginPath(),r.fillStyle=t,r.strokeStyle=e,r.clearRect(i,s,a,n),this.roundedRect(i,s,a,n,o),r.stroke(),r.fill()},roundedRect:function(t,e,i,s,a){var n=this.ctx;i<=0||s<=0?n.arc(t,e,a,0,2*Math.PI):(n.moveTo(t+a,e),n.arcTo(t+i,e,t+i,e+s,a),n.arcTo(t+i,e+s,t,e+s,a),n.arcTo(t,e+s,t,e,a),n.arcTo(t,e,t+i,e,a))},drawStationLine:function(t,e,i){var s=this.ctx;s.beginPath(),s.moveTo(t,e+18),s.lineTo(t,e+18+50*(i+1)),s.stroke()},drawLineArrow:function(t,e,i,s,a){var n=this.ctx;n.fillStyle=a,n.strokeStyle=a,n.beginPath(),n.moveTo(t,e),n.lineTo(i,s),n.moveTo(i,s),t<i?(n.lineTo(i-8,s+4),n.lineTo(i-8,s-4)):(n.lineTo(i+8,s+4),n.lineTo(i+8,s-4)),n.closePath(),n.stroke(),n.fill()},wrapText:function(t,e,i,s,a){for(var n=t.split(" "),o="",r=a,d=this.ctx,l=0;l<n.length;l++){var c=o+n[l]+" ";s<d.measureText(c).width?(d.fillText(o,e,i),o=n[l]+" ",i+=r):o=c}d.fillText(o.trim(),e,i)},drawDelayTime:function(t,e,i){this.ctx.fillText($.su.msTimeConversion(t),e,this.delayTimeY-14)}})})();