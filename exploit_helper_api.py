#!/usr/bin/env python3
"""
åˆ©ç”¨æ–°å‘ç°çš„ /api/Helper/ è·¯å¾„
å¯èƒ½ç»•è¿‡RSAç­¾åéªŒè¯ï¼
"""

import requests
import json
import urllib3
urllib3.disable_warnings()

BASE_URL = "https://gwmobile.emsone.com.vn"

def test_api_helper():
    print("="*70)
    print(" ğŸ”¥ åˆ©ç”¨ /api/Helper/ APIï¼ˆç»•è¿‡RSAç­¾åï¼‰")
    print("="*70)
    
    headers = {
        'X-Client-ID': 'android_app_987654',
        'X-Client-Secret': 'android_s3cr3t_uvwxzy',
        'Content-Type': 'application/json',
    }
    
    # 1. è·å–çœä»½åˆ—è¡¨ï¼ˆæµ‹è¯•è¿æ¥ï¼‰
    print("\n[1] æµ‹è¯•è¿æ¥ - PROVINCE_LIST")
    try:
        r = requests.post(
            f"{BASE_URL}/api/Helper/PROVINCE_LIST",
            json={},
            headers=headers,
            timeout=15,
            verify=False
        )
        
        if r.status_code == 200:
            data = r.json()
            print(f"âœ… æˆåŠŸï¼è¿”å› {len(data)} ä¸ªçœä»½")
            
    except Exception as e:
        print(f"âŒ å¤±è´¥: {e}")
        return
    
    # 2. å°è¯•è·å–è®¢å•
    print("\n[2] æµ‹è¯•è®¢å•è®¿é—® - ORDER_GET_BY_ID")
    
    for order_id in range(1, 11):
        try:
            r = requests.post(
                f"{BASE_URL}/api/Helper/ORDER_GET_BY_ID",
                json={"ID": order_id},
                headers=headers,
                timeout=10,
                verify=False
            )
            
            if r.status_code == 200:
                result = r.json()
                
                if result and result.get('ID'):
                    print(f"\nâœ… è®¢å• {order_id} å­˜åœ¨ï¼")
                    print(json.dumps(result, indent=2, ensure_ascii=False)[:500])
                    
        except:
            pass
    
    # 3. å°è¯•æŸ¥è¯¢å®¢æˆ·
    print("\n\n[3] æµ‹è¯•å®¢æˆ·æŸ¥è¯¢ - GET_BY_MOBILE_NUMBER")
    
    test_phones = [
        "0123456789",
        "0764955842",  # æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æµ‹è¯•å·ç 
        "0987654321"
    ]
    
    for phone in test_phones:
        try:
            r = requests.post(
                f"{BASE_URL}/api/Helper/GET_BY_MOBILE_NUMBER",
                json={"MobileNumber": phone, "ShopID": 0},
                headers=headers,
                timeout=10,
                verify=False
            )
            
            if r.status_code == 200:
                result = r.json()
                if result and result.get('ID'):
                    print(f"\nâœ… æ‰¾åˆ°å®¢æˆ·: {phone}")
                    print(json.dumps(result, indent=2, ensure_ascii=False))
                    
        except:
            pass
    
    # 4. æµ‹è¯•ç»Ÿè®¡ç«¯ç‚¹
    print("\n\n[4] æµ‹è¯•ç»Ÿè®¡ç«¯ç‚¹")
    
    stats_endpoints = [
        "STATISTICAL_ORDER",
        "STATISTICAL_CUSTOMER",
        "STATISTICAL_TRANSPORT"
    ]
    
    for endpoint in stats_endpoints:
        try:
            r = requests.post(
                f"{BASE_URL}/api/Helper/{endpoint}",
                json={},
                headers=headers,
                timeout=10,
                verify=False
            )
            
            if r.status_code == 200:
                result = r.json()
                print(f"\nâœ… {endpoint}:")
                print(json.dumps(result, indent=2, ensure_ascii=False)[:300])
                
        except:
            pass
    
    print("\n" + "="*70)
    print(" æµ‹è¯•å®Œæˆ")
    print("="*70)

if __name__ == "__main__":
    test_api_helper()
