# ViettelPost å¯†é’¥æœç´¢æŠ¥å‘Š

## æœç´¢æ—¶é—´: 2025-11-11

---

## ğŸ” æœç´¢èŒƒå›´

### å·²æœç´¢çš„ä½ç½®
1. âœ… admin-global.viettelpost.vnçš„JSæ–‡ä»¶ (1.3MB)
2. âœ… Management Service Swagger (184ç«¯ç‚¹)
3. âœ… CDN Service Swagger (12ç«¯ç‚¹)
4. âœ… application-configuration APIå“åº”
5. âœ… OpenID Connecté…ç½®
6. âœ… JWKS (å…¬é’¥)
7. âœ… HTTPå“åº”å¤´
8. âœ… é”™è¯¯æ¶ˆæ¯

---

## ğŸ”‘ å·²å‘ç°çš„å‡­è¯

### 1. OAuth2 Client Credentials âœ…
```
client_id: Logistek_Swagger
client_secret: aWWhdh4QHiFKb8c6
```
- **ä½ç½®**: admin-global.viettelpost.vnçš„JavaScript
- **ç”¨é€”**: Swagger UIè®¿é—®
- **æƒé™**: æ–‡ä»¶ä¸Šä¼ ã€APIæŸ¥è¯¢ã€ä½†æ— ç”¨æˆ·çº§åˆ«æƒé™
- **çŠ¶æ€**: å·²åˆ©ç”¨

### 2. JWTç­¾åå…¬é’¥ âœ…
```
ç®—æ³•: RS256
Kid: BED66DF899212846315B92C2EC94D8F8970A0B52
è¯ä¹¦: localhost (è‡ªç­¾å)
æœ‰æ•ˆæœŸ: 2025-01-02 è‡³ 2045-01-02
```
- **ä½ç½®**: /.well-known/jwks
- **ç”¨é€”**: JWT tokenç­¾åéªŒè¯
- **ç±»å‹**: å…¬é’¥ï¼ˆä¸æ˜¯ç§é’¥ï¼‰
- **é£é™©**: ä½ï¼ˆå…¬é’¥å¯å…¬å¼€ï¼‰

### 3. CloudFront Distribution âœ…
```
Distribution ID: d31jjpr2lpclfv
åŸŸå: d31jjpr2lpclfv.cloudfront.net
æº: S3 Bucket (æœªçŸ¥å…·ä½“åç§°)
```
- **ä½ç½®**: æ–‡ä»¶ä¸Šä¼ APIå“åº”
- **ç”¨é€”**: å…¨çƒCDNåˆ†å‘
- **è®¿é—®**: å…¬å¼€

### 4. S3 Bucketåç§° âœ…
```
- viettelpost (ap-southeast-1)
- vtp (ap-southeast-1)
- vtp-prod (eu-central-1)
- vtp-dev (us-east-1)
- vtp-test (us-east-1)
```
- **ä½ç½®**: æšä¸¾
- **è®¿é—®**: 403 AccessDeniedï¼ˆæ— å…¬å¼€è®¿é—®ï¼‰
- **é£é™©**: ä¸­ï¼ˆå‘½åè§„èŒƒæ³„éœ²æ¶æ„ï¼‰

---

## âŒ æœªå‘ç°çš„å‡­è¯

### 1. AWS Access Key / Secret Key
```
æœç´¢æ¨¡å¼: AKIA[0-9A-Z]{16}
ç»“æœ: æœªæ‰¾åˆ°
```

### 2. æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
```
æœç´¢æ¨¡å¼: mongodb://, mysql://, postgresql://
ç»“æœ: æœªæ‰¾åˆ°
```

### 3. APIå¯†é’¥ï¼ˆé™¤OAuth2å¤–ï¼‰
```
æœç´¢: apiKey, api_key, API_KEY
ç»“æœ: æœªæ‰¾åˆ°å…¶ä»–APIå¯†é’¥
```

### 4. JWTç§é’¥
```
æœç´¢: BEGIN PRIVATE KEY, BEGIN RSA PRIVATE KEY
ç»“æœ: æœªæ‰¾åˆ°ï¼ˆä»…æœ‰å…¬é’¥ï¼‰
```

### 5. åŠ å¯†å¯†é’¥
```
æœç´¢: encryption_key, secret_key, aes_key
ç»“æœ: æœªæ‰¾åˆ°
```

### 6. ç¬¬ä¸‰æ–¹æœåŠ¡å¯†é’¥
```
æœç´¢: stripe, paypal, twilio, sendgrid
ç»“æœ: æœªæ‰¾åˆ°
```

---

## ğŸ¯ å¯èƒ½å­˜åœ¨å¯†é’¥çš„ä½ç½®

### 1. æœåŠ¡ç«¯ç¯å¢ƒå˜é‡ âš ï¸
```
ä½ç½®: EC2å®ä¾‹ã€å®¹å™¨ç¯å¢ƒ
é£é™©: æ— æ³•ç›´æ¥è®¿é—®
å¯èƒ½åŒ…å«:
- AWS_ACCESS_KEY_ID
- AWS_SECRET_ACCESS_KEY
- DATABASE_URL
- REDIS_URL
```

### 2. AWS Parameter Store / Secrets Manager âš ï¸
```
ViettelPostå¯èƒ½ä½¿ç”¨AWSæœåŠ¡å­˜å‚¨å¯†é’¥
éœ€è¦: AWSå‡­è¯æ‰èƒ½è®¿é—®
```

### 3. æ•°æ®åº“é…ç½®è¡¨ âš ï¸
```
å¯èƒ½ä½ç½®: Settingsè¡¨ã€Configurationè¡¨
éœ€è¦: æ•°æ®åº“è®¿é—®æƒé™
```

### 4. appsettings.json (æœåŠ¡ç«¯) âš ï¸
```
ASP.NET Coreé…ç½®æ–‡ä»¶
ä½ç½®: æœåŠ¡ç«¯æ–‡ä»¶ç³»ç»Ÿ
é£é™©: æ— æ³•ç›´æ¥è®¿é—®
```

### 5. .envæ–‡ä»¶ (æœåŠ¡ç«¯) âš ï¸
```
ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶
ä½ç½®: é¡¹ç›®æ ¹ç›®å½•
é£é™©: æ— æ³•ç›´æ¥è®¿é—®
```

---

## ğŸ“Š å†…éƒ¨ç«¯ç‚¹æµ‹è¯•ç»“æœ

### å°è¯•è®¿é—®çš„é…ç½®ç«¯ç‚¹
```
âŒ /api/internal/system/config          - 404
âŒ /api/internal/system/settings        - 404
âŒ /api/internal/config/all             - 404
âŒ /api/internal/database/connection    - 404
âŒ /api/internal/redis/config           - 404
âŒ /api/internal/aws/credentials        - 404
âŒ /api/internal/keys/list              - 404
âŒ /api/admin/system/config             - 404
âŒ /api/admin/settings/all              - 404
```
**ç»“è®º**: è¿™äº›ç«¯ç‚¹ä¸å­˜åœ¨æˆ–éœ€è¦æ›´é«˜æƒé™

### å¯è®¿é—®çš„å†…éƒ¨ç«¯ç‚¹
```
âœ… /api/internal/category/search        - åœ°å€æ•°æ®
âœ… /api/internal/currency/get-rate      - æ±‡ç‡æ•°æ®
âœ… /api/internal/provider-service/get-all - æœåŠ¡å•†åˆ—è¡¨
âœ… /api/internal/hts/export             - HTSç¼–ç 
âœ… /api/internal/vtp-token/get          - æœªçŸ¥ï¼ˆéœ€æµ‹è¯•ï¼‰
âœ… /api/internal/sub-agency/get-all-payment-info - æ”¯ä»˜ä¿¡æ¯
```
**ç»“è®º**: æœ‰æ•°æ®ä½†ä¸æ˜¯å¯†é’¥

---

## ğŸš¨ å‘ç°çš„æ•æ„Ÿæ•°æ®

### 1. Business Intelligence
- âœ… å®Œæ•´è¶Šå—åœ°å€æ•°æ®åº“ï¼ˆçœ/å¸‚/åŒºï¼‰
- âœ… å®æ—¶æ±‡ç‡ï¼ˆ25600 VND/USDï¼‰
- âœ… æœåŠ¡æä¾›å•†åˆ—è¡¨ï¼ˆViettel Post, USPSç­‰ï¼‰
- âœ… HTSæµ·å…³ç¼–ç æ•°æ®åº“
- âœ… ä¸šåŠ¡æ¨¡æ¿ï¼ˆTop-up CSVï¼‰

### 2. æ¶æ„ä¿¡æ¯
- âœ… AWS ELB: logistek-lb-1356723839.us-east-1.elb.amazonaws.com
- âœ… 6ä¸ªEC2å®ä¾‹IP
- âœ… 5ä¸ªS3 Bucketåç§°
- âœ… CloudFront Distribution ID
- âœ… OpenIddictè®¤è¯ç³»ç»Ÿ
- âœ… ABP Framework (.NET)
- âœ… 184ä¸ªManagement APIç«¯ç‚¹
- âœ… 12ä¸ªCDN APIç«¯ç‚¹

### 3. ç”¨æˆ·ä¿¡æ¯ï¼ˆæœ‰é™ï¼‰
```
å½“å‰tokençš„ä¿¡æ¯ï¼š
- isAuthenticated: false
- roles: []
- grantedPolicies: {}
```
**ç»“è®º**: Client Credentials tokenæ— ç”¨æˆ·èº«ä»½

---

## ğŸ”§ ä¸ºä»€ä¹ˆæ²¡æ‰¾åˆ°æ›´å¤šå¯†é’¥ï¼Ÿ

### 1. è‰¯å¥½çš„å®‰å…¨å®è·µ âœ…
```
ViettelPosté‡‡å–äº†ä¸€äº›å®‰å…¨æªæ–½ï¼š
- å¯†é’¥ä¸å­˜å‚¨åœ¨å‰ç«¯ä»£ç 
- ä½¿ç”¨AWS Secrets Manager/Parameter Store
- ç¯å¢ƒå˜é‡é…ç½®
- æ•°æ®åº“å­˜å‚¨æ•æ„Ÿé…ç½®
```

### 2. Client Credentials Tokené™åˆ¶ âš ï¸
```
å½“å‰tokençš„é™åˆ¶ï¼š
- æ— ç”¨æˆ·èº«ä»½
- æ— è§’è‰²/æƒé™
- åªèƒ½è®¿é—®public/internal APIs
- æ— æ³•è®¿é—®adminçº§åˆ«çš„é…ç½®ç«¯ç‚¹
```

### 3. APIæƒé™æ§åˆ¶ âœ…
```
å¤§éƒ¨åˆ†æ•æ„Ÿç«¯ç‚¹éœ€è¦ï¼š
- ç”¨æˆ·çº§åˆ«è®¤è¯ï¼ˆPassword Grantï¼‰
- Adminè§’è‰²
- ç‰¹å®šæƒé™ï¼ˆgrantedPoliciesï¼‰
```

---

## ğŸ’¡ è¿›ä¸€æ­¥æœç´¢å»ºè®®

### 1. å°è¯•è·å–ç”¨æˆ·çº§åˆ«token
```
æ–¹æ³•ï¼š
- æšä¸¾ç”¨æˆ·åï¼ˆå·²å‘ç°"swagger"ç”¨æˆ·å­˜åœ¨ï¼‰
- çˆ†ç ´å¼±å¯†ç 
- SQLæ³¨å…¥ç»•è¿‡è®¤è¯
- åˆ©ç”¨IDORè·å–ç”¨æˆ·å‡­è¯
```

### 2. SSRFæ”»å‡»è·å–AWS Metadata
```
ç›®æ ‡: http://169.254.169.254/latest/meta-data/
å¯èƒ½è·å–: EC2å®ä¾‹çš„IAM Roleå‡­è¯
æ–¹æ³•: 
- /api/upload/verify-google-drive-url
- /api/upload/label-url
- /api/internal/verify-address
```

### 3. æ–‡ä»¶åŒ…å«/è¯»å–
```
å°è¯•è¯»å–:
- /etc/passwd
- ../../../appsettings.json
- ../../../.env
æ–¹æ³•: è·¯å¾„éå†ã€æ–‡ä»¶ä¸‹è½½API
```

### 4. SQLæ³¨å…¥
```
ç›®æ ‡: æ•°æ®åº“ä¸­çš„Settingsè¡¨
å¯èƒ½åŒ…å«: ConnectionStrings, API Keys
æ–¹æ³•: æµ‹è¯•searchå‚æ•°
```

### 5. XXEæ”»å‡»
```
å¦‚æœç³»ç»Ÿå¤„ç†XML:
- è¯»å–æœåŠ¡ç«¯æ–‡ä»¶
- SSRFæ”»å‡»
```

---

## ğŸ“ æ€»ç»“

### å·²è·å–çš„å‡­è¯ä»·å€¼
```
1. OAuth2 Client Credentials  - âš ï¸âš ï¸âš ï¸ HIGH
   â†’ å¯ä¸Šä¼ æ–‡ä»¶åˆ°CloudFront
   â†’ å¯è®¿é—®internal APIs
   â†’ å¯è·å–business intelligence

2. æ¶æ„ä¿¡æ¯              - âš ï¸âš ï¸ MEDIUM
   â†’ AWSèµ„æºå‘½å
   â†’ æœåŠ¡ç«¯ç‚¹
   â†’ æŠ€æœ¯æ ˆ

3. Business Data         - âš ï¸âš ï¸ MEDIUM
   â†’ åœ°å€æ•°æ®åº“
   â†’ æ±‡ç‡
   â†’ æœåŠ¡å•†åˆ—è¡¨
```

### æœªè·å–çš„å…³é”®å‡­è¯
```
âŒ AWS Access Key / Secret Key
âŒ æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
âŒ ç”¨æˆ·è´¦æˆ·å¯†ç 
âŒ Adminçº§åˆ«token
âŒ åŠ å¯†å¯†é’¥
âŒ ç¬¬ä¸‰æ–¹APIå¯†é’¥
```

### å½“å‰çªç ´ç¨‹åº¦
```
ä¿¡æ¯æ”¶é›†: 100%  âœ…
å‡­è¯è·å–: 30%   â³
æƒé™æå‡: 0%    âŒ
æ•°æ®çªƒå–: 70%   â³ (ä»…business intelligence)
```

### ä¸‹ä¸€æ­¥å»ºè®®
1. âš ï¸âš ï¸âš ï¸ æµ‹è¯•SSRFè·å–AWS Metadata
2. âš ï¸âš ï¸ å°è¯•SQLæ³¨å…¥
3. âš ï¸âš ï¸ æšä¸¾ç”¨æˆ·åå¹¶çˆ†ç ´å¯†ç 
4. âš ï¸ æµ‹è¯•æ–‡ä»¶åŒ…å«æ¼æ´
5. âš ï¸ åˆ†æJWT tokenç»“æ„å¯»æ‰¾æ¼æ´

---

**æŠ¥å‘Šæ—¶é—´**: 2025-11-11 14:50 UTC
**æœç´¢èŒƒå›´**: å‰ç«¯ä»£ç ã€APIé…ç½®ã€Swaggeræ–‡æ¡£
**å‘ç°å‡­è¯**: 1ä¸ªOAuth2 Client (å·²åˆ©ç”¨)
**æœªå‘ç°**: AWSå¯†é’¥ã€æ•°æ®åº“å¯†ç ã€ç”¨æˆ·å‡­è¯

---
