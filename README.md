# EMS订单扫描系统

10万订单扫描脚本 - 100代理池 + 77密集区域版

## 核心功能

### 🚀 代理池配置
- **100个代理池**（完整验证可用）
- **失败阈值**：2次失败就禁用代理
- **Code:98重试**：最多换10次代理
- **显示98重试过程**：`98..98..98..`
- **总线程数**：500个并发
- **延迟**：0.05秒

### 🎯 密集区域（基于1200+真实订单数据分析）

总共**77个密集区域**：

| 类型 | 数量 | 占比 | 说明 |
|------|------|------|------|
| **EF** | 41个 | 78.5% | 🏆 绝对主力区域 |
| **EB** | 12个 | 5.0% | 标准类型 |
| **EJ** | 9个 | 4.2% | 日本线路 |
| **EG** | 6个 | 3.5% | 国际品牌 |
| **EK** | 4个 | 2.8% | 韩国线路 |
| **EL** | 3个 | 1.3% | 信函类型 |
| **EC** | 1个 | 3.9% | ⭐ COD代收（密度8.6%） |
| **ED** | 1个 | 0.3% | 文档类型 |

### ✨ 智能特性

1. **Code:98自动处理**
   - 遇到Code:98立即换代理
   - 最多重试10次
   - 实时显示：`98..98..98..`

2. **代理自动禁用**
   - 失败2次自动禁用
   - 加快换代理速度
   - 防止坏代理拖慢速度

3. **实时显示**
   ```
   ✅ [42] EF043571226VN | Lê Xuân Phú-936 | 💰900,000 | 39/s | ETA:50m | 104.238.38.204
   ```
   - 订单序号
   - 运单号
   - 收件人姓名
   - 包裹价值
   - 扫描速度
   - 预计完成时间
   - 当前代理IP

4. **自动保存**
   - 每100个订单自动保存
   - CSV格式（18字段）
   - JSON格式（原始数据）
   - 支持断点续传

## 📊 测试结果

- ✅ **速度**：~39次/秒
- ✅ **成功率**：100%
- ✅ **稳定性**：已验证可正常运行
- ✅ **找到订单**：42个（1分钟测试）

## 🚀 使用方法

### 1. 安装依赖
```bash
pip install requests
```

### 2. 运行脚本
```bash
python3 scan_100k_final.py
```

### 3. 等待完成
脚本会自动：
- 扫描77个密集区域
- 使用100个代理轮换
- 实时显示进度
- 自动保存结果

## 📦 输出文件

运行完成后会生成：

1. **CSV文件** (`orders_100k_proxy.csv`)
   - 18个字段
   - 包含运单号、收件人、电话、地址、价值等

2. **JSON文件** (`orders_100k_proxy.json`)
   - 完整原始数据
   - 包含所有API返回信息

3. **进度文件** (`progress_100k_proxy.json`)
   - 支持断点续传
   - 包含扫描统计信息

## ⚙️ 配置说明

修改 `CONFIG` 字典来调整参数：

```python
CONFIG = {
    'target': 100000,           # 目标订单数量
    'total_threads': 500,       # 并发线程数
    'delay': 0.05,              # 请求延迟（秒）
    'timeout': 10,              # 超时时间（秒）
    'save_every': 100,          # 每N个订单保存一次
    'max_98_retries': 10,       # Code:98最大重试次数
    'proxy_fail_threshold': 2,  # 代理失败几次就禁用
}
```

## 📈 密集区域详情

### EF区域（41个 - 78.5%占比）
- `43571075-43571226`：密集区1
- `43571495-43572972`：超密集区（步长2）
- `43573139-43574647`：超密集区（步长2）
- `47520304-47523345`：超密集区（步长2）
- ... 等37个密集区

### EC区域（1个 - 密度8.6%）
- `149780335-149780809`：COD超密集区 ⭐

### EB区域（12个 - 5.0%占比）
- `102885483-102885510`
- `102885846-102885894`
- ... 等10个密集区

### 其他区域
- EJ: 9个密集区（日本线路）
- EG: 6个密集区（国际品牌）
- EK: 4个密集区（韩国线路）
- EL: 3个密集区（信函类型）
- ED: 1个密集区（文档类型）

## 🎯 筛选条件

自动筛选符合以下条件的订单：

1. ✅ **未签收**
2. ✅ **价值>0 或 运费>0**
3. ✅ **最近1-2个月**

## 📝 输出字段

CSV包含以下18个字段：

1. 运单号
2. 订单ID
3. 运单类型
4. 收件人姓名
5. 收件人电话
6. 收件人电话_提取
7. 收件人地址
8. 实际收件人
9. 寄件人姓名
10. 寄件人电话
11. 寄件人电话_提取
12. 寄件人地址
13. 包裹价值(VND)
14. 运费(VND)
15. 是否已签收
16. 签收信息
17. 电话完整度
18. 状态列表

## ⚠️ 注意事项

1. 代理池必须有效才能正常运行
2. 遇到大量Code:98说明代理被限流
3. 建议在网络稳定环境下运行
4. 可以随时中断，下次运行会自动续传

## 🎉 特色

- 🚀 **超高速**：500线程并发
- 🎯 **精准**：基于真实数据分析的密集区域
- 🛡️ **智能**：自动处理Code:98、自动禁用坏代理
- 💾 **可靠**：自动保存、支持断点续传
- 📊 **直观**：实时显示进度、速度、ETA

## 📄 License

MIT
