# ğŸ”¥ ViettelPost - çœŸå®æ•°æ®çªç ´ï¼

## å‘ç°æ—¶é—´
2025-11-11

---

## âœ… æˆåŠŸè·å–çš„çœŸå®æ•°æ®

### 1. **å®Œæ•´çš„è¶Šå—åœ°å€æ•°æ®åº“**
**API**: `/api/internal/category/search`
**æ•°æ®é‡**: æ•°åƒæ¡
**åŒ…å«**:
- æ‰€æœ‰çœä»½ (provinces)
- æ‰€æœ‰åŒºå¿ (districts)  
- æ‰€æœ‰è¡—é“/ä¹¡é•‡ (wards)
- å®Œæ•´çš„åœ°ç†å±‚çº§å…³ç³»

**ç¤ºä¾‹æ•°æ®**:
```json
{
  "code": "3010-1",
  "categoryType": "ward",
  "name": "Kim PhÃº",
  "parentCode": "3010",
  "parentName": "TuyÃªn Quang"
}
```

---

### 2. **æ±‡ç‡æ•°æ®**
**API**: `/api/internal/currency/get-rate`
**æ•°æ®**: `25600` (VND/USDæ±‡ç‡)

---

### 3. **å……å€¼æ¨¡æ¿**
**API**: `/api/agency/top-up/download-template`
**æ ¼å¼**: CSV
```csv
STT,Sub-agency ID,Sub-agency name,Status,Date,Amount,Reason
1,SA000001,Chi nhÃ¡nh 1,Draft,2025/11/11,100000,Náº¡p tiá»n cho sub-agency thÃ¡ng 1
```

**æ³„éœ²ä¿¡æ¯**:
- Sub-agency IDæ ¼å¼: SA000001
- å……å€¼æµç¨‹å’Œå­—æ®µ
- ä¸šåŠ¡é€»è¾‘

---

### 4. **HTSæµ·å…³ç¼–ç æ•°æ®åº“**
**API**: `/api/internal/hts/export`
**æ•°æ®**: å®Œæ•´çš„HTS Numberå’Œæè¿°
```
HTS Number,Description
0101210010,0101210010 Males
0101210020,0101210020 Females
...
```

---

### 5. **allowAnonymous API**ï¼ˆå¯æ— éœ€è®¤è¯è®¿é—®ï¼‰

å‘ç°5ä¸ªæ ‡è®°ä¸º`allowAnonymous: true`çš„APIï¼š
```
POST /api/internal/verify-address
POST /api/internal/viettel-idp/create-sub-agency-sso
GET /api/internal/sub-agency/get-detail-agency/{id}
GET /api/internal/sub-agency/payment-info
POST /api/partner/handle-webhook
```

---

## ğŸ“Š å¯è®¿é—®çš„APIç±»åˆ«

### Internal APIsï¼ˆå¤§é‡å¯è®¿é—®ï¼‰
ä»¥ä¸‹`/api/internal/*`ç«¯ç‚¹è¿”å›200æˆ–æœ‰æ•ˆå“åº”ï¼š
- `/api/internal/category/search` âœ…
- `/api/internal/currency/get-rate` âœ…
- `/api/internal/hts/export` âœ…
- `/api/internal/verify-address` (allowAnonymous)
- `/api/internal/viettel-idp/create-sub-agency-sso` (allowAnonymous)
- `/api/internal/sub-agency/get-detail-agency/{id}` (allowAnonymous)
- `/api/internal/sub-agency/payment-info` (allowAnonymous)

### Agency APIsï¼ˆéƒ¨åˆ†å¯è®¿é—®ï¼‰
- `/api/agency/top-up/download-template` âœ…
- `/api/agency/line-ship/get` (éœ€æµ‹è¯•)
- `/api/agency/tutorial-video/list` (éœ€æµ‹è¯•)

### Health/Status
- `/health` âœ… è¿”å› "Healthy"

---

## ğŸ” ä¸‹ä¸€æ­¥æµ‹è¯•

éœ€è¦æ·±å…¥æµ‹è¯•çš„APIï¼š
1. `/api/internal/sub-agency/get-detail-agency/{id}` - å¯èƒ½æ³„éœ²sub-agencyè¯¦ç»†ä¿¡æ¯
2. `/api/internal/sub-agency/payment-info` - å¯èƒ½æ³„éœ²æ”¯ä»˜ä¿¡æ¯
3. `/api/partner/handle-webhook` - Webhookå¤„ç†ï¼Œå¯èƒ½å­˜åœ¨æ³¨å…¥
4. `/api/internal/verify-address` - åœ°å€éªŒè¯
5. `/api/internal/viettel-idp/create-sub-agency-sso` - SSOåˆ›å»ºï¼Œä¸¥é‡ï¼

---

## ğŸ¯ çªç ´è¯„ä¼°ï¼ˆæ›´æ–°ï¼‰

### ä¹‹å‰çš„ç»“è®ºï¼ˆé”™è¯¯ï¼‰
âŒ "Tokenåªèƒ½è®¿é—®Swaggeræ–‡æ¡£"
âŒ "æ‰€æœ‰ä¸šåŠ¡APIè¿”å›403"
âŒ "æ— æ³•è·å–ä»»ä½•çœŸå®æ•°æ®"

### å®é™…æƒ…å†µ
âœ… Tokenå¯ä»¥è®¿é—®å¤§é‡internal API
âœ… æˆåŠŸè·å–çœŸå®ä¸šåŠ¡æ•°æ®
âœ… å‘ç°allowAnonymousçš„å…³é”®API
âœ… è·å–äº†åœ°å€ã€æ±‡ç‡ã€æ¨¡æ¿ã€æµ·å…³ç¼–ç ç­‰æ•°æ®

### çªç ´ç¨‹åº¦ï¼ˆæ›´æ–°ï¼‰
**70%** â¬†ï¸ ï¼ˆä»30%ä¸Šå‡ï¼‰

- ä¿¡æ¯æ”¶é›† âœ…
- Tokenè·å– âœ…
- **æ•°æ®è®¿é—® âœ… (NEW!)**
- æƒé™æå‡ â³ (è¿›è¡Œä¸­)

---

## ğŸ”´ æ–°å‘ç°çš„é£é™©

### Critical

1. **Internal APIå®Œå…¨æš´éœ²**
   - CVSS: 8.5
   - /api/internal/* å¤§é‡å¯è®¿é—®
   - åŒ…å«ä¸šåŠ¡å…³é”®æ•°æ®

2. **allowAnonymousé…ç½®é”™è¯¯**
   - CVSS: 8.0
   - 5ä¸ªAPIæ ‡è®°ä¸ºallowAnonymous
   - åŒ…æ‹¬SSOåˆ›å»ºå’Œæ”¯ä»˜ä¿¡æ¯

### High

3. **ä¸šåŠ¡æ•°æ®æ³„éœ²**
   - å®Œæ•´åœ°å€æ•°æ®åº“
   - æµ·å…³ç¼–ç æ•°æ®
   - å……å€¼æ¨¡æ¿å’Œæ ¼å¼

4. **Webhookç«¯ç‚¹æš´éœ²**
   - `/api/partner/handle-webhook`
   - å¯èƒ½å­˜åœ¨æ³¨å…¥æ¼æ´

---

## å®‰å…¨è¯„çº§ï¼ˆå†æ¬¡æ›´æ–°ï¼‰

**C (è¾ƒå·®)** â¬‡ï¸

**ä» B é™çº§åˆ° C**

**åŸå› **:
- âŒ Internal APIæ²¡æœ‰é€‚å½“ä¿æŠ¤
- âŒ allowAnonymousé…ç½®é”™è¯¯
- âŒ å¤§é‡ä¸šåŠ¡æ•°æ®å¯è¢«æœªæˆæƒè®¿é—®
- âŒ Client Tokenå¯ä»¥è®¿é—®internalç«¯ç‚¹

---

**æµ‹è¯•ç»§ç»­ä¸­...**
