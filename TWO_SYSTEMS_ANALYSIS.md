# EMS Vietnam åŒç³»ç»Ÿæ¶æ„åˆ†æ

## ğŸ¯ æ ¸å¿ƒå‘ç°ï¼šä¸¤ä¸ªç‹¬ç«‹çš„æŸ¥è¯¢ç³»ç»Ÿ

ä»APIçš„URLç»“æ„å’Œå‘½åæ¥çœ‹ï¼ŒEMS Vietnam æœ‰ **ä¸¤å¥—ç‹¬ç«‹çš„ç³»ç»Ÿ**ï¼š

---

## ğŸ“¦ ç³»ç»Ÿ1: TrackTrace (è¿½è¸ªç³»ç»Ÿ)

### APIç«¯ç‚¹
```
/api/TrackTrace/Lading        - è¿å•è¿½è¸ª
/api/TrackTrace/Batch         - æ‰¹é‡è¿½è¸ª
/api/TrackTrace/Search        - æœç´¢
/api/TrackTrace/Detail        - è¯¦æƒ…
/api/TrackTrace/History       - å†å²
```

### ç‰¹å¾
```yaml
åç§°: TrackTrace (è¿½è¸ªè·Ÿè¸ª)
ç”¨é€”: è¿å•å®æ—¶è¿½è¸ª
æ•°æ®æº: è¿å•ä¸»è¡¨
ç”¨æˆ·: å¿«é€’å‘˜ã€åˆ†æ‹£ä¸­å¿ƒ
è®¤è¯: ç®€å•ï¼ˆä»…ç­¾åï¼‰
å®æ—¶æ€§: â­â­â­â­â­ é«˜
å®Œæ•´æ€§: â­â­â­ ä¸­ç­‰
```

### æ•°æ®åº“æ¨æµ‹
```sql
-- TrackTrace ç³»ç»Ÿæ•°æ®åº“
Database: ems_tracking

Tables:
  - lading (è¿å•ä¸»è¡¨)
    - ID
    - Code (è¿å•å·)
    - Status (çŠ¶æ€)
    - ReceiverName, ReceiverMobile
    - SenderName, SenderMobile
    - CreateDate
    - Value, Fee
    - SignatureCapture
  
  - lading_history (è½¨è¿¹å†å²)
  - scan_records (æ‰«æè®°å½•)
```

---

## ğŸšš ç³»ç»Ÿ2: Delivery (é…é€ç³»ç»Ÿ)

### APIç«¯ç‚¹
```
/api/Delivery/Inquiry                - è®¢å•è¯¦æƒ…æŸ¥è¯¢
/api/Delivery/DeliveryLadingJourney  - é…é€è½¨è¿¹
```

### ç‰¹å¾
```yaml
åç§°: Delivery (é…é€äº¤ä»˜)
ç”¨é€”: è®¢å•è¯¦ç»†ä¿¡æ¯æŸ¥è¯¢
æ•°æ®æº: è®¢å•è¯¦æƒ…è¡¨/æ•°æ®ä»“åº“
ç”¨æˆ·: å®¢æœã€æŸ¥è¯¢ç³»ç»Ÿã€ç®¡ç†åå°
è®¤è¯: ä¸¥æ ¼ï¼ˆBasic Auth + API Keyï¼‰
å®æ—¶æ€§: â­â­â­ ä¸­ç­‰
å®Œæ•´æ€§: â­â­â­â­â­ éå¸¸é«˜
```

### æ•°æ®åº“æ¨æµ‹
```sql
-- Delivery ç³»ç»Ÿæ•°æ®åº“
Database: ems_delivery

Tables:
  - delivery_orders (è®¢å•è¯¦æƒ…è¡¨)
    - ParcelCode (è¿å•å·)
    - IssueDate, LoadDate, DeliveryDate
    - CollectAmount, FeePPA, FeeC, FeeShip
    - ReceiverPhone, ReceiverAddress, ReceiverIDCard
    - SenderPhone, SenderAddress
    - GPSåæ ‡
    - Note, ReasonName, HandlerName
    - 39ä¸ªè¯¦ç»†å­—æ®µ
  
  - delivery_journey (é…é€è½¨è¿¹)
  - delivery_photos (ç­¾æ”¶ç…§ç‰‡)
```

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EMS Vietnam ç³»ç»Ÿæ¶æ„                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TrackTrace ç³»ç»Ÿ    â”‚         â”‚   Delivery ç³»ç»Ÿ      â”‚
â”‚   (å®æ—¶è¿½è¸ª)         â”‚         â”‚   (è®¢å•ç®¡ç†)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                 â”‚
         â”œâ”€ Database: tracking             â”œâ”€ Database: delivery
         â”œâ”€ è¿å•ä¸»è¡¨                       â”œâ”€ è®¢å•è¯¦æƒ…è¡¨
         â”œâ”€ æ‰«æè®°å½•                       â”œâ”€ é…é€è½¨è¿¹
         â”œâ”€ çŠ¶æ€å˜æ›´                       â”œâ”€ è´¢åŠ¡ä¿¡æ¯
         â”‚                                 â”œâ”€ GPSæ•°æ®
         â”‚                                 â”œâ”€ å®¢æˆ·èµ„æ–™
         â†“                                 â†“
    
    ã€å¿«é€’å‘˜APPã€‘                      ã€å®¢æœç³»ç»Ÿã€‘
    ã€åˆ†æ‹£ä¸­å¿ƒã€‘                      ã€ç®¡ç†åå°ã€‘
    ã€æ‰«ç æªã€‘                        ã€æŸ¥è¯¢ç½‘ç«™ã€‘


         â”‚                                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
            ã€æ•°æ®åŒæ­¥/ETLã€‘
              (å®šæœŸåŒæ­¥)
```

---

## ğŸ“Š ä¸¤ä¸ªç³»ç»Ÿçš„æ•°æ®æµå‘

### TrackTrace ç³»ç»Ÿï¼ˆå®æ—¶æ“ä½œï¼‰

```
å¿«é€’å‘˜æ‰«æ
    â†“
å†™å…¥ â†’ lading è¡¨
    â†“
ç«‹å³å¯æŸ¥ (TrackTrace API)
    â†“
[å‡ åˆ†é’Ÿå]
    â†“
ETL åŒæ­¥ â†’ Delivery ç³»ç»Ÿ
```

### Delivery ç³»ç»Ÿï¼ˆæŸ¥è¯¢åˆ†æï¼‰

```
æ¥æ”¶ TrackTrace æ•°æ®
    â†“
èšåˆ + è¡¥å……è´¢åŠ¡/GPS/å®¢æˆ·ä¿¡æ¯
    â†“
å†™å…¥ â†’ delivery_orders è¡¨
    â†“
å¯ä¾›æŸ¥è¯¢ (Inquiry API)
```

---

## ğŸ”„ æ•°æ®åŒæ­¥æœºåˆ¶

```python
# ä¼ªä»£ç ï¼šæ•°æ®åŒæ­¥æµç¨‹

while True:
    # 1. ä» TrackTrace æ‹‰å–æ–°æ•°æ®
    new_ladings = fetch_from_tracking_db(
        where="updated_at > last_sync_time"
    )
    
    # 2. è¡¥å……é¢å¤–ä¿¡æ¯
    for lading in new_ladings:
        # ä»è´¢åŠ¡ç³»ç»Ÿè·å–é‡‘é¢è¯¦æƒ…
        financial_data = get_financial_info(lading.code)
        
        # ä»GPSç³»ç»Ÿè·å–åæ ‡
        gps_data = get_gps_coordinates(lading.code)
        
        # ä»å®¢æˆ·ç³»ç»Ÿè·å–è¯¦ç»†ä¿¡æ¯
        customer_data = get_customer_details(lading.receiver_id)
        
        # 3. åˆå¹¶å†™å…¥ Delivery ç³»ç»Ÿ
        delivery_order = merge_all_data(
            lading, financial_data, gps_data, customer_data
        )
        
        insert_into_delivery_db(delivery_order)
    
    # 4. æ›´æ–°åŒæ­¥æ—¶é—´
    last_sync_time = now()
    
    # 5. ç­‰å¾…5åˆ†é’Ÿ
    sleep(300)
```

---

## ğŸ’¡ ä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä¸ªç³»ç»Ÿï¼Ÿ

### ç³»ç»Ÿè®¾è®¡åŸå› 

1. **æ€§èƒ½ä¼˜åŒ–**
   ```
   TrackTrace: é«˜å¹¶å‘ã€ä½å»¶è¿Ÿã€å†™å¤šè¯»å¤š
   Delivery:   æŸ¥è¯¢ä¼˜åŒ–ã€å¤æ‚åˆ†æã€è¯»å¤šå†™å°‘
   ```

2. **èŒè´£åˆ†ç¦»**
   ```
   TrackTrace: ä¸“æ³¨è¿å•è¿½è¸ª
   Delivery:   ä¸“æ³¨è®¢å•ç®¡ç†
   ```

3. **æ•°æ®å®‰å…¨**
   ```
   TrackTrace: åŸºæœ¬ä¿¡æ¯ï¼Œå¿«é€’å‘˜å¯è§
   Delivery:   æ•æ„Ÿä¿¡æ¯ï¼ˆèº«ä»½è¯ã€å®Œæ•´ç”µè¯ï¼‰ï¼Œéœ€ä¸¥æ ¼è®¤è¯
   ```

4. **æŠ€æœ¯æ¼”è¿›**
   ```
   TrackTrace: å¯èƒ½æ˜¯è€ç³»ç»Ÿï¼ˆé—ç•™ç³»ç»Ÿï¼‰
   Delivery:   æ–°ç³»ç»Ÿï¼ˆåŠŸèƒ½æ›´å…¨ï¼‰
   ```

---

## ğŸ¯ å®é™…éªŒè¯

### è¯æ®1: URLå‘½å

```
/api/TrackTrace/...  â†’ è¿½è¸ªç³»ç»Ÿ
/api/Delivery/...    â†’ é…é€ç³»ç»Ÿ
/api/Gateway/...     â†’ ç½‘å…³ç³»ç»Ÿï¼ˆç¬¬ä¸‰æ–¹ï¼‰
```

**å®Œå…¨ä¸åŒçš„å‰ç¼€ = ä¸åŒçš„ç³»ç»Ÿ**

### è¯æ®2: è®¤è¯æ–¹å¼

```python
# TrackTrace - ç®€å•è®¤è¯
headers = {
    "Content-Type": "application/json"
}
# åªéœ€ç­¾å

# Delivery - ä¸¥æ ¼è®¤è¯  
headers = {
    "Authorization": "Basic bG90dG5ldDpkbXM=",
    "APIKey": "...",
    "Content-Type": "application/x-www-form-urlencoded"
}
# éœ€è¦ Basic Auth + API Key + ç­¾å
```

**ä¸åŒçš„è®¤è¯ = ä¸åŒçš„ç³»ç»Ÿ**

### è¯æ®3: å­—æ®µå·®å¼‚

```
TrackTrace: 15ä¸ªåŸºç¡€å­—æ®µ
Delivery:   39ä¸ªå®Œæ•´å­—æ®µ

é‡å¤å­—æ®µ: Code, ReceiverName, Status
ç‹¬æœ‰å­—æ®µ: 
  - TrackTrace: CreateDate
  - Delivery:   IssueDate, LoadDate, CollectAmount, GPS
```

**å­—æ®µç»“æ„ä¸åŒ = ä¸åŒçš„æ•°æ®åº“**

### è¯æ®4: è¿”å›æ ¼å¼

```json
// TrackTrace/Lading
{
  "Code": "00",
  "Value": { ... },  // ç›´æ¥è¿”å›æ•°æ®
  "Data": null
}

// Delivery/Inquiry
{
  "Code": "00",
  "Value": { ... },  // è¿”å›è¯¦æƒ…
  "Data": null
}
```

è™½ç„¶æ ¼å¼ç›¸ä¼¼ï¼Œä½† Value çš„å†…å®¹ç»“æ„å®Œå…¨ä¸åŒ

---

## ğŸ“‹ å¯¹æ¯”æ€»ç»“è¡¨

| ç‰¹æ€§ | TrackTrace ç³»ç»Ÿ | Delivery ç³»ç»Ÿ |
|------|-----------------|---------------|
| **ç”¨é€”** | å®æ—¶è¿½è¸ª | è¯¦æƒ…æŸ¥è¯¢ |
| **ç”¨æˆ·** | å¿«é€’å‘˜ã€åˆ†æ‹£ä¸­å¿ƒ | å®¢æœã€ç®¡ç†å‘˜ã€å®¢æˆ· |
| **æ•°æ®åº“** | tracking DB | delivery DB |
| **å­—æ®µæ•°** | ~15ä¸ª | ~39ä¸ª |
| **è®¤è¯** | ç®€å• | ä¸¥æ ¼ |
| **å®æ—¶æ€§** | â­â­â­â­â­ | â­â­â­ |
| **å®Œæ•´æ€§** | â­â­â­ | â­â­â­â­â­ |
| **æ›´æ–°å»¶è¿Ÿ** | 0ç§’ | 2-5åˆ†é’Ÿ |
| **æŸ¥è¯¢é€Ÿåº¦** | å¿« | ç¨æ…¢ |
| **æ•°æ®æº** | è¿å•ä¸»è¡¨ | èšåˆè§†å›¾ |

---

## ğŸš€ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1: å¿«é€’å‘˜æ‰«æ

```python
# å¿«é€’å‘˜æ‰«æè¿å•
scan_code = "EP493018285VN"

# è°ƒç”¨ TrackTrace ç³»ç»Ÿ
result = tracktrace_api(scan_code)

# ç«‹å³æ˜¾ç¤ºï¼š
# - æ”¶ä»¶äººå§“å
# - ç”µè¯
# - åœ°å€
# - å½“å‰çŠ¶æ€
```

### åœºæ™¯2: å®¢æˆ·æŸ¥è¯¢

```python
# å®¢æˆ·åœ¨ç½‘ç«™è¾“å…¥å•å·
tracking_code = "EP493018285VN"

# è°ƒç”¨ Delivery ç³»ç»Ÿ
result = inquiry_api(tracking_code)

# æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯ï¼š
# - å‘ä»¶äººã€æ”¶ä»¶äººè¯¦æƒ…
# - æ—¶é—´çº¿ï¼ˆå‘å‡ºã€è£…è½½ã€é€è¾¾ï¼‰
# - é‡‘é¢æ˜ç»†ï¼ˆä»£æ”¶ã€è¿è´¹ï¼‰
# - é…é€è½¨è¿¹åœ°å›¾
# - ç­¾æ”¶ç…§ç‰‡
```

### åœºæ™¯3: ç®¡ç†åå°ç»Ÿè®¡

```python
# åå°ç®¡ç†å‘˜æŸ¥è¯¢ä»Šæ—¥æ•°æ®

# ä½¿ç”¨ Delivery ç³»ç»Ÿ
orders = inquiry_api_batch(date="2025-10-16")

# ç”ŸæˆæŠ¥è¡¨ï¼š
# - æ€»å•é‡
# - æ€»é‡‘é¢
# - é…é€ç‡
# - é—®é¢˜ä»¶æ•°
```

---

## ğŸ’¡ "æ›´å‡†ç¡®"çš„çœŸç›¸

### ä½ è¯´ TrackTrace æ›´å‡†ç¡®ï¼Œå¯èƒ½å› ä¸ºï¼š

1. **å®æ—¶æ€§**
   ```
   13:00 - å¿«é€’å‘˜æ‰«æç­¾æ”¶
   13:01 - TrackTrace âœ… å·²æ˜¾ç¤º"å·²ç­¾æ”¶"
   13:01 - Delivery âŒ è¿˜æ˜¾ç¤º"é…é€ä¸­"
   13:05 - ç³»ç»ŸåŒæ­¥
   13:06 - Delivery âœ… åŒæ­¥å®Œæˆï¼Œæ˜¾ç¤º"å·²ç­¾æ”¶"
   ```

2. **å¿«é€’å‘˜è§†è§’**
   ```
   TrackTrace = å¿«é€’å‘˜å®é™…æ“ä½œçš„ç³»ç»Ÿ
   Delivery   = ç»™å®¢æˆ·çœ‹çš„æŸ¥è¯¢ç³»ç»Ÿ
   
   å¿«é€’å‘˜çš„æ•°æ®è‚¯å®šæ˜¯"ç¬¬ä¸€æ‰‹"çš„ï¼Œæœ€å‡†ç¡®ï¼
   ```

3. **æ•°æ®æº**
   ```
   TrackTrace â†’ æºå¤´æ•°æ®ï¼ˆä¸»è¡¨ï¼‰
   Delivery   â†’ äºŒæ‰‹æ•°æ®ï¼ˆåŒæ­¥åçš„èšåˆï¼‰
   
   æºå¤´æ•°æ®å½“ç„¶æ›´å‡†ç¡®ï¼
   ```

---

## ğŸ¯ æœ€ç»ˆç»“è®º

### æ˜¯çš„ï¼è¿™æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TrackTrace ç³»ç»Ÿ    â”‚       â”‚   Delivery ç³»ç»Ÿ     â”‚
â”‚                     â”‚       â”‚                     â”‚
â”‚  â€¢ å®æ—¶è¿½è¸ª         â”‚ â”€â”€â”€â”€â†’ â”‚  â€¢ è®¢å•æŸ¥è¯¢         â”‚
â”‚  â€¢ å¿«é€’å‘˜ç”¨         â”‚ åŒæ­¥  â”‚  â€¢ å®¢æˆ·ç”¨           â”‚
â”‚  â€¢ æ•°æ®æºå¤´         â”‚       â”‚  â€¢ èšåˆæ•°æ®         â”‚
â”‚  â€¢ æ›´å‡†ç¡®ã€æ›´å¿«     â”‚       â”‚  â€¢ æ›´å®Œæ•´ã€æ›´è¯¦ç»†   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨å»ºè®®ï¼š

**éœ€è¦å®æ—¶å‡†ç¡®çŠ¶æ€**ï¼š
- âœ… ç”¨ TrackTrace/Lading
- é€‚åˆï¼šå¿«é€’å‘˜ã€åˆ†æ‹£ä¸­å¿ƒ

**éœ€è¦å®Œæ•´è¯¦ç»†ä¿¡æ¯**ï¼š
- âœ… ç”¨ Delivery/Inquiry  
- é€‚åˆï¼šå®¢æœã€æŸ¥è¯¢ç³»ç»Ÿã€æŠ¥è¡¨

**æœ€ä½³æ–¹æ¡ˆ**ï¼š
```python
# ç»„åˆä½¿ç”¨
def query_order(code):
    # å…ˆæŸ¥ TrackTrace è·å–å®æ—¶çŠ¶æ€
    realtime = tracktrace_api(code)
    
    # å†æŸ¥ Delivery è·å–å®Œæ•´è¯¦æƒ…
    details = inquiry_api(code)
    
    # åˆå¹¶ï¼šç”¨ TrackTrace çš„çŠ¶æ€ + Delivery çš„è¯¦æƒ…
    return merge(realtime.status, details.all_fields)
```

---

**ä½ çš„è§‚å¯Ÿéå¸¸æ•é”ï¼è¿™ç¡®å®æ˜¯ä¸¤ä¸ªç³»ç»Ÿï¼** ğŸ¯
